var Qs=Object.defineProperty;var Js=(p,t,r)=>t in p?Qs(p,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[t]=r;var wi=(p,t,r)=>(Js(p,typeof t!="symbol"?t+"":t,r),r);import{s as jr,n as De,r as to,o as eo,f as no,b as io}from"../chunks/scheduler.b108d059.js";import{S as Br,i as Vr,g as Pt,s as Ht,m as fr,h as It,j as Ue,c as qt,x as pe,n as dr,f as $t,k as At,a as en,y as pt,z as Ye,A as Xt,B as fn,o as ro,e as pr,t as xi,b as so,d as Oi,p as oo,r as ao,u as co,v as lo,w as ho}from"../chunks/index.7ffdef9a.js";const Wr="14.7.77",gr=(p,t,r)=>({endTime:t,insertTime:r,type:"exponentialRampToValue",value:p}),mr=(p,t,r)=>({endTime:t,insertTime:r,type:"linearRampToValue",value:p}),ki=(p,t)=>({startTime:t,type:"setValue",value:p}),Xr=(p,t,r)=>({duration:r,startTime:t,type:"setValueCurve",values:p}),Yr=(p,t,{startTime:r,target:f,timeConstant:m})=>f+(t-f)*Math.exp((r-p)/m),Ge=p=>p.type==="exponentialRampToValue",qn=p=>p.type==="linearRampToValue",we=p=>Ge(p)||qn(p),ji=p=>p.type==="setValue",de=p=>p.type==="setValueCurve",$n=(p,t,r,f)=>{const m=p[t];return m===void 0?f:we(m)||ji(m)?m.value:de(m)?m.values[m.values.length-1]:Yr(r,$n(p,t-1,m.startTime,f),m)},_r=(p,t,r,f,m)=>r===void 0?[f.insertTime,m]:we(r)?[r.endTime,r.value]:ji(r)?[r.startTime,r.value]:de(r)?[r.startTime+r.duration,r.values[r.values.length-1]]:[r.startTime,$n(p,t-1,r.startTime,m)],Ai=p=>p.type==="cancelAndHold",Ei=p=>p.type==="cancelScheduledValues",Te=p=>Ai(p)||Ei(p)?p.cancelTime:Ge(p)||qn(p)?p.endTime:p.startTime,vr=(p,t,r,{endTime:f,value:m})=>r===m?m:0<r&&0<m||r<0&&m<0?r*(m/r)**((p-t)/(f-t)):0,yr=(p,t,r,{endTime:f,value:m})=>r+(p-t)/(f-t)*(m-r),uo=(p,t)=>{const r=Math.floor(t),f=Math.ceil(t);return r===f?p[r]:(1-(t-r))*p[r]+(1-(f-t))*p[f]},fo=(p,{duration:t,startTime:r,values:f})=>{const m=(p-r)/t*(f.length-1);return uo(f,m)},Bn=p=>p.type==="setTarget";class po{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const r=Te(t);if(Ai(t)||Ei(t)){const f=this._automationEvents.findIndex(_=>Ei(t)&&de(_)?_.startTime+_.duration>=r:Te(_)>=r),m=this._automationEvents[f];if(f!==-1&&(this._automationEvents=this._automationEvents.slice(0,f)),Ai(t)){const _=this._automationEvents[this._automationEvents.length-1];if(m!==void 0&&we(m)){if(_!==void 0&&Bn(_))throw new Error("The internal list is malformed.");const T=_===void 0?m.insertTime:de(_)?_.startTime+_.duration:Te(_),h=_===void 0?this._defaultValue:de(_)?_.values[_.values.length-1]:_.value,e=Ge(m)?vr(r,T,h,m):yr(r,T,h,m),c=Ge(m)?gr(e,r,this._currenTime):mr(e,r,this._currenTime);this._automationEvents.push(c)}if(_!==void 0&&Bn(_)&&this._automationEvents.push(ki(this.getValue(r),r)),_!==void 0&&de(_)&&_.startTime+_.duration>r){const T=r-_.startTime,h=(_.values.length-1)/_.duration,e=Math.max(2,1+Math.ceil(T*h)),c=T/(e-1)*h,l=_.values.slice(0,e);if(c<1)for(let n=1;n<e;n+=1){const s=c*n%1;l[n]=_.values[n-1]*(1-s)+_.values[n]*s}this._automationEvents[this._automationEvents.length-1]=Xr(l,_.startTime,T)}}}else{const f=this._automationEvents.findIndex(T=>Te(T)>r),m=f===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[f-1];if(m!==void 0&&de(m)&&Te(m)+m.duration>r)return!1;const _=Ge(t)?gr(t.value,t.endTime,this._currenTime):qn(t)?mr(t.value,r,this._currenTime):t;if(f===-1)this._automationEvents.push(_);else{if(de(t)&&r+t.duration>Te(this._automationEvents[f]))return!1;this._automationEvents.splice(f,0,_)}}return!0}flush(t){const r=this._automationEvents.findIndex(f=>Te(f)>t);if(r>1){const f=this._automationEvents.slice(r-1),m=f[0];Bn(m)&&f.unshift(ki($n(this._automationEvents,r-2,m.startTime,this._defaultValue),m.startTime)),this._automationEvents=f}}getValue(t){if(this._automationEvents.length===0)return this._defaultValue;const r=this._automationEvents.findIndex(T=>Te(T)>t),f=this._automationEvents[r],m=(r===-1?this._automationEvents.length:r)-1,_=this._automationEvents[m];if(_!==void 0&&Bn(_)&&(f===void 0||!we(f)||f.insertTime>t))return Yr(t,$n(this._automationEvents,m-1,_.startTime,this._defaultValue),_);if(_!==void 0&&ji(_)&&(f===void 0||!we(f)))return _.value;if(_!==void 0&&de(_)&&(f===void 0||!we(f)||_.startTime+_.duration>t))return t<_.startTime+_.duration?fo(t,_):_.values[_.values.length-1];if(_!==void 0&&we(_)&&(f===void 0||!we(f)))return _.value;if(f!==void 0&&Ge(f)){const[T,h]=_r(this._automationEvents,m,_,f,this._defaultValue);return vr(t,T,h,f)}if(f!==void 0&&qn(f)){const[T,h]=_r(this._automationEvents,m,_,f,this._defaultValue);return yr(t,T,h,f)}return this._defaultValue}}const go=p=>({cancelTime:p,type:"cancelAndHold"}),mo=p=>({cancelTime:p,type:"cancelScheduledValues"}),_o=(p,t)=>({endTime:t,type:"exponentialRampToValue",value:p}),vo=(p,t)=>({endTime:t,type:"linearRampToValue",value:p}),yo=(p,t,r)=>({startTime:t,target:p,timeConstant:r,type:"setTarget"}),Co=()=>new DOMException("","AbortError"),To=p=>(t,r,[f,m,_],T)=>{p(t[m],[r,f,_],h=>h[0]===r&&h[1]===f,T)},wo=p=>(t,r,f)=>{const m=[];for(let _=0;_<f.numberOfInputs;_+=1)m.push(new Set);p.set(t,{activeInputs:m,outputs:new Set,passiveInputs:new WeakMap,renderer:r})},So=p=>(t,r)=>{p.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:r})},Ke=new WeakSet,Ur=new WeakMap,Bi=new WeakMap,zr=new WeakMap,Vi=new WeakMap,fi=new WeakMap,Gr=new WeakMap,Di=new WeakMap,Mi=new WeakMap,Pi=new WeakMap,Hr={construct(){return Hr}},bo=p=>{try{const t=new Proxy(p,Hr);new t}catch{return!1}return!0},Cr=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Tr=(p,t)=>{const r=[];let f=p.replace(/^[\s]+/,""),m=f.match(Cr);for(;m!==null;){const _=m[1].slice(1,-1),T=m[0].replace(/([\s]+)?;?$/,"").replace(_,new URL(_,t).toString());r.push(T),f=f.slice(m[0].length).replace(/^[\s]+/,""),m=f.match(Cr)}return[r.join(";"),f]},wr=p=>{if(p!==void 0&&!Array.isArray(p))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Sr=p=>{if(!bo(p))throw new TypeError("The given value for processorCtor should be a constructor.");if(p.prototype===null||typeof p.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},xo=(p,t,r,f,m,_,T,h,e,c,l,n,s)=>{let i=0;return(a,u,o={credentials:"omit"})=>{const d=l.get(a);if(d!==void 0&&d.has(u))return Promise.resolve();const g=c.get(a);if(g!==void 0){const C=g.get(u);if(C!==void 0)return C}const v=_(a),y=v.audioWorklet===void 0?m(u).then(([C,w])=>{const[S,O]=Tr(C,w),M=`${S};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${O}
})})(window,'_AWGS')`;return r(M)}).then(()=>{const C=s._AWGS.pop();if(C===void 0)throw new SyntaxError;f(v.currentTime,v.sampleRate,()=>C(class{},void 0,(w,S)=>{if(w.trim()==="")throw t();const O=Mi.get(v);if(O!==void 0){if(O.has(w))throw t();Sr(S),wr(S.parameterDescriptors),O.set(w,S)}else Sr(S),wr(S.parameterDescriptors),Mi.set(v,new Map([[w,S]]))},v.sampleRate,void 0,void 0))}):Promise.all([m(u),Promise.resolve(p(n,n))]).then(([[C,w],S])=>{const O=i+1;i=O;const[M,I]=Tr(C,w),U=`${M};((AudioWorkletProcessor,registerProcessor)=>{${I}
})(${S?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${S?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${S?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${O}',class extends AudioWorkletProcessor{process(){return !1}})`,R=new Blob([U],{type:"application/javascript; charset=utf-8"}),V=URL.createObjectURL(R);return v.audioWorklet.addModule(V,o).then(()=>{if(h(v))return v;const $=T(v);return $.audioWorklet.addModule(V,o).then(()=>$)}).then($=>{if(e===null)throw new SyntaxError;try{new e($,`__sac${O}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(V))});return g===void 0?c.set(a,new Map([[u,y]])):g.set(u,y),y.then(()=>{const C=l.get(a);C===void 0?l.set(a,new Set([u])):C.add(u)}).finally(()=>{const C=c.get(a);C!==void 0&&C.delete(u)}),y}},ne=(p,t)=>{const r=p.get(t);if(r===void 0)throw new Error("A value with the given key could not be found.");return r},di=(p,t)=>{const r=Array.from(p).filter(t);if(r.length>1)throw Error("More than one element was found.");if(r.length===0)throw Error("No element was found.");const[f]=r;return p.delete(f),f},qr=(p,t,r,f)=>{const m=ne(p,t),_=di(m,T=>T[0]===r&&T[1]===f);return m.size===0&&p.delete(t),_},En=p=>ne(Gr,p),Ze=p=>{if(Ke.has(p))throw new Error("The AudioNode is already stored.");Ke.add(p),En(p).forEach(t=>t(!0))},$r=p=>"port"in p,Dn=p=>{if(!Ke.has(p))throw new Error("The AudioNode is not stored.");Ke.delete(p),En(p).forEach(t=>t(!1))},Ii=(p,t)=>{!$r(p)&&t.every(r=>r.size===0)&&Dn(p)},Oo=(p,t,r,f,m,_,T,h,e,c,l,n,s)=>{const i=new WeakMap;return(a,u,o,d,g)=>{const{activeInputs:v,passiveInputs:y}=_(u),{outputs:C}=_(a),w=h(a),S=O=>{const M=e(u),I=e(a);if(O){const N=qr(y,a,o,d);p(v,a,N,!1),!g&&!n(a)&&r(I,M,o,d),s(u)&&Ze(u)}else{const N=f(v,a,o,d);t(y,d,N,!1),!g&&!n(a)&&m(I,M,o,d);const L=T(u);if(L===0)l(u)&&Ii(u,v);else{const H=i.get(u);H!==void 0&&clearTimeout(H),i.set(u,setTimeout(()=>{l(u)&&Ii(u,v)},L*1e3))}}};return c(C,[u,o,d],O=>O[0]===u&&O[1]===o&&O[2]===d,!0)?(w.add(S),l(a)?p(v,a,[o,d,S],!0):t(y,d,[a,o,S],!0),!0):!1}},ko=p=>(t,r,[f,m,_],T)=>{const h=t.get(f);h===void 0?t.set(f,new Set([[m,r,_]])):p(h,[m,r,_],e=>e[0]===m&&e[1]===r,T)},Ao=p=>(t,r)=>{const f=p(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.connect(f).connect(t.destination);const m=()=>{r.removeEventListener("ended",m),r.disconnect(f),f.disconnect()};r.addEventListener("ended",m)},Eo=p=>(t,r)=>{p(t).add(r)},Do={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Mo=(p,t,r,f,m,_)=>class extends p{constructor(h,e){const c=m(h),l={...Do,...e},n=f(c,l),s=_(c)?t():null;super(h,!1,n,s),this._nativeAnalyserNode=n}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(h){this._nativeAnalyserNode.fftSize=h}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(h){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=h,!(h>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,r()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(h){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=h,!(this._nativeAnalyserNode.maxDecibels>h))throw this._nativeAnalyserNode.minDecibels=e,r()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(h){this._nativeAnalyserNode.smoothingTimeConstant=h}getByteFrequencyData(h){this._nativeAnalyserNode.getByteFrequencyData(h)}getByteTimeDomainData(h){this._nativeAnalyserNode.getByteTimeDomainData(h)}getFloatFrequencyData(h){this._nativeAnalyserNode.getFloatFrequencyData(h)}getFloatTimeDomainData(h){this._nativeAnalyserNode.getFloatTimeDomainData(h)}},Nt=(p,t)=>p.context===t,Po=(p,t,r)=>()=>{const f=new WeakMap,m=async(_,T)=>{let h=t(_);if(!Nt(h,T)){const c={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,fftSize:h.fftSize,maxDecibels:h.maxDecibels,minDecibels:h.minDecibels,smoothingTimeConstant:h.smoothingTimeConstant};h=p(T,c)}return f.set(T,h),await r(_,T,h),h};return{render(_,T){const h=f.get(T);return h!==void 0?Promise.resolve(h):m(_,T)}}},Kn=p=>{try{p.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},le=()=>new DOMException("","IndexSizeError"),Wi=p=>{p.getChannelData=(t=>r=>{try{return t.call(p,r)}catch(f){throw f.code===12?le():f}})(p.getChannelData)},Io={numberOfChannels:1},Fo=(p,t,r,f,m,_,T,h)=>{let e=null;return class Kr{constructor(l){if(m===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:n,numberOfChannels:s,sampleRate:i}={...Io,...l};e===null&&(e=new m(1,1,44100));const a=f!==null&&t(_,_)?new f({length:n,numberOfChannels:s,sampleRate:i}):e.createBuffer(s,n,i);if(a.numberOfChannels===0)throw r();return typeof a.copyFromChannel!="function"?(T(a),Wi(a)):t(Kn,()=>Kn(a))||h(a),p.add(a),a}static[Symbol.hasInstance](l){return l!==null&&typeof l=="object"&&Object.getPrototypeOf(l)===Kr.prototype||p.has(l)}}},Yt=-34028234663852886e22,jt=-Yt,me=p=>Ke.has(p),Ro={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},No=(p,t,r,f,m,_,T,h)=>class extends p{constructor(c,l){const n=_(c),s={...Ro,...l},i=m(n,s),a=T(n),u=a?t():null;super(c,!1,i,u),this._audioBufferSourceNodeRenderer=u,this._isBufferNullified=!1,this._isBufferSet=s.buffer!==null,this._nativeAudioBufferSourceNode=i,this._onended=null,this._playbackRate=r(this,a,i.playbackRate,jt,Yt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(c){if(this._nativeAudioBufferSourceNode.buffer=c,c!==null){if(this._isBufferSet)throw f();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(c){this._nativeAudioBufferSourceNode.loop=c}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(c){this._nativeAudioBufferSourceNode.loopEnd=c}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(c){this._nativeAudioBufferSourceNode.loopStart=c}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?h(this,c):null;this._nativeAudioBufferSourceNode.onended=l;const n=this._nativeAudioBufferSourceNode.onended;this._onended=n!==null&&n===l?c:n}get playbackRate(){return this._playbackRate}start(c=0,l=0,n){if(this._nativeAudioBufferSourceNode.start(c,l,n),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=n===void 0?[c,l]:[c,l,n]),this.context.state!=="closed"){Ze(this);const s=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",s),me(this)&&Dn(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",s)}}stop(c=0){this._nativeAudioBufferSourceNode.stop(c),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=c)}},Lo=(p,t,r,f,m)=>()=>{const _=new WeakMap;let T=null,h=null;const e=async(c,l)=>{let n=r(c);const s=Nt(n,l);if(!s){const i={buffer:n.buffer,channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation,loop:n.loop,loopEnd:n.loopEnd,loopStart:n.loopStart,playbackRate:n.playbackRate.value};n=t(l,i),T!==null&&n.start(...T),h!==null&&n.stop(h)}return _.set(l,n),s?await p(l,c.playbackRate,n.playbackRate):await f(l,c.playbackRate,n.playbackRate),await m(c,l,n),n};return{set start(c){T=c},set stop(c){h=c},render(c,l){const n=_.get(l);return n!==void 0?Promise.resolve(n):e(c,l)}}},jo=p=>"playbackRate"in p,Bo=p=>"frequency"in p&&"gain"in p,Vo=p=>"offset"in p,Wo=p=>!("frequency"in p)&&"gain"in p,Xo=p=>"detune"in p&&"frequency"in p,Yo=p=>"pan"in p,Bt=p=>ne(Ur,p),Mn=p=>ne(zr,p),Fi=(p,t)=>{const{activeInputs:r}=Bt(p);r.forEach(m=>m.forEach(([_])=>{t.includes(p)||Fi(_,[...t,p])}));const f=jo(p)?[p.playbackRate]:$r(p)?Array.from(p.parameters.values()):Bo(p)?[p.Q,p.detune,p.frequency,p.gain]:Vo(p)?[p.offset]:Wo(p)?[p.gain]:Xo(p)?[p.detune,p.frequency]:Yo(p)?[p.pan]:[];for(const m of f){const _=Mn(m);_!==void 0&&_.activeInputs.forEach(([T])=>Fi(T,t))}me(p)&&Dn(p)},Zr=p=>{Fi(p.destination,[])},Uo=p=>p===void 0||typeof p=="number"||typeof p=="string"&&(p==="balanced"||p==="interactive"||p==="playback"),zo=(p,t,r,f,m,_,T,h,e)=>class extends p{constructor(l={}){if(e===null)throw new Error("Missing the native AudioContext constructor.");let n;try{n=new e(l)}catch(a){throw a.code===12&&a.message==="sampleRate is not in range"?r():a}if(n===null)throw f();if(!Uo(l.latencyHint))throw new TypeError(`The provided value '${l.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(l.sampleRate!==void 0&&n.sampleRate!==l.sampleRate)throw r();super(n,2);const{latencyHint:s}=l,{sampleRate:i}=n;if(this._baseLatency=typeof n.baseLatency=="number"?n.baseLatency:s==="balanced"?512/i:s==="interactive"||s===void 0?256/i:s==="playback"?1024/i:Math.max(2,Math.min(128,Math.round(s*i/128)))*128/i,this._nativeAudioContext=n,e.name==="webkitAudioContext"?(this._nativeGainNode=n.createGain(),this._nativeOscillatorNode=n.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(n.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,n.state==="running"){this._state="suspended";const a=()=>{this._state==="suspended"&&(this._state=null),n.removeEventListener("statechange",a)};n.addEventListener("statechange",a)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Zr(this)}))}createMediaElementSource(l){return new m(this,{mediaElement:l})}createMediaStreamDestination(){return new _(this)}createMediaStreamSource(l){return new T(this,{mediaStream:l})}createMediaStreamTrackSource(l){return new h(this,{mediaStreamTrack:l})}resume(){return this._state==="suspended"?new Promise((l,n)=>{const s=()=>{this._nativeAudioContext.removeEventListener("statechange",s),this._nativeAudioContext.state==="running"?l():this.resume().then(l,n)};this._nativeAudioContext.addEventListener("statechange",s)}):this._nativeAudioContext.resume().catch(l=>{throw l===void 0||l.code===15?t():l})}suspend(){return this._nativeAudioContext.suspend().catch(l=>{throw l===void 0?t():l})}},Go=(p,t,r,f,m,_,T,h)=>class extends p{constructor(c,l){const n=_(c),s=T(n),i=m(n,l,s),a=s?t(h):null;super(c,!1,i,a),this._isNodeOfNativeOfflineAudioContext=s,this._nativeAudioDestinationNode=i}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(c){if(this._isNodeOfNativeOfflineAudioContext)throw f();if(c>this._nativeAudioDestinationNode.maxChannelCount)throw r();this._nativeAudioDestinationNode.channelCount=c}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(c){if(this._isNodeOfNativeOfflineAudioContext)throw f();this._nativeAudioDestinationNode.channelCountMode=c}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Ho=p=>{const t=new WeakMap,r=async(f,m)=>{const _=m.destination;return t.set(m,_),await p(f,m,_),_};return{render(f,m){const _=t.get(m);return _!==void 0?Promise.resolve(_):r(f,m)}}},qo=(p,t,r,f,m,_,T,h)=>(e,c)=>{const l=c.listener,n=()=>{const C=new Float32Array(1),w=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),S=T(c);let O=!1,M=[0,0,-1,0,1,0],I=[0,0,0];const N=()=>{if(O)return;O=!0;const R=f(c,256,9,0);R.onaudioprocess=({inputBuffer:V})=>{const $=[_(V,C,0),_(V,C,1),_(V,C,2),_(V,C,3),_(V,C,4),_(V,C,5)];$.some((b,E)=>b!==M[E])&&(l.setOrientation(...$),M=$);const J=[_(V,C,6),_(V,C,7),_(V,C,8)];J.some((b,E)=>b!==I[E])&&(l.setPosition(...J),I=J)},w.connect(R)},L=R=>V=>{V!==M[R]&&(M[R]=V,l.setOrientation(...M))},H=R=>V=>{V!==I[R]&&(I[R]=V,l.setPosition(...I))},U=(R,V,$)=>{const J=r(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:V});J.connect(w,0,R),J.start(),Object.defineProperty(J.offset,"defaultValue",{get(){return V}});const b=p({context:e},S,J.offset,jt,Yt);return h(b,"value",E=>()=>E.call(b),E=>A=>{try{E.call(b,A)}catch(D){if(D.code!==9)throw D}N(),S&&$(A)}),b.cancelAndHoldAtTime=(E=>S?()=>{throw m()}:(...A)=>{const D=E.apply(b,A);return N(),D})(b.cancelAndHoldAtTime),b.cancelScheduledValues=(E=>S?()=>{throw m()}:(...A)=>{const D=E.apply(b,A);return N(),D})(b.cancelScheduledValues),b.exponentialRampToValueAtTime=(E=>S?()=>{throw m()}:(...A)=>{const D=E.apply(b,A);return N(),D})(b.exponentialRampToValueAtTime),b.linearRampToValueAtTime=(E=>S?()=>{throw m()}:(...A)=>{const D=E.apply(b,A);return N(),D})(b.linearRampToValueAtTime),b.setTargetAtTime=(E=>S?()=>{throw m()}:(...A)=>{const D=E.apply(b,A);return N(),D})(b.setTargetAtTime),b.setValueAtTime=(E=>S?()=>{throw m()}:(...A)=>{const D=E.apply(b,A);return N(),D})(b.setValueAtTime),b.setValueCurveAtTime=(E=>S?()=>{throw m()}:(...A)=>{const D=E.apply(b,A);return N(),D})(b.setValueCurveAtTime),b};return{forwardX:U(0,0,L(0)),forwardY:U(1,0,L(1)),forwardZ:U(2,-1,L(2)),positionX:U(6,0,H(0)),positionY:U(7,0,H(1)),positionZ:U(8,0,H(2)),upX:U(3,0,L(3)),upY:U(4,1,L(4)),upZ:U(5,0,L(5))}},{forwardX:s,forwardY:i,forwardZ:a,positionX:u,positionY:o,positionZ:d,upX:g,upY:v,upZ:y}=l.forwardX===void 0?n():l;return{get forwardX(){return s},get forwardY(){return i},get forwardZ(){return a},get positionX(){return u},get positionY(){return o},get positionZ(){return d},get upX(){return g},get upY(){return v},get upZ(){return y}}},Zn=p=>"context"in p,Pn=p=>Zn(p[0]),Ve=(p,t,r,f)=>{for(const m of p)if(r(m)){if(f)return!1;throw Error("The set contains at least one similar element.")}return p.add(t),!0},br=(p,t,[r,f],m)=>{Ve(p,[t,r,f],_=>_[0]===t&&_[1]===r,m)},xr=(p,[t,r,f],m)=>{const _=p.get(t);_===void 0?p.set(t,new Set([[r,f]])):Ve(_,[r,f],T=>T[0]===r,m)},nn=p=>"inputs"in p,Qn=(p,t,r,f)=>{if(nn(t)){const m=t.inputs[f];return p.connect(m,r,0),[m,r,0]}return p.connect(t,r,f),[t,r,f]},Qr=(p,t,r)=>{for(const f of p)if(f[0]===t&&f[1]===r)return p.delete(f),f;return null},$o=(p,t,r)=>di(p,f=>f[0]===t&&f[1]===r),Jr=(p,t)=>{if(!En(p).delete(t))throw new Error("Missing the expected event listener.")},ts=(p,t,r)=>{const f=ne(p,t),m=di(f,_=>_[0]===r);return f.size===0&&p.delete(t),m},Jn=(p,t,r,f)=>{nn(t)?p.disconnect(t.inputs[f],r,0):p.disconnect(t,r,f)},yt=p=>ne(Bi,p),pn=p=>ne(Vi,p),Ie=p=>Di.has(p),zn=p=>!Ke.has(p),Or=(p,t)=>new Promise(r=>{if(t!==null)r(!0);else{const f=p.createScriptProcessor(256,1,1),m=p.createGain(),_=p.createBuffer(1,2,44100),T=_.getChannelData(0);T[0]=1,T[1]=1;const h=p.createBufferSource();h.buffer=_,h.loop=!0,h.connect(f).connect(p.destination),h.connect(m),h.disconnect(m),f.onaudioprocess=e=>{const c=e.inputBuffer.getChannelData(0);Array.prototype.some.call(c,l=>l===1)?r(!0):r(!1),h.stop(),f.onaudioprocess=null,h.disconnect(f),f.disconnect(p.destination)},h.start()}}),Si=(p,t)=>{const r=new Map;for(const f of p)for(const m of f){const _=r.get(m);r.set(m,_===void 0?1:_+1)}r.forEach((f,m)=>t(m,f))},ti=p=>"context"in p,Ko=p=>{const t=new Map;p.connect=(r=>(f,m=0,_=0)=>{const T=ti(f)?r(f,m,_):r(f,m),h=t.get(f);return h===void 0?t.set(f,[{input:_,output:m}]):h.every(e=>e.input!==_||e.output!==m)&&h.push({input:_,output:m}),T})(p.connect.bind(p)),p.disconnect=(r=>(f,m,_)=>{if(r.apply(p),f===void 0)t.clear();else if(typeof f=="number")for(const[T,h]of t){const e=h.filter(c=>c.output!==f);e.length===0?t.delete(T):t.set(T,e)}else if(t.has(f))if(m===void 0)t.delete(f);else{const T=t.get(f);if(T!==void 0){const h=T.filter(e=>e.output!==m&&(e.input!==_||_===void 0));h.length===0?t.delete(f):t.set(f,h)}}for(const[T,h]of t)h.forEach(e=>{ti(T)?p.connect(T,e.output,e.input):p.connect(T,e.output)})})(p.disconnect)},Zo=(p,t,r,f)=>{const{activeInputs:m,passiveInputs:_}=Mn(t),{outputs:T}=Bt(p),h=En(p),e=c=>{const l=yt(p),n=pn(t);if(c){const s=ts(_,p,r);br(m,p,s,!1),!f&&!Ie(p)&&l.connect(n,r)}else{const s=$o(m,p,r);xr(_,s,!1),!f&&!Ie(p)&&l.disconnect(n,r)}};return Ve(T,[t,r],c=>c[0]===t&&c[1]===r,!0)?(h.add(e),me(p)?br(m,p,[r,e],!0):xr(_,[p,r,e],!0),!0):!1},Qo=(p,t,r,f)=>{const{activeInputs:m,passiveInputs:_}=Bt(t),T=Qr(m[f],p,r);return T===null?[qr(_,p,r,f)[2],!1]:[T[2],!0]},Jo=(p,t,r)=>{const{activeInputs:f,passiveInputs:m}=Mn(t),_=Qr(f,p,r);return _===null?[ts(m,p,r)[1],!1]:[_[2],!0]},Xi=(p,t,r,f,m)=>{const[_,T]=Qo(p,r,f,m);if(_!==null&&(Jr(p,_),T&&!t&&!Ie(p)&&Jn(yt(p),yt(r),f,m)),me(r)){const{activeInputs:h}=Bt(r);Ii(r,h)}},Yi=(p,t,r,f)=>{const[m,_]=Jo(p,r,f);m!==null&&(Jr(p,m),_&&!t&&!Ie(p)&&yt(p).disconnect(pn(r),f))},ta=(p,t)=>{const r=Bt(p),f=[];for(const m of r.outputs)Pn(m)?Xi(p,t,...m):Yi(p,t,...m),f.push(m[0]);return r.outputs.clear(),f},ea=(p,t,r)=>{const f=Bt(p),m=[];for(const _ of f.outputs)_[1]===r&&(Pn(_)?Xi(p,t,..._):Yi(p,t,..._),m.push(_[0]),f.outputs.delete(_));return m},na=(p,t,r,f,m)=>{const _=Bt(p);return Array.from(_.outputs).filter(T=>T[0]===r&&(f===void 0||T[1]===f)&&(m===void 0||T[2]===m)).map(T=>(Pn(T)?Xi(p,t,...T):Yi(p,t,...T),_.outputs.delete(T),T[0]))},ia=(p,t,r,f,m,_,T,h,e,c,l,n,s,i,a,u)=>class extends c{constructor(d,g,v,y){super(v),this._context=d,this._nativeAudioNode=v;const C=l(d);n(C)&&r(Or,()=>Or(C,u))!==!0&&Ko(v),Bi.set(this,v),Gr.set(this,new Set),d.state!=="closed"&&g&&Ze(this),p(this,y,v)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(d){this._nativeAudioNode.channelCount=d}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(d){this._nativeAudioNode.channelCountMode=d}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(d){this._nativeAudioNode.channelInterpretation=d}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(d,g=0,v=0){if(g<0||g>=this._nativeAudioNode.numberOfOutputs)throw m();const y=l(this._context),C=a(y);if(s(d)||i(d))throw _();if(Zn(d)){const O=yt(d);try{const I=Qn(this._nativeAudioNode,O,g,v),N=zn(this);(C||N)&&this._nativeAudioNode.disconnect(...I),this.context.state!=="closed"&&!N&&zn(d)&&Ze(d)}catch(I){throw I.code===12?_():I}if(t(this,d,g,v,C)){const I=e([this],d);Si(I,f(C))}return d}const w=pn(d);if(w.name==="playbackRate"&&w.maxValue===1024)throw T();try{this._nativeAudioNode.connect(w,g),(C||zn(this))&&this._nativeAudioNode.disconnect(w,g)}catch(O){throw O.code===12?_():O}if(Zo(this,d,g,C)){const O=e([this],d);Si(O,f(C))}}disconnect(d,g,v){let y;const C=l(this._context),w=a(C);if(d===void 0)y=ta(this,w);else if(typeof d=="number"){if(d<0||d>=this.numberOfOutputs)throw m();y=ea(this,w,d)}else{if(g!==void 0&&(g<0||g>=this.numberOfOutputs)||Zn(d)&&v!==void 0&&(v<0||v>=d.numberOfInputs))throw m();if(y=na(this,w,d,g,v),y.length===0)throw _()}for(const S of y){const O=e([this],S);Si(O,h)}}},ra=(p,t,r,f,m,_,T,h,e,c,l,n,s)=>(i,a,u,o=null,d=null)=>{const g=u.value,v=new po(g),y=a?f(v):null,C={get defaultValue(){return g},get maxValue(){return o===null?u.maxValue:o},get minValue(){return d===null?u.minValue:d},get value(){return u.value},set value(w){u.value=w,C.setValueAtTime(w,i.context.currentTime)},cancelAndHoldAtTime(w){if(typeof u.cancelAndHoldAtTime=="function")y===null&&v.flush(i.context.currentTime),v.add(m(w)),u.cancelAndHoldAtTime(w);else{const S=Array.from(v).pop();y===null&&v.flush(i.context.currentTime),v.add(m(w));const O=Array.from(v).pop();u.cancelScheduledValues(w),S!==O&&O!==void 0&&(O.type==="exponentialRampToValue"?u.exponentialRampToValueAtTime(O.value,O.endTime):O.type==="linearRampToValue"?u.linearRampToValueAtTime(O.value,O.endTime):O.type==="setValue"?u.setValueAtTime(O.value,O.startTime):O.type==="setValueCurve"&&u.setValueCurveAtTime(O.values,O.startTime,O.duration))}return C},cancelScheduledValues(w){return y===null&&v.flush(i.context.currentTime),v.add(_(w)),u.cancelScheduledValues(w),C},exponentialRampToValueAtTime(w,S){if(w===0)throw new RangeError;if(!Number.isFinite(S)||S<0)throw new RangeError;const O=i.context.currentTime;return y===null&&v.flush(O),Array.from(v).length===0&&(v.add(c(g,O)),u.setValueAtTime(g,O)),v.add(T(w,S)),u.exponentialRampToValueAtTime(w,S),C},linearRampToValueAtTime(w,S){const O=i.context.currentTime;return y===null&&v.flush(O),Array.from(v).length===0&&(v.add(c(g,O)),u.setValueAtTime(g,O)),v.add(h(w,S)),u.linearRampToValueAtTime(w,S),C},setTargetAtTime(w,S,O){return y===null&&v.flush(i.context.currentTime),v.add(e(w,S,O)),u.setTargetAtTime(w,S,O),C},setValueAtTime(w,S){return y===null&&v.flush(i.context.currentTime),v.add(c(w,S)),u.setValueAtTime(w,S),C},setValueCurveAtTime(w,S,O){const M=w instanceof Float32Array?w:new Float32Array(w);if(n!==null&&n.name==="webkitAudioContext"){const I=S+O,N=i.context.sampleRate,L=Math.ceil(S*N),H=Math.floor(I*N),U=H-L,R=new Float32Array(U);for(let $=0;$<U;$+=1){const J=(M.length-1)/O*((L+$)/N-S),b=Math.floor(J),E=Math.ceil(J);R[$]=b===E?M[b]:(1-(J-b))*M[b]+(1-(E-J))*M[E]}y===null&&v.flush(i.context.currentTime),v.add(l(R,S,O)),u.setValueCurveAtTime(R,S,O);const V=H/N;V<I&&s(C,R[R.length-1],V),s(C,M[M.length-1],I)}else y===null&&v.flush(i.context.currentTime),v.add(l(M,S,O)),u.setValueCurveAtTime(M,S,O);return C}};return r.set(C,u),t.set(C,i),p(C,y),C},sa=p=>({replay(t){for(const r of p)if(r.type==="exponentialRampToValue"){const{endTime:f,value:m}=r;t.exponentialRampToValueAtTime(m,f)}else if(r.type==="linearRampToValue"){const{endTime:f,value:m}=r;t.linearRampToValueAtTime(m,f)}else if(r.type==="setTarget"){const{startTime:f,target:m,timeConstant:_}=r;t.setTargetAtTime(m,f,_)}else if(r.type==="setValue"){const{startTime:f,value:m}=r;t.setValueAtTime(m,f)}else if(r.type==="setValueCurve"){const{duration:f,startTime:m,values:_}=r;t.setValueCurveAtTime(_,m,f)}else throw new Error("Can't apply an unknown automation.")}});class es{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,r=null){return this._map.forEach((f,m)=>t.call(r,f,m,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const oa={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},aa=(p,t,r,f,m,_,T,h,e,c,l,n,s,i)=>class extends t{constructor(u,o,d){var g;const v=h(u),y=e(v),C=l({...oa,...d});s(C);const w=Mi.get(v),S=w==null?void 0:w.get(o),O=y||v.state!=="closed"?v:(g=T(v))!==null&&g!==void 0?g:v,M=m(O,y?null:u.baseLatency,c,o,S,C),I=y?f(o,C,S):null;super(u,!0,M,I);const N=[];M.parameters.forEach((H,U)=>{const R=r(this,y,H);N.push([U,R])}),this._nativeAudioWorkletNode=M,this._onprocessorerror=null,this._parameters=new es(N),y&&p(v,this);const{activeInputs:L}=_(this);n(M,L)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(u){const o=typeof u=="function"?i(this,u):null;this._nativeAudioWorkletNode.onprocessorerror=o;const d=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=d!==null&&d===o?u:d}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function ei(p,t,r,f,m){if(typeof p.copyFromChannel=="function")t[r].byteLength===0&&(t[r]=new Float32Array(128)),p.copyFromChannel(t[r],f,m);else{const _=p.getChannelData(f);if(t[r].byteLength===0)t[r]=_.slice(m,m+128);else{const T=new Float32Array(_.buffer,m*Float32Array.BYTES_PER_ELEMENT,128);t[r].set(T)}}}const ns=(p,t,r,f,m)=>{typeof p.copyToChannel=="function"?t[r].byteLength!==0&&p.copyToChannel(t[r],f,m):t[r].byteLength!==0&&p.getChannelData(f).set(t[r],m)},ni=(p,t)=>{const r=[];for(let f=0;f<p;f+=1){const m=[],_=typeof t=="number"?t:t[f];for(let T=0;T<_;T+=1)m.push(new Float32Array(128));r.push(m)}return r},ca=(p,t)=>{const r=ne(Pi,p),f=yt(t);return ne(r,f)},la=async(p,t,r,f,m,_,T)=>{const h=t===null?Math.ceil(p.context.length/128)*128:t.length,e=f.channelCount*f.numberOfInputs,c=m.reduce((o,d)=>o+d,0),l=c===0?null:r.createBuffer(c,h,r.sampleRate);if(_===void 0)throw new Error("Missing the processor constructor.");const n=Bt(p),s=await ca(r,p),i=ni(f.numberOfInputs,f.channelCount),a=ni(f.numberOfOutputs,m),u=Array.from(p.parameters.keys()).reduce((o,d)=>({...o,[d]:new Float32Array(128)}),{});for(let o=0;o<h;o+=128){if(f.numberOfInputs>0&&t!==null)for(let d=0;d<f.numberOfInputs;d+=1)for(let g=0;g<f.channelCount;g+=1)ei(t,i[d],g,g,o);_.parameterDescriptors!==void 0&&t!==null&&_.parameterDescriptors.forEach(({name:d},g)=>{ei(t,u,d,e+g,o)});for(let d=0;d<f.numberOfInputs;d+=1)for(let g=0;g<m[d];g+=1)a[d][g].byteLength===0&&(a[d][g]=new Float32Array(128));try{const d=i.map((v,y)=>n.activeInputs[y].size===0?[]:v),g=T(o/r.sampleRate,r.sampleRate,()=>s.process(d,a,u));if(l!==null)for(let v=0,y=0;v<f.numberOfOutputs;v+=1){for(let C=0;C<m[v];C+=1)ns(l,a[v],C,y+C,o);y+=m[v]}if(!g)break}catch(d){p.dispatchEvent(new ErrorEvent("processorerror",{colno:d.colno,filename:d.filename,lineno:d.lineno,message:d.message}));break}}return l},ha=(p,t,r,f,m,_,T,h,e,c,l,n,s,i,a,u)=>(o,d,g)=>{const v=new WeakMap;let y=null;const C=async(w,S)=>{let O=l(w),M=null;const I=Nt(O,S),N=Array.isArray(d.outputChannelCount)?d.outputChannelCount:Array.from(d.outputChannelCount);if(n===null){const L=N.reduce((V,$)=>V+$,0),H=m(S,{channelCount:Math.max(1,L),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,L)}),U=[];for(let V=0;V<w.numberOfOutputs;V+=1)U.push(f(S,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:N[V]}));const R=T(S,{channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,gain:1});R.connect=t.bind(null,U),R.disconnect=e.bind(null,U),M=[H,U,R]}else I||(O=new n(S,o));if(v.set(S,M===null?O:M[2]),M!==null){if(y===null){if(g===void 0)throw new Error("Missing the processor constructor.");if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");const $=w.channelCount*w.numberOfInputs,J=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length,b=$+J;y=la(w,b===0?null:await(async()=>{const A=new s(b,Math.ceil(w.context.length/128)*128,S.sampleRate),D=[],W=[];for(let P=0;P<d.numberOfInputs;P+=1)D.push(T(A,{channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,gain:1})),W.push(m(A,{channelCount:d.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:d.channelCount}));const k=await Promise.all(Array.from(w.parameters.values()).map(async P=>{const F=_(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:P.value});return await i(A,P,F.offset),F})),x=f(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,$+J)});for(let P=0;P<d.numberOfInputs;P+=1){D[P].connect(W[P]);for(let F=0;F<d.channelCount;F+=1)W[P].connect(x,F,P*d.channelCount+F)}for(const[P,F]of k.entries())F.connect(x,0,$+P),F.start(0);return x.connect(A.destination),await Promise.all(D.map(P=>a(w,A,P))),u(A)})(),S,d,N,g,c)}const L=await y,H=r(S,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[U,R,V]=M;L!==null&&(H.buffer=L,H.start(0)),H.connect(U);for(let $=0,J=0;$<w.numberOfOutputs;$+=1){const b=R[$];for(let E=0;E<N[$];E+=1)U.connect(b,J+E,E);J+=N[$]}return V}if(I)for(const[L,H]of w.parameters.entries())await p(S,H,O.parameters.get(L));else for(const[L,H]of w.parameters.entries())await i(S,H,O.parameters.get(L));return await a(w,S,O),O};return{render(w,S){h(S,w);const O=v.get(S);return O!==void 0?Promise.resolve(O):C(w,S)}}},ua=(p,t,r,f,m,_,T,h,e,c,l,n,s,i,a,u,o,d,g,v)=>class extends a{constructor(C,w){super(C,w),this._nativeContext=C,this._audioWorklet=p===void 0?void 0:{addModule:(S,O)=>p(this,S,O)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new m(this)}createBuffer(C,w,S){return new r({length:w,numberOfChannels:C,sampleRate:S})}createBufferSource(){return new f(this)}createChannelMerger(C=6){return new _(this,{numberOfInputs:C})}createChannelSplitter(C=6){return new T(this,{numberOfOutputs:C})}createConstantSource(){return new h(this)}createConvolver(){return new e(this)}createDelay(C=1){return new l(this,{maxDelayTime:C})}createDynamicsCompressor(){return new n(this)}createGain(){return new s(this)}createIIRFilter(C,w){return new i(this,{feedback:w,feedforward:C})}createOscillator(){return new u(this)}createPanner(){return new o(this)}createPeriodicWave(C,w,S={disableNormalization:!1}){return new d(this,{...S,imag:w,real:C})}createStereoPanner(){return new g(this)}createWaveShaper(){return new v(this)}decodeAudioData(C,w,S){return c(this._nativeContext,C).then(O=>(typeof w=="function"&&w(O),O),O=>{throw typeof S=="function"&&S(O),O})}},fa={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},da=(p,t,r,f,m,_,T,h)=>class extends p{constructor(c,l){const n=_(c),s={...fa,...l},i=m(n,s),a=T(n),u=a?r():null;super(c,!1,i,u),this._Q=t(this,a,i.Q,jt,Yt),this._detune=t(this,a,i.detune,1200*Math.log2(jt),-1200*Math.log2(jt)),this._frequency=t(this,a,i.frequency,c.sampleRate/2,0),this._gain=t(this,a,i.gain,40*Math.log10(jt),Yt),this._nativeBiquadFilterNode=i,h(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(c){this._nativeBiquadFilterNode.type=c}getFrequencyResponse(c,l,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(c,l,n)}catch(s){throw s.code===11?f():s}if(c.length!==l.length||l.length!==n.length)throw f()}},pa=(p,t,r,f,m)=>()=>{const _=new WeakMap,T=async(h,e)=>{let c=r(h);const l=Nt(c,e);if(!l){const n={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=t(e,n)}return _.set(e,c),l?(await p(e,h.Q,c.Q),await p(e,h.detune,c.detune),await p(e,h.frequency,c.frequency),await p(e,h.gain,c.gain)):(await f(e,h.Q,c.Q),await f(e,h.detune,c.detune),await f(e,h.frequency,c.frequency),await f(e,h.gain,c.gain)),await m(h,e,c),c};return{render(h,e){const c=_.get(e);return c!==void 0?Promise.resolve(c):T(h,e)}}},ga=(p,t)=>(r,f)=>{const m=t.get(r);if(m!==void 0)return m;const _=p.get(r);if(_!==void 0)return _;try{const T=f();return T instanceof Promise?(p.set(r,T),T.catch(()=>!1).then(h=>(p.delete(r),t.set(r,h),h))):(t.set(r,T),T)}catch{return t.set(r,!1),!1}},ma={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},_a=(p,t,r,f,m)=>class extends p{constructor(T,h){const e=f(T),c={...ma,...h},l=r(e,c),n=m(e)?t():null;super(T,!1,l,n)}},va=(p,t,r)=>()=>{const f=new WeakMap,m=async(_,T)=>{let h=t(_);if(!Nt(h,T)){const c={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,numberOfInputs:h.numberOfInputs};h=p(T,c)}return f.set(T,h),await r(_,T,h),h};return{render(_,T){const h=f.get(T);return h!==void 0?Promise.resolve(h):m(_,T)}}},ya={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Ca=(p,t,r,f,m,_)=>class extends p{constructor(h,e){const c=f(h),l=_({...ya,...e}),n=r(c,l),s=m(c)?t():null;super(h,!1,n,s)}},Ta=(p,t,r)=>()=>{const f=new WeakMap,m=async(_,T)=>{let h=t(_);if(!Nt(h,T)){const c={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,numberOfOutputs:h.numberOfOutputs};h=p(T,c)}return f.set(T,h),await r(_,T,h),h};return{render(_,T){const h=f.get(T);return h!==void 0?Promise.resolve(h):m(_,T)}}},wa=p=>(t,r,f)=>p(r,t,f),Sa=p=>(t,r,f=0,m=0)=>{const _=t[f];if(_===void 0)throw p();return ti(r)?_.connect(r,0,m):_.connect(r,0)},ba=p=>(t,r)=>{const f=p(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),m=t.createBuffer(1,2,44100);return f.buffer=m,f.loop=!0,f.connect(r),f.start(),()=>{f.stop(),f.disconnect(r)}},xa={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Oa=(p,t,r,f,m,_,T)=>class extends p{constructor(e,c){const l=m(e),n={...xa,...c},s=f(l,n),i=_(l),a=i?r():null;super(e,!1,s,a),this._constantSourceNodeRenderer=a,this._nativeConstantSourceNode=s,this._offset=t(this,i,s.offset,jt,Yt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(e){const c=typeof e=="function"?T(this,e):null;this._nativeConstantSourceNode.onended=c;const l=this._nativeConstantSourceNode.onended;this._onended=l!==null&&l===c?e:l}start(e=0){if(this._nativeConstantSourceNode.start(e),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=e),this.context.state!=="closed"){Ze(this);const c=()=>{this._nativeConstantSourceNode.removeEventListener("ended",c),me(this)&&Dn(this)};this._nativeConstantSourceNode.addEventListener("ended",c)}}stop(e=0){this._nativeConstantSourceNode.stop(e),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=e)}},ka=(p,t,r,f,m)=>()=>{const _=new WeakMap;let T=null,h=null;const e=async(c,l)=>{let n=r(c);const s=Nt(n,l);if(!s){const i={channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation,offset:n.offset.value};n=t(l,i),T!==null&&n.start(T),h!==null&&n.stop(h)}return _.set(l,n),s?await p(l,c.offset,n.offset):await f(l,c.offset,n.offset),await m(c,l,n),n};return{set start(c){T=c},set stop(c){h=c},render(c,l){const n=_.get(l);return n!==void 0?Promise.resolve(n):e(c,l)}}},Aa=p=>t=>(p[0]=t,p[0]),Ea={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Da=(p,t,r,f,m,_)=>class extends p{constructor(h,e){const c=f(h),l={...Ea,...e},n=r(c,l),i=m(c)?t():null;super(h,!1,n,i),this._isBufferNullified=!1,this._nativeConvolverNode=n,l.buffer!==null&&_(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(h){if(this._nativeConvolverNode.buffer=h,h===null&&this._nativeConvolverNode.buffer!==null){const e=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=e.createBuffer(1,1,e.sampleRate),this._isBufferNullified=!0,_(this,0)}else this._isBufferNullified=!1,_(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(h){this._nativeConvolverNode.normalize=h}},Ma=(p,t,r)=>()=>{const f=new WeakMap,m=async(_,T)=>{let h=t(_);if(!Nt(h,T)){const c={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,disableNormalization:!h.normalize};h=p(T,c)}return f.set(T,h),nn(h)?await r(_,T,h.inputs[0]):await r(_,T,h),h};return{render(_,T){const h=f.get(T);return h!==void 0?Promise.resolve(h):m(_,T)}}},Pa=(p,t)=>(r,f,m)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(r,f,m)}catch(_){throw _.name==="SyntaxError"?p():_}},Ia=()=>new DOMException("","DataCloneError"),kr=p=>{const{port1:t,port2:r}=new MessageChannel;return new Promise(f=>{const m=()=>{r.onmessage=null,t.close(),r.close(),f()};r.onmessage=()=>m();try{t.postMessage(p,[p])}catch{}finally{m()}})},Fa=(p,t,r,f,m,_,T,h,e,c,l)=>(n,s)=>{const i=T(n)?n:_(n);if(m.has(s)){const a=r();return Promise.reject(a)}try{m.add(s)}catch{}return t(e,()=>e(i))?i.decodeAudioData(s).then(a=>(kr(s).catch(()=>{}),t(h,()=>h(a))||l(a),p.add(a),a)):new Promise((a,u)=>{const o=async()=>{try{await kr(s)}catch{}},d=g=>{u(g),o()};try{i.decodeAudioData(s,g=>{typeof g.copyFromChannel!="function"&&(c(g),Wi(g)),p.add(g),o().then(()=>a(g))},g=>{d(g===null?f():g)})}catch(g){d(g)}})},Ra=(p,t,r,f,m,_,T,h)=>(e,c)=>{const l=t.get(e);if(l===void 0)throw new Error("Missing the expected cycle count.");const n=_(e.context),s=h(n);if(l===c){if(t.delete(e),!s&&T(e)){const i=f(e),{outputs:a}=r(e);for(const u of a)if(Pn(u)){const o=f(u[0]);p(i,o,u[1],u[2])}else{const o=m(u[0]);i.connect(o,u[1])}}}else t.set(e,l-c)},Na={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},La=(p,t,r,f,m,_,T)=>class extends p{constructor(e,c){const l=m(e),n={...Na,...c},s=f(l,n),i=_(l),a=i?r(n.maxDelayTime):null;super(e,!1,s,a),this._delayTime=t(this,i,s.delayTime),T(this,n.maxDelayTime)}get delayTime(){return this._delayTime}},ja=(p,t,r,f,m)=>_=>{const T=new WeakMap,h=async(e,c)=>{let l=r(e);const n=Nt(l,c);if(!n){const s={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:_};l=t(c,s)}return T.set(c,l),n?await p(c,e.delayTime,l.delayTime):await f(c,e.delayTime,l.delayTime),await m(e,c,l),l};return{render(e,c){const l=T.get(c);return l!==void 0?Promise.resolve(l):h(e,c)}}},Ba=p=>(t,r,f,m)=>p(t[m],_=>_[0]===r&&_[1]===f),Va=p=>(t,r)=>{p(t).delete(r)},Wa=p=>"delayTime"in p,Xa=(p,t,r)=>function f(m,_){const T=Zn(_)?_:r(p,_);if(Wa(T))return[];if(m[0]===T)return[m];if(m.includes(T))return[];const{outputs:h}=t(T);return Array.from(h).map(e=>f([...m,T],e[0])).reduce((e,c)=>e.concat(c),[])},Vn=(p,t,r)=>{const f=t[r];if(f===void 0)throw p();return f},Ya=p=>(t,r=void 0,f=void 0,m=0)=>r===void 0?t.forEach(_=>_.disconnect()):typeof r=="number"?Vn(p,t,r).disconnect():ti(r)?f===void 0?t.forEach(_=>_.disconnect(r)):m===void 0?Vn(p,t,f).disconnect(r,0):Vn(p,t,f).disconnect(r,0,m):f===void 0?t.forEach(_=>_.disconnect(r)):Vn(p,t,f).disconnect(r,0),Ua={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},za=(p,t,r,f,m,_,T,h)=>class extends p{constructor(c,l){const n=_(c),s={...Ua,...l},i=f(n,s),a=T(n),u=a?r():null;super(c,!1,i,u),this._attack=t(this,a,i.attack),this._knee=t(this,a,i.knee),this._nativeDynamicsCompressorNode=i,this._ratio=t(this,a,i.ratio),this._release=t(this,a,i.release),this._threshold=t(this,a,i.threshold),h(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(c){const l=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=c,c>2)throw this._nativeDynamicsCompressorNode.channelCount=l,m()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(c){const l=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=c,c==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=l,m()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Ga=(p,t,r,f,m)=>()=>{const _=new WeakMap,T=async(h,e)=>{let c=r(h);const l=Nt(c,e);if(!l){const n={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=t(e,n)}return _.set(e,c),l?(await p(e,h.attack,c.attack),await p(e,h.knee,c.knee),await p(e,h.ratio,c.ratio),await p(e,h.release,c.release),await p(e,h.threshold,c.threshold)):(await f(e,h.attack,c.attack),await f(e,h.knee,c.knee),await f(e,h.ratio,c.ratio),await f(e,h.release,c.release),await f(e,h.threshold,c.threshold)),await m(h,e,c),c};return{render(h,e){const c=_.get(e);return c!==void 0?Promise.resolve(c):T(h,e)}}},Ha=()=>new DOMException("","EncodingError"),qa=p=>t=>new Promise((r,f)=>{if(p===null){f(new SyntaxError);return}const m=p.document.head;if(m===null)f(new SyntaxError);else{const _=p.document.createElement("script"),T=new Blob([t],{type:"application/javascript"}),h=URL.createObjectURL(T),e=p.onerror,c=()=>{p.onerror=e,URL.revokeObjectURL(h)};p.onerror=(l,n,s,i,a)=>{if(n===h||n===p.location.href&&s===1&&i===1)return c(),f(a),!1;if(e!==null)return e(l,n,s,i,a)},_.onerror=()=>{c(),f(new SyntaxError)},_.onload=()=>{c(),r()},_.src=h,_.type="module",m.appendChild(_)}}),$a=p=>class{constructor(r){this._nativeEventTarget=r,this._listeners=new WeakMap}addEventListener(r,f,m){if(f!==null){let _=this._listeners.get(f);_===void 0&&(_=p(this,f),typeof f=="function"&&this._listeners.set(f,_)),this._nativeEventTarget.addEventListener(r,_,m)}}dispatchEvent(r){return this._nativeEventTarget.dispatchEvent(r)}removeEventListener(r,f,m){const _=f===null?void 0:this._listeners.get(f);this._nativeEventTarget.removeEventListener(r,_===void 0?null:_,m)}},Ka=p=>(t,r,f)=>{Object.defineProperties(p,{currentFrame:{configurable:!0,get(){return Math.round(t*r)}},currentTime:{configurable:!0,get(){return t}}});try{return f()}finally{p!==null&&(delete p.currentFrame,delete p.currentTime)}},Za=p=>async t=>{try{const r=await fetch(t);if(r.ok)return[await r.text(),r.url]}catch{}throw p()},Qa={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Ja=(p,t,r,f,m,_)=>class extends p{constructor(h,e){const c=m(h),l={...Qa,...e},n=f(c,l),s=_(c),i=s?r():null;super(h,!1,n,i),this._gain=t(this,s,n.gain,jt,Yt)}get gain(){return this._gain}},tc=(p,t,r,f,m)=>()=>{const _=new WeakMap,T=async(h,e)=>{let c=r(h);const l=Nt(c,e);if(!l){const n={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=t(e,n)}return _.set(e,c),l?await p(e,h.gain,c.gain):await f(e,h.gain,c.gain),await m(h,e,c),c};return{render(h,e){const c=_.get(e);return c!==void 0?Promise.resolve(c):T(h,e)}}},ec=(p,t)=>r=>t(p,r),nc=p=>t=>{const r=p(t);if(r.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return r.renderer},ic=p=>t=>{var r;return(r=p.get(t))!==null&&r!==void 0?r:0},rc=p=>t=>{const r=p(t);if(r.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return r.renderer},sc=p=>t=>p.get(t),Ft=()=>new DOMException("","InvalidStateError"),oc=p=>t=>{const r=p.get(t);if(r===void 0)throw Ft();return r},ac=(p,t)=>r=>{let f=p.get(r);if(f!==void 0)return f;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return f=new t(1,1,44100),p.set(r,f),f},cc=p=>t=>{const r=p.get(t);if(r===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return r},pi=()=>new DOMException("","InvalidAccessError"),lc=p=>{p.getFrequencyResponse=(t=>(r,f,m)=>{if(r.length!==f.length||f.length!==m.length)throw pi();return t.call(p,r,f,m)})(p.getFrequencyResponse)},hc={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},uc=(p,t,r,f,m,_)=>class extends p{constructor(h,e){const c=f(h),l=m(c),n={...hc,...e},s=t(c,l?null:h.baseLatency,n),i=l?r(n.feedback,n.feedforward):null;super(h,!1,s,i),lc(s),this._nativeIIRFilterNode=s,_(this,1)}getFrequencyResponse(h,e,c){return this._nativeIIRFilterNode.getFrequencyResponse(h,e,c)}},is=(p,t,r,f,m,_,T,h,e,c,l)=>{const n=c.length;let s=h;for(let i=0;i<n;i+=1){let a=r[0]*c[i];for(let u=1;u<m;u+=1){const o=s-u&e-1;a+=r[u]*_[o],a-=p[u]*T[o]}for(let u=m;u<f;u+=1)a+=r[u]*_[s-u&e-1];for(let u=m;u<t;u+=1)a-=p[u]*T[s-u&e-1];_[s]=c[i],T[s]=a,s=s+1&e-1,l[i]=a}return s},fc=(p,t,r,f)=>{const m=r instanceof Float64Array?r:new Float64Array(r),_=f instanceof Float64Array?f:new Float64Array(f),T=m.length,h=_.length,e=Math.min(T,h);if(m[0]!==1){for(let a=0;a<T;a+=1)_[a]/=m[0];for(let a=1;a<h;a+=1)m[a]/=m[0]}const c=32,l=new Float32Array(c),n=new Float32Array(c),s=t.createBuffer(p.numberOfChannels,p.length,p.sampleRate),i=p.numberOfChannels;for(let a=0;a<i;a+=1){const u=p.getChannelData(a),o=s.getChannelData(a);l.fill(0),n.fill(0),is(m,T,_,h,e,l,n,0,c,u,o)}return s},dc=(p,t,r,f,m)=>(_,T)=>{const h=new WeakMap;let e=null;const c=async(l,n)=>{let s=null,i=t(l);const a=Nt(i,n);if(n.createIIRFilter===void 0?s=p(n,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):a||(i=n.createIIRFilter(T,_)),h.set(n,s===null?i:s),s!==null){if(e===null){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const o=new r(l.context.destination.channelCount,l.context.length,n.sampleRate);e=(async()=>{await f(l,o,o.destination);const d=await m(o);return fc(d,n,_,T)})()}const u=await e;return s.buffer=u,s.start(0),s}return await f(l,n,i),i};return{render(l,n){const s=h.get(n);return s!==void 0?Promise.resolve(s):c(l,n)}}},pc=(p,t,r,f,m,_)=>T=>(h,e)=>{const c=p.get(h);if(c===void 0){if(!T&&_(h)){const l=f(h),{outputs:n}=r(h);for(const s of n)if(Pn(s)){const i=f(s[0]);t(l,i,s[1],s[2])}else{const i=m(s[0]);l.disconnect(i,s[1])}}p.set(h,e)}else p.set(h,c+e)},gc=(p,t)=>r=>{const f=p.get(r);return t(f)||t(r)},mc=(p,t)=>r=>p.has(r)||t(r),_c=(p,t)=>r=>p.has(r)||t(r),vc=(p,t)=>r=>{const f=p.get(r);return t(f)||t(r)},yc=p=>t=>p!==null&&t instanceof p,Cc=p=>t=>p!==null&&typeof p.AudioNode=="function"&&t instanceof p.AudioNode,Tc=p=>t=>p!==null&&typeof p.AudioParam=="function"&&t instanceof p.AudioParam,wc=(p,t)=>r=>p(r)||t(r),Sc=p=>t=>p!==null&&t instanceof p,bc=p=>p!==null&&p.isSecureContext,xc=(p,t,r,f)=>class extends p{constructor(_,T){const h=r(_),e=t(h,T);if(f(h))throw TypeError();super(_,!0,e,null),this._nativeMediaElementAudioSourceNode=e}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Oc={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},kc=(p,t,r,f)=>class extends p{constructor(_,T){const h=r(_);if(f(h))throw new TypeError;const e={...Oc,...T},c=t(h,e);super(_,!1,c,null),this._nativeMediaStreamAudioDestinationNode=c}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Ac=(p,t,r,f)=>class extends p{constructor(_,T){const h=r(_),e=t(h,T);if(f(h))throw new TypeError;super(_,!0,e,null),this._nativeMediaStreamAudioSourceNode=e}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},Ec=(p,t,r)=>class extends p{constructor(m,_){const T=r(m),h=t(T,_);super(m,!0,h,null)}},Dc=(p,t,r,f,m,_)=>class extends r{constructor(h,e){super(h),this._nativeContext=h,fi.set(this,h),f(h)&&m.set(h,new Set),this._destination=new p(this,e),this._listener=t(this,h),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(h){const e=typeof h=="function"?_(this,h):null;this._nativeContext.onstatechange=e;const c=this._nativeContext.onstatechange;this._onstatechange=c!==null&&c===e?h:c}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},gn=p=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const r=p.decodeAudioData(t.buffer,()=>{});return r===void 0?!1:(r.catch(()=>{}),!0)}catch{}return!1},Mc=(p,t)=>(r,f,m)=>{const _=new Set;return r.connect=(T=>(h,e=0,c=0)=>{const l=_.size===0;if(t(h))return T.call(r,h,e,c),p(_,[h,e,c],n=>n[0]===h&&n[1]===e&&n[2]===c,!0),l&&f(),h;T.call(r,h,e),p(_,[h,e],n=>n[0]===h&&n[1]===e,!0),l&&f()})(r.connect),r.disconnect=(T=>(h,e,c)=>{const l=_.size>0;if(h===void 0)T.apply(r),_.clear();else if(typeof h=="number"){T.call(r,h);for(const s of _)s[1]===h&&_.delete(s)}else{t(h)?T.call(r,h,e,c):T.call(r,h,e);for(const s of _)s[0]===h&&(e===void 0||s[1]===e)&&(c===void 0||s[2]===c)&&_.delete(s)}const n=_.size===0;l&&n&&m()})(r.disconnect),r},Tt=(p,t,r)=>{const f=t[r];f!==void 0&&f!==p[r]&&(p[r]=f)},Dt=(p,t)=>{Tt(p,t,"channelCount"),Tt(p,t,"channelCountMode"),Tt(p,t,"channelInterpretation")},Ar=p=>typeof p.getFloatTimeDomainData=="function",Pc=p=>{p.getFloatTimeDomainData=t=>{const r=new Uint8Array(t.length);p.getByteTimeDomainData(r);const f=Math.max(r.length,p.fftSize);for(let m=0;m<f;m+=1)t[m]=(r[m]-128)*.0078125;return t}},Ic=(p,t)=>(r,f)=>{const m=r.createAnalyser();if(Dt(m,f),!(f.maxDecibels>f.minDecibels))throw t();return Tt(m,f,"fftSize"),Tt(m,f,"maxDecibels"),Tt(m,f,"minDecibels"),Tt(m,f,"smoothingTimeConstant"),p(Ar,()=>Ar(m))||Pc(m),m},Fc=p=>p===null?null:p.hasOwnProperty("AudioBuffer")?p.AudioBuffer:null,wt=(p,t,r)=>{const f=t[r];f!==void 0&&f!==p[r].value&&(p[r].value=f)},Rc=p=>{p.start=(t=>{let r=!1;return(f=0,m=0,_)=>{if(r)throw Ft();t.call(p,f,m,_),r=!0}})(p.start)},Ui=p=>{p.start=(t=>(r=0,f=0,m)=>{if(typeof m=="number"&&m<0||f<0||r<0)throw new RangeError("The parameters can't be negative.");t.call(p,r,f,m)})(p.start)},zi=p=>{p.stop=(t=>(r=0)=>{if(r<0)throw new RangeError("The parameter can't be negative.");t.call(p,r)})(p.stop)},Nc=(p,t,r,f,m,_,T,h,e,c,l)=>(n,s)=>{const i=n.createBufferSource();return Dt(i,s),wt(i,s,"playbackRate"),Tt(i,s,"buffer"),Tt(i,s,"loop"),Tt(i,s,"loopEnd"),Tt(i,s,"loopStart"),t(r,()=>r(n))||Rc(i),t(f,()=>f(n))||e(i),t(m,()=>m(n))||c(i,n),t(_,()=>_(n))||Ui(i),t(T,()=>T(n))||l(i,n),t(h,()=>h(n))||zi(i),p(n,i),i},Lc=p=>p===null?null:p.hasOwnProperty("AudioContext")?p.AudioContext:p.hasOwnProperty("webkitAudioContext")?p.webkitAudioContext:null,jc=(p,t)=>(r,f,m)=>{const _=r.destination;if(_.channelCount!==f)try{_.channelCount=f}catch{}m&&_.channelCountMode!=="explicit"&&(_.channelCountMode="explicit"),_.maxChannelCount===0&&Object.defineProperty(_,"maxChannelCount",{value:f});const T=p(r,{channelCount:f,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});return t(T,"channelCount",h=>()=>h.call(T),h=>e=>{h.call(T,e);try{_.channelCount=e}catch(c){if(e>_.maxChannelCount)throw c}}),t(T,"channelCountMode",h=>()=>h.call(T),h=>e=>{h.call(T,e),_.channelCountMode=e}),t(T,"channelInterpretation",h=>()=>h.call(T),h=>e=>{h.call(T,e),_.channelInterpretation=e}),Object.defineProperty(T,"maxChannelCount",{get:()=>_.maxChannelCount}),T.connect(_),T},Bc=p=>p===null?null:p.hasOwnProperty("AudioWorkletNode")?p.AudioWorkletNode:null,Vc=p=>{const{port1:t}=new MessageChannel;try{t.postMessage(p)}finally{t.close()}},Wc=(p,t,r,f,m)=>(_,T,h,e,c,l)=>{if(h!==null)try{const n=new h(_,e,l),s=new Map;let i=null;if(Object.defineProperties(n,{channelCount:{get:()=>l.channelCount,set:()=>{throw p()}},channelCountMode:{get:()=>"explicit",set:()=>{throw p()}},onprocessorerror:{get:()=>i,set:a=>{typeof i=="function"&&n.removeEventListener("processorerror",i),i=typeof a=="function"?a:null,typeof i=="function"&&n.addEventListener("processorerror",i)}}}),n.addEventListener=(a=>(...u)=>{if(u[0]==="processorerror"){const o=typeof u[1]=="function"?u[1]:typeof u[1]=="object"&&u[1]!==null&&typeof u[1].handleEvent=="function"?u[1].handleEvent:null;if(o!==null){const d=s.get(u[1]);d!==void 0?u[1]=d:(u[1]=g=>{g.type==="error"?(Object.defineProperties(g,{type:{value:"processorerror"}}),o(g)):o(new ErrorEvent(u[0],{...g}))},s.set(o,u[1]))}}return a.call(n,"error",u[1],u[2]),a.call(n,...u)})(n.addEventListener),n.removeEventListener=(a=>(...u)=>{if(u[0]==="processorerror"){const o=s.get(u[1]);o!==void 0&&(s.delete(u[1]),u[1]=o)}return a.call(n,"error",u[1],u[2]),a.call(n,u[0],u[1],u[2])})(n.removeEventListener),l.numberOfOutputs!==0){const a=r(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return n.connect(a).connect(_.destination),m(n,()=>a.disconnect(),()=>a.connect(_.destination))}return n}catch(n){throw n.code===11?f():n}if(c===void 0)throw f();return Vc(l),t(_,T,c,l)},rs=(p,t)=>p===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(p*t))))),Xc=p=>new Promise((t,r)=>{const{port1:f,port2:m}=new MessageChannel;f.onmessage=({data:_})=>{f.close(),m.close(),t(_)},f.onmessageerror=({data:_})=>{f.close(),m.close(),r(_)},m.postMessage(p)}),Yc=async(p,t)=>{const r=await Xc(t);return new p(r)},Uc=(p,t,r,f)=>{let m=Pi.get(p);m===void 0&&(m=new WeakMap,Pi.set(p,m));const _=Yc(r,f);return m.set(t,_),_},zc=(p,t,r,f,m,_,T,h,e,c,l,n,s)=>(i,a,u,o)=>{if(o.numberOfInputs===0&&o.numberOfOutputs===0)throw e();const d=Array.isArray(o.outputChannelCount)?o.outputChannelCount:Array.from(o.outputChannelCount);if(d.some(j=>j<1))throw e();if(d.length!==o.numberOfOutputs)throw t();if(o.channelCountMode!=="explicit")throw e();const g=o.channelCount*o.numberOfInputs,v=d.reduce((j,Y)=>j+Y,0),y=u.parameterDescriptors===void 0?0:u.parameterDescriptors.length;if(g+y>6||v>6)throw e();const C=new MessageChannel,w=[],S=[];for(let j=0;j<o.numberOfInputs;j+=1)w.push(T(i,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:1})),S.push(m(i,{channelCount:o.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:o.channelCount}));const O=[];if(u.parameterDescriptors!==void 0)for(const{defaultValue:j,maxValue:Y,minValue:z,name:K}of u.parameterDescriptors){const tt=_(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:o.parameterData[K]!==void 0?o.parameterData[K]:j===void 0?0:j});Object.defineProperties(tt.offset,{defaultValue:{get:()=>j===void 0?0:j},maxValue:{get:()=>Y===void 0?jt:Y},minValue:{get:()=>z===void 0?Yt:z}}),O.push(tt)}const M=f(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,g+y)}),I=rs(a,i.sampleRate),N=h(i,I,g+y,Math.max(1,v)),L=m(i,{channelCount:Math.max(1,v),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,v)}),H=[];for(let j=0;j<o.numberOfOutputs;j+=1)H.push(f(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:d[j]}));for(let j=0;j<o.numberOfInputs;j+=1){w[j].connect(S[j]);for(let Y=0;Y<o.channelCount;Y+=1)S[j].connect(M,Y,j*o.channelCount+Y)}const U=new es(u.parameterDescriptors===void 0?[]:u.parameterDescriptors.map(({name:j},Y)=>{const z=O[Y];return z.connect(M,0,g+Y),z.start(0),[j,z.offset]}));M.connect(N);let R=o.channelInterpretation,V=null;const $=o.numberOfOutputs===0?[N]:H,J={get bufferSize(){return I},get channelCount(){return o.channelCount},set channelCount(j){throw r()},get channelCountMode(){return o.channelCountMode},set channelCountMode(j){throw r()},get channelInterpretation(){return R},set channelInterpretation(j){for(const Y of w)Y.channelInterpretation=j;R=j},get context(){return N.context},get inputs(){return w},get numberOfInputs(){return o.numberOfInputs},get numberOfOutputs(){return o.numberOfOutputs},get onprocessorerror(){return V},set onprocessorerror(j){typeof V=="function"&&J.removeEventListener("processorerror",V),V=typeof j=="function"?j:null,typeof V=="function"&&J.addEventListener("processorerror",V)},get parameters(){return U},get port(){return C.port2},addEventListener(...j){return N.addEventListener(j[0],j[1],j[2])},connect:p.bind(null,$),disconnect:c.bind(null,$),dispatchEvent(...j){return N.dispatchEvent(j[0])},removeEventListener(...j){return N.removeEventListener(j[0],j[1],j[2])}},b=new Map;C.port1.addEventListener=(j=>(...Y)=>{if(Y[0]==="message"){const z=typeof Y[1]=="function"?Y[1]:typeof Y[1]=="object"&&Y[1]!==null&&typeof Y[1].handleEvent=="function"?Y[1].handleEvent:null;if(z!==null){const K=b.get(Y[1]);K!==void 0?Y[1]=K:(Y[1]=tt=>{l(i.currentTime,i.sampleRate,()=>z(tt))},b.set(z,Y[1]))}}return j.call(C.port1,Y[0],Y[1],Y[2])})(C.port1.addEventListener),C.port1.removeEventListener=(j=>(...Y)=>{if(Y[0]==="message"){const z=b.get(Y[1]);z!==void 0&&(b.delete(Y[1]),Y[1]=z)}return j.call(C.port1,Y[0],Y[1],Y[2])})(C.port1.removeEventListener);let E=null;Object.defineProperty(C.port1,"onmessage",{get:()=>E,set:j=>{typeof E=="function"&&C.port1.removeEventListener("message",E),E=typeof j=="function"?j:null,typeof E=="function"&&(C.port1.addEventListener("message",E),C.port1.start())}}),u.prototype.port=C.port1;let A=null;Uc(i,J,u,o).then(j=>A=j);const W=ni(o.numberOfInputs,o.channelCount),k=ni(o.numberOfOutputs,d),x=u.parameterDescriptors===void 0?[]:u.parameterDescriptors.reduce((j,{name:Y})=>({...j,[Y]:new Float32Array(128)}),{});let P=!0;const F=()=>{o.numberOfOutputs>0&&N.disconnect(L);for(let j=0,Y=0;j<o.numberOfOutputs;j+=1){const z=H[j];for(let K=0;K<d[j];K+=1)L.disconnect(z,Y+K,K);Y+=d[j]}},B=new Map;N.onaudioprocess=({inputBuffer:j,outputBuffer:Y})=>{if(A!==null){const z=n(J);for(let K=0;K<I;K+=128){for(let tt=0;tt<o.numberOfInputs;tt+=1)for(let st=0;st<o.channelCount;st+=1)ei(j,W[tt],st,st,K);u.parameterDescriptors!==void 0&&u.parameterDescriptors.forEach(({name:tt},st)=>{ei(j,x,tt,g+st,K)});for(let tt=0;tt<o.numberOfInputs;tt+=1)for(let st=0;st<d[tt];st+=1)k[tt][st].byteLength===0&&(k[tt][st]=new Float32Array(128));try{const tt=W.map((rt,Z)=>{if(z[Z].size>0)return B.set(Z,I/128),rt;const at=B.get(Z);return at===void 0?[]:(rt.every(ht=>ht.every(mt=>mt===0))&&(at===1?B.delete(Z):B.set(Z,at-1)),rt)});P=l(i.currentTime+K/i.sampleRate,i.sampleRate,()=>A.process(tt,k,x));for(let rt=0,Z=0;rt<o.numberOfOutputs;rt+=1){for(let ot=0;ot<d[rt];ot+=1)ns(Y,k[rt],ot,Z+ot,K);Z+=d[rt]}}catch(tt){P=!1,J.dispatchEvent(new ErrorEvent("processorerror",{colno:tt.colno,filename:tt.filename,lineno:tt.lineno,message:tt.message}))}if(!P){for(let tt=0;tt<o.numberOfInputs;tt+=1){w[tt].disconnect(S[tt]);for(let st=0;st<o.channelCount;st+=1)S[K].disconnect(M,st,tt*o.channelCount+st)}if(u.parameterDescriptors!==void 0){const tt=u.parameterDescriptors.length;for(let st=0;st<tt;st+=1){const rt=O[st];rt.disconnect(M,0,g+st),rt.stop()}}M.disconnect(N),N.onaudioprocess=null,G?F():nt();break}}}};let G=!1;const Q=T(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),et=()=>N.connect(Q).connect(i.destination),nt=()=>{N.disconnect(Q),Q.disconnect()},q=()=>{if(P){nt(),o.numberOfOutputs>0&&N.connect(L);for(let j=0,Y=0;j<o.numberOfOutputs;j+=1){const z=H[j];for(let K=0;K<d[j];K+=1)L.connect(z,Y+K,K);Y+=d[j]}}G=!0},X=()=>{P&&(et(),F()),G=!1};return et(),s(J,q,X)},ss=(p,t)=>{const r=p.createBiquadFilter();return Dt(r,t),wt(r,t,"Q"),wt(r,t,"detune"),wt(r,t,"frequency"),wt(r,t,"gain"),Tt(r,t,"type"),r},Gc=(p,t)=>(r,f)=>{const m=r.createChannelMerger(f.numberOfInputs);return p!==null&&p.name==="webkitAudioContext"&&t(r,m),Dt(m,f),m},Hc=p=>{const t=p.numberOfOutputs;Object.defineProperty(p,"channelCount",{get:()=>t,set:r=>{if(r!==t)throw Ft()}}),Object.defineProperty(p,"channelCountMode",{get:()=>"explicit",set:r=>{if(r!=="explicit")throw Ft()}}),Object.defineProperty(p,"channelInterpretation",{get:()=>"discrete",set:r=>{if(r!=="discrete")throw Ft()}})},In=(p,t)=>{const r=p.createChannelSplitter(t.numberOfOutputs);return Dt(r,t),Hc(r),r},qc=(p,t,r,f,m)=>(_,T)=>{if(_.createConstantSource===void 0)return r(_,T);const h=_.createConstantSource();return Dt(h,T),wt(h,T,"offset"),t(f,()=>f(_))||Ui(h),t(m,()=>m(_))||zi(h),p(_,h),h},rn=(p,t)=>(p.connect=t.connect.bind(t),p.disconnect=t.disconnect.bind(t),p),$c=(p,t,r,f)=>(m,{offset:_,...T})=>{const h=m.createBuffer(1,2,44100),e=t(m,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=r(m,{...T,gain:_}),l=h.getChannelData(0);l[0]=1,l[1]=1,e.buffer=h,e.loop=!0;const n={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(a){c.channelCount=a},get channelCountMode(){return c.channelCountMode},set channelCountMode(a){c.channelCountMode=a},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(a){c.channelInterpretation=a},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return e.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return e.onended},set onended(a){e.onended=a},addEventListener(...a){return e.addEventListener(a[0],a[1],a[2])},dispatchEvent(...a){return e.dispatchEvent(a[0])},removeEventListener(...a){return e.removeEventListener(a[0],a[1],a[2])},start(a=0){e.start.call(e,a)},stop(a=0){e.stop.call(e,a)}},s=()=>e.connect(c),i=()=>e.disconnect(c);return p(m,e),f(rn(n,c),s,i)},Kc=(p,t)=>(r,f)=>{const m=r.createConvolver();if(Dt(m,f),f.disableNormalization===m.normalize&&(m.normalize=!f.disableNormalization),Tt(m,f,"buffer"),f.channelCount>2||(t(m,"channelCount",_=>()=>_.call(m),_=>T=>{if(T>2)throw p();return _.call(m,T)}),f.channelCountMode==="max"))throw p();return t(m,"channelCountMode",_=>()=>_.call(m),_=>T=>{if(T==="max")throw p();return _.call(m,T)}),m},os=(p,t)=>{const r=p.createDelay(t.maxDelayTime);return Dt(r,t),wt(r,t,"delayTime"),r},Zc=p=>(t,r)=>{const f=t.createDynamicsCompressor();if(Dt(f,r),r.channelCount>2||r.channelCountMode==="max")throw p();return wt(f,r,"attack"),wt(f,r,"knee"),wt(f,r,"ratio"),wt(f,r,"release"),wt(f,r,"threshold"),f},zt=(p,t)=>{const r=p.createGain();return Dt(r,t),wt(r,t,"gain"),r},Qc=p=>(t,r,f)=>{if(t.createIIRFilter===void 0)return p(t,r,f);const m=t.createIIRFilter(f.feedforward,f.feedback);return Dt(m,f),m};function Jc(p,t){const r=t[0]*t[0]+t[1]*t[1];return[(p[0]*t[0]+p[1]*t[1])/r,(p[1]*t[0]-p[0]*t[1])/r]}function tl(p,t){return[p[0]*t[0]-p[1]*t[1],p[0]*t[1]+p[1]*t[0]]}function Er(p,t){let r=[0,0];for(let f=p.length-1;f>=0;f-=1)r=tl(r,t),r[0]+=p[f];return r}const el=(p,t,r,f)=>(m,_,{channelCount:T,channelCountMode:h,channelInterpretation:e,feedback:c,feedforward:l})=>{const n=rs(_,m.sampleRate),s=c instanceof Float64Array?c:new Float64Array(c),i=l instanceof Float64Array?l:new Float64Array(l),a=s.length,u=i.length,o=Math.min(a,u);if(a===0||a>20)throw f();if(s[0]===0)throw t();if(u===0||u>20)throw f();if(i[0]===0)throw t();if(s[0]!==1){for(let O=0;O<u;O+=1)i[O]/=s[0];for(let O=1;O<a;O+=1)s[O]/=s[0]}const d=r(m,n,T,T);d.channelCount=T,d.channelCountMode=h,d.channelInterpretation=e;const g=32,v=[],y=[],C=[];for(let O=0;O<T;O+=1){v.push(0);const M=new Float32Array(g),I=new Float32Array(g);M.fill(0),I.fill(0),y.push(M),C.push(I)}d.onaudioprocess=O=>{const M=O.inputBuffer,I=O.outputBuffer,N=M.numberOfChannels;for(let L=0;L<N;L+=1){const H=M.getChannelData(L),U=I.getChannelData(L);v[L]=is(s,a,i,u,o,y[L],C[L],v[L],g,H,U)}};const w=m.sampleRate/2;return rn({get bufferSize(){return n},get channelCount(){return d.channelCount},set channelCount(O){d.channelCount=O},get channelCountMode(){return d.channelCountMode},set channelCountMode(O){d.channelCountMode=O},get channelInterpretation(){return d.channelInterpretation},set channelInterpretation(O){d.channelInterpretation=O},get context(){return d.context},get inputs(){return[d]},get numberOfInputs(){return d.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},addEventListener(...O){return d.addEventListener(O[0],O[1],O[2])},dispatchEvent(...O){return d.dispatchEvent(O[0])},getFrequencyResponse(O,M,I){if(O.length!==M.length||M.length!==I.length)throw p();const N=O.length;for(let L=0;L<N;L+=1){const H=-Math.PI*(O[L]/w),U=[Math.cos(H),Math.sin(H)],R=Er(i,U),V=Er(s,U),$=Jc(R,V);M[L]=Math.sqrt($[0]*$[0]+$[1]*$[1]),I[L]=Math.atan2($[1],$[0])}},removeEventListener(...O){return d.removeEventListener(O[0],O[1],O[2])}},d)},nl=(p,t)=>p.createMediaElementSource(t.mediaElement),il=(p,t)=>{const r=p.createMediaStreamDestination();return Dt(r,t),r.numberOfOutputs===1&&Object.defineProperty(r,"numberOfOutputs",{get:()=>0}),r},rl=(p,{mediaStream:t})=>{const r=t.getAudioTracks();r.sort((_,T)=>_.id<T.id?-1:_.id>T.id?1:0);const f=r.slice(0,1),m=p.createMediaStreamSource(new MediaStream(f));return Object.defineProperty(m,"mediaStream",{value:t}),m},sl=(p,t)=>(r,{mediaStreamTrack:f})=>{if(typeof r.createMediaStreamTrackSource=="function")return r.createMediaStreamTrackSource(f);const m=new MediaStream([f]),_=r.createMediaStreamSource(m);if(f.kind!=="audio")throw p();if(t(r))throw new TypeError;return _},ol=p=>p===null?null:p.hasOwnProperty("OfflineAudioContext")?p.OfflineAudioContext:p.hasOwnProperty("webkitOfflineAudioContext")?p.webkitOfflineAudioContext:null,al=(p,t,r,f,m,_)=>(T,h)=>{const e=T.createOscillator();return Dt(e,h),wt(e,h,"detune"),wt(e,h,"frequency"),h.periodicWave!==void 0?e.setPeriodicWave(h.periodicWave):Tt(e,h,"type"),t(r,()=>r(T))||Ui(e),t(f,()=>f(T))||_(e,T),t(m,()=>m(T))||zi(e),p(T,e),e},cl=p=>(t,r)=>{const f=t.createPanner();return f.orientationX===void 0?p(t,r):(Dt(f,r),wt(f,r,"orientationX"),wt(f,r,"orientationY"),wt(f,r,"orientationZ"),wt(f,r,"positionX"),wt(f,r,"positionY"),wt(f,r,"positionZ"),Tt(f,r,"coneInnerAngle"),Tt(f,r,"coneOuterAngle"),Tt(f,r,"coneOuterGain"),Tt(f,r,"distanceModel"),Tt(f,r,"maxDistance"),Tt(f,r,"panningModel"),Tt(f,r,"refDistance"),Tt(f,r,"rolloffFactor"),f)},ll=(p,t,r,f,m,_,T,h,e,c)=>(l,{coneInnerAngle:n,coneOuterAngle:s,coneOuterGain:i,distanceModel:a,maxDistance:u,orientationX:o,orientationY:d,orientationZ:g,panningModel:v,positionX:y,positionY:C,positionZ:w,refDistance:S,rolloffFactor:O,...M})=>{const I=l.createPanner();if(M.channelCount>2||M.channelCountMode==="max")throw T();Dt(I,M);const N={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},L=r(l,{...N,channelInterpretation:"speakers",numberOfInputs:6}),H=f(l,{...M,gain:1}),U=f(l,{...N,gain:1}),R=f(l,{...N,gain:0}),V=f(l,{...N,gain:0}),$=f(l,{...N,gain:0}),J=f(l,{...N,gain:0}),b=f(l,{...N,gain:0}),E=m(l,256,6,1),A=_(l,{...N,curve:new Float32Array([1,1]),oversample:"none"});let D=[o,d,g],W=[y,C,w];const k=new Float32Array(1);E.onaudioprocess=({inputBuffer:B})=>{const G=[e(B,k,0),e(B,k,1),e(B,k,2)];G.some((et,nt)=>et!==D[nt])&&(I.setOrientation(...G),D=G);const Q=[e(B,k,3),e(B,k,4),e(B,k,5)];Q.some((et,nt)=>et!==W[nt])&&(I.setPosition(...Q),W=Q)},Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(J.gain,"defaultValue",{get:()=>0}),Object.defineProperty(b.gain,"defaultValue",{get:()=>0});const x={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(B){if(B>2)throw T();H.channelCount=B,I.channelCount=B},get channelCountMode(){return I.channelCountMode},set channelCountMode(B){if(B==="max")throw T();H.channelCountMode=B,I.channelCountMode=B},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(B){H.channelInterpretation=B,I.channelInterpretation=B},get coneInnerAngle(){return I.coneInnerAngle},set coneInnerAngle(B){I.coneInnerAngle=B},get coneOuterAngle(){return I.coneOuterAngle},set coneOuterAngle(B){I.coneOuterAngle=B},get coneOuterGain(){return I.coneOuterGain},set coneOuterGain(B){if(B<0||B>1)throw t();I.coneOuterGain=B},get context(){return I.context},get distanceModel(){return I.distanceModel},set distanceModel(B){I.distanceModel=B},get inputs(){return[H]},get maxDistance(){return I.maxDistance},set maxDistance(B){if(B<0)throw new RangeError;I.maxDistance=B},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get orientationX(){return U.gain},get orientationY(){return R.gain},get orientationZ(){return V.gain},get panningModel(){return I.panningModel},set panningModel(B){I.panningModel=B},get positionX(){return $.gain},get positionY(){return J.gain},get positionZ(){return b.gain},get refDistance(){return I.refDistance},set refDistance(B){if(B<0)throw new RangeError;I.refDistance=B},get rolloffFactor(){return I.rolloffFactor},set rolloffFactor(B){if(B<0)throw new RangeError;I.rolloffFactor=B},addEventListener(...B){return H.addEventListener(B[0],B[1],B[2])},dispatchEvent(...B){return H.dispatchEvent(B[0])},removeEventListener(...B){return H.removeEventListener(B[0],B[1],B[2])}};n!==x.coneInnerAngle&&(x.coneInnerAngle=n),s!==x.coneOuterAngle&&(x.coneOuterAngle=s),i!==x.coneOuterGain&&(x.coneOuterGain=i),a!==x.distanceModel&&(x.distanceModel=a),u!==x.maxDistance&&(x.maxDistance=u),o!==x.orientationX.value&&(x.orientationX.value=o),d!==x.orientationY.value&&(x.orientationY.value=d),g!==x.orientationZ.value&&(x.orientationZ.value=g),v!==x.panningModel&&(x.panningModel=v),y!==x.positionX.value&&(x.positionX.value=y),C!==x.positionY.value&&(x.positionY.value=C),w!==x.positionZ.value&&(x.positionZ.value=w),S!==x.refDistance&&(x.refDistance=S),O!==x.rolloffFactor&&(x.rolloffFactor=O),(D[0]!==1||D[1]!==0||D[2]!==0)&&I.setOrientation(...D),(W[0]!==0||W[1]!==0||W[2]!==0)&&I.setPosition(...W);const P=()=>{H.connect(I),p(H,A,0,0),A.connect(U).connect(L,0,0),A.connect(R).connect(L,0,1),A.connect(V).connect(L,0,2),A.connect($).connect(L,0,3),A.connect(J).connect(L,0,4),A.connect(b).connect(L,0,5),L.connect(E).connect(l.destination)},F=()=>{H.disconnect(I),h(H,A,0,0),A.disconnect(U),U.disconnect(L),A.disconnect(R),R.disconnect(L),A.disconnect(V),V.disconnect(L),A.disconnect($),$.disconnect(L),A.disconnect(J),J.disconnect(L),A.disconnect(b),b.disconnect(L),L.disconnect(E),E.disconnect(l.destination)};return c(rn(x,I),P,F)},hl=p=>(t,{disableNormalization:r,imag:f,real:m})=>{const _=f instanceof Float32Array?f:new Float32Array(f),T=m instanceof Float32Array?m:new Float32Array(m),h=t.createPeriodicWave(T,_,{disableNormalization:r});if(Array.from(f).length<2)throw p();return h},Fn=(p,t,r,f)=>p.createScriptProcessor(t,r,f),ul=(p,t)=>(r,f)=>{const m=f.channelCountMode;if(m==="clamped-max")throw t();if(r.createStereoPanner===void 0)return p(r,f);const _=r.createStereoPanner();return Dt(_,f),wt(_,f,"pan"),Object.defineProperty(_,"channelCountMode",{get:()=>m,set:T=>{if(T!==m)throw t()}}),_},fl=(p,t,r,f,m,_)=>{const h=new Float32Array([1,1]),e=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l={...c,oversample:"none"},n=(a,u,o,d)=>{const g=new Float32Array(16385),v=new Float32Array(16385);for(let M=0;M<16385;M+=1){const I=M/16384*e;g[M]=Math.cos(I),v[M]=Math.sin(I)}const y=r(a,{...c,gain:0}),C=f(a,{...l,curve:g}),w=f(a,{...l,curve:h}),S=r(a,{...c,gain:0}),O=f(a,{...l,curve:v});return{connectGraph(){u.connect(y),u.connect(w.inputs===void 0?w:w.inputs[0]),u.connect(S),w.connect(o),o.connect(C.inputs===void 0?C:C.inputs[0]),o.connect(O.inputs===void 0?O:O.inputs[0]),C.connect(y.gain),O.connect(S.gain),y.connect(d,0,0),S.connect(d,0,1)},disconnectGraph(){u.disconnect(y),u.disconnect(w.inputs===void 0?w:w.inputs[0]),u.disconnect(S),w.disconnect(o),o.disconnect(C.inputs===void 0?C:C.inputs[0]),o.disconnect(O.inputs===void 0?O:O.inputs[0]),C.disconnect(y.gain),O.disconnect(S.gain),y.disconnect(d,0,0),S.disconnect(d,0,1)}}},s=(a,u,o,d)=>{const g=new Float32Array(16385),v=new Float32Array(16385),y=new Float32Array(16385),C=new Float32Array(16385),w=Math.floor(16385/2);for(let $=0;$<16385;$+=1)if($>w){const J=($-w)/(16384-w)*e;g[$]=Math.cos(J),v[$]=Math.sin(J),y[$]=0,C[$]=1}else{const J=$/(16384-w)*e;g[$]=1,v[$]=0,y[$]=Math.cos(J),C[$]=Math.sin(J)}const S=t(a,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),O=r(a,{...c,gain:0}),M=f(a,{...l,curve:g}),I=r(a,{...c,gain:0}),N=f(a,{...l,curve:v}),L=f(a,{...l,curve:h}),H=r(a,{...c,gain:0}),U=f(a,{...l,curve:y}),R=r(a,{...c,gain:0}),V=f(a,{...l,curve:C});return{connectGraph(){u.connect(S),u.connect(L.inputs===void 0?L:L.inputs[0]),S.connect(O,0),S.connect(I,0),S.connect(H,1),S.connect(R,1),L.connect(o),o.connect(M.inputs===void 0?M:M.inputs[0]),o.connect(N.inputs===void 0?N:N.inputs[0]),o.connect(U.inputs===void 0?U:U.inputs[0]),o.connect(V.inputs===void 0?V:V.inputs[0]),M.connect(O.gain),N.connect(I.gain),U.connect(H.gain),V.connect(R.gain),O.connect(d,0,0),H.connect(d,0,0),I.connect(d,0,1),R.connect(d,0,1)},disconnectGraph(){u.disconnect(S),u.disconnect(L.inputs===void 0?L:L.inputs[0]),S.disconnect(O,0),S.disconnect(I,0),S.disconnect(H,1),S.disconnect(R,1),L.disconnect(o),o.disconnect(M.inputs===void 0?M:M.inputs[0]),o.disconnect(N.inputs===void 0?N:N.inputs[0]),o.disconnect(U.inputs===void 0?U:U.inputs[0]),o.disconnect(V.inputs===void 0?V:V.inputs[0]),M.disconnect(O.gain),N.disconnect(I.gain),U.disconnect(H.gain),V.disconnect(R.gain),O.disconnect(d,0,0),H.disconnect(d,0,0),I.disconnect(d,0,1),R.disconnect(d,0,1)}}},i=(a,u,o,d,g)=>{if(u===1)return n(a,o,d,g);if(u===2)return s(a,o,d,g);throw m()};return(a,{channelCount:u,channelCountMode:o,pan:d,...g})=>{if(o==="max")throw m();const v=p(a,{...g,channelCount:1,channelCountMode:o,numberOfInputs:2}),y=r(a,{...g,channelCount:u,channelCountMode:o,gain:1}),C=r(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:d});let{connectGraph:w,disconnectGraph:S}=i(a,u,y,C,v);Object.defineProperty(C.gain,"defaultValue",{get:()=>0}),Object.defineProperty(C.gain,"maxValue",{get:()=>1}),Object.defineProperty(C.gain,"minValue",{get:()=>-1});const O={get bufferSize(){},get channelCount(){return y.channelCount},set channelCount(L){y.channelCount!==L&&(M&&S(),{connectGraph:w,disconnectGraph:S}=i(a,L,y,C,v),M&&w()),y.channelCount=L},get channelCountMode(){return y.channelCountMode},set channelCountMode(L){if(L==="clamped-max"||L==="max")throw m();y.channelCountMode=L},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(L){y.channelInterpretation=L},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},get pan(){return C.gain},addEventListener(...L){return y.addEventListener(L[0],L[1],L[2])},dispatchEvent(...L){return y.dispatchEvent(L[0])},removeEventListener(...L){return y.removeEventListener(L[0],L[1],L[2])}};let M=!1;const I=()=>{w(),M=!0},N=()=>{S(),M=!1};return _(rn(O,v),I,N)}},dl=(p,t,r,f,m,_,T)=>(h,e)=>{const c=h.createWaveShaper();if(_!==null&&_.name==="webkitAudioContext"&&h.createGain().gain.automationRate===void 0)return r(h,e);Dt(c,e);const l=e.curve===null||e.curve instanceof Float32Array?e.curve:new Float32Array(e.curve);if(l!==null&&l.length<2)throw t();Tt(c,{curve:l},"curve"),Tt(c,e,"oversample");let n=null,s=!1;return T(c,"curve",u=>()=>u.call(c),u=>o=>(u.call(c,o),s&&(f(o)&&n===null?n=p(h,c):!f(o)&&n!==null&&(n(),n=null)),o)),m(c,()=>{s=!0,f(c.curve)&&(n=p(h,c))},()=>{s=!1,n!==null&&(n(),n=null)})},pl=(p,t,r,f,m)=>(_,{curve:T,oversample:h,...e})=>{const c=_.createWaveShaper(),l=_.createWaveShaper();Dt(c,e),Dt(l,e);const n=r(_,{...e,gain:1}),s=r(_,{...e,gain:-1}),i=r(_,{...e,gain:1}),a=r(_,{...e,gain:-1});let u=null,o=!1,d=null;const g={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(C){n.channelCount=C,s.channelCount=C,c.channelCount=C,i.channelCount=C,l.channelCount=C,a.channelCount=C},get channelCountMode(){return c.channelCountMode},set channelCountMode(C){n.channelCountMode=C,s.channelCountMode=C,c.channelCountMode=C,i.channelCountMode=C,l.channelCountMode=C,a.channelCountMode=C},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(C){n.channelInterpretation=C,s.channelInterpretation=C,c.channelInterpretation=C,i.channelInterpretation=C,l.channelInterpretation=C,a.channelInterpretation=C},get context(){return c.context},get curve(){return d},set curve(C){if(C!==null&&C.length<2)throw t();if(C===null)c.curve=C,l.curve=C;else{const w=C.length,S=new Float32Array(w+2-w%2),O=new Float32Array(w+2-w%2);S[0]=C[0],O[0]=-C[w-1];const M=Math.ceil((w+1)/2),I=(w+1)/2-1;for(let N=1;N<M;N+=1){const L=N/M*I,H=Math.floor(L),U=Math.ceil(L);S[N]=H===U?C[H]:(1-(L-H))*C[H]+(1-(U-L))*C[U],O[N]=H===U?-C[w-1-H]:-((1-(L-H))*C[w-1-H])-(1-(U-L))*C[w-1-U]}S[M]=w%2===1?C[M-1]:(C[M-2]+C[M-1])/2,c.curve=S,l.curve=O}d=C,o&&(f(d)&&u===null?u=p(_,n):u!==null&&(u(),u=null))},get inputs(){return[n]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(C){c.oversample=C,l.oversample=C},addEventListener(...C){return n.addEventListener(C[0],C[1],C[2])},dispatchEvent(...C){return n.dispatchEvent(C[0])},removeEventListener(...C){return n.removeEventListener(C[0],C[1],C[2])}};T!==null&&(g.curve=T instanceof Float32Array?T:new Float32Array(T)),h!==g.oversample&&(g.oversample=h);const v=()=>{n.connect(c).connect(i),n.connect(s).connect(l).connect(a).connect(i),o=!0,f(d)&&(u=p(_,n))},y=()=>{n.disconnect(c),c.disconnect(i),n.disconnect(s),s.disconnect(l),l.disconnect(a),a.disconnect(i),o=!1,u!==null&&(u(),u=null)};return m(rn(g,i),v,y)},Wt=()=>new DOMException("","NotSupportedError"),gl={numberOfChannels:1},ml=(p,t,r,f,m)=>class extends p{constructor(T,h,e){let c;if(typeof T=="number"&&h!==void 0&&e!==void 0)c={length:h,numberOfChannels:T,sampleRate:e};else if(typeof T=="object")c=T;else throw new Error("The given parameters are not valid.");const{length:l,numberOfChannels:n,sampleRate:s}={...gl,...c},i=f(n,l,s);t(gn,()=>gn(i))||i.addEventListener("statechange",(()=>{let a=0;const u=o=>{this._state==="running"&&(a>0?(i.removeEventListener("statechange",u),o.stopImmediatePropagation(),this._waitForThePromiseToSettle(o)):a+=1)};return u})()),super(i,n),this._length=l,this._nativeOfflineAudioContext=i,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(r()):(this._state="running",m(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Zr(this)}))}_waitForThePromiseToSettle(T){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(T):setTimeout(()=>this._waitForThePromiseToSettle(T))}},_l={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},vl=(p,t,r,f,m,_,T)=>class extends p{constructor(e,c){const l=m(e),n={..._l,...c},s=r(l,n),i=_(l),a=i?f():null,u=e.sampleRate/2;super(e,!1,s,a),this._detune=t(this,i,s.detune,153600,-153600),this._frequency=t(this,i,s.frequency,u,-u),this._nativeOscillatorNode=s,this._onended=null,this._oscillatorNodeRenderer=a,this._oscillatorNodeRenderer!==null&&n.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=n.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(e){const c=typeof e=="function"?T(this,e):null;this._nativeOscillatorNode.onended=c;const l=this._nativeOscillatorNode.onended;this._onended=l!==null&&l===c?e:l}get type(){return this._nativeOscillatorNode.type}set type(e){this._nativeOscillatorNode.type=e,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(e){this._nativeOscillatorNode.setPeriodicWave(e),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=e)}start(e=0){if(this._nativeOscillatorNode.start(e),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=e),this.context.state!=="closed"){Ze(this);const c=()=>{this._nativeOscillatorNode.removeEventListener("ended",c),me(this)&&Dn(this)};this._nativeOscillatorNode.addEventListener("ended",c)}}stop(e=0){this._nativeOscillatorNode.stop(e),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=e)}},yl=(p,t,r,f,m)=>()=>{const _=new WeakMap;let T=null,h=null,e=null;const c=async(l,n)=>{let s=r(l);const i=Nt(s,n);if(!i){const a={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,detune:s.detune.value,frequency:s.frequency.value,periodicWave:T===null?void 0:T,type:s.type};s=t(n,a),h!==null&&s.start(h),e!==null&&s.stop(e)}return _.set(n,s),i?(await p(n,l.detune,s.detune),await p(n,l.frequency,s.frequency)):(await f(n,l.detune,s.detune),await f(n,l.frequency,s.frequency)),await m(l,n,s),s};return{set periodicWave(l){T=l},set start(l){h=l},set stop(l){e=l},render(l,n){const s=_.get(n);return s!==void 0?Promise.resolve(s):c(l,n)}}},Cl={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Tl=(p,t,r,f,m,_,T)=>class extends p{constructor(e,c){const l=m(e),n={...Cl,...c},s=r(l,n),i=_(l),a=i?f():null;super(e,!1,s,a),this._nativePannerNode=s,this._orientationX=t(this,i,s.orientationX,jt,Yt),this._orientationY=t(this,i,s.orientationY,jt,Yt),this._orientationZ=t(this,i,s.orientationZ,jt,Yt),this._positionX=t(this,i,s.positionX,jt,Yt),this._positionY=t(this,i,s.positionY,jt,Yt),this._positionZ=t(this,i,s.positionZ,jt,Yt),T(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(e){this._nativePannerNode.coneInnerAngle=e}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(e){this._nativePannerNode.coneOuterAngle=e}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(e){this._nativePannerNode.coneOuterGain=e}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(e){this._nativePannerNode.distanceModel=e}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(e){this._nativePannerNode.maxDistance=e}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(e){this._nativePannerNode.panningModel=e}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(e){this._nativePannerNode.refDistance=e}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(e){this._nativePannerNode.rolloffFactor=e}},wl=(p,t,r,f,m,_,T,h,e,c)=>()=>{const l=new WeakMap;let n=null;const s=async(i,a)=>{let u=null,o=_(i);const d={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation},g={...d,coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,panningModel:o.panningModel,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor},v=Nt(o,a);if("bufferSize"in o)u=f(a,{...d,gain:1});else if(!v){const y={...g,orientationX:o.orientationX.value,orientationY:o.orientationY.value,orientationZ:o.orientationZ.value,positionX:o.positionX.value,positionY:o.positionY.value,positionZ:o.positionZ.value};o=m(a,y)}if(l.set(a,u===null?o:u),u!==null){if(n===null){if(T===null)throw new Error("Missing the native OfflineAudioContext constructor.");const N=new T(6,i.context.length,a.sampleRate),L=t(N,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});L.connect(N.destination),n=(async()=>{const H=await Promise.all([i.orientationX,i.orientationY,i.orientationZ,i.positionX,i.positionY,i.positionZ].map(async(U,R)=>{const V=r(N,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:R===0?1:0});return await h(N,U,V.offset),V}));for(let U=0;U<6;U+=1)H[U].connect(L,0,U),H[U].start(0);return c(N)})()}const y=await n,C=f(a,{...d,gain:1});await e(i,a,C);const w=[];for(let N=0;N<y.numberOfChannels;N+=1)w.push(y.getChannelData(N));let S=[w[0][0],w[1][0],w[2][0]],O=[w[3][0],w[4][0],w[5][0]],M=f(a,{...d,gain:1}),I=m(a,{...g,orientationX:S[0],orientationY:S[1],orientationZ:S[2],positionX:O[0],positionY:O[1],positionZ:O[2]});C.connect(M).connect(I.inputs[0]),I.connect(u);for(let N=128;N<y.length;N+=128){const L=[w[0][N],w[1][N],w[2][N]],H=[w[3][N],w[4][N],w[5][N]];if(L.some((U,R)=>U!==S[R])||H.some((U,R)=>U!==O[R])){S=L,O=H;const U=N/a.sampleRate;M.gain.setValueAtTime(0,U),M=f(a,{...d,gain:0}),I=m(a,{...g,orientationX:S[0],orientationY:S[1],orientationZ:S[2],positionX:O[0],positionY:O[1],positionZ:O[2]}),M.gain.setValueAtTime(1,U),C.connect(M).connect(I.inputs[0]),I.connect(u)}}return u}return v?(await p(a,i.orientationX,o.orientationX),await p(a,i.orientationY,o.orientationY),await p(a,i.orientationZ,o.orientationZ),await p(a,i.positionX,o.positionX),await p(a,i.positionY,o.positionY),await p(a,i.positionZ,o.positionZ)):(await h(a,i.orientationX,o.orientationX),await h(a,i.orientationY,o.orientationY),await h(a,i.orientationZ,o.orientationZ),await h(a,i.positionX,o.positionX),await h(a,i.positionY,o.positionY),await h(a,i.positionZ,o.positionZ)),nn(o)?await e(i,a,o.inputs[0]):await e(i,a,o),o};return{render(i,a){const u=l.get(a);return u!==void 0?Promise.resolve(u):s(i,a)}}},Sl={disableNormalization:!1},bl=(p,t,r,f)=>class as{constructor(_,T){const h=t(_),e=f({...Sl,...T}),c=p(h,e);return r.add(c),c}static[Symbol.hasInstance](_){return _!==null&&typeof _=="object"&&Object.getPrototypeOf(_)===as.prototype||r.has(_)}},xl=(p,t)=>(r,f,m)=>(p(f).replay(m),t(f,r,m)),Ol=(p,t,r)=>async(f,m,_)=>{const T=p(f);await Promise.all(T.activeInputs.map((h,e)=>Array.from(h).map(async([c,l])=>{const s=await t(c).render(c,m),i=f.context.destination;!r(c)&&(f!==i||!r(f))&&s.connect(_,l,e)})).reduce((h,e)=>[...h,...e],[]))},kl=(p,t,r)=>async(f,m,_)=>{const T=t(f);await Promise.all(Array.from(T.activeInputs).map(async([h,e])=>{const l=await p(h).render(h,m);r(h)||l.connect(_,e)}))},Al=(p,t,r,f)=>m=>p(gn,()=>gn(m))?Promise.resolve(p(f,f)).then(_=>{if(!_){const T=r(m,512,0,1);m.oncomplete=()=>{T.onaudioprocess=null,T.disconnect()},T.onaudioprocess=()=>m.currentTime,T.connect(m.destination)}return m.startRendering()}):new Promise(_=>{const T=t(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});m.oncomplete=h=>{T.disconnect(),_(h.renderedBuffer)},T.connect(m.destination),m.startRendering()}),El=p=>(t,r)=>{p.set(t,r)},Dl=p=>(t,r)=>p.set(t,r),Ml=(p,t,r,f,m,_,T,h)=>(e,c)=>r(e).render(e,c).then(()=>Promise.all(Array.from(f(c)).map(l=>r(l).render(l,c)))).then(()=>m(c)).then(l=>(typeof l.copyFromChannel!="function"?(T(l),Wi(l)):t(_,()=>_(l))||h(l),p.add(l),l)),Pl={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Il=(p,t,r,f,m,_)=>class extends p{constructor(h,e){const c=m(h),l={...Pl,...e},n=r(c,l),s=_(c),i=s?f():null;super(h,!1,n,i),this._pan=t(this,s,n.pan)}get pan(){return this._pan}},Fl=(p,t,r,f,m)=>()=>{const _=new WeakMap,T=async(h,e)=>{let c=r(h);const l=Nt(c,e);if(!l){const n={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=t(e,n)}return _.set(e,c),l?await p(e,h.pan,c.pan):await f(e,h.pan,c.pan),nn(c)?await m(h,e,c.inputs[0]):await m(h,e,c),c};return{render(h,e){const c=_.get(e);return c!==void 0?Promise.resolve(c):T(h,e)}}},Rl=p=>()=>{if(p===null)return!1;try{new p({length:1,sampleRate:44100})}catch{return!1}return!0},Nl=(p,t)=>async()=>{if(p===null)return!0;if(t===null)return!1;const r=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),f=new t(1,128,44100),m=URL.createObjectURL(r);let _=!1,T=!1;try{await f.audioWorklet.addModule(m);const h=new p(f,"a",{numberOfOutputs:0}),e=f.createOscillator();h.port.onmessage=()=>_=!0,h.onprocessorerror=()=>T=!0,e.connect(h),e.start(0),await f.startRendering(),await new Promise(c=>setTimeout(c))}catch{}finally{URL.revokeObjectURL(m)}return _&&!T},Ll=(p,t)=>()=>{if(t===null)return Promise.resolve(!1);const r=new t(1,1,44100),f=p(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(m=>{r.oncomplete=()=>{f.disconnect(),m(r.currentTime!==0)},r.startRendering()})},jl=()=>new DOMException("","UnknownError"),Bl={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Vl=(p,t,r,f,m,_,T)=>class extends p{constructor(e,c){const l=m(e),n={...Bl,...c},s=r(l,n),a=_(l)?f():null;super(e,!0,s,a),this._isCurveNullified=!1,this._nativeWaveShaperNode=s,T(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(e){if(e===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(e){this._nativeWaveShaperNode.oversample=e}},Wl=(p,t,r)=>()=>{const f=new WeakMap,m=async(_,T)=>{let h=t(_);if(!Nt(h,T)){const c={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,curve:h.curve,oversample:h.oversample};h=p(T,c)}return f.set(T,h),nn(h)?await r(_,T,h.inputs[0]):await r(_,T,h),h};return{render(_,T){const h=f.get(T);return h!==void 0?Promise.resolve(h):m(_,T)}}},Xl=()=>typeof window>"u"?null:window,Yl=(p,t)=>r=>{r.copyFromChannel=(f,m,_=0)=>{const T=p(_),h=p(m);if(h>=r.numberOfChannels)throw t();const e=r.length,c=r.getChannelData(h),l=f.length;for(let n=T<0?-T:0;n+T<e&&n<l;n+=1)f[n]=c[n+T]},r.copyToChannel=(f,m,_=0)=>{const T=p(_),h=p(m);if(h>=r.numberOfChannels)throw t();const e=r.length,c=r.getChannelData(h),l=f.length;for(let n=T<0?-T:0;n+T<e&&n<l;n+=1)c[n+T]=f[n]}},Ul=p=>t=>{t.copyFromChannel=(r=>(f,m,_=0)=>{const T=p(_),h=p(m);if(T<t.length)return r.call(t,f,h,T)})(t.copyFromChannel),t.copyToChannel=(r=>(f,m,_=0)=>{const T=p(_),h=p(m);if(T<t.length)return r.call(t,f,h,T)})(t.copyToChannel)},zl=p=>(t,r)=>{const f=r.createBuffer(1,1,44100);t.buffer===null&&(t.buffer=f),p(t,"buffer",m=>()=>{const _=m.call(t);return _===f?null:_},m=>_=>m.call(t,_===null?f:_))},Gl=(p,t)=>(r,f)=>{f.channelCount=1,f.channelCountMode="explicit",Object.defineProperty(f,"channelCount",{get:()=>1,set:()=>{throw p()}}),Object.defineProperty(f,"channelCountMode",{get:()=>"explicit",set:()=>{throw p()}});const m=r.createBufferSource();t(f,()=>{const h=f.numberOfInputs;for(let e=0;e<h;e+=1)m.connect(f,0,e)},()=>m.disconnect(f))},cs=(p,t,r)=>p.copyFromChannel===void 0?p.getChannelData(r)[0]:(p.copyFromChannel(t,r),t[0]),ls=p=>{if(p===null)return!1;const t=p.length;return t%2!==0?p[Math.floor(t/2)]!==0:p[t/2-1]+p[t/2]!==0},Rn=(p,t,r,f)=>{let m=p;for(;!m.hasOwnProperty(t);)m=Object.getPrototypeOf(m);const{get:_,set:T}=Object.getOwnPropertyDescriptor(m,t);Object.defineProperty(p,t,{get:r(_),set:f(T)})},Hl=p=>({...p,outputChannelCount:p.outputChannelCount!==void 0?p.outputChannelCount:p.numberOfInputs===1&&p.numberOfOutputs===1?[p.channelCount]:Array.from({length:p.numberOfOutputs},()=>1)}),ql=p=>({...p,channelCount:p.numberOfOutputs}),$l=p=>{const{imag:t,real:r}=p;return t===void 0?r===void 0?{...p,imag:[0,0],real:[0,0]}:{...p,imag:Array.from(r,()=>0),real:r}:r===void 0?{...p,imag:t,real:Array.from(t,()=>0)}:{...p,imag:t,real:r}},hs=(p,t,r)=>{try{p.setValueAtTime(t,r)}catch(f){if(f.code!==9)throw f;hs(p,t,r+1e-7)}},Kl=p=>{const t=p.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},Zl=p=>{const t=p.createBufferSource(),r=p.createBuffer(1,1,44100);t.buffer=r;try{t.start(0,1)}catch{return!1}return!0},Ql=p=>{const t=p.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},Gi=p=>{const t=p.createOscillator();try{t.start(-1)}catch(r){return r instanceof RangeError}return!1},us=p=>{const t=p.createBuffer(1,1,44100),r=p.createBufferSource();r.buffer=t,r.start(),r.stop();try{return r.stop(),!0}catch{return!1}},Hi=p=>{const t=p.createOscillator();try{t.stop(-1)}catch(r){return r instanceof RangeError}return!1},Jl=p=>{const{port1:t,port2:r}=new MessageChannel;try{t.postMessage(p)}finally{t.close(),r.close()}},th=p=>{p.start=(t=>(r=0,f=0,m)=>{const _=p.buffer,T=_===null?f:Math.min(_.duration,f);_!==null&&T>_.duration-.5/p.context.sampleRate?t.call(p,r,0,0):t.call(p,r,T,m)})(p.start)},fs=(p,t)=>{const r=t.createGain();p.connect(r);const f=(m=>()=>{m.call(p,r),p.removeEventListener("ended",f)})(p.disconnect);p.addEventListener("ended",f),rn(p,r),p.stop=(m=>{let _=!1;return(T=0)=>{if(_)try{m.call(p,T)}catch{r.gain.setValueAtTime(0,T)}else m.call(p,T),_=!0}})(p.stop)},sn=(p,t)=>r=>{const f={value:p};return Object.defineProperties(r,{currentTarget:f,target:f}),typeof t=="function"?t.call(p,r):t.handleEvent.call(p,r)},eh=To(Ve),nh=ko(Ve),ih=Ba(di),ds=new WeakMap,rh=ic(ds),ie=ga(new Map,new WeakMap),ae=Xl(),ps=Ic(ie,le),qi=nc(Bt),Rt=Ol(Bt,qi,Ie),sh=Po(ps,yt,Rt),vt=oc(fi),ve=ol(ae),dt=Sc(ve),gs=new WeakMap,ms=$a(sn),Nn=Lc(ae),$i=yc(Nn),Ki=Cc(ae),_s=Tc(ae),mn=Bc(ae),Ot=ia(wo(Ur),Oo(eh,nh,Qn,ih,Jn,Bt,rh,En,yt,Ve,me,Ie,zn),ie,pc(Di,Jn,Bt,yt,pn,me),le,pi,Wt,Ra(Qn,Di,Bt,yt,pn,vt,me,dt),Xa(gs,Bt,ne),ms,vt,$i,Ki,_s,dt,mn),oh=Mo(Ot,sh,le,ps,vt,dt),Zi=new WeakSet,Dr=Fc(ae),vs=Aa(new Uint32Array(1)),Qi=Yl(vs,le),Ji=Ul(vs),ah=Fo(Zi,ie,Wt,Dr,ve,Rl(Dr),Qi,Ji),gi=Ao(zt),ys=kl(qi,Mn,Ie),he=wa(ys),on=Nc(gi,ie,Kl,Zl,Ql,Gi,us,Hi,th,zl(Rn),fs),ue=xl(rc(Mn),ys),ch=Lo(he,on,yt,ue,Rt),re=ra(So(zr),gs,Vi,sa,go,mo,_o,vo,yo,ki,Xr,Nn,hs),lh=No(Ot,ch,re,Ft,on,vt,dt,sn),hh=Go(Ot,Ho,le,Ft,jc(zt,Rn),vt,dt,Rt),uh=pa(he,ss,yt,ue,Rt),We=Dl(ds),fh=da(Ot,re,uh,pi,ss,vt,dt,We),Oe=Mc(Ve,Ki),dh=Gl(Ft,Oe),ke=Gc(Nn,dh),ph=va(ke,yt,Rt),gh=_a(Ot,ph,ke,vt,dt),mh=Ta(In,yt,Rt),_h=Ca(Ot,mh,In,vt,dt,ql),vh=$c(gi,on,zt,Oe),an=qc(gi,ie,vh,Gi,Hi),yh=ka(he,an,yt,ue,Rt),Ch=Oa(Ot,re,yh,an,vt,dt,sn),Cs=Kc(Wt,Rn),Th=Ma(Cs,yt,Rt),wh=Da(Ot,Th,Cs,vt,dt,We),Sh=ja(he,os,yt,ue,Rt),bh=La(Ot,re,Sh,os,vt,dt,We),Ts=Zc(Wt),xh=Ga(he,Ts,yt,ue,Rt),Oh=za(Ot,re,xh,Ts,Wt,vt,dt,We),kh=tc(he,zt,yt,ue,Rt),Ah=Ja(Ot,re,kh,zt,vt,dt),Eh=el(pi,Ft,Fn,Wt),mi=Al(ie,zt,Fn,Ll(zt,ve)),Dh=dc(on,yt,ve,Rt,mi),Mh=Qc(Eh),Ph=uc(Ot,Mh,Dh,vt,dt,We),Ih=qo(re,ke,an,Fn,Wt,cs,dt,Rn),ws=new WeakMap,Fh=Dc(hh,Ih,ms,dt,ws,sn),Ss=al(gi,ie,Gi,us,Hi,fs),Rh=yl(he,Ss,yt,ue,Rt),Nh=vl(Ot,re,Ss,Rh,vt,dt,sn),bs=ba(on),Lh=pl(bs,Ft,zt,ls,Oe),_i=dl(bs,Ft,Lh,ls,Oe,Nn,Rn),jh=ll(Qn,Ft,ke,zt,Fn,_i,Wt,Jn,cs,Oe),xs=cl(jh),Bh=wl(he,ke,an,zt,xs,yt,ve,ue,Rt,mi),Vh=Tl(Ot,re,xs,Bh,vt,dt,We),Wh=hl(le),Xh=bl(Wh,vt,new WeakSet,$l),Yh=fl(ke,In,zt,_i,Wt,Oe),Os=ul(Yh,Wt),Uh=Fl(he,Os,yt,ue,Rt),zh=Il(Ot,re,Os,Uh,vt,dt),Gh=Wl(_i,yt,Rt),Hh=Vl(Ot,Ft,_i,Gh,vt,dt,We),ks=bc(ae),tr=Ka(ae),As=new WeakMap,qh=ac(As,ve),$h=ks?xo(ie,Wt,qa(ae),tr,Za(Co),vt,qh,dt,mn,new WeakMap,new WeakMap,Nl(mn,ve),ae):void 0,Kh=wc($i,dt),Zh=Fa(Zi,ie,Ia,Ha,new WeakSet,vt,Kh,Kn,gn,Qi,Ji),Es=ua($h,oh,ah,lh,fh,gh,_h,Ch,wh,Zh,bh,Oh,Ah,Ph,Fh,Nh,Vh,Xh,zh,Hh),Qh=xc(Ot,nl,vt,dt),Jh=kc(Ot,il,vt,dt),tu=Ac(Ot,rl,vt,dt),eu=sl(Ft,dt),nu=Ec(Ot,eu,vt),iu=zo(Es,Ft,Wt,jl,Qh,Jh,tu,nu,Nn),er=cc(ws),ru=Eo(er),Ds=Sa(le),su=Va(er),Ms=Ya(le),Ps=new WeakMap,ou=ec(Ps,ne),au=zc(Ds,le,Ft,ke,In,an,zt,Fn,Wt,Ms,tr,ou,Oe),cu=Wc(Ft,au,zt,Wt,Oe),lu=ha(he,Ds,on,ke,In,an,zt,su,Ms,tr,yt,mn,ve,ue,Rt,mi),hu=sc(As),uu=El(Ps),Mr=ks?aa(ru,Ot,re,lu,cu,Bt,hu,vt,dt,mn,Hl,uu,Jl,sn):void 0,fu=Pa(Wt,ve),du=Ml(Zi,ie,qi,er,mi,Kn,Qi,Ji),pu=ml(Es,ie,Ft,fu,du),gu=gc(fi,$i),mu=mc(Bi,Ki),_u=_c(Vi,_s),vu=vc(fi,dt);function ct(p,t){if(!p)throw new Error(t)}function be(p,t,r=1/0){if(!(t<=p&&p<=r))throw new RangeError(`Value must be within [${t}, ${r}], got: ${p}`)}function Is(p){!p.isOffline&&p.state!=="running"&&Rs('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Fs=console;function yu(...p){Fs.log(...p)}function Rs(...p){Fs.warn(...p)}function Qt(p){return typeof p>"u"}function ut(p){return!Qt(p)}function Cu(p){return typeof p=="function"}function Fe(p){return typeof p=="number"}function Me(p){return Object.prototype.toString.call(p)==="[object Object]"&&p.constructor===Object}function Tu(p){return typeof p=="boolean"}function ee(p){return Array.isArray(p)}function ce(p){return typeof p=="string"}function Wn(p){return ce(p)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(p)}function wu(p){return new iu(p)}function Su(p,t,r){return new pu(p,t,r)}const Pe=typeof self=="object"?self:null,bu=Pe&&(Pe.hasOwnProperty("AudioContext")||Pe.hasOwnProperty("webkitAudioContext"));function xu(p,t,r){return ct(ut(Mr),"This node only works in a secure context (https or localhost)"),new Mr(p,t,r)}function se(p,t,r,f){var m=arguments.length,_=m<3?t:f===null?f=Object.getOwnPropertyDescriptor(t,r):f,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(p,t,r,f);else for(var h=p.length-1;h>=0;h--)(T=p[h])&&(_=(m<3?T(_):m>3?T(t,r,_):T(t,r))||_);return m>3&&_&&Object.defineProperty(t,r,_),_}function Et(p,t,r,f){function m(_){return _ instanceof r?_:new r(function(T){T(_)})}return new(r||(r=Promise))(function(_,T){function h(l){try{c(f.next(l))}catch(n){T(n)}}function e(l){try{c(f.throw(l))}catch(n){T(n)}}function c(l){l.done?_(l.value):m(l.value).then(h,e)}c((f=f.apply(p,t||[])).next())})}class Ou{constructor(t,r,f){this._callback=t,this._type=r,this._updateInterval=f,this._createClock()}_createWorker(){const t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),r=URL.createObjectURL(t),f=new Worker(r);f.onmessage=this._callback.bind(this),this._worker=f}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(t*1e3,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Re(p){return _u(p)}function Se(p){return mu(p)}function Gn(p){return vu(p)}function ze(p){return gu(p)}function Ns(p){return p instanceof AudioBuffer}function ku(p,t){return p==="value"||Re(t)||Se(t)||Ns(t)}function He(p,...t){if(!t.length)return p;const r=t.shift();if(Me(p)&&Me(r))for(const f in r)ku(f,r[f])?p[f]=r[f]:Me(r[f])?(p[f]||Object.assign(p,{[f]:{}}),He(p[f],r[f])):Object.assign(p,{[f]:r[f]});return He(p,...t)}function Au(p,t){return p.length===t.length&&p.every((r,f)=>t[f]===r)}function it(p,t,r=[],f){const m={},_=Array.from(t);if(Me(_[0])&&f&&!Reflect.has(_[0],f)&&(Object.keys(_[0]).some(h=>Reflect.has(p,h))||(He(m,{[f]:_[0]}),r.splice(r.indexOf(f),1),_.shift())),_.length===1&&Me(_[0]))He(m,_[0]);else for(let T=0;T<r.length;T++)ut(_[T])&&(m[r[T]]=_[T]);return He(p,m)}function Eu(p){return p.constructor.getDefaults()}function qe(p,t){return Qt(p)?t:p}function Pr(p,t){return t.forEach(r=>{Reflect.has(p,r)&&delete p[r]}),p}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class ye{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Pe&&this.toString()===Pe.TONE_DEBUG_CLASS)&&yu(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}ye.version=Wr;const nr=1e-6;function ii(p,t){return p>t+nr}function Ri(p,t){return ii(p,t)||Jt(p,t)}function Ls(p,t){return p+nr<t}function Jt(p,t){return Math.abs(p-t)<nr}function Du(p,t,r){return Math.max(Math.min(p,r),t)}class fe extends ye{constructor(){super(),this.name="Timeline",this._timeline=[];const t=it(fe.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(ct(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const r=this._timeline[this.length-1];ct(Ri(t.time,r.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const r=this._search(t.time);this._timeline.splice(r+1,0,t)}if(this.length>this.memory){const r=this.length-this.memory;this._timeline.splice(0,r)}return this}remove(t){const r=this._timeline.indexOf(t);return r!==-1&&this._timeline.splice(r,1),this}get(t,r="time"){const f=this._search(t,r);return f!==-1?this._timeline[f]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,r="time"){const f=this._search(t,r);return f+1<this._timeline.length?this._timeline[f+1]:null}getBefore(t){const r=this._timeline.length;if(r>0&&this._timeline[r-1].time<t)return this._timeline[r-1];const f=this._search(t);return f-1>=0?this._timeline[f-1]:null}cancel(t){if(this._timeline.length>1){let r=this._search(t);if(r>=0)if(Jt(this._timeline[r].time,t)){for(let f=r;f>=0&&Jt(this._timeline[f].time,t);f--)r=f;this._timeline=this._timeline.slice(0,r)}else this._timeline=this._timeline.slice(0,r+1);else this._timeline=[]}else this._timeline.length===1&&Ri(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const r=this._search(t);return r>=0&&(this._timeline=this._timeline.slice(r+1)),this}previousEvent(t){const r=this._timeline.indexOf(t);return r>0?this._timeline[r-1]:null}_search(t,r="time"){if(this._timeline.length===0)return-1;let f=0;const m=this._timeline.length;let _=m;if(m>0&&this._timeline[m-1][r]<=t)return m-1;for(;f<_;){let T=Math.floor(f+(_-f)/2);const h=this._timeline[T],e=this._timeline[T+1];if(Jt(h[r],t)){for(let c=T;c<this._timeline.length;c++){const l=this._timeline[c];if(Jt(l[r],t))T=c;else break}return T}else{if(Ls(h[r],t)&&ii(e[r],t))return T;ii(h[r],t)?_=T:f=T+1}}return-1}_iterate(t,r=0,f=this._timeline.length-1){this._timeline.slice(r,f+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,r){const f=this._search(t);return f!==-1&&this._iterate(r,0,f),this}forEachAfter(t,r){const f=this._search(t);return this._iterate(r,f+1),this}forEachBetween(t,r,f){let m=this._search(t),_=this._search(r);return m!==-1&&_!==-1?(this._timeline[m].time!==t&&(m+=1),this._timeline[_].time===r&&(_-=1),this._iterate(f,m,_)):m===-1&&this._iterate(f,0,_),this}forEachFrom(t,r){let f=this._search(t);for(;f>=0&&this._timeline[f].time>=t;)f--;return this._iterate(r,f+1),this}forEachAtTime(t,r){const f=this._search(t);if(f!==-1&&Jt(this._timeline[f].time,t)){let m=f;for(let _=f;_>=0&&Jt(this._timeline[_].time,t);_--)m=_;this._iterate(_=>{r(_)},m,f)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const js=[];function vi(p){js.push(p)}function Mu(p){js.forEach(t=>t(p))}const Bs=[];function yi(p){Bs.push(p)}function Pu(p){Bs.forEach(t=>t(p))}class Ln extends ye{constructor(){super(...arguments),this.name="Emitter"}on(t,r){return t.split(/\W+/).forEach(m=>{Qt(this._events)&&(this._events={}),this._events.hasOwnProperty(m)||(this._events[m]=[]),this._events[m].push(r)}),this}once(t,r){const f=(...m)=>{r(...m),this.off(t,f)};return this.on(t,f),this}off(t,r){return t.split(/\W+/).forEach(m=>{if(Qt(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Qt(r))this._events[t]=[];else{const _=this._events[t];for(let T=_.length-1;T>=0;T--)_[T]===r&&_.splice(T,1)}}),this}emit(t,...r){if(this._events&&this._events.hasOwnProperty(t)){const f=this._events[t].slice(0);for(let m=0,_=f.length;m<_;m++)f[m].apply(this,r)}return this}static mixin(t){["on","once","off","emit"].forEach(r=>{const f=Object.getOwnPropertyDescriptor(Ln.prototype,r);Object.defineProperty(t.prototype,r,f)})}dispose(){return super.dispose(),this._events=void 0,this}}class Vs extends Ln{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class jn extends Vs{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new fe,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=it(jn.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=wu({latencyHint:t.latencyHint}),this._ticker=new Ou(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Mu(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,r,f){return this._context.createBuffer(t,r,f)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,r){return this._context.createIIRFilter(t,r)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,r,f){return this._context.createPeriodicWave(t,r,f)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return ct(ze(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return ct(ze(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return ct(ze(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){ct(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){ct(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){ct(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){ct(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,r){return xu(this.rawContext,t,r)}addAudioWorkletModule(t,r){return Et(this,void 0,void 0,function*(){ct(ut(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(r)||this._workletModules.set(r,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(r)})}workletsAreReady(){return Et(this,void 0,void 0,function*(){const t=[];this._workletModules.forEach(r=>t.push(r)),yield Promise.all(t)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let r=0;if(this._latencyHint=t,ce(t))switch(t){case"interactive":r=.1;break;case"playback":r=.5;break;case"balanced":r=.25;break}this.lookAhead=r,this.updateInterval=r/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return ze(this._context)?this._context.resume():Promise.resolve()}close(){return Et(this,void 0,void 0,function*(){ze(this._context)&&(yield this._context.close()),this._initialized&&Pu(this)})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const r=this._context.createBuffer(1,128,this._context.sampleRate),f=r.getChannelData(0);for(let _=0;_<f.length;_++)f[_]=t;const m=this._context.createBufferSource();return m.channelCount=1,m.channelCountMode="explicit",m.buffer=r,m.loop=!0,m.start(0),this._constants.set(t,m),m}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){const t=this.now();let r=this._timeouts.peek();for(;this._timeouts.length&&r&&r.time<=t;)r.callback(),this._timeouts.shift(),r=this._timeouts.peek()}setTimeout(t,r){this._timeoutIds++;const f=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:f+r}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(r=>{r.id===t&&this._timeouts.remove(r)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,r){const f=++this._timeoutIds,m=()=>{const _=this.now();this._timeouts.add({callback:()=>{t(),m()},id:f,time:_+r})};return m(),f}}class Iu extends Vs{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,r,f){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,r){return{}}createPanner(){return{}}createPeriodicWave(t,r,f){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,r){return{}}get rawContext(){return{}}addAudioWorkletModule(t,r){return Et(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,r){return 0}clearTimeout(t){return this}setInterval(t,r){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}}function St(p,t){ee(t)?t.forEach(r=>St(p,r)):Object.defineProperty(p,t,{enumerable:!0,writable:!1})}function Ws(p,t){ee(t)?t.forEach(r=>Ws(p,r)):Object.defineProperty(p,t,{writable:!0})}const gt=()=>{};class _t extends ye{constructor(){super(),this.name="ToneAudioBuffer",this.onload=gt;const t=it(_t.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Ns(t.url)||t.url instanceof _t?this.set(t.url):ce(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:gt,onload:gt,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Kt().sampleRate}set(t){return t instanceof _t?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Et(this,void 0,void 0,function*(){const r=_t.load(t).then(f=>{this.set(f),this.onload(this)});_t.downloads.push(r);try{yield r}finally{const f=_t.downloads.indexOf(r);_t.downloads.splice(f,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const r=ee(t)&&t[0].length>0,f=r?t.length:1,m=r?t[0].length:t.length,_=Kt(),T=_.createBuffer(f,m,_.sampleRate),h=!r&&f===1?[t]:t;for(let e=0;e<f;e++)T.copyToChannel(h[e],e);return this._buffer=T,this}toMono(t){if(Fe(t))this.fromArray(this.toArray(t));else{let r=new Float32Array(this.length);const f=this.numberOfChannels;for(let m=0;m<f;m++){const _=this.toArray(m);for(let T=0;T<_.length;T++)r[T]+=_[T]}r=r.map(m=>m/f),this.fromArray(r)}return this}toArray(t){if(Fe(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{const r=[];for(let f=0;f<this.numberOfChannels;f++)r[f]=this.getChannelData(f);return r}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,r=this.duration){const f=Math.floor(t*this.sampleRate),m=Math.floor(r*this.sampleRate);ct(f<m,"The start time must be less than the end time");const _=m-f,T=Kt().createBuffer(this.numberOfChannels,_,this.sampleRate);for(let h=0;h<this.numberOfChannels;h++)T.copyToChannel(this.getChannelData(h).subarray(f,m),h);return new _t(T)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new _t().fromArray(t)}static fromUrl(t){return Et(this,void 0,void 0,function*(){return yield new _t().load(t)})}static load(t){return Et(this,void 0,void 0,function*(){const r=t.match(/\[([^\]\[]+\|.+)\]$/);if(r){const h=r[1].split("|");let e=h[0];for(const c of h)if(_t.supportsType(c)){e=c;break}t=t.replace(r[0],e)}const f=_t.baseUrl===""||_t.baseUrl.endsWith("/")?_t.baseUrl:_t.baseUrl+"/",m=yield fetch(f+t);if(!m.ok)throw new Error(`could not load url: ${t}`);const _=yield m.arrayBuffer();return yield Kt().decodeAudioData(_)})}static supportsType(t){const r=t.split("."),f=r[r.length-1];return document.createElement("audio").canPlayType("audio/"+f)!==""}static loaded(){return Et(this,void 0,void 0,function*(){for(yield Promise.resolve();_t.downloads.length;)yield _t.downloads[0]})}}_t.baseUrl="";_t.downloads=[];class ir extends jn{constructor(){super({clockSource:"offline",context:Gn(arguments[0])?arguments[0]:Su(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Gn(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Gn(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Et(this,void 0,void 0,function*(){let r=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,r++;const f=Math.floor(this.sampleRate/128);t&&r%f===0&&(yield new Promise(m=>setTimeout(m,1)))}})}render(t=!0){return Et(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(t);const r=yield this._context.startRendering();return new _t(r)})}close(){return Promise.resolve()}}const Xs=new Iu;let $e=Xs;function Kt(){return $e===Xs&&bu&&Fu(new jn),$e}function Fu(p){ze(p)?$e=new jn(p):Gn(p)?$e=new ir(p):$e=p}function Ru(){return $e.resume()}if(Pe&&!Pe.TONE_SILENCE_LOGGING){const t=` * Tone.js v${Wr} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function Nu(p){return Math.pow(10,p/20)}function Lu(p){return 20*(Math.log(p)/Math.LN10)}function Ys(p){return Math.pow(2,p/12)}let Ci=440;function ju(){return Ci}function Bu(p){Ci=p}function Ni(p){return Math.round(Us(p))}function Us(p){return 69+12*Math.log2(p/Ci)}function Vu(p){return Ci*Math.pow(2,(p-69)/12)}class rr extends ye{constructor(t,r,f){super(),this.defaultUnits="s",this._val=r,this._units=f,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,r)=>{const f=parseInt(t,10),m=r==="."?1.5:1;return f===1?this._beatsToUnits(this._getTimeSignature())*m:this._beatsToUnits(4/f)*m},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const r=parseInt(t,10);return this._beatsToUnits(8/(Math.floor(r)*3))},regexp:/^(\d+)t$/i},tr:{method:(t,r,f)=>{let m=0;return t&&t!=="0"&&(m+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),r&&r!=="0"&&(m+=this._beatsToUnits(parseFloat(r))),f&&f!=="0"&&(m+=this._beatsToUnits(parseFloat(f)/4)),m},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof rr&&this.fromType(this._val),Qt(this._val))return this._noArg();if(ce(this._val)&&Qt(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Me(this._val)){let t=0;for(const r in this._val)if(ut(this._val[r])){const f=this._val[r],m=new this.constructor(this.context,r).valueOf()*f;t+=m}return t}if(ut(this._units)){const t=this._expressions[this._units],r=this._val.toString().trim().match(t.regexp);return r?t.method.apply(this,r.slice(1)):t.method.call(this,this._val)}else return ce(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class te extends rr{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const r=new te(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(r))},regexp:/^@(.+)/}})}quantize(t,r=1){const f=new this.constructor(this.context,t).valueOf(),m=this.valueOf(),h=Math.round(m/f)*f-m;return m+h*r}toNotation(){const t=this.toSeconds(),r=["1m"];for(let _=1;_<9;_++){const T=Math.pow(2,_);r.push(T+"n."),r.push(T+"n"),r.push(T+"t")}r.push("0");let f=r[0],m=new te(this.context,r[0]).toSeconds();return r.forEach(_=>{const T=new te(this.context,_).toSeconds();Math.abs(T-t)<Math.abs(m-t)&&(f=_,m=T)}),f}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let r=this.valueOf()/t;r=parseFloat(r.toFixed(4));const f=Math.floor(r/this._getTimeSignature());let m=r%1*4;r=Math.floor(r)%this._getTimeSignature();const _=m.toString();return _.length>3&&(m=parseFloat(parseFloat(_).toFixed(3))),[f,r,m].join(":")}toTicks(){const t=this._beatsToUnits(1),r=this.valueOf()/t;return Math.round(r*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Ni(this.toFrequency())}_now(){return this.context.now()}}class Zt extends te{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return ju()}static set A4(t){Bu(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:Zt.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,r){const m=Wu[t.toLowerCase()]+(parseInt(r,10)+1)*12;return this.defaultUnits==="midi"?m:Zt.mtof(m)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,r,f){let m=1;return t&&t!=="0"&&(m*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),r&&r!=="0"&&(m*=this._beatsToUnits(parseFloat(r))),f&&f!=="0"&&(m*=this._beatsToUnits(parseFloat(f)/4)),m}}})}transpose(t){return new Zt(this.context,this.valueOf()*Ys(t))}harmonize(t){return t.map(r=>this.transpose(r))}toMidi(){return Ni(this.valueOf())}toNote(){const t=this.toFrequency(),r=Math.log2(t/Zt.A4);let f=Math.round(12*r)+57;const m=Math.floor(f/12);return m<0&&(f+=-12*m),Xu[f%12]+m.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),r=this.valueOf()/t;return Math.floor(r*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(t*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return Vu(t)}static ftom(t){return Ni(t)}}const Wu={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},Xu=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class dn extends te{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ut extends ye{constructor(){super();const t=it(Ut.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Kt()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new te(this.context,t).toSeconds()}toFrequency(t){return new Zt(this.context,t).toFrequency()}toTicks(t){return new dn(this.context,t).toTicks()}_getPartialProperties(t){const r=this.get();return Object.keys(r).forEach(f=>{Qt(t[f])&&delete r[f]}),r}get(){const t=Eu(this);return Object.keys(t).forEach(r=>{if(Reflect.has(this,r)){const f=this[r];ut(f)&&ut(f.value)&&ut(f.setValueAtTime)?t[r]=f.value:f instanceof Ut?t[r]=f._getPartialProperties(t[r]):ee(f)||Fe(f)||ce(f)||Tu(f)?t[r]=f:delete t[r]}}),t}set(t){return Object.keys(t).forEach(r=>{Reflect.has(this,r)&&ut(this[r])&&(this[r]&&ut(this[r].value)&&ut(this[r].setValueAtTime)?this[r].value!==t[r]&&(this[r].value=t[r]):this[r]instanceof Ut?this[r].set(t[r]):this[r]=t[r])}),this}}class sr extends fe{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const r=this.get(t);return r!==null?r.state:this._initial}setStateAtTime(t,r,f){return be(r,0),this.add(Object.assign({},f,{state:t,time:r})),this}getLastState(t,r){const f=this._search(r);for(let m=f;m>=0;m--){const _=this._timeline[m];if(_.state===t)return _}}getNextState(t,r){const f=this._search(r);if(f!==-1)for(let m=f;m<this._timeline.length;m++){const _=this._timeline[m];if(_.state===t)return _}}}class Ct extends Ut{constructor(){super(it(Ct.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=it(Ct.getDefaults(),arguments,["param","units","convert"]);for(ct(ut(t.param)&&(Re(t.param)||t.param instanceof Ct),"param must be an AudioParam");!Re(t.param);)t.param=t.param._param;this._swappable=ut(t.swappable)?t.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new fe(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,ut(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ut.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return ut(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return ut(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,r){return this.units===r}_assertRange(t){return ut(this.maxValue)&&ut(this.minValue)&&be(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?Nu(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?Lu(t):t}setValueAtTime(t,r){const f=this.toSeconds(r),m=this._fromType(t);return ct(isFinite(m)&&isFinite(f),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._assertRange(m),this.log(this.units,"setValueAtTime",t,f),this._events.add({time:f,type:"setValueAtTime",value:m}),this._param.setValueAtTime(m,f),this}getValueAtTime(t){const r=Math.max(this.toSeconds(t),0),f=this._events.getAfter(r),m=this._events.get(r);let _=this._initialValue;if(m===null)_=this._initialValue;else if(m.type==="setTargetAtTime"&&(f===null||f.type==="setValueAtTime")){const T=this._events.getBefore(m.time);let h;T===null?h=this._initialValue:h=T.value,m.type==="setTargetAtTime"&&(_=this._exponentialApproach(m.time,h,m.value,m.constant,r))}else if(f===null)_=m.value;else if(f.type==="linearRampToValueAtTime"||f.type==="exponentialRampToValueAtTime"){let T=m.value;if(m.type==="setTargetAtTime"){const h=this._events.getBefore(m.time);h===null?T=this._initialValue:T=h.value}f.type==="linearRampToValueAtTime"?_=this._linearInterpolate(m.time,T,f.time,f.value,r):_=this._exponentialInterpolate(m.time,T,f.time,f.value,r)}else _=m.value;return this._toType(_)}setRampPoint(t){t=this.toSeconds(t);let r=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(r)===0&&(r=this._toType(this._minOutput)),this.setValueAtTime(r,t),this}linearRampToValueAtTime(t,r){const f=this._fromType(t),m=this.toSeconds(r);return ct(isFinite(f)&&isFinite(m),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._assertRange(f),this._events.add({time:m,type:"linearRampToValueAtTime",value:f}),this.log(this.units,"linearRampToValueAtTime",t,m),this._param.linearRampToValueAtTime(f,m),this}exponentialRampToValueAtTime(t,r){let f=this._fromType(t);f=Jt(f,0)?this._minOutput:f,this._assertRange(f);const m=this.toSeconds(r);return ct(isFinite(f)&&isFinite(m),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._events.add({time:m,type:"exponentialRampToValueAtTime",value:f}),this.log(this.units,"exponentialRampToValueAtTime",t,m),this._param.exponentialRampToValueAtTime(f,m),this}exponentialRampTo(t,r,f){return f=this.toSeconds(f),this.setRampPoint(f),this.exponentialRampToValueAtTime(t,f+this.toSeconds(r)),this}linearRampTo(t,r,f){return f=this.toSeconds(f),this.setRampPoint(f),this.linearRampToValueAtTime(t,f+this.toSeconds(r)),this}targetRampTo(t,r,f){return f=this.toSeconds(f),this.setRampPoint(f),this.exponentialApproachValueAtTime(t,f,r),this}exponentialApproachValueAtTime(t,r,f){r=this.toSeconds(r),f=this.toSeconds(f);const m=Math.log(f+1)/Math.log(200);return this.setTargetAtTime(t,r,m),this.cancelAndHoldAtTime(r+f*.9),this.linearRampToValueAtTime(t,r+f),this}setTargetAtTime(t,r,f){const m=this._fromType(t);ct(isFinite(f)&&f>0,"timeConstant must be a number greater than 0");const _=this.toSeconds(r);return this._assertRange(m),ct(isFinite(m)&&isFinite(_),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._events.add({constant:f,time:_,type:"setTargetAtTime",value:m}),this.log(this.units,"setTargetAtTime",t,_,f),this._param.setTargetAtTime(m,_,f),this}setValueCurveAtTime(t,r,f,m=1){f=this.toSeconds(f),r=this.toSeconds(r);const _=this._fromType(t[0])*m;this.setValueAtTime(this._toType(_),r);const T=f/(t.length-1);for(let h=1;h<t.length;h++){const e=this._fromType(t[h])*m;this.linearRampToValueAtTime(this._toType(e),r+h*T)}return this}cancelScheduledValues(t){const r=this.toSeconds(t);return ct(isFinite(r),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(r),this._param.cancelScheduledValues(r),this.log(this.units,"cancelScheduledValues",r),this}cancelAndHoldAtTime(t){const r=this.toSeconds(t),f=this._fromType(this.getValueAtTime(r));ct(isFinite(r),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",r,"value="+f);const m=this._events.get(r),_=this._events.getAfter(r);return m&&Jt(m.time,r)?_?(this._param.cancelScheduledValues(_.time),this._events.cancel(_.time)):(this._param.cancelAndHoldAtTime(r),this._events.cancel(r+this.sampleTime)):_&&(this._param.cancelScheduledValues(_.time),this._events.cancel(_.time),_.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(f),r):_.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(f),r)),this._events.add({time:r,type:"setValueAtTime",value:f}),this._param.setValueAtTime(f,r),this}rampTo(t,r=.1,f){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,r,f):this.linearRampTo(t,r,f),this}apply(t){const r=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(r),r);const f=this._events.get(r);if(f&&f.type==="setTargetAtTime"){const m=this._events.getAfter(f.time),_=m?m.time:r+2,T=(_-r)/10;for(let h=r;h<_;h+=T)t.linearRampToValueAtTime(this.getValueAtTime(h),h)}return this._events.forEachAfter(this.context.currentTime,m=>{m.type==="cancelScheduledValues"?t.cancelScheduledValues(m.time):m.type==="setTargetAtTime"?t.setTargetAtTime(m.value,m.time,m.constant):t[m.type](m.value,m.time)}),this}setParam(t){ct(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const r=this.input;return r.disconnect(this._param),this.apply(t),this._param=t,r.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,r,f,m,_){return f+(r-f)*Math.exp(-(_-t)/m)}_linearInterpolate(t,r,f,m,_){return r+(m-r)*((_-t)/(f-t))}_exponentialInterpolate(t,r,f,m,_){return r*Math.pow(m/r,(_-t)/(f-t))}}class lt extends Ut{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return ut(this.input)?Re(this.input)||this.input instanceof Ct?1:this.input.numberOfInputs:0}get numberOfOutputs(){return ut(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return ut(t)&&(t instanceof lt||Se(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(f=>{f.channelCount=t.channelCount,f.channelCountMode=t.channelCountMode,f.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();ct(t.length>0,"ToneAudioNode does not have any internal nodes");const r=t[0];return{channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const r=this._getChannelProperties();this._setChannelProperties(Object.assign(r,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const r=this._getChannelProperties();this._setChannelProperties(Object.assign(r,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const r=this._getChannelProperties();this._setChannelProperties(Object.assign(r,{channelInterpretation:t}))}connect(t,r=0,f=0){return cn(this,t,r,f),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Rs("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,r=0,f=0){return Yu(this,t,r,f),this}chain(...t){return Li(this,...t),this}fan(...t){return t.forEach(r=>this.connect(r)),this}dispose(){return super.dispose(),ut(this.input)&&(this.input instanceof lt?this.input.dispose():Se(this.input)&&this.input.disconnect()),ut(this.output)&&(this.output instanceof lt?this.output.dispose():Se(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Li(...p){const t=p.shift();p.reduce((r,f)=>(r instanceof lt?r.connect(f):Se(r)&&cn(r,f),f),t)}function cn(p,t,r=0,f=0){for(ct(ut(p),"Cannot connect from undefined node"),ct(ut(t),"Cannot connect to undefined node"),(t instanceof lt||Se(t))&&ct(t.numberOfInputs>0,"Cannot connect to node with no inputs"),ct(p.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof lt||t instanceof Ct;)ut(t.input)&&(t=t.input);for(;p instanceof lt;)ut(p.output)&&(p=p.output);Re(t)?p.connect(t,r):p.connect(t,r,f)}function Yu(p,t,r=0,f=0){if(ut(t))for(;t instanceof lt;)t=t.input;for(;!Se(p);)ut(p.output)&&(p=p.output);Re(t)?p.disconnect(t,r):Se(t)?p.disconnect(t,r,f):p.disconnect()}class Vt extends lt{constructor(){super(it(Vt.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=it(Vt.getDefaults(),arguments,["gain","units"]);this.gain=new Ct({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),St(this,"gain")}static getDefaults(){return Object.assign(lt.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Qe extends lt{constructor(t){super(t),this.onended=gt,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Vt({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(r){const f=this.toSeconds(r);return this._startTime!==-1&&f>=this._startTime&&(this._stopTime===-1||f<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(lt.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:gt})}_startGain(t,r=1){ct(this._startTime===-1,"Source cannot be started more than once");const f=this.toSeconds(this._fadeIn);return this._startTime=t+f,this._startTime=Math.max(this._startTime,this.context.currentTime),f>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(r,t+f):this._gainNode.gain.exponentialApproachValueAtTime(r,t,f)):this._gainNode.gain.setValueAtTime(r,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){ct(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const r=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+r,this._stopTime=Math.max(this._stopTime,this.context.currentTime),r>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,r,t):this._gainNode.gain.targetRampTo(0,r,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const f=this._curve==="exponential"?r*2:0;this._stopSource(this.now()+f),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==gt&&(this.onended(this),this.onended=gt,!this.context.isOffline)){const t=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),ct(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class ri extends Qe{constructor(){super(it(ri.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=it(ri.getDefaults(),arguments,["offset"]);cn(this._source,this._gainNode),this.offset=new Ct({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Qe.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const r=this.toSeconds(t);return this.log("start",r),this._startGain(r),this._source.start(r),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Mt extends lt{constructor(){super(it(Mt.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=it(Mt.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ri({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(lt.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,r=0,f=0){return or(this,t,r,f),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,r){return this._param.setValueAtTime(t,r),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,r){return this._param.linearRampToValueAtTime(t,r),this}exponentialRampToValueAtTime(t,r){return this._param.exponentialRampToValueAtTime(t,r),this}exponentialRampTo(t,r,f){return this._param.exponentialRampTo(t,r,f),this}linearRampTo(t,r,f){return this._param.linearRampTo(t,r,f),this}targetRampTo(t,r,f){return this._param.targetRampTo(t,r,f),this}exponentialApproachValueAtTime(t,r,f){return this._param.exponentialApproachValueAtTime(t,r,f),this}setTargetAtTime(t,r,f){return this._param.setTargetAtTime(t,r,f),this}setValueCurveAtTime(t,r,f,m){return this._param.setValueCurveAtTime(t,r,f,m),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,r,f){return this._param.rampTo(t,r,f),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function or(p,t,r,f){(t instanceof Ct||Re(t)||t instanceof Mt&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof Mt&&(t.overridden=!0)),cn(p,t,r,f)}class si extends Ct{constructor(){super(it(si.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new fe(1/0),this._multiplier=1;const t=it(si.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ct.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,r,f){r=this.toSeconds(r),this.setRampPoint(r);const m=this._fromType(t),_=this._events.get(r),T=Math.round(Math.max(1/f,1));for(let h=0;h<=T;h++){const e=f*h+r,c=this._exponentialApproach(_.time,_.value,m,f,e);this.linearRampToValueAtTime(this._toType(c),e)}return this}setValueAtTime(t,r){const f=this.toSeconds(r);super.setValueAtTime(t,r);const m=this._events.get(f),_=this._events.previousEvent(m),T=this._getTicksUntilEvent(_,f);return m.ticks=Math.max(T,0),this}linearRampToValueAtTime(t,r){const f=this.toSeconds(r);super.linearRampToValueAtTime(t,r);const m=this._events.get(f),_=this._events.previousEvent(m),T=this._getTicksUntilEvent(_,f);return m.ticks=Math.max(T,0),this}exponentialRampToValueAtTime(t,r){r=this.toSeconds(r);const f=this._fromType(t),m=this._events.get(r),_=Math.round(Math.max((r-m.time)*10,1)),T=(r-m.time)/_;for(let h=0;h<=_;h++){const e=T*h+m.time,c=this._exponentialInterpolate(m.time,m.value,r,f,e);this.linearRampToValueAtTime(this._toType(c),e)}return this}_getTicksUntilEvent(t,r){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Qt(t.ticks)){const T=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(T,t.time)}const f=this._fromType(this.getValueAtTime(t.time));let m=this._fromType(this.getValueAtTime(r));const _=this._events.get(r);return _&&_.time===r&&_.type==="setValueAtTime"&&(m=this._fromType(this.getValueAtTime(r-this.sampleTime))),.5*(r-t.time)*(f+m)+t.ticks}getTicksAtTime(t){const r=this.toSeconds(t),f=this._events.get(r);return Math.max(this._getTicksUntilEvent(f,r),0)}getDurationOfTicks(t,r){const f=this.toSeconds(r),m=this.getTicksAtTime(r);return this.getTimeOfTick(m+t)-f}getTimeOfTick(t){const r=this._events.get(t,"ticks"),f=this._events.getAfter(t,"ticks");if(r&&r.ticks===t)return r.time;if(r&&f&&f.type==="linearRampToValueAtTime"&&r.value!==f.value){const m=this._fromType(this.getValueAtTime(r.time)),T=(this._fromType(this.getValueAtTime(f.time))-m)/(f.time-r.time),h=Math.sqrt(Math.pow(m,2)-2*T*(r.ticks-t)),e=(-m+h)/T,c=(-m-h)/T;return(e>0?e:c)+r.time}else return r?r.value===0?1/0:r.time+(t-r.ticks)/r.value:t/this._initialValue}ticksToTime(t,r){return this.getDurationOfTicks(t,r)}timeToTicks(t,r){const f=this.toSeconds(r),m=this.toSeconds(t),_=this.getTicksAtTime(f);return this.getTicksAtTime(f+m)-_}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const r=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(r,0)}}class oi extends Mt{constructor(){super(it(oi.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=it(oi.getDefaults(),arguments,["value"]);this.input=this._param=new si({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Mt.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,r){return this._param.ticksToTime(t,r)}timeToTicks(t,r){return this._param.timeToTicks(t,r)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,r){return this._param.getDurationOfTicks(t,r)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class ai extends Ut{constructor(){super(it(ai.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new sr,this._tickOffset=new fe;const t=it(ai.getDefaults(),arguments,["frequency"]);this.frequency=new oi({context:this.context,units:t.units,value:t.frequency}),St(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ut.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,r){const f=this.toSeconds(t);return this._state.getValueAtTime(f)!=="started"&&(this._state.setStateAtTime("started",f),ut(r)&&this.setTicksAtTime(r,f)),this}stop(t){const r=this.toSeconds(t);if(this._state.getValueAtTime(r)==="stopped"){const f=this._state.get(r);f&&f.time>0&&(this._tickOffset.cancel(f.time),this._state.cancel(f.time))}return this._state.cancel(r),this._state.setStateAtTime("stopped",r),this.setTicksAtTime(0,r),this}pause(t){const r=this.toSeconds(t);return this._state.getValueAtTime(r)==="started"&&this._state.setStateAtTime("paused",r),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const r=this.toSeconds(t),f=this._state.getLastState("stopped",r),m={state:"paused",time:r};this._state.add(m);let _=f,T=0;return this._state.forEachBetween(f.time,r+this.sampleTime,h=>{let e=_.time;const c=this._tickOffset.get(h.time);c&&c.time>=_.time&&(T=c.ticks,e=c.time),_.state==="started"&&h.state!=="started"&&(T+=this.frequency.getTicksAtTime(h.time)-this.frequency.getTicksAtTime(e)),_=h}),this._state.remove(m),T}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const r=this.now(),f=this.frequency.timeToTicks(t,r);this.setTicksAtTime(f,r)}getSecondsAtTime(t){t=this.toSeconds(t);const r=this._state.getLastState("stopped",t),f={state:"paused",time:t};this._state.add(f);let m=r,_=0;return this._state.forEachBetween(r.time,t+this.sampleTime,T=>{let h=m.time;const e=this._tickOffset.get(T.time);e&&e.time>=m.time&&(_=e.seconds,h=e.time),m.state==="started"&&T.state!=="started"&&(_+=T.time-h),m=T}),this._state.remove(f),_}setTicksAtTime(t,r){return r=this.toSeconds(r),this._tickOffset.cancel(r),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,r),ticks:t,time:r}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,r=this.now()){const f=this._tickOffset.get(r),m=this._state.get(r),_=Math.max(f.time,m.time),T=this.frequency.getTicksAtTime(_)+t-f.ticks;return this.frequency.getTimeOfTick(T)}forEachTickBetween(t,r,f){let m=this._state.get(t);this._state.forEachBetween(t,r,T=>{m&&m.state==="started"&&T.state!=="started"&&this.forEachTickBetween(Math.max(m.time,t),T.time-this.sampleTime,f),m=T});let _=null;if(m&&m.state==="started"){const T=Math.max(m.time,t),h=this.frequency.getTicksAtTime(T),e=this.frequency.getTicksAtTime(m.time),c=h-e;let l=Math.ceil(c)-c;l=Jt(l,1)?0:l;let n=this.frequency.getTimeOfTick(h+l);for(;n<r;){try{f(n,Math.round(this.getTicksAtTime(n)))}catch(s){_=s;break}n+=this.frequency.getDurationOfTicks(1,n)}}if(_)throw _;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class _n extends Ut{constructor(){super(it(_n.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=gt,this._lastUpdate=0,this._state=new sr("stopped"),this._boundLoop=this._loop.bind(this);const t=it(_n.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new ai({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,St(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ut.getDefaults(),{callback:gt,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,r){Is(this.context);const f=this.toSeconds(t);return this.log("start",f),this._state.getValueAtTime(f)!=="started"&&(this._state.setStateAtTime("started",f),this._tickSource.start(f,r),f<this._lastUpdate&&this.emit("start",f,r)),this}stop(t){const r=this.toSeconds(t);return this.log("stop",r),this._state.cancel(r),this._state.setStateAtTime("stopped",r),this._tickSource.stop(r),r<this._lastUpdate&&this.emit("stop",r),this}pause(t){const r=this.toSeconds(t);return this._state.getValueAtTime(r)==="started"&&(this._state.setStateAtTime("paused",r),this._tickSource.pause(r),r<this._lastUpdate&&this.emit("pause",r)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,r){return this._tickSource.setTicksAtTime(t,r),this}getTimeOfTick(t,r=this.now()){return this._tickSource.getTimeOfTick(t,r)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,r){const f=this.toSeconds(r),m=this.getTicksAtTime(f);return this._tickSource.getTimeOfTick(m+t,f)}_loop(){const t=this._lastUpdate,r=this.now();this._lastUpdate=r,this.log("loop",t,r),t!==r&&(this._state.forEachBetween(t,r,f=>{switch(f.state){case"started":const m=this._tickSource.getTicksAtTime(f.time);this.emit("start",f.time,m);break;case"stopped":f.time!==0&&this.emit("stop",f.time);break;case"paused":this.emit("pause",f.time);break}}),this._tickSource.forEachTickBetween(t,r,(f,m)=>{this.callback(f,m)}))}getStateAtTime(t){const r=this.toSeconds(t);return this._state.getValueAtTime(r)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Ln.mixin(_n);class ar extends ye{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=it(ar.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(r=>{this._loadingCount++;const f=t.urls[r];this.add(r,f,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:gt,onload:gt,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return ct(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,r])=>r.loaded)}add(t,r,f=gt,m=gt){return ce(r)?this._buffers.set(t.toString(),new _t(this.baseUrl+r,f,m)):this._buffers.set(t.toString(),new _t(r,f,m)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class ge extends dn{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Uu extends Ut{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new fe,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,r){return this._events.add({callback:t,time:this.toSeconds(r)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const r=this._events.shift();r&&t-r.time<=this.expiration&&r.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}vi(p=>{p.draw=new Uu({context:p})});yi(p=>{p.draw.dispose()});class zu extends ye{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){ct(ut(t.time),"Events must have a time property"),ct(ut(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let r=new Gu(t.time,t.time+t.duration,t);for(this._root===null?this._root=r:this._root.insert(r),this._length++;r!==null;)r.updateHeight(),r.updateMax(),this._rebalance(r),r=r.parent;return this}remove(t){if(this._root!==null){const r=[];this._root.search(t.time,r);for(const f of r)if(f.event===t){this._removeNode(f),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,r=>this.remove(r)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,r){t.parent!==null?(t.isLeftChild()?t.parent.left=r:t.parent.right=r,this._rebalance(t.parent)):this._setRoot(r)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{const r=t.getBalance();let f,m=null;if(r>0)if(t.left.right===null)f=t.left,f.right=t.right,m=f;else{for(f=t.left.right;f.right!==null;)f=f.right;f.parent&&(f.parent.right=f.left,m=f.parent,f.left=t.left,f.right=t.right)}else if(t.right.left===null)f=t.right,f.left=t.left,m=f;else{for(f=t.right.left;f.left!==null;)f=f.left;f.parent&&(f.parent.left=f.right,m=f.parent,f.left=t.left,f.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=f:t.parent.right=f:this._setRoot(f),m&&this._rebalance(m)}t.dispose()}_rotateLeft(t){const r=t.parent,f=t.isLeftChild(),m=t.right;m&&(t.right=m.left,m.left=t),r!==null?f?r.left=m:r.right=m:this._setRoot(m)}_rotateRight(t){const r=t.parent,f=t.isLeftChild(),m=t.left;m&&(t.left=m.right,m.right=t),r!==null?f?r.left=m:r.right=m:this._setRoot(m)}_rebalance(t){const r=t.getBalance();r>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):r<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){const r=[];if(this._root.search(t,r),r.length>0){let f=r[0];for(let m=1;m<r.length;m++)r[m].low>f.low&&(f=r[m]);return f.event}}return null}forEach(t){if(this._root!==null){const r=[];this._root.traverse(f=>r.push(f)),r.forEach(f=>{f.event&&t(f.event)})}return this}forEachAtTime(t,r){if(this._root!==null){const f=[];this._root.search(t,f),f.forEach(m=>{m.event&&r(m.event)})}return this}forEachFrom(t,r){if(this._root!==null){const f=[];this._root.searchAfter(t,f),f.forEach(m=>{m.event&&r(m.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class Gu{constructor(t,r,f){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=f,this.low=t,this.high=r,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,r){t>this.max||(this.left!==null&&this.left.search(t,r),this.low<=t&&this.high>t&&r.push(this),!(this.low>t)&&this.right!==null&&this.right.search(t,r))}searchAfter(t,r){this.low>=t&&(r.push(this),this.left!==null&&this.left.searchAfter(t,r)),this.right!==null&&this.right.searchAfter(t,r)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Ne extends lt{constructor(){super(it(Ne.getDefaults(),arguments,["volume"])),this.name="Volume";const t=it(Ne.getDefaults(),arguments,["volume"]);this.input=this.output=new Vt({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,St(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(lt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class ci extends lt{constructor(){super(it(ci.getDefaults(),arguments)),this.name="Destination",this.input=new Ne({context:this.context}),this.output=new Vt({context:this.context}),this.volume=this.input.volume;const t=it(ci.getDefaults(),arguments);Li(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(lt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Li(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}vi(p=>{p.destination=new ci({context:p})});yi(p=>{p.destination.dispose()});class Hu extends ye{constructor(t){super(),this.name="TimelineValue",this._timeline=new fe({memory:10}),this._initialValue=t}set(t,r){return this._timeline.add({value:t,time:r}),this}get(t){const r=this._timeline.get(t);return r?r.value:this._initialValue}}class xe{constructor(t,r){this.id=xe._eventId++;const f=Object.assign(xe.getDefaults(),r);this.transport=t,this.callback=f.callback,this._once=f.once,this.time=f.time}static getDefaults(){return{callback:gt,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}xe._eventId=0;class cr extends xe{constructor(t,r){super(t,r),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const f=Object.assign(cr.getDefaults(),r);this.duration=new ge(t.context,f.duration).valueOf(),this._interval=new ge(t.context,f.interval).valueOf(),this._nextTick=f.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},xe.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const r=this.transport.getTicksAtTime(t);r>=this.time&&r>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ge(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const r=this.transport.getTicksAtTime(t);r>this.time&&(this._nextTick=this.time+Math.ceil((r-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new ge(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ge(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class vn extends Ut{constructor(){super(it(vn.getDefaults(),arguments)),this.name="Transport",this._loop=new Hu(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new fe,this._repeatedEvents=new zu,this._syncedSignals=[],this._swingAmount=0;const t=it(vn.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new _n({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),St(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(Ut.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,r){if(this._loop.get(t)&&r>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),r=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&r%this._ppq!==0&&r%(this._swingTicks*2)!==0){const f=r%(this._swingTicks*2)/(this._swingTicks*2),m=Math.sin(f*Math.PI)*this._swingAmount;t+=new ge(this.context,this._swingTicks*2/3).toSeconds()*m}this._timeline.forEachAtTime(r,f=>f.invoke(t))}schedule(t,r){const f=new xe(this,{callback:t,time:new dn(this.context,r).toTicks()});return this._addEvent(f,this._timeline)}scheduleRepeat(t,r,f,m=1/0){const _=new cr(this,{callback:t,duration:new te(this.context,m).toTicks(),interval:new te(this.context,r).toTicks(),time:new dn(this.context,f).toTicks()});return this._addEvent(_,this._repeatedEvents)}scheduleOnce(t,r){const f=new xe(this,{callback:t,once:!0,time:new dn(this.context,r).toTicks()});return this._addEvent(f,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const r=this._scheduledEvents[t.toString()];r.timeline.remove(r.event),r.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,r){return this._scheduledEvents[t.id.toString()]={event:t,timeline:r},r.add(t),t.id}cancel(t=0){const r=this.toTicks(t);return this._timeline.forEachFrom(r,f=>this.clear(f.id)),this._repeatedEvents.forEachFrom(r,f=>this.clear(f.id)),this}_bindClockEvents(){this._clock.on("start",(t,r)=>{r=new ge(this.context,r).toSeconds(),this.emit("start",t,r)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,r){let f;return ut(r)&&(f=this.toTicks(r)),this._clock.start(t,f),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){ee(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new te(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new te(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,r){return this.loopStart=t,this.loopEnd=r,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new ge(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),r=this._clock.getTicksAtTime(t);return new ge(this.context,r).toBarsBeatsSixteenths()}set position(t){const r=this.toTicks(t);this.ticks=r}get seconds(){return this._clock.seconds}set seconds(t){const r=this.now(),f=this._clock.frequency.timeToTicks(t,r);this.ticks=f}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const r=this.now();if(this.state==="started"){const f=this._clock.getTicksAtTime(r),m=this._clock.frequency.getDurationOfTicks(Math.ceil(f)-f,r),_=r+m;this.emit("stop",_),this._clock.setTicksAtTime(t,_),this.emit("start",_,this._clock.getSecondsAtTime(_))}else this._clock.setTicksAtTime(t,r)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{const r=this.now(),f=this.getTicksAtTime(r),m=t-f%t;return this._clock.nextTickTime(m,r)}}syncSignal(t,r){if(!r){const m=this.now();if(t.getValueAtTime(m)!==0){const T=1/(60/this.bpm.getValueAtTime(m)/this.PPQ);r=t.getValueAtTime(m)/T}else r=0}const f=new Vt(r);return this.bpm.connect(f),f.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:f,signal:t}),t.value=0,this}unsyncSignal(t){for(let r=this._syncedSignals.length-1;r>=0;r--){const f=this._syncedSignals[r];f.signal===t&&(f.ratio.dispose(),f.signal.value=f.initial,this._syncedSignals.splice(r,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Ws(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Ln.mixin(vn);vi(p=>{p.transport=new vn({context:p})});yi(p=>{p.transport.dispose()});class Gt extends lt{constructor(t){super(t),this.input=void 0,this._state=new sr("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=gt,this._syncedStop=gt,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Ne({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,St(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(lt.getDefaults(),{mute:!1,onstop:gt,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,r,f){let m=Qt(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(m=this._clampToCurrentTime(m),!this._synced&&this._state.getValueAtTime(m)==="started")ct(ii(m,this._state.get(m).time),"Start time must be strictly greater than previous start time"),this._state.cancel(m),this._state.setStateAtTime("started",m),this.log("restart",m),this.restart(m,r,f);else if(this.log("start",m),this._state.setStateAtTime("started",m),this._synced){const _=this._state.get(m);_&&(_.offset=this.toSeconds(qe(r,0)),_.duration=f?this.toSeconds(f):void 0);const T=this.context.transport.schedule(h=>{this._start(h,r,f)},m);this._scheduled.push(T),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>m&&this._syncedStart(this.now(),this.context.transport.seconds)}else Is(this.context),this._start(m,r,f);return this}stop(t){let r=Qt(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(r=this._clampToCurrentTime(r),this._state.getValueAtTime(r)==="started"||ut(this._state.getNextState("started",r))){if(this.log("stop",r),!this._synced)this._stop(r);else{const f=this.context.transport.schedule(this._stop.bind(this),r);this._scheduled.push(f)}this._state.cancel(r),this._state.setStateAtTime("stopped",r)}return this}restart(t,r,f){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,r,f)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,r)=>{if(r>0){const f=this._state.get(r);if(f&&f.state==="started"&&f.time!==r){const m=r-this.toSeconds(f.time);let _;f.duration&&(_=this.toSeconds(f.duration)-m),this._start(t,this.toSeconds(f.offset)+m,_)}}},this._syncedStop=t=>{const r=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(r)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=gt,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class yn extends Qe{constructor(){super(it(yn.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=it(yn.getDefaults(),arguments,["url","onload"]);cn(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ct({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new _t(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Qe.getDefaults(),{url:new _t,loop:!1,loopEnd:0,loopStart:0,onload:gt,onerror:gt,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,r,f,m=1){ct(this.buffer.loaded,"buffer is either not set or not loaded");const _=this.toSeconds(t);this._startGain(_,m),this.loop?r=qe(r,this.loopStart):r=qe(r,0);let T=Math.max(this.toSeconds(r),0);if(this.loop){const h=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),c=h-e;Ri(T,h)&&(T=(T-e)%c+e),Jt(T,this.buffer.duration)&&(T=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Ls(T,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(_,T)),ut(f)){let h=this.toSeconds(f);h=Math.max(h,0),this.stop(_+h)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function Xe(p,t){return Et(this,void 0,void 0,function*(){const r=t/p.context.sampleRate,f=new ir(1,r,p.context.sampleRate);return new p.constructor(Object.assign(p.get(),{frequency:2/r,detune:0,context:f})).toDestination().start(0),(yield f.render()).getChannelData(0)})}class li extends Qe{constructor(){super(it(li.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=it(li.getDefaults(),arguments,["frequency","type"]);cn(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Ct({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Ct({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),St(this,["frequency","detune"])}static getDefaults(){return Object.assign(Qe.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const r=this.toSeconds(t);return this.log("start",r),this._startGain(r),this._oscillator.start(r),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class xt extends Gt{constructor(){super(it(xt.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=it(xt.getDefaults(),arguments,["frequency","type"]);this.frequency=new Mt({context:this.context,units:"frequency",value:t.frequency}),St(this,"frequency"),this.detune=new Mt({context:this.context,units:"cents",value:t.detune}),St(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(Gt.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const r=this.toSeconds(t),f=new li({context:this.context,onended:()=>this.onstop(this)});this._oscillator=f,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(r)}_stop(t){const r=this.toSeconds(t);this._oscillator&&this._oscillator.stop(r)}_restart(t){const r=this.toSeconds(t);return this.log("restart",r),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(r),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return xt._periodicWaveCache.find(r=>r.phase===this._phase&&Au(r.partials,this._partials));{const t=xt._periodicWaveCache.find(r=>r.type===this._type&&r.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const r=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&r)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{const f=this._getCachedPeriodicWave();if(ut(f)){const{partials:m,wave:_}=f;this._wave=_,this._partials=m,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[m,_]=this._getRealImaginary(t,this._phase),T=this.context.createPeriodicWave(m,_);this._wave=T,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),xt._periodicWaveCache.push({imag:_,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:m,type:this._type,wave:this._wave}),xt._periodicWaveCache.length>100&&xt._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){be(t,0);let r=this._type;const f=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(f&&(r=f[1]),this._type!=="custom")t===0?this.type=r:this.type=r+t.toString();else{const m=new Float32Array(t);this._partials.forEach((_,T)=>m[T]=_),this._partials=Array.from(m),this.type=this._type}}_getRealImaginary(t,r){let m=2048;const _=new Float32Array(m),T=new Float32Array(m);let h=1;if(t==="custom"){if(h=this._partials.length+1,this._partialCount=this._partials.length,m=h,this._partials.length===0)return[_,T]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(h=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],h=Math.max(h,2),m=h):this._partialCount=0,this._partials=[]}for(let e=1;e<m;++e){const c=2/(e*Math.PI);let l;switch(t){case"sine":l=e<=h?1:0,this._partials[e-1]=l;break;case"square":l=e&1?2*c:0,this._partials[e-1]=l;break;case"sawtooth":l=c*(e&1?1:-1),this._partials[e-1]=l;break;case"triangle":e&1?l=2*(c*c)*(e-1>>1&1?-1:1):l=0,this._partials[e-1]=l;break;case"custom":l=this._partials[e-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}l!==0?(_[e]=-l*Math.sin(r*e),T[e]=l*Math.cos(r*e)):(_[e]=0,T[e]=0)}return[_,T]}_inverseFFT(t,r,f){let m=0;const _=t.length;for(let T=0;T<_;T++)m+=t[T]*Math.cos(T*f)+r[T]*Math.sin(T*f);return m}getInitialValue(){const[t,r]=this._getRealImaginary(this._type,0);let f=0;const m=Math.PI*2,_=32;for(let T=0;T<_;T++)f=Math.max(this._inverseFFT(t,r,T/_*m),f);return Du(-this._inverseFFT(t,r,this._phase)/f,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return Et(this,void 0,void 0,function*(){return Xe(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}xt._periodicWaveCache=[];class Ti extends lt{constructor(){super(Object.assign(it(Ti.getDefaults(),arguments,["context"])))}connect(t,r=0,f=0){return or(this,t,r,f),this}}class Cn extends Ti{constructor(){super(Object.assign(it(Cn.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=it(Cn.getDefaults(),arguments,["mapping","length"]);ee(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):Cu(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Mt.getDefaults(),{length:1024})}setMap(t,r=1024){const f=new Float32Array(r);for(let m=0,_=r;m<_;m++){const T=m/(_-1)*2-1;f[m]=t(T,m)}return this.curve=f,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){const r=["none","2x","4x"].some(f=>f.includes(t));ct(r,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class qu extends Ti{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Cn({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Le extends Mt{constructor(){super(Object.assign(it(Le.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=it(Le.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Vt({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Mt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Tn extends Gt{constructor(){super(it(Tn.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new qu({context:this.context}),this._modulationNode=new Vt({context:this.context});const t=it(Tn.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new xt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new xt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Le({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),St(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(xt.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Et(this,void 0,void 0,function*(){return Xe(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class wn extends Gt{constructor(){super(it(wn.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Vt({context:this.context,gain:0});const t=it(wn.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new xt({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Mt({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new xt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Le({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Le({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),St(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(xt.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Et(this,void 0,void 0,function*(){return Xe(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Je extends Gt{constructor(){super(it(Je.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Vt({context:this.context,gain:0}),this._thresh=new Cn({context:this.context,mapping:r=>r<=0?-1:1});const t=it(Je.getDefaults(),arguments,["frequency","width"]);this.width=new Mt({context:this.context,units:"audioRange",value:t.width}),this._triangle=new xt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),St(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Gt.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return Et(this,void 0,void 0,function*(){return Xe(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Sn extends Gt{constructor(){super(it(Sn.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=it(Sn.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Mt({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Mt({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,St(this,["frequency","detune"])}static getDefaults(){return Object.assign(xt.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(r=>r.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(r=>r.stop(t))}_restart(t){this._forEach(r=>r.restart(t))}_forEach(t){for(let r=0;r<this._oscillators.length;r++)t(this._oscillators[r],r)}get type(){return this._type}set type(t){this._type=t,this._forEach(r=>r.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const r=-t/2,f=t/(this._oscillators.length-1);this._forEach((m,_)=>m.detune.value=r+f*_)}}get count(){return this._oscillators.length}set count(t){if(be(t,1),this._oscillators.length!==t){this._forEach(r=>r.dispose()),this._oscillators=[];for(let r=0;r<t;r++){const f=new xt({context:this.context,volume:-6-t*1.1,type:this._type,phase:this._phase+r/t*360,partialCount:this._partialCount,onstop:r===0?()=>this.onstop(this):gt});this.type==="custom"&&(f.partials=this._partials),this.frequency.connect(f.frequency),this.detune.connect(f.detune),f.detune.overridden=!1,f.connect(this.output),this._oscillators[r]=f}this.spread=this._spread,this.state==="started"&&this._forEach(r=>r.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((r,f)=>r.phase=this._phase+f/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(r=>r.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(r=>r.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(r=>r.partialCount=t),this._type=this._oscillators[0].type}asArray(t=1024){return Et(this,void 0,void 0,function*(){return Xe(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class bn extends Gt{constructor(){super(it(bn.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Le({context:this.context,value:2});const t=it(bn.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Je({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new xt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),St(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Gt.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return Et(this,void 0,void 0,function*(){return Xe(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Ir={am:Tn,fat:Sn,fm:wn,oscillator:xt,pulse:Je,pwm:bn};class xn extends Gt{constructor(){super(it(xn.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=it(xn.getDefaults(),arguments,["frequency","type"]);this.frequency=new Mt({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Mt({context:this.context,units:"cents",value:t.detune}),St(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(xt.getDefaults(),wn.getDefaults(),Tn.getDefaults(),Sn.getDefaults(),Je.getDefaults(),bn.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(r=>this._sourceType===r)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const r=Ir[t],f=this.now();if(this._oscillator){const m=this._oscillator;m.stop(f),this.context.setTimeout(()=>m.dispose(),this.blockTime)}this._oscillator=new r({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(f)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let r="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(r=this._oscillator.type),t==="fm"?this.type="fm"+r:t==="am"?this.type="am"+r:t==="fat"?this.type="fat"+r:t==="oscillator"?this.type=r:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,r){return t instanceof Ir[r]}get baseType(){return this._oscillator.baseType}set baseType(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&t!=="pulse"&&t!=="pwm"&&(this._oscillator.baseType=t)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(t){this._getOscType(this._oscillator,"fat")&&Fe(t)&&(this._oscillator.count=t)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(t){this._getOscType(this._oscillator,"fat")&&Fe(t)&&(this._oscillator.spread=t)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&ce(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(t=1024){return Et(this,void 0,void 0,function*(){return Xe(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function zs(p,t=1/0){const r=new WeakMap;return function(f,m){Reflect.defineProperty(f,m,{configurable:!0,enumerable:!0,get:function(){return r.get(this)},set:function(_){be(_,p,t),r.set(this,_)}})}}function Ce(p,t=1/0){const r=new WeakMap;return function(f,m){Reflect.defineProperty(f,m,{configurable:!0,enumerable:!0,get:function(){return r.get(this)},set:function(_){be(this.toSeconds(_),p,t),r.set(this,_)}})}}class On extends Gt{constructor(){super(it(On.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=it(On.getDefaults(),arguments,["url","onload"]);this._buffer=new _t({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Gt.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:gt,onerror:gt,playbackRate:1,reverse:!1})}load(t){return Et(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=gt){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,r,f){return super.start(t,r,f),this}_start(t,r,f){this._loop?r=qe(r,this._loopStart):r=qe(r,0);const m=this.toSeconds(r),_=f;f=qe(f,Math.max(this._buffer.duration-m,0));let T=this.toSeconds(f);T=T/this._playbackRate,t=this.toSeconds(t);const h=new yn({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(t+T),this._state.setStateAtTime("stopped",t+T,{implicitEnd:!0})),this._activeSources.add(h),this._loop&&Qt(_)?h.start(t,m):h.start(t,m,T-this.toSeconds(this.fadeOut))}_stop(t){const r=this.toSeconds(t);this._activeSources.forEach(f=>f.stop(r))}restart(t,r,f){return super.restart(t,r,f),this}_restart(t,r,f){this._stop(t),this._start(t,r,f)}seek(t,r){const f=this.toSeconds(r);if(this._state.getValueAtTime(f)==="started"){const m=this.toSeconds(t);this._stop(f),this._start(f,m)}return this}setLoopPoints(t,r){return this.loopStart=t,this.loopEnd=r,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&be(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(r=>{r.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&be(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(r=>{r.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(r=>{r.loop=t}),t)){const r=this._state.getNextState("stopped",this.now());r&&this._state.cancel(r.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const r=this.now(),f=this._state.getNextState("stopped",r);f&&f.implicitEnd&&(this._state.cancel(f.time),this._activeSources.forEach(m=>m.cancelStop())),this._activeSources.forEach(m=>{m.playbackRate.setValueAtTime(t,r)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}se([Ce(0)],On.prototype,"fadeIn",void 0);se([Ce(0)],On.prototype,"fadeOut",void 0);class _e extends lt{constructor(){super(it(_e.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Mt({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=it(_e.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(lt.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,r){if(ce(t))return t;{let f;for(f in Xn)if(Xn[f][r]===t)return f;return t}}_setCurve(t,r,f){if(ce(f)&&Reflect.has(Xn,f)){const m=Xn[f];Me(m)?t!=="_decayCurve"&&(this[t]=m[r]):this[t]=m}else if(ee(f)&&t!=="_decayCurve")this[t]=f;else throw new Error("Envelope: invalid curve: "+f)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){ct(["linear","exponential"].some(r=>r===t),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,r=1){this.log("triggerAttack",t,r),t=this.toSeconds(t);let m=this.toSeconds(this.attack);const _=this.toSeconds(this.decay),T=this.getValueAtTime(t);if(T>0){const h=1/m;m=(1-T)/h}if(m<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(r,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(r,m,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(r,m,t);else{this._sig.cancelAndHoldAtTime(t);let h=this._attackCurve;for(let e=1;e<h.length;e++)if(h[e-1]<=T&&T<=h[e]){h=this._attackCurve.slice(e),h[0]=T;break}this._sig.setValueCurveAtTime(h,t,m,r)}if(_&&this.sustain<1){const h=r*this.sustain,e=t+m;this.log("decay",e),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(h,_+e):this._sig.exponentialApproachValueAtTime(h,e,_)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const r=this.getValueAtTime(t);if(r>0){const f=this.toSeconds(this.release);f<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,f,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,f,t):(ct(ee(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,f,r))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,r,f=1){return r=this.toSeconds(r),this.triggerAttack(r,f),this.triggerRelease(r+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,r=0,f=0){return or(this,t,r,f),this}asArray(t=1024){return Et(this,void 0,void 0,function*(){const r=t/this.context.sampleRate,f=new ir(1,r,this.context.sampleRate),m=this.toSeconds(this.attack)+this.toSeconds(this.decay),_=m+this.toSeconds(this.release),T=_*.1,h=_+T,e=new this.constructor(Object.assign(this.get(),{attack:r*this.toSeconds(this.attack)/h,decay:r*this.toSeconds(this.decay)/h,release:r*this.toSeconds(this.release)/h,context:f}));return e._sig.toDestination(),e.triggerAttackRelease(r*(m+T)/h,0),(yield f.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}se([Ce(0)],_e.prototype,"attack",void 0);se([Ce(0)],_e.prototype,"decay",void 0);se([zs(0,1)],_e.prototype,"sustain",void 0);se([Ce(0)],_e.prototype,"release",void 0);const Xn=(()=>{let t,r;const f=[];for(t=0;t<128;t++)f[t]=Math.sin(t/(128-1)*(Math.PI/2));const m=[],_=6.4;for(t=0;t<128-1;t++){r=t/(128-1);const s=Math.sin(r*(Math.PI*2)*_-Math.PI/2)+1;m[t]=s/10+r*.83}m[128-1]=1;const T=[],h=5;for(t=0;t<128;t++)T[t]=Math.ceil(t/(128-1)*h)/h;const e=[];for(t=0;t<128;t++)r=t/(128-1),e[t]=.5*(1-Math.cos(Math.PI*r));const c=[];for(t=0;t<128;t++){r=t/(128-1);const s=Math.pow(r,3)*4+.2,i=Math.cos(s*Math.PI*2*r);c[t]=Math.abs(i*(1-r))}function l(s){const i=new Array(s.length);for(let a=0;a<s.length;a++)i[a]=1-s[a];return i}function n(s){return s.slice(0).reverse()}return{bounce:{In:l(c),Out:c},cosine:{In:f,Out:n(f)},exponential:"exponential",linear:"linear",ripple:{In:m,Out:l(m)},sine:{In:e,Out:l(e)},step:{In:T,Out:l(T)}}})();class je extends lt{constructor(){super(it(je.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=it(je.getDefaults(),arguments);this._volume=this.output=new Ne({context:this.context,volume:t.volume}),this.volume=this._volume.volume,St(this,"volume")}static getDefaults(){return Object.assign(lt.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,r){const f=this["_original_"+t]=this[t];this[t]=(...m)=>{const _=m[r],T=this.context.transport.schedule(h=>{m[r]=h,f.apply(this,m)},_);this._scheduledEvents.push(T)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,r,f,m){const _=this.toSeconds(f),T=this.toSeconds(r);return this.triggerAttack(t,_,m),this.triggerRelease(_+T),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Be extends je{constructor(){super(it(Be.getDefaults(),arguments));const t=it(Be.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(je.getDefaults(),{detune:0,onsilence:gt,portamento:0})}triggerAttack(t,r,f=1){this.log("triggerAttack",t,r,f);const m=this.toSeconds(r);return this._triggerEnvelopeAttack(m,f),this.setNote(t,m),this}triggerRelease(t){this.log("triggerRelease",t);const r=this.toSeconds(t);return this._triggerEnvelopeRelease(r),this}setNote(t,r){const f=this.toSeconds(r),m=t instanceof Zt?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(f)>.05){const _=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(m,_,f)}else this.frequency.setValueAtTime(m,f);return this}}se([Ce(0)],Be.prototype,"portamento",void 0);class lr extends _e{constructor(){super(it(lr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Vt({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class tn extends Be{constructor(){super(it(tn.getDefaults(),arguments)),this.name="Synth";const t=it(tn.getDefaults(),arguments);this.oscillator=new xn(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new lr(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),St(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Be.getDefaults(),{envelope:Object.assign(Pr(_e.getDefaults(),Object.keys(lt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Pr(xn.getDefaults(),[...Object.keys(Gt.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,r){if(this.envelope.triggerAttack(t,r),this.oscillator.start(t),this.envelope.sustain===0){const f=this.toSeconds(this.envelope.attack),m=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+f+m)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class kn extends tn{constructor(){super(it(kn.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=it(kn.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,St(this,["oscillator","envelope"])}static getDefaults(){return He(Be.getDefaults(),tn.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,r){const f=this.toSeconds(r),m=this.toFrequency(t instanceof Zt?t.toFrequency():t),_=m*this.octaves;return this.oscillator.frequency.setValueAtTime(_,f),this.oscillator.frequency.exponentialRampToValueAtTime(m,f+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}se([zs(0)],kn.prototype,"octaves",void 0);se([Ce(0)],kn.prototype,"pitchDecay",void 0);const Gs=new Set;function hr(p){Gs.add(p)}function Hs(p,t){const r=`registerProcessor("${p}", ${t})`;Gs.add(r)}const $u=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;hr($u);const Ku=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;hr(Ku);const Zu=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;hr(Zu);const Qu="feedback-comb-filter",Ju=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Hs(Qu,Ju);class An extends je{constructor(){super(it(An.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=it(An.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),r={};Object.keys(t.urls).forEach(f=>{const m=parseInt(f,10);if(ct(Wn(f)||Fe(m)&&isFinite(m),`url key is neither a note or midi pitch: ${f}`),Wn(f)){const _=new Zt(this.context,f).toMidi();r[_]=t.urls[f]}else Fe(m)&&isFinite(m)&&(r[m]=t.urls[m])}),this._buffers=new ar({urls:r,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(je.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:gt,onerror:gt,release:.1,urls:{}})}_findClosest(t){let f=0;for(;f<96;){if(this._buffers.has(t+f))return-f;if(this._buffers.has(t-f))return f;f++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,r,f=1){return this.log("triggerAttack",t,r,f),Array.isArray(t)||(t=[t]),t.forEach(m=>{const _=Us(new Zt(this.context,m).toFrequency()),T=Math.round(_),h=_-T,e=this._findClosest(T),c=T-e,l=this._buffers.get(c),n=Ys(e+h),s=new yn({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:n}).connect(this.output);s.start(r,0,l.duration/n,f),ee(this._activeSources.get(T))||this._activeSources.set(T,[]),this._activeSources.get(T).push(s),s.onended=()=>{if(this._activeSources&&this._activeSources.has(T)){const i=this._activeSources.get(T),a=i.indexOf(s);a!==-1&&i.splice(a,1)}}}),this}triggerRelease(t,r){return this.log("triggerRelease",t,r),Array.isArray(t)||(t=[t]),t.forEach(f=>{const m=new Zt(this.context,f).toMidi();if(this._activeSources.has(m)&&this._activeSources.get(m).length){const _=this._activeSources.get(m);r=this.toSeconds(r),_.forEach(T=>{T.stop(r)}),this._activeSources.set(m,[])}}),this}releaseAll(t){const r=this.toSeconds(t);return this._activeSources.forEach(f=>{for(;f.length;)f.shift().stop(r)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,r,f,m=1){const _=this.toSeconds(f);return this.triggerAttack(t,_,m),ee(r)?(ct(ee(t),"notes must be an array when duration is array"),t.forEach((T,h)=>{const e=r[Math.min(h,r.length-1)];this.triggerRelease(T,_+this.toSeconds(e))})):this.triggerRelease(t,_+this.toSeconds(r)),this}add(t,r,f){if(ct(Wn(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Wn(t)){const m=new Zt(this.context,t).toMidi();this._buffers.add(m,r,f)}else this._buffers.add(t,r,f);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(r=>r.dispose())}),this._activeSources.clear(),this}}se([Ce(0)],An.prototype,"attack",void 0);se([Ce(0)],An.prototype,"release",void 0);class hi extends lt{constructor(){super(Object.assign(it(hi.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=it(hi.getDefaults(),arguments,["pan"]);this.pan=new Ct({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",St(this,"pan")}static getDefaults(){return Object.assign(lt.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const tf="bit-crusher",ef=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Hs(tf,ef);class bt extends lt{constructor(){super(it(bt.getDefaults(),arguments,["solo"])),this.name="Solo";const t=it(bt.getDefaults(),arguments,["solo"]);this.input=this.output=new Vt({context:this.context}),bt._allSolos.has(this.context)||bt._allSolos.set(this.context,new Set),bt._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(lt.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),bt._allSolos.get(this.context).forEach(r=>r._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){bt._soloed.has(this.context)||bt._soloed.set(this.context,new Set),bt._soloed.get(this.context).add(this)}_removeSolo(){bt._soloed.has(this.context)&&bt._soloed.get(this.context).delete(this)}_isSoloed(){return bt._soloed.has(this.context)&&bt._soloed.get(this.context).has(this)}_noSolos(){return!bt._soloed.has(this.context)||bt._soloed.has(this.context)&&bt._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),bt._allSolos.get(this.context).delete(this),this._removeSolo(),this}}bt._allSolos=new Map;bt._soloed=new Map;class ui extends lt{constructor(){super(it(ui.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=it(ui.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new hi({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Ne({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,St(this,["pan","volume"])}static getDefaults(){return Object.assign(lt.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Ee extends lt{constructor(){super(it(Ee.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=it(Ee.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new bt({solo:t.solo,context:this.context}),this._panVol=this.output=new ui({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),St(this,["pan","volume"])}static getDefaults(){return Object.assign(lt.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return Ee.buses.has(t)||Ee.buses.set(t,new Vt({context:this.context})),Ee.buses.get(t)}send(t,r=0){const f=this._getBus(t),m=new Vt({context:this.context,units:"decibels",gain:r});return this.connect(m),m.connect(f),m}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Ee.buses=new Map;class nf extends lt{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ct({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ct({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ct({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ct({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ct({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ct({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ct({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ct({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ct({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(lt.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}vi(p=>{p.listener=new nf({context:p})});yi(p=>{p.listener.dispose()});function rf(){return Kt().now()}Kt().transport;Kt().destination;Kt().destination;Kt().listener;Kt().draw;Kt();class sf{constructor(t=100){wi(this,"synths");wi(this,"usedSynths");this.synths=[],this.usedSynths=[];for(let r=0;r<t;r++)this.synths.push(new tn().toDestination()),this.usedSynths.push(!1)}triggerAttackRelease(t,r,f){for(let m=0;m<this.synths.length;m++)if(!this.usedSynths[m]){this.usedSynths[m]=!0,this.synths[m].triggerAttackRelease(t,r,f),setTimeout(()=>{console.log(m),this.usedSynths[m]=!1},f+r+100);return}console.warn(`all ${this.synths.length} synths are already in use, skipping note`)}shutup(){this.synths.forEach(t=>t.triggerRelease())}}function of(p){if(p.__esModule)return p;var t=p.default;if(typeof t=="function"){var r=function f(){return this instanceof f?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(p).forEach(function(f){var m=Object.getOwnPropertyDescriptor(p,f);Object.defineProperty(r,f,m.get?m:{enumerable:!0,get:function(){return p[f]}})}),r}var un={};const af={},cf=Object.freeze(Object.defineProperty({__proto__:null,default:af},Symbol.toStringTag,{value:"Module"})),bi=of(cf);(function(p){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(p.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var r=bi,f=new r.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=f.document,t.jsdomImplForWrapper=bi.implForWrapper,t.nodeCanvas=bi.Canvas,t.window=f,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function h(i,a){if(this.__eventListeners[i]){var u=this.__eventListeners[i];a?u[u.indexOf(a)]=!1:t.util.array.fill(u,!1)}}function e(i,a){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var u in i)this.on(u,i[u]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(a);return this}function c(i,a){var u=(function(){a.apply(this,arguments),this.off(i,u)}).bind(this);this.on(i,u)}function l(i,a){if(arguments.length===1)for(var u in i)c.call(this,u,i[u]);else c.call(this,i,a);return this}function n(i,a){if(!this.__eventListeners)return this;if(arguments.length===0)for(i in this.__eventListeners)h.call(this,i);else if(arguments.length===1&&typeof arguments[0]=="object")for(var u in i)h.call(this,u,i[u]);else h.call(this,i,a);return this}function s(i,a){if(!this.__eventListeners)return this;var u=this.__eventListeners[i];if(!u)return this;for(var o=0,d=u.length;o<d;o++)u[o]&&u[o].call(this,a||{});return this.__eventListeners[i]=u.filter(function(g){return g!==!1}),this}t.Observable={fire:s,on:e,once:l,off:n}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var h=0,e=arguments.length;h<e;h++)this._onObjectAdded(arguments[h]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(h,e,c){var l=this._objects;return c?l[e]=h:l.splice(e,0,h),this._onObjectAdded&&this._onObjectAdded(h),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var h=this._objects,e,c=!1,l=0,n=arguments.length;l<n;l++)e=h.indexOf(arguments[l]),e!==-1&&(c=!0,h.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[l]));return this.renderOnAddRemove&&c&&this.requestRenderAll(),this},forEachObject:function(h,e){for(var c=this.getObjects(),l=0,n=c.length;l<n;l++)h.call(e,c[l],l,c);return this},getObjects:function(h){return typeof h>"u"?this._objects.concat():this._objects.filter(function(e){return e.type===h})},item:function(h){return this._objects[h]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(h,e){return this._objects.indexOf(h)>-1?!0:e?this._objects.some(function(c){return typeof c.contains=="function"&&c.contains(h,!0)}):!1},complexity:function(){return this._objects.reduce(function(h,e){return h+=e.complexity?e.complexity():0,h},0)}},t.CommonMethods={_setOptions:function(h){for(var e in h)this.set(e,h[e])},_initGradient:function(h,e){h&&h.colorStops&&!(h instanceof t.Gradient)&&this.set(e,new t.Gradient(h))},_initPattern:function(h,e,c){h&&h.source&&!(h instanceof t.Pattern)?this.set(e,new t.Pattern(h,c)):c&&c()},_setObject:function(h){for(var e in h)this._set(e,h[e])},set:function(h,e){return typeof h=="object"?this._setObject(h):this._set(h,e),this},_set:function(h,e){this[h]=e},toggle:function(h){var e=this.get(h);return typeof e=="boolean"&&this.set(h,!e),this},get:function(h){return this[h]}},function(h){var e=Math.sqrt,c=Math.atan2,l=Math.pow,n=Math.PI/180,s=Math.PI/2;t.util={cos:function(i){if(i===0)return 1;i<0&&(i=-i);var a=i/s;switch(a){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(i===0)return 0;var a=i/s,u=1;switch(i<0&&(u=-1),a){case 1:return u;case 2:return 0;case 3:return-u}return Math.sin(i)},removeFromArray:function(i,a){var u=i.indexOf(a);return u!==-1&&i.splice(u,1),i},getRandomInt:function(i,a){return Math.floor(Math.random()*(a-i+1))+i},degreesToRadians:function(i){return i*n},radiansToDegrees:function(i){return i/n},rotatePoint:function(i,a,u){var o=new t.Point(i.x-a.x,i.y-a.y),d=t.util.rotateVector(o,u);return new t.Point(d.x,d.y).addEquals(a)},rotateVector:function(i,a){var u=t.util.sin(a),o=t.util.cos(a),d=i.x*o-i.y*u,g=i.x*u+i.y*o;return{x:d,y:g}},createVector:function(i,a){return new t.Point(a.x-i.x,a.y-i.y)},calcAngleBetweenVectors:function(i,a){return Math.acos((i.x*a.x+i.y*a.y)/(Math.hypot(i.x,i.y)*Math.hypot(a.x,a.y)))},getHatVector:function(i){return new t.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,a,u){var o=t.util.createVector(i,a),d=t.util.createVector(i,u),g=t.util.calcAngleBetweenVectors(o,d),v=t.util.calcAngleBetweenVectors(t.util.rotateVector(o,g),d),y=g*(v===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(o,y)),angle:g}},projectStrokeOnPoints:function(i,a,u){var o=[],d=a.strokeWidth/2,g=a.strokeUniform?new t.Point(1/a.scaleX,1/a.scaleY):new t.Point(1,1),v=function(y){var C=d/Math.hypot(y.x,y.y);return new t.Point(y.x*C*g.x,y.y*C*g.y)};return i.length<=1||i.forEach(function(y,C){var w=new t.Point(y.x,y.y),S,O;C===0?(O=i[C+1],S=u?v(t.util.createVector(O,w)).addEquals(w):i[i.length-1]):C===i.length-1?(S=i[C-1],O=u?v(t.util.createVector(S,w)).addEquals(w):i[0]):(S=i[C-1],O=i[C+1]);var M=t.util.getBisector(w,S,O),I=M.vector,N=M.angle,L,H;if(a.strokeLineJoin==="miter"&&(L=-d/Math.sin(N/2),H=new t.Point(I.x*L*g.x,I.y*L*g.y),Math.hypot(H.x,H.y)/d<=a.strokeMiterLimit)){o.push(w.add(H)),o.push(w.subtract(H));return}L=-d*Math.SQRT2,H=new t.Point(I.x*L*g.x,I.y*L*g.y),o.push(w.add(H)),o.push(w.subtract(H))}),o},transformPoint:function(i,a,u){return u?new t.Point(a[0]*i.x+a[2]*i.y,a[1]*i.x+a[3]*i.y):new t.Point(a[0]*i.x+a[2]*i.y+a[4],a[1]*i.x+a[3]*i.y+a[5])},makeBoundingBoxFromPoints:function(i,a){if(a)for(var u=0;u<i.length;u++)i[u]=t.util.transformPoint(i[u],a);var o=[i[0].x,i[1].x,i[2].x,i[3].x],d=t.util.array.min(o),g=t.util.array.max(o),v=g-d,y=[i[0].y,i[1].y,i[2].y,i[3].y],C=t.util.array.min(y),w=t.util.array.max(y),S=w-C;return{left:d,top:C,width:v,height:S}},invertTransform:function(i){var a=1/(i[0]*i[3]-i[1]*i[2]),u=[a*i[3],-a*i[1],-a*i[2],a*i[0]],o=t.util.transformPoint({x:i[4],y:i[5]},u,!0);return u[4]=-o.x,u[5]=-o.y,u},toFixed:function(i,a){return parseFloat(Number(i).toFixed(a))},parseUnit:function(i,a){var u=/\D{0,2}$/.exec(i),o=parseFloat(i);switch(a||(a=t.Text.DEFAULT_SVG_FONT_SIZE),u[0]){case"mm":return o*t.DPI/25.4;case"cm":return o*t.DPI/2.54;case"in":return o*t.DPI;case"pt":return o*t.DPI/72;case"pc":return o*t.DPI/72*12;case"em":return o*a;default:return o}},falseFunction:function(){return!1},getKlass:function(i,a){return i=t.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),t.util.resolveNamespace(a)[i]},getSvgAttributes:function(i){var a=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"]);break}return a},resolveNamespace:function(i){if(!i)return t;var a=i.split("."),u=a.length,o,d=h||t.window;for(o=0;o<u;++o)d=d[a[o]];return d},loadImage:function(i,a,u,o){if(!i){a&&a.call(u,i);return}var d=t.util.createImage(),g=function(){a&&a.call(u,d,!1),d=d.onload=d.onerror=null};d.onload=g,d.onerror=function(){t.log("Error loading "+d.src),a&&a.call(u,null,!0),d=d.onload=d.onerror=null},i.indexOf("data")!==0&&o!==void 0&&o!==null&&(d.crossOrigin=o),i.substring(0,14)==="data:image/svg"&&(d.onload=null,t.util.loadImageInDom(d,g)),d.src=i},loadImageInDom:function(i,a){var u=t.document.createElement("div");u.style.width=u.style.height="1px",u.style.left=u.style.top="-100%",u.style.position="absolute",u.appendChild(i),t.document.querySelector("body").appendChild(u),i.onload=function(){a(),u.parentNode.removeChild(u),u=null}},enlivenObjects:function(i,a,u,o){i=i||[];var d=[],g=0,v=i.length;function y(){++g===v&&a&&a(d.filter(function(C){return C}))}if(!v){a&&a(d);return}i.forEach(function(C,w){if(!C||!C.type){y();return}var S=t.util.getKlass(C.type,u);S.fromObject(C,function(O,M){M||(d[w]=O),o&&o(C,O,M),y()})})},enlivenObjectEnlivables:function(i,a,u){var o=t.Object.ENLIVEN_PROPS.filter(function(d){return!!i[d]});t.util.enlivenObjects(o.map(function(d){return i[d]}),function(d){var g={};o.forEach(function(v,y){g[v]=d[y],a&&(a[v]=d[y])}),u&&u(g)})},enlivenPatterns:function(i,a){i=i||[];function u(){++d===g&&a&&a(o)}var o=[],d=0,g=i.length;if(!g){a&&a(o);return}i.forEach(function(v,y){v&&v.source?new t.Pattern(v,function(C){o[y]=C,u()}):(o[y]=v,u())})},groupSVGElements:function(i,a,u){var o;return i&&i.length===1?(typeof u<"u"&&(i[0].sourcePath=u),i[0]):(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),o=new t.Group(i,a),typeof u<"u"&&(o.sourcePath=u),o)},populateWithProperties:function(i,a,u){if(u&&Array.isArray(u))for(var o=0,d=u.length;o<d;o++)u[o]in i&&(a[u[o]]=i[u[o]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(i){var a=t.util.createCanvasElement();return a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0),a},toDataURL:function(i,a,u){return i.toDataURL("image/"+a,u)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(i,a,u){return[i[0]*a[0]+i[2]*a[1],i[1]*a[0]+i[3]*a[1],i[0]*a[2]+i[2]*a[3],i[1]*a[2]+i[3]*a[3],u?0:i[0]*a[4]+i[2]*a[5]+i[4],u?0:i[1]*a[4]+i[3]*a[5]+i[5]]},qrDecompose:function(i){var a=c(i[1],i[0]),u=l(i[0],2)+l(i[1],2),o=e(u),d=(i[0]*i[3]-i[2]*i[1])/o,g=c(i[0]*i[2]+i[1]*i[3],u);return{angle:a/n,scaleX:o,scaleY:d,skewX:g/n,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return t.iMatrix.concat();var a=t.util.degreesToRadians(i.angle),u=t.util.cos(a),o=t.util.sin(a);return[u,o,-o,u,0,0]},calcDimensionsMatrix:function(i){var a=typeof i.scaleX>"u"?1:i.scaleX,u=typeof i.scaleY>"u"?1:i.scaleY,o=[i.flipX?-a:a,0,0,i.flipY?-u:u,0,0],d=t.util.multiplyTransformMatrices,g=t.util.degreesToRadians;return i.skewX&&(o=d(o,[1,0,Math.tan(g(i.skewX)),1],!0)),i.skewY&&(o=d(o,[1,Math.tan(g(i.skewY)),0,1],!0)),o},composeMatrix:function(i){var a=[1,0,0,1,i.translateX||0,i.translateY||0],u=t.util.multiplyTransformMatrices;return i.angle&&(a=u(a,t.util.calcRotateMatrix(i))),(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY)&&(a=u(a,t.util.calcDimensionsMatrix(i))),a},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,a,u,o){o>0&&(a>o?a-=o:a=0,u>o?u-=o:u=0);var d=!0,g,v,y=i.getImageData(a,u,o*2||1,o*2||1),C=y.data.length;for(g=3;g<C&&(v=y.data[g],d=v<=0,d!==!1);g+=4);return y=null,d},parsePreserveAspectRatioAttribute:function(i){var a="meet",u="Mid",o="Mid",d=i.split(" "),g;return d&&d.length&&(a=d.pop(),a!=="meet"&&a!=="slice"?(g=a,a="meet"):d.length&&(g=d.pop())),u=g!=="none"?g.slice(1,4):"none",o=g!=="none"?g.slice(5,8):"none",{meetOrSlice:a,alignX:u,alignY:o}},clearFabricFontCache:function(i){i=(i||"").toLowerCase(),i?t.charWidthsCache[i]&&delete t.charWidthsCache[i]:t.charWidthsCache={}},limitDimsByArea:function(i,a){var u=Math.sqrt(a*i),o=Math.floor(a/u);return{x:Math.floor(u),y:o}},capValue:function(i,a,u){return Math.max(i,Math.min(a,u))},findScaleToFit:function(i,a){return Math.min(a.width/i.width,a.height/i.height)},findScaleToCover:function(i,a){return Math.max(a.width/i.width,a.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(a){return t.util.toFixed(a,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,a){var u=t.util.invertTransform(a),o=t.util.multiplyTransformMatrices(u,i.calcOwnMatrix());t.util.applyTransformToObject(i,o)},addTransformToObject:function(i,a){t.util.applyTransformToObject(i,t.util.multiplyTransformMatrices(a,i.calcOwnMatrix()))},applyTransformToObject:function(i,a){var u=t.util.qrDecompose(a),o=new t.Point(u.translateX,u.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",u.scaleX),i.set("scaleY",u.scaleY),i.skewX=u.skewX,i.skewY=u.skewY,i.angle=u.angle,i.setPositionByOrigin(o,"center","center")},sizeAfterTransform:function(i,a,u){var o=i/2,d=a/2,g=[{x:-o,y:-d},{x:o,y:-d},{x:-o,y:d},{x:o,y:d}],v=t.util.calcDimensionsMatrix(u),y=t.util.makeBoundingBoxFromPoints(g,v);return{x:y.width,y:y.height}},mergeClipPaths:function(i,a){var u=i,o=a;u.inverted&&!o.inverted&&(u=a,o=i),t.util.applyTransformToObject(o,t.util.multiplyTransformMatrices(t.util.invertTransform(u.calcTransformMatrix()),o.calcTransformMatrix()));var d=u.inverted&&o.inverted;return d&&(u.inverted=o.inverted=!1),new t.Group([u],{clipPath:o,inverted:d})},hasStyleChanged:function(i,a,u){return u=u||!1,i.fill!==a.fill||i.stroke!==a.stroke||i.strokeWidth!==a.strokeWidth||i.fontSize!==a.fontSize||i.fontFamily!==a.fontFamily||i.fontWeight!==a.fontWeight||i.fontStyle!==a.fontStyle||i.textBackgroundColor!==a.textBackgroundColor||i.deltaY!==a.deltaY||u&&(i.overline!==a.overline||i.underline!==a.underline||i.linethrough!==a.linethrough)},stylesToArray:function(u,a){for(var u=t.util.object.clone(u,!0),o=a.split(`
`),d=-1,g={},v=[],y=0;y<o.length;y++){if(!u[y]){d+=o[y].length;continue}for(var C=0;C<o[y].length;C++){d++;var w=u[y][C];if(w&&Object.keys(w).length>0){var S=t.util.hasStyleChanged(g,w,!0);S?v.push({start:d,end:d+1,style:w}):v[v.length-1].end++}g=w||{}}}return v},stylesFromArray:function(i,a){if(!Array.isArray(i))return i;for(var u=a.split(`
`),o=-1,d=0,g={},v=0;v<u.length;v++)for(var y=0;y<u[v].length;y++)o++,i[d]&&i[d].start<=o&&o<i[d].end&&(g[v]=g[v]||{},g[v][y]=Object.assign({},i[d].style),o===i[d].end-1&&d++);return g}}}(p),function(){var h=Array.prototype.join,e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};function l(b,E,A,D,W,k,x,P,F,B,G){var Q=t.util.cos(b),et=t.util.sin(b),nt=t.util.cos(E),q=t.util.sin(E),X=A*W*nt-D*k*q+x,j=D*W*nt+A*k*q+P,Y=B+F*(-A*W*et-D*k*Q),z=G+F*(-D*W*et+A*k*Q),K=X+F*(A*W*q+D*k*nt),tt=j+F*(D*W*q-A*k*nt);return["C",Y,z,K,tt,X,j]}function n(b,E,A,D,W,k,x){var P=Math.PI,F=x*P/180,B=t.util.sin(F),G=t.util.cos(F),Q=0,et=0;A=Math.abs(A),D=Math.abs(D);var nt=-G*b*.5-B*E*.5,q=-G*E*.5+B*b*.5,X=A*A,j=D*D,Y=q*q,z=nt*nt,K=X*j-X*Y-j*z,tt=0;if(K<0){var st=Math.sqrt(1-K/(X*j));A*=st,D*=st}else tt=(W===k?-1:1)*Math.sqrt(K/(X*Y+j*z));var rt=tt*A*q/D,Z=-tt*D*nt/A,ot=G*rt-B*Z+b*.5,at=B*rt+G*Z+E*.5,ht=s(1,0,(nt-rt)/A,(q-Z)/D),mt=s((nt-rt)/A,(q-Z)/D,(-nt-rt)/A,(-q-Z)/D);k===0&&mt>0?mt-=2*P:k===1&&mt<0&&(mt+=2*P);for(var ft=Math.ceil(Math.abs(mt/P*2)),Lt=[],kt=mt/ft,Ae=8/3*Math.sin(kt/4)*Math.sin(kt/4)/Math.sin(kt/2),ln=ht+kt,oe=0;oe<ft;oe++)Lt[oe]=l(ht,ln,G,B,A,D,ot,at,Ae,Q,et),Q=Lt[oe][5],et=Lt[oe][6],ht=ln,ln+=kt;return Lt}function s(b,E,A,D){var W=Math.atan2(E,b),k=Math.atan2(D,A);return k>=W?k-W:2*Math.PI-(W-k)}function i(b,E,A,D,W,k,x,P){var F;if(t.cachesBoundsOfCurve&&(F=h.call(arguments),t.boundsOfCurveCache[F]))return t.boundsOfCurveCache[F];var B=Math.sqrt,G=Math.min,Q=Math.max,et=Math.abs,nt=[],q=[[],[]],X,j,Y,z,K,tt,st,rt;j=6*b-12*A+6*W,X=-3*b+9*A-9*W+3*x,Y=3*A-3*b;for(var Z=0;Z<2;++Z){if(Z>0&&(j=6*E-12*D+6*k,X=-3*E+9*D-9*k+3*P,Y=3*D-3*E),et(X)<1e-12){if(et(j)<1e-12)continue;z=-Y/j,0<z&&z<1&&nt.push(z);continue}st=j*j-4*Y*X,!(st<0)&&(rt=B(st),K=(-j+rt)/(2*X),0<K&&K<1&&nt.push(K),tt=(-j-rt)/(2*X),0<tt&&tt<1&&nt.push(tt))}for(var ot,at,ht=nt.length,mt=ht,ft;ht--;)z=nt[ht],ft=1-z,ot=ft*ft*ft*b+3*ft*ft*z*A+3*ft*z*z*W+z*z*z*x,q[0][ht]=ot,at=ft*ft*ft*E+3*ft*ft*z*D+3*ft*z*z*k+z*z*z*P,q[1][ht]=at;q[0][mt]=b,q[1][mt]=E,q[0][mt+1]=x,q[1][mt+1]=P;var Lt=[{x:G.apply(null,q[0]),y:G.apply(null,q[1])},{x:Q.apply(null,q[0]),y:Q.apply(null,q[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[F]=Lt),Lt}function a(b,E,A){for(var D=A[1],W=A[2],k=A[3],x=A[4],P=A[5],F=A[6],B=A[7],G=n(F-b,B-E,D,W,x,P,k),Q=0,et=G.length;Q<et;Q++)G[Q][1]+=b,G[Q][2]+=E,G[Q][3]+=b,G[Q][4]+=E,G[Q][5]+=b,G[Q][6]+=E;return G}function u(b){var E=0,A=0,D=b.length,W=0,k=0,x,P,F,B=[],G,Q,et;for(P=0;P<D;++P){switch(F=!1,x=b[P].slice(0),x[0]){case"l":x[0]="L",x[1]+=E,x[2]+=A;case"L":E=x[1],A=x[2];break;case"h":x[1]+=E;case"H":x[0]="L",x[2]=A,E=x[1];break;case"v":x[1]+=A;case"V":x[0]="L",A=x[1],x[1]=E,x[2]=A;break;case"m":x[0]="M",x[1]+=E,x[2]+=A;case"M":E=x[1],A=x[2],W=x[1],k=x[2];break;case"c":x[0]="C",x[1]+=E,x[2]+=A,x[3]+=E,x[4]+=A,x[5]+=E,x[6]+=A;case"C":Q=x[3],et=x[4],E=x[5],A=x[6];break;case"s":x[0]="S",x[1]+=E,x[2]+=A,x[3]+=E,x[4]+=A;case"S":G==="C"?(Q=2*E-Q,et=2*A-et):(Q=E,et=A),E=x[3],A=x[4],x[0]="C",x[5]=x[3],x[6]=x[4],x[3]=x[1],x[4]=x[2],x[1]=Q,x[2]=et,Q=x[3],et=x[4];break;case"q":x[0]="Q",x[1]+=E,x[2]+=A,x[3]+=E,x[4]+=A;case"Q":Q=x[1],et=x[2],E=x[3],A=x[4];break;case"t":x[0]="T",x[1]+=E,x[2]+=A;case"T":G==="Q"?(Q=2*E-Q,et=2*A-et):(Q=E,et=A),x[0]="Q",E=x[1],A=x[2],x[1]=Q,x[2]=et,x[3]=E,x[4]=A;break;case"a":x[0]="A",x[6]+=E,x[7]+=A;case"A":F=!0,B=B.concat(a(E,A,x)),E=x[6],A=x[7];break;case"z":case"Z":E=W,A=k;break}F||B.push(x),G=x[0]}return B}function o(b,E,A,D){return Math.sqrt((A-b)*(A-b)+(D-E)*(D-E))}function d(b){return b*b*b}function g(b){return 3*b*b*(1-b)}function v(b){return 3*b*(1-b)*(1-b)}function y(b){return(1-b)*(1-b)*(1-b)}function C(b,E,A,D,W,k,x,P){return function(F){var B=d(F),G=g(F),Q=v(F),et=y(F);return{x:x*B+W*G+A*Q+b*et,y:P*B+k*G+D*Q+E*et}}}function w(b,E,A,D,W,k,x,P){return function(F){var B=1-F,G=3*B*B*(A-b)+6*B*F*(W-A)+3*F*F*(x-W),Q=3*B*B*(D-E)+6*B*F*(k-D)+3*F*F*(P-k);return Math.atan2(Q,G)}}function S(b){return b*b}function O(b){return 2*b*(1-b)}function M(b){return(1-b)*(1-b)}function I(b,E,A,D,W,k){return function(x){var P=S(x),F=O(x),B=M(x);return{x:W*P+A*F+b*B,y:k*P+D*F+E*B}}}function N(b,E,A,D,W,k){return function(x){var P=1-x,F=2*P*(A-b)+2*x*(W-A),B=2*P*(D-E)+2*x*(k-D);return Math.atan2(B,F)}}function L(b,E,A){var D={x:E,y:A},W,k=0,x;for(x=1;x<=100;x+=1)W=b(x/100),k+=o(D.x,D.y,W.x,W.y),D=W;return k}function H(b,E){for(var A=0,D=0,W=b.iterator,k={x:b.x,y:b.y},x,P,F=.01,B=b.angleFinder,G;D<E&&F>1e-4;)x=W(A),G=A,P=o(k.x,k.y,x.x,x.y),P+D>E?(A-=F,F/=2):(k=x,A+=F,D+=P);return x.angle=B(G),x}function U(b){for(var E=0,A=b.length,D,W=0,k=0,x=0,P=0,F=[],B,G,Q,et=0;et<A;et++){switch(D=b[et],G={x:W,y:k,command:D[0]},D[0]){case"M":G.length=0,x=W=D[1],P=k=D[2];break;case"L":G.length=o(W,k,D[1],D[2]),W=D[1],k=D[2];break;case"C":B=C(W,k,D[1],D[2],D[3],D[4],D[5],D[6]),Q=w(W,k,D[1],D[2],D[3],D[4],D[5],D[6]),G.iterator=B,G.angleFinder=Q,G.length=L(B,W,k),W=D[5],k=D[6];break;case"Q":B=I(W,k,D[1],D[2],D[3],D[4]),Q=N(W,k,D[1],D[2],D[3],D[4]),G.iterator=B,G.angleFinder=Q,G.length=L(B,W,k),W=D[3],k=D[4];break;case"Z":case"z":G.destX=x,G.destY=P,G.length=o(W,k,x,P),W=x,k=P;break}E+=G.length,F.push(G)}return F.push({length:E,x:W,y:k}),F}function R(b,E,A){A||(A=U(b));for(var D=0;E-A[D].length>0&&D<A.length-2;)E-=A[D].length,D++;var W=A[D],k=E/W.length,x=W.command,P=b[D],F;switch(x){case"M":return{x:W.x,y:W.y,angle:0};case"Z":case"z":return F=new t.Point(W.x,W.y).lerp(new t.Point(W.destX,W.destY),k),F.angle=Math.atan2(W.destY-W.y,W.destX-W.x),F;case"L":return F=new t.Point(W.x,W.y).lerp(new t.Point(P[1],P[2]),k),F.angle=Math.atan2(P[2]-W.y,P[1]-W.x),F;case"C":return H(W,E);case"Q":return H(W,E)}}function V(b){var E=[],A=[],D,W,k=t.rePathCommand,x="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",P="("+x+")"+t.commaWsp,F="([01])"+t.commaWsp+"?",B=P+"?"+P+"?"+P+F+F+P+"?("+x+")",G=new RegExp(B,"g"),Q,et,nt;if(!b||!b.match)return E;nt=b.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var q=0,X,j=nt.length;q<j;q++){D=nt[q],et=D.slice(1).trim(),A.length=0;var Y=D.charAt(0);if(X=[Y],Y.toLowerCase()==="a")for(var z;z=G.exec(et);)for(var K=1;K<z.length;K++)A.push(z[K]);else for(;Q=k.exec(et);)A.push(Q[0]);for(var K=0,tt=A.length;K<tt;K++)W=parseFloat(A[K]),isNaN(W)||X.push(W);var st=e[Y.toLowerCase()],rt=c[Y]||Y;if(X.length-1>st)for(var Z=1,ot=X.length;Z<ot;Z+=st)E.push([Y].concat(X.slice(Z,Z+st))),Y=rt;else E.push(X)}return E}function $(b,E){var A=[],D,W=new t.Point(b[0].x,b[0].y),k=new t.Point(b[1].x,b[1].y),x=b.length,P=1,F=0,B=x>2;for(E=E||0,B&&(P=b[2].x<k.x?-1:b[2].x===k.x?0:1,F=b[2].y<k.y?-1:b[2].y===k.y?0:1),A.push(["M",W.x-P*E,W.y-F*E]),D=1;D<x;D++){if(!W.eq(k)){var G=W.midPointFrom(k);A.push(["Q",W.x,W.y,G.x,G.y])}W=b[D],D+1<b.length&&(k=b[D+1])}return B&&(P=W.x>b[D-2].x?1:W.x===b[D-2].x?0:-1,F=W.y>b[D-2].y?1:W.y===b[D-2].y?0:-1),A.push(["L",W.x+P*E,W.y+F*E]),A}function J(b,E,A){return A&&(E=t.util.multiplyTransformMatrices(E,[1,0,0,1,-A.x,-A.y])),b.map(function(D){for(var W=D.slice(0),k={},x=1;x<D.length-1;x+=2)k.x=D[x],k.y=D[x+1],k=t.util.transformPoint(k,E),W[x]=k.x,W[x+1]=k.y;return W})}t.util.joinPath=function(b){return b.map(function(E){return E.join(" ")}).join(" ")},t.util.parsePath=V,t.util.makePathSimpler=u,t.util.getSmoothPathFromPoints=$,t.util.getPathSegmentsInfo=U,t.util.getBoundsOfCurve=i,t.util.getPointOnPath=R,t.util.transformPath=J}(),function(){var h=Array.prototype.slice;function e(i,a){for(var u=h.call(arguments,2),o=[],d=0,g=i.length;d<g;d++)o[d]=u.length?i[d][a].apply(i[d],u):i[d][a].call(i[d]);return o}function c(i,a){return s(i,a,function(u,o){return u>=o})}function l(i,a){return s(i,a,function(u,o){return u<o})}function n(i,a){for(var u=i.length;u--;)i[u]=a;return i}function s(i,a,u){if(!(!i||i.length===0)){var o=i.length-1,d=a?i[o][a]:i[o];if(a)for(;o--;)u(i[o][a],d)&&(d=i[o][a]);else for(;o--;)u(i[o],d)&&(d=i[o]);return d}}t.util.array={fill:n,invoke:e,min:l,max:c}}(),function(){function h(c,l,n){if(n)if(!t.isLikelyNode&&l instanceof Element)c=l;else if(l instanceof Array){c=[];for(var s=0,i=l.length;s<i;s++)c[s]=h({},l[s],n)}else if(l&&typeof l=="object")for(var a in l)a==="canvas"||a==="group"?c[a]=null:l.hasOwnProperty(a)&&(c[a]=h({},l[a],n));else c=l;else for(var a in l)c[a]=l[a];return c}function e(c,l){return h({},c,l)}t.util.object={extend:h,clone:e},t.util.object.extend(t.util,t.Observable)}(),function(){function h(s){return s.replace(/-+(.)?/g,function(i,a){return a?a.toUpperCase():""})}function e(s,i){return s.charAt(0).toUpperCase()+(i?s.slice(1):s.slice(1).toLowerCase())}function c(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(s){var i=0,a,u=[];for(i=0,a;i<s.length;i++)(a=n(s,i))!==!1&&u.push(a);return u}function n(s,i){var a=s.charCodeAt(i);if(isNaN(a))return"";if(a<55296||a>57343)return s.charAt(i);if(55296<=a&&a<=56319){if(s.length<=i+1)throw"High surrogate without following low surrogate";var u=s.charCodeAt(i+1);if(56320>u||u>57343)throw"High surrogate without following low surrogate";return s.charAt(i)+s.charAt(i+1)}if(i===0)throw"Low surrogate without preceding high surrogate";var o=s.charCodeAt(i-1);if(55296>o||o>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:h,capitalize:e,escapeXml:c,graphemeSplit:l}}(),function(){var h=Array.prototype.slice,e=function(){},c=function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}(),l=function(a,u,o){for(var d in u)d in a.prototype&&typeof a.prototype[d]=="function"&&(u[d]+"").indexOf("callSuper")>-1?a.prototype[d]=function(g){return function(){var v=this.constructor.superclass;this.constructor.superclass=o;var y=u[g].apply(this,arguments);if(this.constructor.superclass=v,g!=="initialize")return y}}(d):a.prototype[d]=u[d],c&&(u.toString!==Object.prototype.toString&&(a.prototype.toString=u.toString),u.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=u.valueOf))};function n(){}function s(a){for(var u=null,o=this;o.constructor.superclass;){var d=o.constructor.superclass.prototype[a];if(o[a]!==d){u=d;break}o=o.constructor.superclass.prototype}return u?arguments.length>1?u.apply(this,h.call(arguments,1)):u.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}function i(){var a=null,u=h.call(arguments,0);typeof u[0]=="function"&&(a=u.shift());function o(){this.initialize.apply(this,arguments)}o.superclass=a,o.subclasses=[],a&&(n.prototype=a.prototype,o.prototype=new n,a.subclasses.push(o));for(var d=0,g=u.length;d<g;d++)l(o,u[d],a);return o.prototype.initialize||(o.prototype.initialize=e),o.prototype.constructor=o,o.prototype.callSuper=s,o}t.util.createClass=i}(),function(){var h=!!t.document.createElement("div").attachEvent,e=["touchstart","touchmove","touchend"];t.util.addListener=function(l,n,s,i){l&&l.addEventListener(n,s,h?!1:i)},t.util.removeListener=function(l,n,s,i){l&&l.removeEventListener(n,s,h?!1:i)};function c(l){var n=l.changedTouches;return n&&n[0]?n[0]:l}t.util.getPointer=function(l){var n=l.target,s=t.util.getScrollLeftTop(n),i=c(l);return{x:i.clientX+s.left,y:i.clientY+s.top}},t.util.isTouchEvent=function(l){return e.indexOf(l.type)>-1||l.pointerType==="touch"}}(),function(){function h(i,a){var u=i.style;if(!u)return i;if(typeof a=="string")return i.style.cssText+=";"+a,a.indexOf("opacity")>-1?s(i,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var o in a)if(o==="opacity")s(i,a[o]);else{var d=o==="float"||o==="cssFloat"?typeof u.styleFloat>"u"?"cssFloat":"styleFloat":o;u.setProperty(d,a[o])}return i}var e=t.document.createElement("div"),c=typeof e.style.opacity=="string",l=typeof e.style.filter=="string",n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(i){return i};c?s=function(i,a){return i.style.opacity=a,i}:l&&(s=function(i,a){var u=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(u.zoom=1),n.test(u.filter)?(a=a>=.9999?"":"alpha(opacity="+a*100+")",u.filter=u.filter.replace(n,a)):u.filter+=" alpha(opacity="+a*100+")",i}),t.util.setStyle=h}(),function(){var h=Array.prototype.slice;function e(y){return typeof y=="string"?t.document.getElementById(y):y}var c,l=function(y){return h.call(y,0)};try{c=l(t.document.childNodes)instanceof Array}catch{}c||(l=function(y){for(var C=new Array(y.length),w=y.length;w--;)C[w]=y[w];return C});function n(y,C){var w=t.document.createElement(y);for(var S in C)S==="class"?w.className=C[S]:S==="for"?w.htmlFor=C[S]:w.setAttribute(S,C[S]);return w}function s(y,C){y&&(" "+y.className+" ").indexOf(" "+C+" ")===-1&&(y.className+=(y.className?" ":"")+C)}function i(y,C,w){return typeof C=="string"&&(C=n(C,w)),y.parentNode&&y.parentNode.replaceChild(C,y),C.appendChild(y),C}function a(y){for(var C=0,w=0,S=t.document.documentElement,O=t.document.body||{scrollLeft:0,scrollTop:0};y&&(y.parentNode||y.host)&&(y=y.parentNode||y.host,y===t.document?(C=O.scrollLeft||S.scrollLeft||0,w=O.scrollTop||S.scrollTop||0):(C+=y.scrollLeft||0,w+=y.scrollTop||0),!(y.nodeType===1&&y.style.position==="fixed")););return{left:C,top:w}}function u(y){var C,w=y&&y.ownerDocument,S={left:0,top:0},O={left:0,top:0},M,I={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return O;for(var N in I)O[I[N]]+=parseInt(o(y,N),10)||0;return C=w.documentElement,typeof y.getBoundingClientRect<"u"&&(S=y.getBoundingClientRect()),M=a(y),{left:S.left+M.left-(C.clientLeft||0)+O.left,top:S.top+M.top-(C.clientTop||0)+O.top}}var o;t.document.defaultView&&t.document.defaultView.getComputedStyle?o=function(y,C){var w=t.document.defaultView.getComputedStyle(y,null);return w?w[C]:void 0}:o=function(y,C){var w=y.style[C];return!w&&y.currentStyle&&(w=y.currentStyle[C]),w},function(){var y=t.document.documentElement.style,C="userSelect"in y?"userSelect":"MozUserSelect"in y?"MozUserSelect":"WebkitUserSelect"in y?"WebkitUserSelect":"KhtmlUserSelect"in y?"KhtmlUserSelect":"";function w(O){return typeof O.onselectstart<"u"&&(O.onselectstart=t.util.falseFunction),C?O.style[C]="none":typeof O.unselectable=="string"&&(O.unselectable="on"),O}function S(O){return typeof O.onselectstart<"u"&&(O.onselectstart=null),C?O.style[C]="":typeof O.unselectable=="string"&&(O.unselectable=""),O}t.util.makeElementUnselectable=w,t.util.makeElementSelectable=S}();function d(y){var C=t.jsdomImplForWrapper(y);return C._canvas||C._image}function g(y){if(t.isLikelyNode){var C=t.jsdomImplForWrapper(y);C&&(C._image=null,C._canvas=null,C._currentSrc=null,C._attributes=null,C._classList=null)}}function v(y,C){y.imageSmoothingEnabled=y.imageSmoothingEnabled||y.webkitImageSmoothingEnabled||y.mozImageSmoothingEnabled||y.msImageSmoothingEnabled||y.oImageSmoothingEnabled,y.imageSmoothingEnabled=C}t.util.setImageSmoothing=v,t.util.getById=e,t.util.toArray=l,t.util.addClass=s,t.util.makeElement=n,t.util.wrapElement=i,t.util.getScrollLeftTop=a,t.util.getElementOffset=u,t.util.getNodeCanvas=d,t.util.cleanUpJsdomNode=g}(),function(){function h(l,n){return l+(/\?/.test(l)?"&":"?")+n}function e(){}function c(l,n){n||(n={});var s=n.method?n.method.toUpperCase():"GET",i=n.onComplete||function(){},a=new t.window.XMLHttpRequest,u=n.body||n.parameters;return a.onreadystatechange=function(){a.readyState===4&&(i(a),a.onreadystatechange=e)},s==="GET"&&(u=null,typeof n.parameters=="string"&&(l=h(l,n.parameters))),a.open(s,l,!0),(s==="POST"||s==="PUT")&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(u),a}t.util.request=c}(),t.log=console.log,t.warn=console.warn,function(){var h=t.util.object.extend,e=t.util.object.clone,c=[];t.util.object.extend(c,{cancelAll:function(){var d=this.splice(0);return d.forEach(function(g){g.cancel()}),d},cancelByCanvas:function(d){if(!d)return[];var g=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===d});return g.forEach(function(v){v.cancel()}),g},cancelByTarget:function(d){var g=this.findAnimationsByTarget(d);return g.forEach(function(v){v.cancel()}),g},findAnimationIndex:function(d){return this.indexOf(this.findAnimation(d))},findAnimation:function(d){return this.find(function(g){return g.cancel===d})},findAnimationsByTarget:function(d){return d?this.filter(function(g){return g.target===d}):[]}});function l(){return!1}function n(d,g,v,y){return-v*Math.cos(d/y*(Math.PI/2))+v+g}function s(d){d||(d={});var g=!1,v,y=function(){var C=t.runningAnimations.indexOf(v);return C>-1&&t.runningAnimations.splice(C,1)[0]};return v=h(e(d),{cancel:function(){return g=!0,y()},currentValue:"startValue"in d?d.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(v),u(function(C){var w=C||+new Date,S=d.duration||500,O=w+S,M,I=d.onChange||l,N=d.abort||l,L=d.onComplete||l,H=d.easing||n,U="startValue"in d?d.startValue.length>0:!1,R="startValue"in d?d.startValue:0,V="endValue"in d?d.endValue:100,$=d.byValue||(U?R.map(function(J,b){return V[b]-R[b]}):V-R);d.onStart&&d.onStart(),function J(b){M=b||+new Date;var E=M>O?S:M-w,A=E/S,D=U?R.map(function(k,x){return H(E,R[x],$[x],S)}):H(E,R,$,S),W=Math.abs(U?(D[0]-R[0])/$[0]:(D-R)/$);if(v.currentValue=U?D.slice():D,v.completionRate=W,v.durationRate=A,!g){if(N(D,W,A)){y();return}if(M>O){v.currentValue=U?V.slice():V,v.completionRate=1,v.durationRate=1,I(U?V.slice():V,1,1),L(V,1,1),y();return}else I(D,W,A),u(J)}}(w)}),v.cancel}var i=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(d){return t.window.setTimeout(d,1e3/60)},a=t.window.cancelAnimationFrame||t.window.clearTimeout;function u(){return i.apply(t.window,arguments)}function o(){return a.apply(t.window,arguments)}t.util.animate=s,t.util.requestAnimFrame=u,t.util.cancelAnimFrame=o,t.runningAnimations=c}(),function(){function h(c,l,n){var s="rgba("+parseInt(c[0]+n*(l[0]-c[0]),10)+","+parseInt(c[1]+n*(l[1]-c[1]),10)+","+parseInt(c[2]+n*(l[2]-c[2]),10);return s+=","+(c&&l?parseFloat(c[3]+n*(l[3]-c[3])):1),s+=")",s}function e(c,l,n,s){var i=new t.Color(c).getSource(),a=new t.Color(l).getSource(),u=s.onComplete,o=s.onChange;return s=s||{},t.util.animate(t.util.object.extend(s,{duration:n||500,startValue:i,endValue:a,byValue:a,easing:function(d,g,v,y){var C=s.colorEasing?s.colorEasing(d,y):1-Math.cos(d/y*(Math.PI/2));return h(g,v,C)},onComplete:function(d,g,v){if(u)return u(h(a,a,0),g,v)},onChange:function(d,g,v){if(o){if(Array.isArray(d))return o(h(d,d,0),g,v);o(d,g,v)}}}))}t.util.animateColor=e}(),function(){function h(b,E,A,D){return b<Math.abs(E)?(b=E,D=A/4):E===0&&b===0?D=A/(2*Math.PI)*Math.asin(1):D=A/(2*Math.PI)*Math.asin(E/b),{a:b,c:E,p:A,s:D}}function e(b,E,A){return b.a*Math.pow(2,10*(E-=1))*Math.sin((E*A-b.s)*(2*Math.PI)/b.p)}function c(b,E,A,D){return A*((b=b/D-1)*b*b+1)+E}function l(b,E,A,D){return b/=D/2,b<1?A/2*b*b*b+E:A/2*((b-=2)*b*b+2)+E}function n(b,E,A,D){return A*(b/=D)*b*b*b+E}function s(b,E,A,D){return-A*((b=b/D-1)*b*b*b-1)+E}function i(b,E,A,D){return b/=D/2,b<1?A/2*b*b*b*b+E:-A/2*((b-=2)*b*b*b-2)+E}function a(b,E,A,D){return A*(b/=D)*b*b*b*b+E}function u(b,E,A,D){return A*((b=b/D-1)*b*b*b*b+1)+E}function o(b,E,A,D){return b/=D/2,b<1?A/2*b*b*b*b*b+E:A/2*((b-=2)*b*b*b*b+2)+E}function d(b,E,A,D){return-A*Math.cos(b/D*(Math.PI/2))+A+E}function g(b,E,A,D){return A*Math.sin(b/D*(Math.PI/2))+E}function v(b,E,A,D){return-A/2*(Math.cos(Math.PI*b/D)-1)+E}function y(b,E,A,D){return b===0?E:A*Math.pow(2,10*(b/D-1))+E}function C(b,E,A,D){return b===D?E+A:A*(-Math.pow(2,-10*b/D)+1)+E}function w(b,E,A,D){return b===0?E:b===D?E+A:(b/=D/2,b<1?A/2*Math.pow(2,10*(b-1))+E:A/2*(-Math.pow(2,-10*--b)+2)+E)}function S(b,E,A,D){return-A*(Math.sqrt(1-(b/=D)*b)-1)+E}function O(b,E,A,D){return A*Math.sqrt(1-(b=b/D-1)*b)+E}function M(b,E,A,D){return b/=D/2,b<1?-A/2*(Math.sqrt(1-b*b)-1)+E:A/2*(Math.sqrt(1-(b-=2)*b)+1)+E}function I(b,E,A,D){var W=1.70158,k=0,x=A;if(b===0)return E;if(b/=D,b===1)return E+A;k||(k=D*.3);var P=h(x,A,k,W);return-e(P,b,D)+E}function N(b,E,A,D){var W=1.70158,k=0,x=A;if(b===0)return E;if(b/=D,b===1)return E+A;k||(k=D*.3);var P=h(x,A,k,W);return P.a*Math.pow(2,-10*b)*Math.sin((b*D-P.s)*(2*Math.PI)/P.p)+P.c+E}function L(b,E,A,D){var W=1.70158,k=0,x=A;if(b===0)return E;if(b/=D/2,b===2)return E+A;k||(k=D*(.3*1.5));var P=h(x,A,k,W);return b<1?-.5*e(P,b,D)+E:P.a*Math.pow(2,-10*(b-=1))*Math.sin((b*D-P.s)*(2*Math.PI)/P.p)*.5+P.c+E}function H(b,E,A,D,W){return W===void 0&&(W=1.70158),A*(b/=D)*b*((W+1)*b-W)+E}function U(b,E,A,D,W){return W===void 0&&(W=1.70158),A*((b=b/D-1)*b*((W+1)*b+W)+1)+E}function R(b,E,A,D,W){return W===void 0&&(W=1.70158),b/=D/2,b<1?A/2*(b*b*(((W*=1.525)+1)*b-W))+E:A/2*((b-=2)*b*(((W*=1.525)+1)*b+W)+2)+E}function V(b,E,A,D){return A-$(D-b,0,A,D)+E}function $(b,E,A,D){return(b/=D)<1/2.75?A*(7.5625*b*b)+E:b<2/2.75?A*(7.5625*(b-=1.5/2.75)*b+.75)+E:b<2.5/2.75?A*(7.5625*(b-=2.25/2.75)*b+.9375)+E:A*(7.5625*(b-=2.625/2.75)*b+.984375)+E}function J(b,E,A,D){return b<D/2?V(b*2,0,A,D)*.5+E:$(b*2-D,0,A,D)*.5+A*.5+E}t.util.ease={easeInQuad:function(b,E,A,D){return A*(b/=D)*b+E},easeOutQuad:function(b,E,A,D){return-A*(b/=D)*(b-2)+E},easeInOutQuad:function(b,E,A,D){return b/=D/2,b<1?A/2*b*b+E:-A/2*(--b*(b-2)-1)+E},easeInCubic:function(b,E,A,D){return A*(b/=D)*b*b+E},easeOutCubic:c,easeInOutCubic:l,easeInQuart:n,easeOutQuart:s,easeInOutQuart:i,easeInQuint:a,easeOutQuint:u,easeInOutQuint:o,easeInSine:d,easeOutSine:g,easeInOutSine:v,easeInExpo:y,easeOutExpo:C,easeInOutExpo:w,easeInCirc:S,easeOutCirc:O,easeInOutCirc:M,easeInElastic:I,easeOutElastic:N,easeInOutElastic:L,easeInBack:H,easeOutBack:U,easeInOutBack:R,easeInBounce:V,easeOutBounce:$,easeInOutBounce:J}}(),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend,l=e.util.object.clone,n=e.util.toFixed,s=e.util.parseUnit,i=e.util.multiplyTransformMatrices,a=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],u=["symbol","image","marker","pattern","view","svg"],o=["pattern","defs","symbol","metadata","clipPath","mask","desc"],d=["symbol","g","a","svg","clipPath","defs"],g={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},v={stroke:"strokeOpacity",fill:"fillOpacity"},y="font-size",C="clip-path";e.svgValidTagNamesRegEx=O(a),e.svgViewBoxElementsRegEx=O(u),e.svgInvalidAncestorsRegEx=O(o),e.svgValidParentsRegEx=O(d),e.cssRules={},e.gradientDefs={},e.clipPaths={};function w(k){return k in g?g[k]:k}function S(k,x,P,F){var B=Array.isArray(x),G;if((k==="fill"||k==="stroke")&&x==="none")x="";else{if(k==="strokeUniform")return x==="non-scaling-stroke";if(k==="strokeDashArray")x==="none"?x=null:x=x.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(k==="transformMatrix")P&&P.transformMatrix?x=i(P.transformMatrix,e.parseTransformAttribute(x)):x=e.parseTransformAttribute(x);else if(k==="visible")x=x!=="none"&&x!=="hidden",P&&P.visible===!1&&(x=!1);else if(k==="opacity")x=parseFloat(x),P&&typeof P.opacity<"u"&&(x*=P.opacity);else if(k==="textAnchor")x=x==="start"?"left":x==="end"?"right":"center";else if(k==="charSpacing")G=s(x,F)/F*1e3;else if(k==="paintFirst"){var Q=x.indexOf("fill"),et=x.indexOf("stroke"),x="fill";(Q>-1&&et>-1&&et<Q||Q===-1&&et>-1)&&(x="stroke")}else{if(k==="href"||k==="xlink:href"||k==="font")return x;if(k==="imageSmoothing")return x==="optimizeQuality";G=B?x.map(s):s(x,F)}}return!B&&isNaN(G)?x:G}function O(k){return new RegExp("^("+k.join("|")+")\\b","i")}function M(k){for(var x in v)if(!(typeof k[v[x]]>"u"||k[x]==="")){if(typeof k[x]>"u"){if(!e.Object.prototype[x])continue;k[x]=e.Object.prototype[x]}if(k[x].indexOf("url(")!==0){var P=new e.Color(k[x]);k[x]=P.setAlpha(n(P.getAlpha()*k[v[x]],2)).toRgba()}}return k}function I(k,x){var P,F=[],B,G,Q;for(G=0,Q=x.length;G<Q;G++)P=x[G],B=k.getElementsByTagName(P),F=F.concat(Array.prototype.slice.call(B));return F}e.parseTransformAttribute=function(){function k(Z,ot){var at=e.util.cos(ot[0]),ht=e.util.sin(ot[0]),mt=0,ft=0;ot.length===3&&(mt=ot[1],ft=ot[2]),Z[0]=at,Z[1]=ht,Z[2]=-ht,Z[3]=at,Z[4]=mt-(at*mt-ht*ft),Z[5]=ft-(ht*mt+at*ft)}function x(Z,ot){var at=ot[0],ht=ot.length===2?ot[1]:ot[0];Z[0]=at,Z[3]=ht}function P(Z,ot,at){Z[at]=Math.tan(e.util.degreesToRadians(ot[0]))}function F(Z,ot){Z[4]=ot[0],ot.length===2&&(Z[5]=ot[1])}var B=e.iMatrix,G=e.reNum,Q=e.commaWsp,et="(?:(skewX)\\s*\\(\\s*("+G+")\\s*\\))",nt="(?:(skewY)\\s*\\(\\s*("+G+")\\s*\\))",q="(?:(rotate)\\s*\\(\\s*("+G+")(?:"+Q+"("+G+")"+Q+"("+G+"))?\\s*\\))",X="(?:(scale)\\s*\\(\\s*("+G+")(?:"+Q+"("+G+"))?\\s*\\))",j="(?:(translate)\\s*\\(\\s*("+G+")(?:"+Q+"("+G+"))?\\s*\\))",Y="(?:(matrix)\\s*\\(\\s*("+G+")"+Q+"("+G+")"+Q+"("+G+")"+Q+"("+G+")"+Q+"("+G+")"+Q+"("+G+")\\s*\\))",z="(?:"+Y+"|"+j+"|"+X+"|"+q+"|"+et+"|"+nt+")",K="(?:"+z+"(?:"+Q+"*"+z+")*)",tt="^\\s*(?:"+K+"?)\\s*$",st=new RegExp(tt),rt=new RegExp(z,"g");return function(Z){var ot=B.concat(),at=[];if(!Z||Z&&!st.test(Z))return ot;Z.replace(rt,function(mt){var ft=new RegExp(z).exec(mt).filter(function(Ae){return!!Ae}),Lt=ft[1],kt=ft.slice(2).map(parseFloat);switch(Lt){case"translate":F(ot,kt);break;case"rotate":kt[0]=e.util.degreesToRadians(kt[0]),k(ot,kt);break;case"scale":x(ot,kt);break;case"skewX":P(ot,kt,2);break;case"skewY":P(ot,kt,1);break;case"matrix":ot=kt;break}at.push(ot.concat()),ot=B.concat()});for(var ht=at[0];at.length>1;)at.shift(),ht=e.util.multiplyTransformMatrices(ht,at[0]);return ht}}();function N(k,x){var P,F;k.replace(/;\s*$/,"").split(";").forEach(function(B){var G=B.split(":");P=G[0].trim().toLowerCase(),F=G[1].trim(),x[P]=F})}function L(k,x){var P,F;for(var B in k)typeof k[B]>"u"||(P=B.toLowerCase(),F=k[B],x[P]=F)}function H(k,x){var P={};for(var F in e.cssRules[x])if(U(k,F.split(" ")))for(var B in e.cssRules[x][F])P[B]=e.cssRules[x][F][B];return P}function U(k,x){var P,F=!0;return P=V(k,x.pop()),P&&x.length&&(F=R(k,x)),P&&F&&x.length===0}function R(k,x){for(var P,F=!0;k.parentNode&&k.parentNode.nodeType===1&&x.length;)F&&(P=x.pop()),k=k.parentNode,F=V(k,P);return x.length===0}function V(k,x){var P=k.nodeName,F=k.getAttribute("class"),B=k.getAttribute("id"),G,Q;if(G=new RegExp("^"+P,"i"),x=x.replace(G,""),B&&x.length&&(G=new RegExp("#"+B+"(?![a-zA-Z\\-]+)","i"),x=x.replace(G,"")),F&&x.length)for(F=F.split(" "),Q=F.length;Q--;)G=new RegExp("\\."+F[Q]+"(?![a-zA-Z\\-]+)","i"),x=x.replace(G,"");return x.length===0}function $(k,x){var P;if(k.getElementById&&(P=k.getElementById(x)),P)return P;var F,B,G,Q=k.getElementsByTagName("*");for(B=0,G=Q.length;B<G;B++)if(F=Q[B],x===F.getAttribute("id"))return F}function J(k){for(var x=I(k,["use","svg:use"]),P=0;x.length&&P<x.length;){var F=x[P],B=F.getAttribute("xlink:href")||F.getAttribute("href");if(B===null)return;var G=B.slice(1),Q=F.getAttribute("x")||0,et=F.getAttribute("y")||0,nt=$(k,G).cloneNode(!0),q=(nt.getAttribute("transform")||"")+" translate("+Q+", "+et+")",X,j=x.length,Y,z,K,tt,st=e.svgNS;if(E(nt),/^svg$/i.test(nt.nodeName)){var rt=nt.ownerDocument.createElementNS(st,"g");for(z=0,K=nt.attributes,tt=K.length;z<tt;z++)Y=K.item(z),rt.setAttributeNS(st,Y.nodeName,Y.nodeValue);for(;nt.firstChild;)rt.appendChild(nt.firstChild);nt=rt}for(z=0,K=F.attributes,tt=K.length;z<tt;z++)Y=K.item(z),!(Y.nodeName==="x"||Y.nodeName==="y"||Y.nodeName==="xlink:href"||Y.nodeName==="href")&&(Y.nodeName==="transform"?q=Y.nodeValue+" "+q:nt.setAttribute(Y.nodeName,Y.nodeValue));nt.setAttribute("transform",q),nt.setAttribute("instantiated_by_use","1"),nt.removeAttribute("id"),X=F.parentNode,X.replaceChild(nt,F),x.length===j&&P++}}var b=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function E(k){if(!e.svgViewBoxElementsRegEx.test(k.nodeName))return{};var x=k.getAttribute("viewBox"),P=1,F=1,B=0,G=0,Q,et,nt,q,X=k.getAttribute("width"),j=k.getAttribute("height"),Y=k.getAttribute("x")||0,z=k.getAttribute("y")||0,K=k.getAttribute("preserveAspectRatio")||"",tt=!x||!(x=x.match(b)),st=!X||!j||X==="100%"||j==="100%",rt=tt&&st,Z={},ot="",at=0,ht=0;if(Z.width=0,Z.height=0,Z.toBeParsed=rt,tt&&(Y||z)&&k.parentNode&&k.parentNode.nodeName!=="#document"&&(ot=" translate("+s(Y)+" "+s(z)+") ",nt=(k.getAttribute("transform")||"")+ot,k.setAttribute("transform",nt),k.removeAttribute("x"),k.removeAttribute("y")),rt)return Z;if(tt)return Z.width=s(X),Z.height=s(j),Z;if(B=-parseFloat(x[1]),G=-parseFloat(x[2]),Q=parseFloat(x[3]),et=parseFloat(x[4]),Z.minX=B,Z.minY=G,Z.viewBoxWidth=Q,Z.viewBoxHeight=et,st?(Z.width=Q,Z.height=et):(Z.width=s(X),Z.height=s(j),P=Z.width/Q,F=Z.height/et),K=e.util.parsePreserveAspectRatioAttribute(K),K.alignX!=="none"&&(K.meetOrSlice==="meet"&&(F=P=P>F?F:P),K.meetOrSlice==="slice"&&(F=P=P>F?P:F),at=Z.width-Q*P,ht=Z.height-et*P,K.alignX==="Mid"&&(at/=2),K.alignY==="Mid"&&(ht/=2),K.alignX==="Min"&&(at=0),K.alignY==="Min"&&(ht=0)),P===1&&F===1&&B===0&&G===0&&Y===0&&z===0)return Z;if((Y||z)&&k.parentNode.nodeName!=="#document"&&(ot=" translate("+s(Y)+" "+s(z)+") "),nt=ot+" matrix("+P+" 0 0 "+F+" "+(B*P+at)+" "+(G*F+ht)+") ",k.nodeName==="svg"){for(q=k.ownerDocument.createElementNS(e.svgNS,"g");k.firstChild;)q.appendChild(k.firstChild);k.appendChild(q)}else q=k,q.removeAttribute("x"),q.removeAttribute("y"),nt=q.getAttribute("transform")+nt;return q.setAttribute("transform",nt),Z}function A(k,x){for(;k&&(k=k.parentNode);)if(k.nodeName&&x.test(k.nodeName.replace("svg:",""))&&!k.getAttribute("instantiated_by_use"))return!0;return!1}e.parseSVGDocument=function(k,x,P,F){if(k){J(k);var B=e.Object.__uid++,G,Q,et=E(k),nt=e.util.toArray(k.getElementsByTagName("*"));if(et.crossOrigin=F&&F.crossOrigin,et.svgUid=B,nt.length===0&&e.isLikelyNode){nt=k.selectNodes('//*[name(.)!="svg"]');var q=[];for(G=0,Q=nt.length;G<Q;G++)q[G]=nt[G];nt=q}var X=nt.filter(function(Y){return E(Y),e.svgValidTagNamesRegEx.test(Y.nodeName.replace("svg:",""))&&!A(Y,e.svgInvalidAncestorsRegEx)});if(!X||X&&!X.length){x&&x([],{});return}var j={};nt.filter(function(Y){return Y.nodeName.replace("svg:","")==="clipPath"}).forEach(function(Y){var z=Y.getAttribute("id");j[z]=e.util.toArray(Y.getElementsByTagName("*")).filter(function(K){return e.svgValidTagNamesRegEx.test(K.nodeName.replace("svg:",""))})}),e.gradientDefs[B]=e.getGradientDefs(k),e.cssRules[B]=e.getCSSRules(k),e.clipPaths[B]=j,e.parseElements(X,function(Y,z){x&&(x(Y,et,z,nt),delete e.gradientDefs[B],delete e.cssRules[B],delete e.clipPaths[B])},l(et),P,F)}};function D(k,x){var P=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],F="xlink:href",B=x.getAttribute(F).slice(1),G=$(k,B);if(G&&G.getAttribute(F)&&D(k,G),P.forEach(function(et){G&&!x.hasAttribute(et)&&G.hasAttribute(et)&&x.setAttribute(et,G.getAttribute(et))}),!x.children.length)for(var Q=G.cloneNode(!0);Q.firstChild;)x.appendChild(Q.firstChild);x.removeAttribute(F)}var W=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");c(e,{parseFontDeclaration:function(k,x){var P=k.match(W);if(P){var F=P[1],B=P[3],G=P[4],Q=P[5],et=P[6];F&&(x.fontStyle=F),B&&(x.fontWeight=isNaN(parseFloat(B))?B:parseFloat(B)),G&&(x.fontSize=s(G)),et&&(x.fontFamily=et),Q&&(x.lineHeight=Q==="normal"?1:Q)}},getGradientDefs:function(k){var x=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],P=I(k,x),F,B=0,G={};for(B=P.length;B--;)F=P[B],F.getAttribute("xlink:href")&&D(k,F),G[F.getAttribute("id")]=F;return G},parseAttributes:function(k,x,P){if(k){var F,B={},G,Q;typeof P>"u"&&(P=k.getAttribute("svgUid")),k.parentNode&&e.svgValidParentsRegEx.test(k.parentNode.nodeName)&&(B=e.parseAttributes(k.parentNode,x,P));var et=x.reduce(function(K,tt){return F=k.getAttribute(tt),F&&(K[tt]=F),K},{}),nt=c(H(k,P),e.parseStyleAttribute(k));et=c(et,nt),nt[C]&&k.setAttribute(C,nt[C]),G=Q=B.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,et[y]&&(et[y]=G=s(et[y],Q));var q,X,j={};for(var Y in et)q=w(Y),X=S(q,et[Y],B,G),j[q]=X;j&&j.font&&e.parseFontDeclaration(j.font,j);var z=c(B,j);return e.svgValidParentsRegEx.test(k.nodeName)?z:M(z)}},parseElements:function(k,x,P,F,B){new e.ElementsParser(k,x,P,F,B).parse()},parseStyleAttribute:function(k){var x={},P=k.getAttribute("style");return P&&(typeof P=="string"?N(P,x):L(P,x)),x},parsePointsAttribute:function(k){if(!k)return null;k=k.replace(/,/g," ").trim(),k=k.split(/\s+/);var x=[],P,F;for(P=0,F=k.length;P<F;P+=2)x.push({x:parseFloat(k[P]),y:parseFloat(k[P+1])});return x},getCSSRules:function(k){var x=k.getElementsByTagName("style"),P,F,B={},G;for(P=0,F=x.length;P<F;P++){var Q=x[P].textContent;Q=Q.replace(/\/\*[\s\S]*?\*\//g,""),Q.trim()!==""&&(G=Q.split("}"),G=G.filter(function(et){return et.trim()}),G.forEach(function(et){var nt=et.split("{"),q={},X=nt[1].trim(),j=X.split(";").filter(function(tt){return tt.trim()});for(P=0,F=j.length;P<F;P++){var Y=j[P].split(":"),z=Y[0].trim(),K=Y[1].trim();q[z]=K}et=nt[0].trim(),et.split(",").forEach(function(tt){tt=tt.replace(/^svg/i,"").trim(),tt!==""&&(B[tt]?e.util.object.extend(B[tt],q):B[tt]=e.util.object.clone(q))})}))}return B},loadSVGFromURL:function(k,x,P,F){k=k.replace(/^\n\s*/,"").trim(),new e.util.request(k,{method:"get",onComplete:B});function B(G){var Q=G.responseXML;if(!Q||!Q.documentElement)return x&&x(null),!1;e.parseSVGDocument(Q.documentElement,function(et,nt,q,X){x&&x(et,nt,q,X)},P,F)}},loadSVGFromString:function(k,x,P,F){var B=new e.window.DOMParser,G=B.parseFromString(k.trim(),"text/xml");e.parseSVGDocument(G.documentElement,function(Q,et,nt,q){x(Q,et,nt,q)},P,F)}})}(p),t.ElementsParser=function(h,e,c,l,n,s){this.elements=h,this.callback=e,this.options=c,this.reviver=l,this.svgUid=c&&c.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},function(h){h.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},h.createObjects=function(){var e=this;this.elements.forEach(function(c,l){c.setAttribute("svgUid",e.svgUid),e.createObject(c,l)})},h.findTag=function(e){return t[t.util.string.capitalize(e.tagName.replace("svg:",""))]},h.createObject=function(e,c){var l=this.findTag(e);if(l&&l.fromElement)try{l.fromElement(e,this.createCallback(c,e),this.options)}catch(n){t.log(n)}else this.checkIfDone()},h.createCallback=function(e,c){var l=this;return function(n){var s;l.resolveGradient(n,c,"fill"),l.resolveGradient(n,c,"stroke"),n instanceof t.Image&&n._originalElement&&(s=n.parsePreserveAspectRatioAttribute(c)),n._removeTransformMatrix(s),l.resolveClipPath(n,c),l.reviver&&l.reviver(c,n),l.instances[e]=n,l.checkIfDone()}},h.extractPropertyDefinition=function(e,c,l){var n=e[c],s=this.regexUrl;if(s.test(n)){s.lastIndex=0;var i=s.exec(n)[1];return s.lastIndex=0,t[l][this.svgUid][i]}},h.resolveGradient=function(e,c,l){var n=this.extractPropertyDefinition(e,l,"gradientDefs");if(n){var s=c.getAttribute(l+"-opacity"),i=t.Gradient.fromElement(n,e,s,this.options);e.set(l,i)}},h.createClipPathCallback=function(e,c){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,c.push(l)}},h.resolveClipPath=function(e,c){var l=this.extractPropertyDefinition(e,"clipPath","clipPaths"),n,s,i,a,u,o;if(l){a=[],i=t.util.invertTransform(e.calcTransformMatrix());for(var d=l[0].parentNode,g=c;g.parentNode&&g.getAttribute("clip-path")!==e.clipPath;)g=g.parentNode;g.parentNode.appendChild(d);for(var v=0;v<l.length;v++)n=l[v],s=this.findTag(n),s.fromElement(n,this.createClipPathCallback(e,a),this.options);a.length===1?l=a[0]:l=new t.Group(a),u=t.util.multiplyTransformMatrices(i,l.calcTransformMatrix()),l.clipPath&&this.resolveClipPath(l,g);var o=t.util.qrDecompose(u);l.flipX=!1,l.flipY=!1,l.set("scaleX",o.scaleX),l.set("scaleY",o.scaleY),l.angle=o.angle,l.skewX=o.skewX,l.skewY=0,l.setPositionByOrigin({x:o.translateX,y:o.translateY},"center","center"),e.clipPath=l}else delete e.clipPath},h.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(h){var e=h.fabric||(h.fabric={});if(e.Point){e.warn("fabric.Point is already defined");return}e.Point=c;function c(l,n){this.x=l,this.y=n}c.prototype={type:"point",constructor:c,add:function(l){return new c(this.x+l.x,this.y+l.y)},addEquals:function(l){return this.x+=l.x,this.y+=l.y,this},scalarAdd:function(l){return new c(this.x+l,this.y+l)},scalarAddEquals:function(l){return this.x+=l,this.y+=l,this},subtract:function(l){return new c(this.x-l.x,this.y-l.y)},subtractEquals:function(l){return this.x-=l.x,this.y-=l.y,this},scalarSubtract:function(l){return new c(this.x-l,this.y-l)},scalarSubtractEquals:function(l){return this.x-=l,this.y-=l,this},multiply:function(l){return new c(this.x*l,this.y*l)},multiplyEquals:function(l){return this.x*=l,this.y*=l,this},divide:function(l){return new c(this.x/l,this.y/l)},divideEquals:function(l){return this.x/=l,this.y/=l,this},eq:function(l){return this.x===l.x&&this.y===l.y},lt:function(l){return this.x<l.x&&this.y<l.y},lte:function(l){return this.x<=l.x&&this.y<=l.y},gt:function(l){return this.x>l.x&&this.y>l.y},gte:function(l){return this.x>=l.x&&this.y>=l.y},lerp:function(l,n){return typeof n>"u"&&(n=.5),n=Math.max(Math.min(1,n),0),new c(this.x+(l.x-this.x)*n,this.y+(l.y-this.y)*n)},distanceFrom:function(l){var n=this.x-l.x,s=this.y-l.y;return Math.sqrt(n*n+s*s)},midPointFrom:function(l){return this.lerp(l)},min:function(l){return new c(Math.min(this.x,l.x),Math.min(this.y,l.y))},max:function(l){return new c(Math.max(this.x,l.x),Math.max(this.y,l.y))},toString:function(){return this.x+","+this.y},setXY:function(l,n){return this.x=l,this.y=n,this},setX:function(l){return this.x=l,this},setY:function(l){return this.y=l,this},setFromPoint:function(l){return this.x=l.x,this.y=l.y,this},swap:function(l){var n=this.x,s=this.y;this.x=l.x,this.y=l.y,l.x=n,l.y=s},clone:function(){return new c(this.x,this.y)}}}(p),function(h){var e=h.fabric||(h.fabric={});if(e.Intersection){e.warn("fabric.Intersection is already defined");return}function c(l){this.status=l,this.points=[]}e.Intersection=c,e.Intersection.prototype={constructor:c,appendPoint:function(l){return this.points.push(l),this},appendPoints:function(l){return this.points=this.points.concat(l),this}},e.Intersection.intersectLineLine=function(l,n,s,i){var a,u=(i.x-s.x)*(l.y-s.y)-(i.y-s.y)*(l.x-s.x),o=(n.x-l.x)*(l.y-s.y)-(n.y-l.y)*(l.x-s.x),d=(i.y-s.y)*(n.x-l.x)-(i.x-s.x)*(n.y-l.y);if(d!==0){var g=u/d,v=o/d;0<=g&&g<=1&&0<=v&&v<=1?(a=new c("Intersection"),a.appendPoint(new e.Point(l.x+g*(n.x-l.x),l.y+g*(n.y-l.y)))):a=new c}else u===0||o===0?a=new c("Coincident"):a=new c("Parallel");return a},e.Intersection.intersectLinePolygon=function(l,n,s){var i=new c,a=s.length,u,o,d,g;for(g=0;g<a;g++)u=s[g],o=s[(g+1)%a],d=c.intersectLineLine(l,n,u,o),i.appendPoints(d.points);return i.points.length>0&&(i.status="Intersection"),i},e.Intersection.intersectPolygonPolygon=function(l,n){var s=new c,i=l.length,a;for(a=0;a<i;a++){var u=l[a],o=l[(a+1)%i],d=c.intersectLinePolygon(u,o,n);s.appendPoints(d.points)}return s.points.length>0&&(s.status="Intersection"),s},e.Intersection.intersectPolygonRectangle=function(l,n,s){var i=n.min(s),a=n.max(s),u=new e.Point(a.x,i.y),o=new e.Point(i.x,a.y),d=c.intersectLinePolygon(i,u,l),g=c.intersectLinePolygon(u,a,l),v=c.intersectLinePolygon(a,o,l),y=c.intersectLinePolygon(o,i,l),C=new c;return C.appendPoints(d.points),C.appendPoints(g.points),C.appendPoints(v.points),C.appendPoints(y.points),C.points.length>0&&(C.status="Intersection"),C}}(p),function(h){var e=h.fabric||(h.fabric={});if(e.Color){e.warn("fabric.Color is already defined.");return}function c(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}e.Color=c,e.Color.prototype={_tryParsingColor:function(n){var s;n in c.colorNameMap&&(n=c.colorNameMap[n]),n==="transparent"&&(s=[255,255,255,0]),s||(s=c.sourceFromHex(n)),s||(s=c.sourceFromRgb(n)),s||(s=c.sourceFromHsl(n)),s||(s=[0,0,0,1]),s&&this.setSource(s)},_rgbToHsl:function(n,s,i){n/=255,s/=255,i/=255;var a,u,o,d=e.util.array.max([n,s,i]),g=e.util.array.min([n,s,i]);if(o=(d+g)/2,d===g)a=u=0;else{var v=d-g;switch(u=o>.5?v/(2-d-g):v/(d+g),d){case n:a=(s-i)/v+(s<i?6:0);break;case s:a=(i-n)/v+2;break;case i:a=(n-s)/v+4;break}a/=6}return[Math.round(a*360),Math.round(u*100),Math.round(o*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),s=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+s[0]+","+s[1]+"%,"+s[2]+"%)"},toHsla:function(){var n=this.getSource(),s=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+n[3]+")"},toHex:function(){var n=this.getSource(),s,i,a;return s=n[0].toString(16),s=s.length===1?"0"+s:s,i=n[1].toString(16),i=i.length===1?"0"+i:i,a=n[2].toString(16),a=a.length===1?"0"+a:a,s.toUpperCase()+i.toUpperCase()+a.toUpperCase()},toHexa:function(){var n=this.getSource(),s;return s=Math.round(n[3]*255),s=s.toString(16),s=s.length===1?"0"+s:s,this.toHex()+s.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var s=this.getSource();return s[3]=n,this.setSource(s),this},toGrayscale:function(){var n=this.getSource(),s=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([s,s,s,i]),this},toBlackWhite:function(n){var s=this.getSource(),i=(s[0]*.3+s[1]*.59+s[2]*.11).toFixed(0),a=s[3];return n=n||127,i=Number(i)<Number(n)?0:255,this.setSource([i,i,i,a]),this},overlayWith:function(n){n instanceof c||(n=new c(n));var s=[],i=this.getAlpha(),a=.5,u=this.getSource(),o=n.getSource(),d;for(d=0;d<3;d++)s.push(Math.round(u[d]*(1-a)+o[d]*a));return s[3]=i,this.setSource(s),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function l(n,s,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(s-n)*6*i:i<1/2?s:i<2/3?n+(s-n)*(2/3-i)*6:n}e.Color.fromRgb=function(n){return c.fromSource(c.sourceFromRgb(n))},e.Color.sourceFromRgb=function(n){var s=n.match(c.reRGBa);if(s){var i=parseInt(s[1],10)/(/%$/.test(s[1])?100:1)*(/%$/.test(s[1])?255:1),a=parseInt(s[2],10)/(/%$/.test(s[2])?100:1)*(/%$/.test(s[2])?255:1),u=parseInt(s[3],10)/(/%$/.test(s[3])?100:1)*(/%$/.test(s[3])?255:1);return[parseInt(i,10),parseInt(a,10),parseInt(u,10),s[4]?parseFloat(s[4]):1]}},e.Color.fromRgba=c.fromRgb,e.Color.fromHsl=function(n){return c.fromSource(c.sourceFromHsl(n))},e.Color.sourceFromHsl=function(n){var s=n.match(c.reHSLa);if(s){var i=(parseFloat(s[1])%360+360)%360/360,a=parseFloat(s[2])/(/%$/.test(s[2])?100:1),u=parseFloat(s[3])/(/%$/.test(s[3])?100:1),o,d,g;if(a===0)o=d=g=u;else{var v=u<=.5?u*(a+1):u+a-u*a,y=u*2-v;o=l(y,v,i+1/3),d=l(y,v,i),g=l(y,v,i-1/3)}return[Math.round(o*255),Math.round(d*255),Math.round(g*255),s[4]?parseFloat(s[4]):1]}},e.Color.fromHsla=c.fromHsl,e.Color.fromHex=function(n){return c.fromSource(c.sourceFromHex(n))},e.Color.sourceFromHex=function(n){if(n.match(c.reHex)){var s=n.slice(n.indexOf("#")+1),i=s.length===3||s.length===4,a=s.length===8||s.length===4,u=i?s.charAt(0)+s.charAt(0):s.substring(0,2),o=i?s.charAt(1)+s.charAt(1):s.substring(2,4),d=i?s.charAt(2)+s.charAt(2):s.substring(4,6),g=a?i?s.charAt(3)+s.charAt(3):s.substring(6,8):"FF";return[parseInt(u,16),parseInt(o,16),parseInt(d,16),parseFloat((parseInt(g,16)/255).toFixed(2))]}},e.Color.fromSource=function(n){var s=new c;return s.setSource(n),s}}(p),function(h){var e=h.fabric||(h.fabric={}),c=["e","se","s","sw","w","nw","n","ne","e"],l=["ns","nesw","ew","nwse"],n={},s="left",i="top",a="right",u="bottom",o="center",d={top:u,bottom:i,left:a,right:s,center:o},g=e.util.radiansToDegrees,v=Math.sign||function(q){return(q>0)-(q<0)||+q};function y(q,X){var j=q.angle+g(Math.atan2(X.y,X.x))+360;return Math.round(j%360/45)}function C(q,X){var j=X.transform.target,Y=j.canvas,z=e.util.object.clone(X);z.target=j,Y&&Y.fire("object:"+q,z),j.fire(q,X)}function w(q,X){var j=X.canvas,Y=j.uniScaleKey,z=q[Y];return j.uniformScaling&&!z||!j.uniformScaling&&z}function S(q){return q.originX===o&&q.originY===o}function O(q,X,j){var Y=q.lockScalingX,z=q.lockScalingY;return!!(Y&&z||!X&&(Y||z)&&j||Y&&X==="x"||z&&X==="y")}function M(q,X,j){var Y="not-allowed",z=w(q,j),K="";if(X.x!==0&&X.y===0?K="x":X.x===0&&X.y!==0&&(K="y"),O(j,K,z))return Y;var tt=y(j,X);return c[tt]+"-resize"}function I(q,X,j){var Y="not-allowed";if(X.x!==0&&j.lockSkewingY||X.y!==0&&j.lockSkewingX)return Y;var z=y(j,X)%4;return l[z]+"-resize"}function N(q,X,j){return q[j.canvas.altActionKey]?n.skewCursorStyleHandler(q,X,j):n.scaleCursorStyleHandler(q,X,j)}function L(q,X,j){var Y=q[j.canvas.altActionKey];if(X.x===0)return Y?"skewX":"scaleY";if(X.y===0)return Y?"skewY":"scaleX"}function H(q,X,j){return j.lockRotation?"not-allowed":X.cursorStyle}function U(q,X,j,Y){return{e:q,transform:X,pointer:{x:j,y:Y}}}function R(q){return function(X,j,Y,z){var K=j.target,tt=K.getCenterPoint(),st=K.translateToOriginPoint(tt,j.originX,j.originY),rt=q(X,j,Y,z);return K.setPositionByOrigin(st,j.originX,j.originY),rt}}function V(q,X){return function(j,Y,z,K){var tt=X(j,Y,z,K);return tt&&C(q,U(j,Y,z,K)),tt}}function $(q,X,j,Y,z){var K=q.target,tt=K.controls[q.corner],st=K.canvas.getZoom(),rt=K.padding/st,Z=K.toLocalPoint(new e.Point(Y,z),X,j);return Z.x>=rt&&(Z.x-=rt),Z.x<=-rt&&(Z.x+=rt),Z.y>=rt&&(Z.y-=rt),Z.y<=rt&&(Z.y+=rt),Z.x-=tt.offsetX,Z.y-=tt.offsetY,Z}function J(q){return q.flipX!==q.flipY}function b(q,X,j,Y,z){if(q[X]!==0){var K=q._getTransformedDimensions()[Y],tt=z/K*q[j];q.set(j,tt)}}function E(q,X,j,Y){var z=X.target,K=z._getTransformedDimensions(0,z.skewY),tt=$(X,X.originX,X.originY,j,Y),st=Math.abs(tt.x*2)-K.x,rt=z.skewX,Z;st<2?Z=0:(Z=g(Math.atan2(st/z.scaleX,K.y/z.scaleY)),X.originX===s&&X.originY===u&&(Z=-Z),X.originX===a&&X.originY===i&&(Z=-Z),J(z)&&(Z=-Z));var ot=rt!==Z;if(ot){var at=z._getTransformedDimensions().y;z.set("skewX",Z),b(z,"skewY","scaleY","y",at)}return ot}function A(q,X,j,Y){var z=X.target,K=z._getTransformedDimensions(z.skewX,0),tt=$(X,X.originX,X.originY,j,Y),st=Math.abs(tt.y*2)-K.y,rt=z.skewY,Z;st<2?Z=0:(Z=g(Math.atan2(st/z.scaleY,K.x/z.scaleX)),X.originX===s&&X.originY===u&&(Z=-Z),X.originX===a&&X.originY===i&&(Z=-Z),J(z)&&(Z=-Z));var ot=rt!==Z;if(ot){var at=z._getTransformedDimensions().x;z.set("skewY",Z),b(z,"skewX","scaleX","x",at)}return ot}function D(q,X,j,Y){var z=X.target,K=z.skewX,tt,st=X.originY;if(z.lockSkewingX)return!1;if(K===0){var rt=$(X,o,o,j,Y);rt.x>0?tt=s:tt=a}else K>0&&(tt=st===i?s:a),K<0&&(tt=st===i?a:s),J(z)&&(tt=tt===s?a:s);X.originX=tt;var Z=V("skewing",R(E));return Z(q,X,j,Y)}function W(q,X,j,Y){var z=X.target,K=z.skewY,tt,st=X.originX;if(z.lockSkewingY)return!1;if(K===0){var rt=$(X,o,o,j,Y);rt.y>0?tt=i:tt=u}else K>0&&(tt=st===s?i:u),K<0&&(tt=st===s?u:i),J(z)&&(tt=tt===i?u:i);X.originY=tt;var Z=V("skewing",R(A));return Z(q,X,j,Y)}function k(q,X,j,Y){var z=X,K=z.target,tt=K.translateToOriginPoint(K.getCenterPoint(),z.originX,z.originY);if(K.lockRotation)return!1;var st=Math.atan2(z.ey-tt.y,z.ex-tt.x),rt=Math.atan2(Y-tt.y,j-tt.x),Z=g(rt-st+z.theta),ot=!0;if(K.snapAngle>0){var at=K.snapAngle,ht=K.snapThreshold||at,mt=Math.ceil(Z/at)*at,ft=Math.floor(Z/at)*at;Math.abs(Z-ft)<ht?Z=ft:Math.abs(Z-mt)<ht&&(Z=mt)}return Z<0&&(Z=360+Z),Z%=360,ot=K.angle!==Z,K.angle=Z,ot}function x(q,X,j,Y,z){z=z||{};var K=X.target,tt=K.lockScalingX,st=K.lockScalingY,rt=z.by,Z,ot,at,ht,mt=w(q,K),ft=O(K,rt,mt),Lt,kt,Ae=X.gestureScale;if(ft)return!1;if(Ae)ot=X.scaleX*Ae,at=X.scaleY*Ae;else{if(Z=$(X,X.originX,X.originY,j,Y),Lt=rt!=="y"?v(Z.x):1,kt=rt!=="x"?v(Z.y):1,X.signX||(X.signX=Lt),X.signY||(X.signY=kt),K.lockScalingFlip&&(X.signX!==Lt||X.signY!==kt))return!1;if(ht=K._getTransformedDimensions(),mt&&!rt){var ln=Math.abs(Z.x)+Math.abs(Z.y),oe=X.original,$s=Math.abs(ht.x*oe.scaleX/K.scaleX)+Math.abs(ht.y*oe.scaleY/K.scaleY),ur=ln/$s;ot=oe.scaleX*ur,at=oe.scaleY*ur}else ot=Math.abs(Z.x*K.scaleX/ht.x),at=Math.abs(Z.y*K.scaleY/ht.y);S(X)&&(ot*=2,at*=2),X.signX!==Lt&&rt!=="y"&&(X.originX=d[X.originX],ot*=-1,X.signX=Lt),X.signY!==kt&&rt!=="x"&&(X.originY=d[X.originY],at*=-1,X.signY=kt)}var Ks=K.scaleX,Zs=K.scaleY;return rt?(rt==="x"&&K.set("scaleX",ot),rt==="y"&&K.set("scaleY",at)):(!tt&&K.set("scaleX",ot),!st&&K.set("scaleY",at)),Ks!==K.scaleX||Zs!==K.scaleY}function P(q,X,j,Y){return x(q,X,j,Y)}function F(q,X,j,Y){return x(q,X,j,Y,{by:"x"})}function B(q,X,j,Y){return x(q,X,j,Y,{by:"y"})}function G(q,X,j,Y){return q[X.target.canvas.altActionKey]?n.skewHandlerX(q,X,j,Y):n.scalingY(q,X,j,Y)}function Q(q,X,j,Y){return q[X.target.canvas.altActionKey]?n.skewHandlerY(q,X,j,Y):n.scalingX(q,X,j,Y)}function et(q,X,j,Y){var z=X.target,K=$(X,X.originX,X.originY,j,Y),tt=z.strokeWidth/(z.strokeUniform?z.scaleX:1),st=S(X)?2:1,rt=z.width,Z=Math.abs(K.x*st/z.scaleX)-tt;return z.set("width",Math.max(Z,0)),rt!==Z}function nt(q,X,j,Y){var z=X.target,K=j-X.offsetX,tt=Y-X.offsetY,st=!z.get("lockMovementX")&&z.left!==K,rt=!z.get("lockMovementY")&&z.top!==tt;return st&&z.set("left",K),rt&&z.set("top",tt),(st||rt)&&C("moving",U(q,X,j,Y)),st||rt}n.scaleCursorStyleHandler=M,n.skewCursorStyleHandler=I,n.scaleSkewCursorStyleHandler=N,n.rotationWithSnapping=V("rotating",R(k)),n.scalingEqually=V("scaling",R(P)),n.scalingX=V("scaling",R(F)),n.scalingY=V("scaling",R(B)),n.scalingYOrSkewingX=G,n.scalingXOrSkewingY=Q,n.changeWidth=V("resizing",R(et)),n.skewHandlerX=D,n.skewHandlerY=W,n.dragHandler=nt,n.scaleOrSkewActionName=L,n.rotationStyleHandler=H,n.fireEvent=C,n.wrapWithFixedAnchor=R,n.wrapWithFireEvent=V,n.getLocalPoint=$,e.controlsUtils=n}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.degreesToRadians,l=e.controlsUtils;function n(i,a,u,o,d){o=o||{};var g=this.sizeX||o.cornerSize||d.cornerSize,v=this.sizeY||o.cornerSize||d.cornerSize,y=typeof o.transparentCorners<"u"?o.transparentCorners:d.transparentCorners,C=y?"stroke":"fill",w=!y&&(o.cornerStrokeColor||d.cornerStrokeColor),S=a,O=u,M;i.save(),i.fillStyle=o.cornerColor||d.cornerColor,i.strokeStyle=o.cornerStrokeColor||d.cornerStrokeColor,g>v?(M=g,i.scale(1,v/g),O=u*g/v):v>g?(M=v,i.scale(g/v,1),S=a*v/g):M=g,i.lineWidth=1,i.beginPath(),i.arc(S,O,M/2,0,2*Math.PI,!1),i[C](),w&&i.stroke(),i.restore()}function s(i,a,u,o,d){o=o||{};var g=this.sizeX||o.cornerSize||d.cornerSize,v=this.sizeY||o.cornerSize||d.cornerSize,y=typeof o.transparentCorners<"u"?o.transparentCorners:d.transparentCorners,C=y?"stroke":"fill",w=!y&&(o.cornerStrokeColor||d.cornerStrokeColor),S=g/2,O=v/2;i.save(),i.fillStyle=o.cornerColor||d.cornerColor,i.strokeStyle=o.cornerStrokeColor||d.cornerStrokeColor,i.lineWidth=1,i.translate(a,u),i.rotate(c(d.angle)),i[C+"Rect"](-S,-O,g,v),w&&i.strokeRect(-S,-O,g,v),i.restore()}l.renderCircleControl=n,l.renderSquareControl=s}(p),function(h){var e=h.fabric||(h.fabric={});function c(l){for(var n in l)this[n]=l[n]}e.Control=c,e.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,n){return n.cursorStyle},getActionName:function(l,n){return n.actionName},getVisibility:function(l,n){var s=l._controlsVisibility;return s&&typeof s[n]<"u"?s[n]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,n){var s=e.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},n);return s},calcCornerCoords:function(l,n,s,i,a){var u,o,d,g,v=a?this.touchSizeX:this.sizeX,y=a?this.touchSizeY:this.sizeY;if(v&&y&&v!==y){var C=Math.atan2(y,v),w=Math.sqrt(v*v+y*y)/2,S=C-e.util.degreesToRadians(l),O=Math.PI/2-C-e.util.degreesToRadians(l);u=w*e.util.cos(S),o=w*e.util.sin(S),d=w*e.util.cos(O),g=w*e.util.sin(O)}else{var M=v&&y?v:n;w=M*.7071067812;var S=e.util.degreesToRadians(45-l);u=d=w*e.util.cos(S),o=g=w*e.util.sin(S)}return{tl:{x:s-g,y:i-d},tr:{x:s+u,y:i-o},bl:{x:s-u,y:i+o},br:{x:s+g,y:i+d}}},render:function(l,n,s,i,a){switch(i=i||{},i.cornerStyle||a.cornerStyle){case"circle":e.controlsUtils.renderCircleControl.call(this,l,n,s,i,a);break;default:e.controlsUtils.renderSquareControl.call(this,l,n,s,i,a)}}}}(p),function(){function h(s,i){var a=s.getAttribute("style"),u=s.getAttribute("offset")||0,o,d,g,v;if(u=parseFloat(u)/(/%$/.test(u)?100:1),u=u<0?0:u>1?1:u,a){var y=a.split(/\s*;\s*/);for(y[y.length-1]===""&&y.pop(),v=y.length;v--;){var C=y[v].split(/\s*:\s*/),w=C[0].trim(),S=C[1].trim();w==="stop-color"?o=S:w==="stop-opacity"&&(g=S)}}return o||(o=s.getAttribute("stop-color")||"rgb(0,0,0)"),g||(g=s.getAttribute("stop-opacity")),o=new t.Color(o),d=o.getAlpha(),g=isNaN(parseFloat(g))?1:parseFloat(g),g*=d*i,{offset:u,color:o.toRgb(),opacity:g}}function e(s){return{x1:s.getAttribute("x1")||0,y1:s.getAttribute("y1")||0,x2:s.getAttribute("x2")||"100%",y2:s.getAttribute("y2")||0}}function c(s){return{x1:s.getAttribute("fx")||s.getAttribute("cx")||"50%",y1:s.getAttribute("fy")||s.getAttribute("cy")||"50%",r1:0,x2:s.getAttribute("cx")||"50%",y2:s.getAttribute("cy")||"50%",r2:s.getAttribute("r")||"50%"}}var l=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(s){s||(s={}),s.coords||(s.coords={});var i,a=this;Object.keys(s).forEach(function(u){a[u]=s[u]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,i={x1:s.coords.x1||0,y1:s.coords.y1||0,x2:s.coords.x2||0,y2:s.coords.y2||0},this.type==="radial"&&(i.r1=s.coords.r1||0,i.r2=s.coords.r2||0),this.coords=i,this.colorStops=s.colorStops.slice()},addColorStop:function(s){for(var i in s){var a=new t.Color(s[i]);this.colorStops.push({offset:parseFloat(i),color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(s){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,i,s),i},toSVG:function(s,d){var a=l(this.coords,!0),u,o,d=d||{},g,v,y=l(this.colorStops,!0),C=a.r1>a.r2,w=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,O=-this.offsetY,M=!!d.additionalTransform,I=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(y.sort(function(R,V){return R.offset-V.offset}),I==="objectBoundingBox"?(S/=s.width,O/=s.height):(S+=s.width/2,O+=s.height/2),s.type==="path"&&this.gradientUnits!=="percentage"&&(S-=s.pathOffset.x,O-=s.pathOffset.y),w[4]-=S,w[5]-=O,v='id="SVGID_'+this.id+'" gradientUnits="'+I+'"',v+=' gradientTransform="'+(M?d.additionalTransform+" ":"")+t.util.matrixToSVG(w)+'" ',this.type==="linear"?g=["<linearGradient ",v,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`">
`]:this.type==="radial"&&(g=["<radialGradient ",v,' cx="',C?a.x1:a.x2,'" cy="',C?a.y1:a.y2,'" r="',C?a.r1:a.r2,'" fx="',C?a.x2:a.x1,'" fy="',C?a.y2:a.y1,`">
`]),this.type==="radial"){if(C)for(y=y.concat(),y.reverse(),u=0,o=y.length;u<o;u++)y[u].offset=1-y[u].offset;var N=Math.min(a.r1,a.r2);if(N>0){var L=Math.max(a.r1,a.r2),H=N/L;for(u=0,o=y.length;u<o;u++)y[u].offset+=H*(1-y[u].offset)}}for(u=0,o=y.length;u<o;u++){var U=y[u];g.push("<stop ",'offset="',U.offset*100+"%",'" style="stop-color:',U.color,typeof U.opacity<"u"?";stop-opacity: "+U.opacity:";",`"/>
`)}return g.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),g.join("")},toLive:function(s){var i,a=t.util.object.clone(this.coords),u,o;if(this.type){for(this.type==="linear"?i=s.createLinearGradient(a.x1,a.y1,a.x2,a.y2):this.type==="radial"&&(i=s.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2)),u=0,o=this.colorStops.length;u<o;u++){var d=this.colorStops[u].color,g=this.colorStops[u].opacity,v=this.colorStops[u].offset;typeof g<"u"&&(d=new t.Color(d).setAlpha(g).toRgba()),i.addColorStop(v,d)}return i}}}),t.util.object.extend(t.Gradient,{fromElement:function(s,i,a,u){var o=parseFloat(a)/(/%$/.test(a)?100:1);o=o<0?0:o>1?1:o,isNaN(o)&&(o=1);var d=s.getElementsByTagName("stop"),g,v=s.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",y=s.getAttribute("gradientTransform")||"",C=[],w,S,O=0,M=0,I;for(s.nodeName==="linearGradient"||s.nodeName==="LINEARGRADIENT"?(g="linear",w=e(s)):(g="radial",w=c(s)),S=d.length;S--;)C.push(h(d[S],o));I=t.parseTransformAttribute(y),n(i,w,u,v),v==="pixels"&&(O=-i.left,M=-i.top);var N=new t.Gradient({id:s.getAttribute("id"),type:g,coords:w,colorStops:C,gradientUnits:v,gradientTransform:I,offsetX:O,offsetY:M});return N}});function n(s,i,a,u){var o,d;Object.keys(i).forEach(function(g){o=i[g],o==="Infinity"?d=1:o==="-Infinity"?d=0:(d=parseFloat(i[g],10),typeof o=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(o)&&(d*=.01,u==="pixels"&&((g==="x1"||g==="x2"||g==="r2")&&(d*=a.viewBoxWidth||a.width),(g==="y1"||g==="y2")&&(d*=a.viewBoxHeight||a.height)))),i[g]=d})}}(),function(){var h=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,c){if(e||(e={}),this.id=t.Object.__uid++,this.setOptions(e),!e.source||e.source&&typeof e.source!="string"){c&&c(this);return}else{var l=this;this.source=t.util.createImage(),t.util.loadImage(e.source,function(n,s){l.source=n,c&&c(l,s)},null,this.crossOrigin)}},toObject:function(e){var c=t.Object.NUM_FRACTION_DIGITS,l,n;return typeof this.source.src=="string"?l=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(l=this.source.toDataURL()),n={type:"pattern",source:l,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:h(this.offsetX,c),offsetY:h(this.offsetY,c),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,n,e),n},toSVG:function(e){var c=typeof this.source=="function"?this.source():this.source,l=c.width/e.width,n=c.height/e.height,s=this.offsetX/e.width,i=this.offsetY/e.height,a="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(n=1,i&&(n+=Math.abs(i))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(l=1,s&&(l+=Math.abs(s))),c.src?a=c.src:c.toDataURL&&(a=c.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+s+'" y="'+i+'" width="'+l+'" height="'+n+`">
<image x="0" y="0" width="`+c.width+'" height="'+c.height+'" xlink:href="'+a+`"></image>
</pattern>
`},setOptions:function(e){for(var c in e)this[c]=e[c]},toLive:function(e){var c=this.source;return!c||typeof c.src<"u"&&(!c.complete||c.naturalWidth===0||c.naturalHeight===0)?"":e.createPattern(c,this.repeat)}})}(),function(h){var e=h.fabric||(h.fabric={}),c=e.util.toFixed;if(e.Shadow){e.warn("fabric.Shadow is already defined.");return}e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(l){typeof l=="string"&&(l=this._parseShadow(l));for(var n in l)this[n]=l[n];this.id=e.Object.__uid++},_parseShadow:function(l){var n=l.trim(),s=e.Shadow.reOffsetsAndBlur.exec(n)||[],i=n.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseFloat(s[1],10)||0,offsetY:parseFloat(s[2],10)||0,blur:parseFloat(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(l){var n=40,s=40,i=e.Object.NUM_FRACTION_DIGITS,a=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-l.angle)),u=20,o=new e.Color(this.color);return l.width&&l.height&&(n=c((Math.abs(a.x)+this.blur)/l.width,i)*100+u,s=c((Math.abs(a.y)+this.blur)/l.height,i)*100+u),l.flipX&&(a.x*=-1),l.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+n+'%" width="'+(100+2*n)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+c(this.blur?this.blur/2:0,i)+`"></feGaussianBlur>
	<feOffset dx="`+c(a.x,i)+'" dy="'+c(a.y,i)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+o.toRgb()+'" flood-opacity="'+o.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var l={},n=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(s){this[s]!==n[s]&&(l[s]=this[s])},this),l}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(p),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var h=t.util.object.extend,e=t.util.getElementOffset,c=t.util.removeFromArray,l=t.util.toFixed,n=t.util.transformPoint,s=t.util.invertTransform,i=t.util.getNodeCanvas,a=t.util.createCanvasElement,u=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(o,d){d||(d={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,d)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(o,d){var g=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(o),this._initOptions(d),this.interactive||this._initRetinaScaling(),d.overlayImage&&this.setOverlayImage(d.overlayImage,g),d.backgroundImage&&this.setBackgroundImage(d.backgroundImage,g),d.backgroundColor&&this.setBackgroundColor(d.backgroundColor,g),d.overlayColor&&this.setOverlayColor(d.overlayColor,g),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var o=t.devicePixelRatio;this.__initRetinaScaling(o,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(o,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(o,d,g){d.setAttribute("width",this.width*o),d.setAttribute("height",this.height*o),g.scale(o,o)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(o,d,g){return this.__setBgOverlayImage("overlayImage",o,d,g)},setBackgroundImage:function(o,d,g){return this.__setBgOverlayImage("backgroundImage",o,d,g)},setOverlayColor:function(o,d){return this.__setBgOverlayColor("overlayColor",o,d)},setBackgroundColor:function(o,d){return this.__setBgOverlayColor("backgroundColor",o,d)},__setBgOverlayImage:function(o,d,g,v){return typeof d=="string"?t.util.loadImage(d,function(y,C){if(y){var w=new t.Image(y,v);this[o]=w,w.canvas=this}g&&g(y,C)},this,v&&v.crossOrigin):(v&&d.setOptions(v),this[o]=d,d&&(d.canvas=this),g&&g(d,!1)),this},__setBgOverlayColor:function(o,d,g){return this[o]=d,this._initGradient(d,o),this._initPattern(d,o,g),this},_createCanvasElement:function(){var o=a();if(!o||(o.style||(o.style={}),typeof o.getContext>"u"))throw u;return o},_initOptions:function(o){var d=this.lowerCanvasEl;this._setOptions(o),this.width=this.width||parseInt(d.width,10)||0,this.height=this.height||parseInt(d.height,10)||0,this.lowerCanvasEl.style&&(d.width=this.width,d.height=this.height,d.style.width=this.width+"px",d.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(o){o&&o.getContext?this.lowerCanvasEl=o:this.lowerCanvasEl=t.util.getById(o)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(o,d){return this.setDimensions({width:o},d)},setHeight:function(o,d){return this.setDimensions({height:o},d)},setDimensions:function(o,d){var g;d=d||{};for(var v in o)g=o[v],d.cssOnly||(this._setBackstoreDimension(v,o[v]),g+="px",this.hasLostContext=!0),d.backstoreOnly||this._setCssDimension(v,g);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),d.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(o,d){return this.lowerCanvasEl[o]=d,this.upperCanvasEl&&(this.upperCanvasEl[o]=d),this.cacheCanvasEl&&(this.cacheCanvasEl[o]=d),this[o]=d,this},_setCssDimension:function(o,d){return this.lowerCanvasEl.style[o]=d,this.upperCanvasEl&&(this.upperCanvasEl.style[o]=d),this.wrapperEl&&(this.wrapperEl.style[o]=d),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(o){var d=this._activeObject,g=this.backgroundImage,v=this.overlayImage,y,C,w;for(this.viewportTransform=o,C=0,w=this._objects.length;C<w;C++)y=this._objects[C],y.group||y.setCoords(!0);return d&&d.setCoords(),g&&g.setCoords(!0),v&&v.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(o,d){var g=o,v=this.viewportTransform.slice(0);o=n(o,s(this.viewportTransform)),v[0]=d,v[3]=d;var y=n(o,v);return v[4]+=g.x-y.x,v[5]+=g.y-y.y,this.setViewportTransform(v)},setZoom:function(o){return this.zoomToPoint(new t.Point(0,0),o),this},absolutePan:function(o){var d=this.viewportTransform.slice(0);return d[4]=-o.x,d[5]=-o.y,this.setViewportTransform(d)},relativePan:function(o){return this.absolutePan(new t.Point(-o.x-this.viewportTransform[4],-o.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(o){this.stateful&&o.setupState(),o._set("canvas",this),o.setCoords(),this.fire("object:added",{target:o}),o.fire("added")},_onObjectRemoved:function(o){this.fire("object:removed",{target:o}),o.fire("removed"),delete o.canvas},clearContext:function(o){return o.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var o=this.contextContainer;return this.renderCanvas(o,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var o={},d=this.width,g=this.height,v=s(this.viewportTransform);return o.tl=n({x:0,y:0},v),o.br=n({x:d,y:g},v),o.tr=new t.Point(o.br.x,o.tl.y),o.bl=new t.Point(o.tl.x,o.br.y),this.vptCoords=o,o},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(o,d){var g=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(o),t.util.setImageSmoothing(o,this.imageSmoothingEnabled),this.fire("before:render",{ctx:o}),this._renderBackground(o),o.save(),o.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._renderObjects(o,d),o.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(o),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(o)),this._renderOverlay(o),this.controlsAboveOverlay&&this.interactive&&this.drawControls(o),this.fire("after:render",{ctx:o})},drawClipPathOnCanvas:function(o){var d=this.viewportTransform,g=this.clipPath;o.save(),o.transform(d[0],d[1],d[2],d[3],d[4],d[5]),o.globalCompositeOperation="destination-in",g.transform(o),o.scale(1/g.zoomX,1/g.zoomY),o.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),o.restore()},_renderObjects:function(o,d){var g,v;for(g=0,v=d.length;g<v;++g)d[g]&&d[g].render(o)},_renderBackgroundOrOverlay:function(o,d){var g=this[d+"Color"],v=this[d+"Image"],y=this.viewportTransform,C=this[d+"Vpt"];if(!(!g&&!v)){if(g){o.save(),o.beginPath(),o.moveTo(0,0),o.lineTo(this.width,0),o.lineTo(this.width,this.height),o.lineTo(0,this.height),o.closePath(),o.fillStyle=g.toLive?g.toLive(o,this):g,C&&o.transform(y[0],y[1],y[2],y[3],y[4],y[5]),o.transform(1,0,0,1,g.offsetX||0,g.offsetY||0);var w=g.gradientTransform||g.patternTransform;w&&o.transform(w[0],w[1],w[2],w[3],w[4],w[5]),o.fill(),o.restore()}v&&(o.save(),C&&o.transform(y[0],y[1],y[2],y[3],y[4],y[5]),v.render(o),o.restore())}},_renderBackground:function(o){this._renderBackgroundOrOverlay(o,"background")},_renderOverlay:function(o){this._renderBackgroundOrOverlay(o,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(o){return this._centerObject(o,new t.Point(this.getCenterPoint().x,o.getCenterPoint().y))},centerObjectV:function(o){return this._centerObject(o,new t.Point(o.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(o){var d=this.getCenterPoint();return this._centerObject(o,d)},viewportCenterObject:function(o){var d=this.getVpCenter();return this._centerObject(o,d)},viewportCenterObjectH:function(o){var d=this.getVpCenter();return this._centerObject(o,new t.Point(d.x,o.getCenterPoint().y)),this},viewportCenterObjectV:function(o){var d=this.getVpCenter();return this._centerObject(o,new t.Point(o.getCenterPoint().x,d.y))},getVpCenter:function(){var o=this.getCenterPoint(),d=s(this.viewportTransform);return n(o,d)},_centerObject:function(o,d){return o.setPositionByOrigin(d,"center","center"),o.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(o){return this.toDatalessObject(o)},toObject:function(o){return this._toObjectMethod("toObject",o)},toDatalessObject:function(o){return this._toObjectMethod("toDatalessObject",o)},_toObjectMethod:function(o,d){var g=this.clipPath,v={version:t.version,objects:this._toObjects(o,d)};return g&&!g.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,o,d)),h(v,this.__serializeBgOverlay(o,d)),t.util.populateWithProperties(this,v,d),v},_toObjects:function(o,d){return this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){return this._toObject(g,o,d)},this)},_toObject:function(o,d,g){var v;this.includeDefaultValues||(v=o.includeDefaultValues,o.includeDefaultValues=!1);var y=o[d](g);return this.includeDefaultValues||(o.includeDefaultValues=v),y},__serializeBgOverlay:function(o,d){var g={},v=this.backgroundImage,y=this.overlayImage,C=this.backgroundColor,w=this.overlayColor;return C&&C.toObject?C.excludeFromExport||(g.background=C.toObject(d)):C&&(g.background=C),w&&w.toObject?w.excludeFromExport||(g.overlay=w.toObject(d)):w&&(g.overlay=w),v&&!v.excludeFromExport&&(g.backgroundImage=this._toObject(v,o,d)),y&&!y.excludeFromExport&&(g.overlayImage=this._toObject(y,o,d)),g},svgViewportTransformation:!0,toSVG:function(o,d){o||(o={}),o.reviver=d;var g=[];return this._setSVGPreamble(g,o),this._setSVGHeader(g,o),this.clipPath&&g.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(g,"background"),this._setSVGBgOverlayImage(g,"backgroundImage",d),this._setSVGObjects(g,d),this.clipPath&&g.push(`</g>
`),this._setSVGBgOverlayColor(g,"overlay"),this._setSVGBgOverlayImage(g,"overlayImage",d),g.push("</svg>"),g.join("")},_setSVGPreamble:function(o,d){d.suppressPreamble||o.push('<?xml version="1.0" encoding="',d.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(o,d){var g=d.width||this.width,v=d.height||this.height,y,C='viewBox="0 0 '+this.width+" "+this.height+'" ',w=t.Object.NUM_FRACTION_DIGITS;d.viewBox?C='viewBox="'+d.viewBox.x+" "+d.viewBox.y+" "+d.viewBox.width+" "+d.viewBox.height+'" ':this.svgViewportTransformation&&(y=this.viewportTransform,C='viewBox="'+l(-y[4]/y[0],w)+" "+l(-y[5]/y[3],w)+" "+l(this.width/y[0],w)+" "+l(this.height/y[3],w)+'" '),o.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',g,'" ','height="',v,'" ',C,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(d),`</defs>
`)},createSVGClipPathMarkup:function(o){var d=this.clipPath;return d?(d.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+d.clipPathId+`" >
`+this.clipPath.toClipPathSVG(o.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var o=this,d=["background","overlay"].map(function(g){var v=o[g+"Color"];if(v&&v.toLive){var y=o[g+"Vpt"],C=o.viewportTransform,w={width:o.width/(y?C[0]:1),height:o.height/(y?C[3]:1)};return v.toSVG(w,{additionalTransform:y?t.util.matrixToSVG(C):""})}});return d.join("")},createSVGFontFacesMarkup:function(){var o="",d={},g,v,y,C,w,S,O,M,I,N=t.fontPaths,L=[];for(this._objects.forEach(function U(R){L.push(R),R._objects&&R._objects.forEach(U)}),M=0,I=L.length;M<I;M++)if(g=L[M],v=g.fontFamily,!(g.type.indexOf("text")===-1||d[v]||!N[v])&&(d[v]=!0,!!g.styles)){y=g.styles;for(w in y){C=y[w];for(O in C)S=C[O],v=S.fontFamily,!d[v]&&N[v]&&(d[v]=!0)}}for(var H in d)o+=[`		@font-face {
`,"			font-family: '",H,`';
`,"			src: url('",N[H],`');
`,`		}
`].join("");return o&&(o=['	<style type="text/css">',`<![CDATA[
`,o,"]]>",`</style>
`].join("")),o},_setSVGObjects:function(o,d){var g,v,y,C=this._objects;for(v=0,y=C.length;v<y;v++)g=C[v],!g.excludeFromExport&&this._setSVGObject(o,g,d)},_setSVGObject:function(o,d,g){o.push(d.toSVG(g))},_setSVGBgOverlayImage:function(o,d,g){this[d]&&!this[d].excludeFromExport&&this[d].toSVG&&o.push(this[d].toSVG(g))},_setSVGBgOverlayColor:function(o,d){var g=this[d+"Color"],v=this.viewportTransform,y=this.width,C=this.height;if(g)if(g.toLive){var w=g.repeat,S=t.util.invertTransform(v),O=this[d+"Vpt"],M=O?t.util.matrixToSVG(S):"";o.push('<rect transform="'+M+" translate(",y/2,",",C/2,')"',' x="',g.offsetX-y/2,'" y="',g.offsetY-C/2,'" ','width="',w==="repeat-y"||w==="no-repeat"?g.source.width:y,'" height="',w==="repeat-x"||w==="no-repeat"?g.source.height:C,'" fill="url(#SVGID_'+g.id+')"',`></rect>
`)}else o.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',g,'"',`></rect>
`)},sendToBack:function(o){if(!o)return this;var d=this._activeObject,g,v,y;if(o===d&&o.type==="activeSelection")for(y=d._objects,g=y.length;g--;)v=y[g],c(this._objects,v),this._objects.unshift(v);else c(this._objects,o),this._objects.unshift(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(o){if(!o)return this;var d=this._activeObject,g,v,y;if(o===d&&o.type==="activeSelection")for(y=d._objects,g=0;g<y.length;g++)v=y[g],c(this._objects,v),this._objects.push(v);else c(this._objects,o),this._objects.push(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(o,d){if(!o)return this;var g=this._activeObject,v,y,C,w,S,O=0;if(o===g&&o.type==="activeSelection")for(S=g._objects,v=0;v<S.length;v++)y=S[v],C=this._objects.indexOf(y),C>0+O&&(w=C-1,c(this._objects,y),this._objects.splice(w,0,y)),O++;else C=this._objects.indexOf(o),C!==0&&(w=this._findNewLowerIndex(o,C,d),c(this._objects,o),this._objects.splice(w,0,o));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(o,d,g){var v,y;if(g)for(v=d,y=d-1;y>=0;--y){var C=o.intersectsWithObject(this._objects[y])||o.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(o);if(C){v=y;break}}else v=d-1;return v},bringForward:function(o,d){if(!o)return this;var g=this._activeObject,v,y,C,w,S,O=0;if(o===g&&o.type==="activeSelection")for(S=g._objects,v=S.length;v--;)y=S[v],C=this._objects.indexOf(y),C<this._objects.length-1-O&&(w=C+1,c(this._objects,y),this._objects.splice(w,0,y)),O++;else C=this._objects.indexOf(o),C!==this._objects.length-1&&(w=this._findNewUpperIndex(o,C,d),c(this._objects,o),this._objects.splice(w,0,o));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(o,d,g){var v,y,C;if(g)for(v=d,y=d+1,C=this._objects.length;y<C;++y){var w=o.intersectsWithObject(this._objects[y])||o.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(o);if(w){v=y;break}}else v=d+1;return v},moveTo:function(o,d){return c(this._objects,o),this._objects.splice(d,0,o),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(o){o.dispose&&o.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),h(t.StaticCanvas.prototype,t.Observable),h(t.StaticCanvas.prototype,t.Collection),h(t.StaticCanvas.prototype,t.DataURLExporter),h(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(o){var d=a();if(!d||!d.getContext)return null;var g=d.getContext("2d");if(!g)return null;switch(o){case"setLineDash":return typeof g.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var o=i(this.lowerCanvasEl);return o&&o.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(o){var d=i(this.lowerCanvasEl);return d&&d.createJPEGStream(o)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(h){h.strokeStyle=this.color,h.lineWidth=this.width,h.lineCap=this.strokeLineCap,h.miterLimit=this.strokeMiterLimit,h.lineJoin=this.strokeLineJoin,h.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(h){var e=this.canvas.viewportTransform;h.save(),h.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var h=this.canvas,e=this.shadow,c=h.contextTop,l=h.getZoom();h&&h._isRetinaScaling()&&(l*=t.devicePixelRatio),c.shadowColor=e.color,c.shadowBlur=e.blur*l,c.shadowOffsetX=e.offsetX*l,c.shadowOffsetY=e.offsetY*l}},needsFullRender:function(){var h=new t.Color(this.color);return h.getAlpha()<1||!!this.shadow},_resetShadow:function(){var h=this.canvas.contextTop;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_isOutSideCanvas:function(h){return h.x<0||h.x>this.canvas.getWidth()||h.y<0||h.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(h){this.canvas=h,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(h,e,c){var l=e.midPointFrom(c);return h.quadraticCurveTo(e.x,e.y,l.x,l.y),l},onMouseDown:function(h,e){this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],this._prepareForDrawing(h),this._captureDrawingPath(h),this._render())},onMouseMove:function(h,e){if(this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h))&&this._captureDrawingPath(h)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var c=this._points,l=c.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,c[l-2],c[l-1],!0),n.stroke(),n.restore()}},onMouseUp:function(h){return this.canvas._isMainEvent(h.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(h){var e=new t.Point(h.x,h.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(h){return this._points.length>1&&h.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(h),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(h){var e=new t.Point(h.x,h.y);return this._addPoint(e)},_render:function(h){var e,c,l=this._points[0],n=this._points[1];if(h=h||this.canvas.contextTop,this._saveAndTransform(h),h.beginPath(),this._points.length===2&&l.x===n.x&&l.y===n.y){var s=this.width/1e3;l=new t.Point(l.x,l.y),n=new t.Point(n.x,n.y),l.x-=s,n.x+=s}for(h.moveTo(l.x,l.y),e=1,c=this._points.length;e<c;e++)this._drawSegment(h,l,n),l=this._points[e],n=this._points[e+1];h.lineTo(l.x,l.y),h.stroke(),h.restore()},convertPointsToSVGPath:function(h){var e=this.width/1e3;return t.util.getSmoothPathFromPoints(h,e)},_isEmptySVGPath:function(h){var e=t.util.joinPath(h);return e==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(h){var e=new t.Path(h,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.shadow=new t.Shadow(this.shadow)),e},decimatePoints:function(h,e){if(h.length<=2)return h;var c=this.canvas.getZoom(),l=Math.pow(e/c,2),n,s=h.length-1,i=h[0],a=[i],u;for(n=1;n<s-1;n++)u=Math.pow(i.x-h[n].x,2)+Math.pow(i.y-h[n].y,2),u>=l&&(i=h[n],a.push(i));return a.push(h[s]),a},_finalizeAndAddPath:function(){var h=this.canvas.contextTop;h.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(e)){this.canvas.requestRenderAll();return}var c=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.requestRenderAll(),c.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:c})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(h){this.canvas=h,this.points=[]},drawDot:function(h){var e=this.addPoint(h),c=this.canvas.contextTop;this._saveAndTransform(c),this.dot(c,e),c.restore()},dot:function(h,e){h.fillStyle=e.fill,h.beginPath(),h.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),h.closePath(),h.fill()},onMouseDown:function(h){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(h)},_render:function(){var h=this.canvas.contextTop,e,c,l=this.points;for(this._saveAndTransform(h),e=0,c=l.length;e<c;e++)this.dot(h,l[e]);h.restore()},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(h),this._render()):this.drawDot(h))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove,e,c;this.canvas.renderOnAddRemove=!1;var l=[];for(e=0,c=this.points.length;e<c;e++){var n=this.points[e],s=new t.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(s.shadow=new t.Shadow(this.shadow)),l.push(s)}var i=new t.Group(l);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},addPoint:function(h){var e=new t.Point(h.x,h.y),c=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,l=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return e.radius=c,e.fill=l,this.points.push(e),e}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(h){this.canvas=h,this.sprayChunks=[]},onMouseDown:function(h){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(h),this.render(this.sprayChunkPoints)},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.addSprayChunk(h),this.render(this.sprayChunkPoints))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],c=0,l=this.sprayChunks.length;c<l;c++)for(var n=this.sprayChunks[c],s=0,i=n.length;s<i;s++){var a=new t.Rect({width:n[s].width,height:n[s].width,left:n[s].x+1,top:n[s].y+1,originX:"center",originY:"center",fill:this.color});e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var u=new t.Group(e);this.shadow&&u.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},_getOptimizedRects:function(h){var e={},c,l,n;for(l=0,n=h.length;l<n;l++)c=h[l].left+""+h[l].top,e[c]||(e[c]=h[l]);var s=[];for(c in e)s.push(e[c]);return s},render:function(h){var e=this.canvas.contextTop,c,l;for(e.fillStyle=this.color,this._saveAndTransform(e),c=0,l=h.length;c<l;c++){var n=h[c];typeof n.opacity<"u"&&(e.globalAlpha=n.opacity),e.fillRect(n.x,n.y,n.width,n.width)}e.restore()},_render:function(){var h=this.canvas.contextTop,e,c;for(h.fillStyle=this.color,this._saveAndTransform(h),e=0,c=this.sprayChunks.length;e<c;e++)this.render(this.sprayChunks[e]);h.restore()},addSprayChunk:function(h){this.sprayChunkPoints=[];var e,c,l,n=this.width/2,s;for(s=0;s<this.density;s++){e=t.util.getRandomInt(h.x-n,h.x+n),c=t.util.getRandomInt(h.y-n,h.y+n),this.dotWidthVariance?l=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):l=this.dotWidth;var i=new t.Point(e,c);i.width=l,this.randomOpacity&&(i.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var h=20,e=5,c=t.util.createCanvasElement(),l=c.getContext("2d");return c.width=c.height=h+e,l.fillStyle=this.color,l.beginPath(),l.arc(h/2,h/2,h/2,0,Math.PI*2,!1),l.closePath(),l.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(h){return h.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(h){this.callSuper("_setBrushStyles",h),h.strokeStyle=this.getPattern(h)},createPath:function(h){var e=this.callSuper("createPath",h),c=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-c.x,offsetY:-c.y}),e}}),function(){var h=t.util.getPointer,e=t.util.degreesToRadians,c=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(n,s){s||(s={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(n,s),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var n=this.getActiveObjects(),s,i,a;if(n.length>0&&!this.preserveObjectStacking){i=[],a=[];for(var u=0,o=this._objects.length;u<o;u++)s=this._objects[u],n.indexOf(s)===-1?i.push(s):a.push(s);n.length>1&&(this._activeObject._objects=a),i.push.apply(i,a)}else i=this._objects;return i},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var n=this.contextContainer;return this.renderCanvas(n,this._chooseObjectsToRender()),this},renderTopLayer:function(n){n.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(n),this.contextTopDirty=!0),n.restore()},renderTop:function(){var n=this.contextTop;return this.clearContext(n),this.renderTopLayer(n),this.fire("after:render"),this},_normalizePointer:function(n,s){var i=n.calcTransformMatrix(),a=t.util.invertTransform(i),u=this.restorePointerVpt(s);return t.util.transformPoint(u,a)},isTargetTransparent:function(n,s,i){if(n.shouldCache()&&n._cacheCanvas&&n!==this._activeObject){var a=this._normalizePointer(n,{x:s,y:i}),u=Math.max(n.cacheTranslationX+a.x*n.zoomX,0),o=Math.max(n.cacheTranslationY+a.y*n.zoomY,0),y=t.util.isTransparent(n._cacheContext,Math.round(u),Math.round(o),this.targetFindTolerance);return y}var d=this.contextCache,g=n.selectionBackgroundColor,v=this.viewportTransform;n.selectionBackgroundColor="",this.clearContext(d),d.save(),d.transform(v[0],v[1],v[2],v[3],v[4],v[5]),n.render(d),d.restore(),n.selectionBackgroundColor=g;var y=t.util.isTransparent(d,s,i,this.targetFindTolerance);return y},_isSelectionKeyPressed:function(n){var s=!1;return Array.isArray(this.selectionKey)?s=!!this.selectionKey.find(function(i){return n[i]===!0}):s=n[this.selectionKey],s},_shouldClearSelection:function(n,s){var i=this.getActiveObjects(),a=this._activeObject;return!s||s&&a&&i.length>1&&i.indexOf(s)===-1&&a!==s&&!this._isSelectionKeyPressed(n)||s&&!s.evented||s&&!s.selectable&&a&&a!==s},_shouldCenterTransform:function(n,s,i){if(n){var a;return s==="scale"||s==="scaleX"||s==="scaleY"||s==="resizing"?a=this.centeredScaling||n.centeredScaling:s==="rotate"&&(a=this.centeredRotation||n.centeredRotation),a?!i:i}},_getOriginFromCorner:function(n,s){var i={x:n.originX,y:n.originY};return s==="ml"||s==="tl"||s==="bl"?i.x="right":(s==="mr"||s==="tr"||s==="br")&&(i.x="left"),s==="tl"||s==="mt"||s==="tr"?i.y="bottom":(s==="bl"||s==="mb"||s==="br")&&(i.y="top"),i},_getActionFromCorner:function(n,s,i,a){if(!s||!n)return"drag";var u=a.controls[s];return u.getActionName(i,u,a)},_setupCurrentTransform:function(n,s,i){if(s){var a=this.getPointer(n),u=s.__corner,o=s.controls[u],d=i&&u?o.getActionHandler(n,s,o):t.controlsUtils.dragHandler,g=this._getActionFromCorner(i,u,n,s),v=this._getOriginFromCorner(s,u),y=n[this.centeredKey],C={target:s,action:g,actionHandler:d,corner:u,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,offsetX:a.x-s.left,offsetY:a.y-s.top,originX:v.x,originY:v.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,theta:e(s.angle),width:s.width*s.scaleX,shiftKey:n.shiftKey,altKey:y,original:t.util.saveObjectTransform(s)};this._shouldCenterTransform(s,g,y)&&(C.originX="center",C.originY="center"),C.original.originX=v.x,C.original.originY=v.y,this._currentTransform=C,this._beforeTransform(n)}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_drawSelection:function(n){var s=this._groupSelector,i=new t.Point(s.ex,s.ey),a=t.util.transformPoint(i,this.viewportTransform),u=new t.Point(s.ex+s.left,s.ey+s.top),o=t.util.transformPoint(u,this.viewportTransform),d=Math.min(a.x,o.x),g=Math.min(a.y,o.y),v=Math.max(a.x,o.x),y=Math.max(a.y,o.y),C=this.selectionLineWidth/2;this.selectionColor&&(n.fillStyle=this.selectionColor,n.fillRect(d,g,v-d,y-g)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(n.lineWidth=this.selectionLineWidth,n.strokeStyle=this.selectionBorderColor,d+=C,g+=C,v-=C,y-=C,t.Object.prototype._setLineDash.call(this,n,this.selectionDashArray),n.strokeRect(d,g,v-d,y-g))},findTarget:function(n,s){if(!this.skipTargetFind){var i=!0,a=this.getPointer(n,i),u=this._activeObject,o=this.getActiveObjects(),d,g,v=c(n),y=o.length>1&&!s||o.length===1;if(this.targets=[],y&&u._findTargetCorner(a,v)||o.length>1&&!s&&u===this._searchPossibleTargets([u],a))return u;if(o.length===1&&u===this._searchPossibleTargets([u],a))if(this.preserveObjectStacking)d=u,g=this.targets,this.targets=[];else return u;var C=this._searchPossibleTargets(this._objects,a);return n[this.altSelectionKey]&&C&&d&&C!==d&&(C=d,this.targets=g),C}},_checkTarget:function(n,s,i){if(s&&s.visible&&s.evented&&s.containsPoint(n))if((this.perPixelTargetFind||s.perPixelTargetFind)&&!s.isEditing){var a=this.isTargetTransparent(s,i.x,i.y);if(!a)return!0}else return!0},_searchPossibleTargets:function(n,s){for(var i,a=n.length,u;a--;){var o=n[a],d=o.group?this._normalizePointer(o.group,s):s;if(this._checkTarget(d,o,s)){i=n[a],i.subTargetCheck&&i instanceof t.Group&&(u=this._searchPossibleTargets(i._objects,s),u&&this.targets.push(u));break}}return i},restorePointerVpt:function(n){return t.util.transformPoint(n,t.util.invertTransform(this.viewportTransform))},getPointer:function(n,s){if(this._absolutePointer&&!s)return this._absolutePointer;if(this._pointer&&s)return this._pointer;var i=h(n),a=this.upperCanvasEl,u=a.getBoundingClientRect(),o=u.width||0,d=u.height||0,g;(!o||!d)&&("top"in u&&"bottom"in u&&(d=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(o=Math.abs(u.right-u.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,s||(i=this.restorePointerVpt(i));var v=this.getRetinaScaling();return v!==1&&(i.x/=v,i.y/=v),o===0||d===0?g={width:1,height:1}:g={width:a.width/o,height:a.height/d},{x:i.x*g.width,y:i.y*g.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),s=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),t.util.addClass(i,"upper-canvas "+n),this.wrapperEl.appendChild(i),this._copyCanvasStyle(s,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var s=this.width||n.width,i=this.height||n.height;t.util.setStyle(n,{position:"absolute",width:s+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),n.width=s,n.height=i,t.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,s){s.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var n=this._activeObject;return n?n.type==="activeSelection"&&n._objects?n._objects.slice(0):[n]:[]},_onObjectRemoved:function(n){n===this._activeObject&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared",{target:n}),n.fire("deselected")),n===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",n)},_fireSelectionEvents:function(n,s){var i=!1,a=this.getActiveObjects(),u=[],o=[];n.forEach(function(d){a.indexOf(d)===-1&&(i=!0,d.fire("deselected",{e:s,target:d}),o.push(d))}),a.forEach(function(d){n.indexOf(d)===-1&&(i=!0,d.fire("selected",{e:s,target:d}),u.push(d))}),n.length>0&&a.length>0?i&&this.fire("selection:updated",{e:s,selected:u,deselected:o}):a.length>0?this.fire("selection:created",{e:s,selected:u}):n.length>0&&this.fire("selection:cleared",{e:s,deselected:o})},setActiveObject:function(n,s){var i=this.getActiveObjects();return this._setActiveObject(n,s),this._fireSelectionEvents(i,s),this},_setActiveObject:function(n,s){return this._activeObject===n||!this._discardActiveObject(s,n)||n.onSelect({e:s})?!1:(this._activeObject=n,!0)},_discardActiveObject:function(n,s){var i=this._activeObject;if(i){if(i.onDeselect({e:n,object:s}))return!1;this._activeObject=null}return!0},discardActiveObject:function(n){var s=this.getActiveObjects(),i=this.getActiveObject();return s.length&&this.fire("before:selection:cleared",{target:i,e:n}),this._discardActiveObject(n),this._fireSelectionEvents(s,n),this},dispose:function(){var n=this.wrapperEl;return this.removeListeners(),n.removeChild(this.upperCanvasEl),n.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(s){t.util.cleanUpJsdomNode(this[s]),this[s]=void 0}).bind(this)),n.parentNode&&n.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(n){var s=this._activeObject;s&&s._renderControls(n)},_toObject:function(n,s,i){var a=this._realizeGroupTransformOnObject(n),u=this.callSuper("_toObject",n,s,i);return this._unwindGroupTransformOnObject(n,a),u},_realizeGroupTransformOnObject:function(n){if(n.group&&n.group.type==="activeSelection"&&this._activeObject===n.group){var s=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],i={};return s.forEach(function(a){i[a]=n[a]}),t.util.addTransformToObject(n,this._activeObject.calcOwnMatrix()),i}else return null},_unwindGroupTransformOnObject:function(n,s){s&&n.set(s)},_setSVGObject:function(n,s,i){var a=this._realizeGroupTransformOnObject(s);this.callSuper("_setSVGObject",n,s,i),this._unwindGroupTransformOnObject(s,a)},setViewportTransform:function(n){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,n)}});for(var l in t.StaticCanvas)l!=="prototype"&&(t.Canvas[l]=t.StaticCanvas[l])}(),function(){var h=t.util.addListener,e=t.util.removeListener,c=3,l=2,n=1,s={passive:!1};function i(a,u){return a.button&&a.button===u-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(h,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,u){var o=this.upperCanvasEl,d=this._getEventPrefix();a(t.window,"resize",this._onResize),a(o,d+"down",this._onMouseDown),a(o,d+"move",this._onMouseMove,s),a(o,d+"out",this._onMouseOut),a(o,d+"enter",this._onMouseEnter),a(o,"wheel",this._onMouseWheel),a(o,"contextmenu",this._onContextMenu),a(o,"dblclick",this._onDoubleClick),a(o,"dragover",this._onDragOver),a(o,"dragenter",this._onDragEnter),a(o,"dragleave",this._onDragLeave),a(o,"drop",this._onDrop),this.enablePointerEvents||a(o,"touchstart",this._onTouchStart,s),typeof eventjs<"u"&&u in eventjs&&(eventjs[u](o,"gesture",this._onGesture),eventjs[u](o,"drag",this._onDrag),eventjs[u](o,"orientation",this._onOrientationChange),eventjs[u](o,"shake",this._onShake),eventjs[u](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(e,"remove");var a=this._getEventPrefix();e(t.document,a+"up",this._onMouseUp),e(t.document,"touchend",this._onTouchEnd,s),e(t.document,a+"move",this._onMouseMove,s),e(t.document,"touchmove",this._onMouseMove,s)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(a,u){this.__onTransformGesture&&this.__onTransformGesture(a,u)},_onDrag:function(a,u){this.__onDrag&&this.__onDrag(a,u)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var u=this._hoveredTarget;this.fire("mouse:out",{target:u,e:a}),this._hoveredTarget=null,u&&u.fire("mouseout",{e:a});var o=this;this._hoveredTargets.forEach(function(d){o.fire("mouse:out",{target:u,e:a}),d&&u.fire("mouseout",{e:a})}),this._hoveredTargets=[]},_onMouseEnter:function(a){!this._currentTransform&&!this.findTarget(a)&&(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,u){this.__onOrientationChange&&this.__onOrientationChange(a,u)},_onShake:function(a,u){this.__onShake&&this.__onShake(a,u)},_onLongPress:function(a,u){this.__onLongPress&&this.__onLongPress(a,u)},_onDragOver:function(a){a.preventDefault();var u=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(u,a)},_onDrop:function(a){return this._simpleEventHandler("drop:before",a),this._simpleEventHandler("drop",a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var u=a.changedTouches;return u?u[0]&&u[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return a.isPrimary===!0?!0:a.isPrimary===!1?!1:a.type==="touchend"&&a.touches.length===0?!0:a.changedTouches?a.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(a){a.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var u=this.upperCanvasEl,o=this._getEventPrefix();h(t.document,"touchend",this._onTouchEnd,s),h(t.document,"touchmove",this._onMouseMove,s),e(u,o+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var u=this.upperCanvasEl,o=this._getEventPrefix();e(u,o+"move",this._onMouseMove,s),h(t.document,o+"up",this._onMouseUp),h(t.document,o+"move",this._onMouseMove,s)},_onTouchEnd:function(a){if(!(a.touches.length>0)){this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var u=this._getEventPrefix();e(t.document,"touchend",this._onTouchEnd,s),e(t.document,"touchmove",this._onMouseMove,s);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){h(o.upperCanvasEl,u+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var u=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(a)&&(e(t.document,o+"up",this._onMouseUp),e(t.document,o+"move",this._onMouseMove,s),h(u,o+"move",this._onMouseMove,s))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var u=this._activeObject;return!!u!=!!a||u&&a&&u!==a?!0:(u&&u.isEditing,!1)},__onMouseUp:function(a){var u,o=this._currentTransform,d=this._groupSelector,g=!1,v=!d||d.left===0&&d.top===0;if(this._cacheTransformEventData(a),u=this._target,this._handleEvent(a,"up:before"),i(a,c)){this.fireRightClick&&this._handleEvent(a,"up",c,v);return}if(i(a,l)){this.fireMiddleClick&&this._handleEvent(a,"up",l,v),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(a);return}if(this._isMainEvent(a)){if(o&&(this._finalizeCurrentTransform(a),g=o.actionPerformed),!v){var y=u===this._activeObject;this._maybeGroupObjects(a),g||(g=this._shouldRender(u)||!y&&u===this._activeObject)}var C,w;if(u){if(C=u._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a)),u.selectable&&u!==this._activeObject&&u.activeOn==="up")this.setActiveObject(u,a),g=!0;else{var S=u.controls[C],O=S&&S.getMouseUpHandler(a,u,S);O&&(w=this.getPointer(a),O(a,o,w.x,w.y))}u.isMoving=!1}if(o&&(o.target!==u||o.corner!==C)){var M=o.target&&o.target.controls[o.corner],I=M&&M.getMouseUpHandler(a,u,S);w=w||this.getPointer(a),I&&I(a,o,w.x,w.y)}this._setCursorFromEvent(a,u),this._handleEvent(a,"up",n,v),this._groupSelector=null,this._currentTransform=null,u&&(u.__corner=0),g?this.requestRenderAll():v||this.renderTop()}},_simpleEventHandler:function(a,u){var o=this.findTarget(u),d=this.targets,g={e:u,target:o,subTargets:d};if(this.fire(a,g),o&&o.fire(a,g),!d)return o;for(var v=0;v<d.length;v++)d[v].fire(a,g);return o},_handleEvent:function(a,u,o,d){var g=this._target,v=this.targets||[],y={e:a,target:g,subTargets:v,button:o||n,isClick:d||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};u==="up"&&(y.currentTarget=this.findTarget(a),y.currentSubTargets=this.targets),this.fire("mouse:"+u,y),g&&g.fire("mouse"+u,y);for(var C=0;C<v.length;C++)v[C].fire("mouse"+u,y)},_finalizeCurrentTransform:function(a){var u=this._currentTransform,o=u.target,d={e:a,target:o,transform:u,action:u.action};o._scaling&&(o._scaling=!1),o.setCoords(),(u.actionPerformed||this.stateful&&o.hasStateChanged())&&this._fire("modified",d)},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();var u=this.getPointer(a);this.freeDrawingBrush.onMouseDown(u,{e:a,pointer:u}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var u=this.getPointer(a);this.freeDrawingBrush.onMouseMove(u,{e:a,pointer:u})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){var u=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:u}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var u=this._target;if(i(a,c)){this.fireRightClick&&this._handleEvent(a,"down",c);return}if(i(a,l)){this.fireMiddleClick&&this._handleEvent(a,"down",l);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(a);return}if(this._isMainEvent(a)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var d=this._shouldRender(u),g=this._shouldGroup(a,u);if(this._shouldClearSelection(a,u)?this.discardActiveObject(a):g&&(this._handleGrouping(a,u),u=this._activeObject),this.selection&&(!u||!u.selectable&&!u.isEditing&&u!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),u){var v=u===this._activeObject;u.selectable&&u.activeOn==="down"&&this.setActiveObject(u,a);var y=u._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a));if(u.__corner=y,u===this._activeObject&&(y||!g)){this._setupCurrentTransform(a,u,v);var C=u.controls[y],o=this.getPointer(a),w=C&&C.getMouseDownHandler(a,u,C);w&&w(a,this._currentTransform,o.x,o.y)}}this._handleEvent(a,"down"),(d||g)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var u=this._currentTransform;this.stateful&&u.target.saveState(),this.fire("before:transform",{e:a,transform:u})},__onMouseMove:function(a){this._handleEvent(a,"move:before"),this._cacheTransformEventData(a);var u,o;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(a);return}if(this._isMainEvent(a)){var d=this._groupSelector;d?(o=this._absolutePointer,d.left=o.x-d.ex,d.top=o.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(u=this.findTarget(a)||null,this._setCursorFromEvent(a,u),this._fireOverOutEvents(u,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,u){var o=this._hoveredTarget,d=this._hoveredTargets,g=this.targets,v=Math.max(d.length,g.length);this.fireSyntheticInOutEvents(a,u,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var y=0;y<v;y++)this.fireSyntheticInOutEvents(g[y],u,{oldTarget:d[y],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,u){var o=this._draggedoverTarget,d=this._hoveredTargets,g=this.targets,v=Math.max(d.length,g.length);this.fireSyntheticInOutEvents(a,u,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var y=0;y<v;y++)this.fireSyntheticInOutEvents(g[y],u,{oldTarget:d[y],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,u,o){var d,g,v=o.oldTarget,y,C,w=v!==a,S=o.canvasEvtIn,O=o.canvasEvtOut;w&&(d={e:u,target:a,previousTarget:v},g={e:u,target:v,nextTarget:a}),C=a&&w,y=v&&w,y&&(O&&this.fire(O,g),v.fire(o.evtOut,g)),C&&(S&&this.fire(S,d),a.fire(o.evtIn,d))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var u=this.getPointer(a),o=this._currentTransform;o.reset=!1,o.shiftKey=a.shiftKey,o.altKey=a[this.centeredKey],this._performTransformAction(a,o,u),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,u,o){var d=o.x,g=o.y,v=u.action,y=!1,C=u.actionHandler;C&&(y=C(a,u,d,g)),v==="drag"&&y&&(u.target.isMoving=!0,this.setCursor(u.target.moveCursor||this.moveCursor)),u.actionPerformed=u.actionPerformed||y},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(a,u){if(!u)return this.setCursor(this.defaultCursor),!1;var o=u.hoverCursor||this.hoverCursor,d=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,g=(!d||!d.contains(u))&&u._findTargetCorner(this.getPointer(a,!0));g?this.setCursor(this.getCornerCursor(g,u,a)):(u.subTargetCheck&&this.targets.concat().reverse().map(function(v){o=v.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(a,u,o){var d=u.controls[a];return d.cursorStyleHandler(o,d,u)}})}(),function(){var h=Math.min,e=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(c,l){var n=this._activeObject;return n&&this._isSelectionKeyPressed(c)&&l&&l.selectable&&this.selection&&(n!==l||n.type==="activeSelection")&&!l.onSelect({e:c})},_handleGrouping:function(c,l){var n=this._activeObject;n.__corner||l===n&&(l=this.findTarget(c,!0),!l||!l.selectable)||(n&&n.type==="activeSelection"?this._updateActiveSelection(l,c):this._createActiveSelection(l,c))},_updateActiveSelection:function(c,l){var n=this._activeObject,s=n._objects.slice(0);n.contains(c)?(n.removeWithUpdate(c),this._hoveredTarget=c,this._hoveredTargets=this.targets.concat(),n.size()===1&&this._setActiveObject(n.item(0),l)):(n.addWithUpdate(c),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(s,l)},_createActiveSelection:function(c,l){var n=this.getActiveObjects(),s=this._createGroup(c);this._hoveredTarget=s,this._setActiveObject(s,l),this._fireSelectionEvents(n,l)},_createGroup:function(c){var l=this._objects,n=l.indexOf(this._activeObject)<l.indexOf(c),s=n?[this._activeObject,c]:[c,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(s,{canvas:this})},_groupSelectedObjects:function(c){var l=this._collectObjects(c),n;l.length===1?this.setActiveObject(l[0],c):l.length>1&&(n=new t.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(n,c))},_collectObjects:function(c){for(var l=[],n,s=this._groupSelector.ex,i=this._groupSelector.ey,a=s+this._groupSelector.left,u=i+this._groupSelector.top,o=new t.Point(h(s,a),h(i,u)),d=new t.Point(e(s,a),e(i,u)),g=!this.selectionFullyContained,v=s===a&&i===u,y=this._objects.length;y--&&(n=this._objects[y],!(!(!n||!n.selectable||!n.visible)&&(g&&n.intersectsWithRect(o,d,!0)||n.isContainedWithinRect(o,d,!0)||g&&n.containsPoint(o,null,!0)||g&&n.containsPoint(d,null,!0))&&(l.push(n),v))););return l.length>1&&(l=l.filter(function(C){return!C.onSelect({e:c})})),l},_maybeGroupObjects:function(c){this.selection&&this._groupSelector&&this._groupSelectedObjects(c),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var e=h.format||"png",c=h.quality||1,l=(h.multiplier||1)*(h.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(l,h);return t.util.toDataURL(n,e,c)},toCanvasElement:function(h,e){h=h||1,e=e||{};var c=(e.width||this.width)*h,l=(e.height||this.height)*h,n=this.getZoom(),s=this.width,i=this.height,a=n*h,u=this.viewportTransform,o=(u[4]-(e.left||0))*h,d=(u[5]-(e.top||0))*h,g=this.interactive,v=[a,0,0,a,o,d],y=this.enableRetinaScaling,C=t.util.createCanvasElement(),w=this.contextTop;return C.width=c,C.height=l,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=c,this.height=l,this.calcViewportBoundaries(),this.renderCanvas(C.getContext("2d"),this._objects),this.viewportTransform=u,this.width=s,this.height=i,this.calcViewportBoundaries(),this.interactive=g,this.enableRetinaScaling=y,this.contextTop=w,C}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(h,e,c){if(h){var l=typeof h=="string"?JSON.parse(h):t.util.object.clone(h),n=this,s=l.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete l.clipPath,this._enlivenObjects(l.objects,function(a){n.clear(),n._setBgOverlay(l,function(){s?n._enlivenObjects([s],function(u){n.clipPath=u[0],n.__setupCanvas.call(n,l,a,i,e)}):n.__setupCanvas.call(n,l,a,i,e)})},c),this}},__setupCanvas:function(h,e,c,l){var n=this;e.forEach(function(s,i){n.insertAt(s,i)}),this.renderOnAddRemove=c,delete h.objects,delete h.backgroundImage,delete h.overlayImage,delete h.background,delete h.overlay,this._setOptions(h),this.renderAll(),l&&l()},_setBgOverlay:function(h,e){var c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!h.backgroundImage&&!h.overlayImage&&!h.background&&!h.overlay){e&&e();return}var l=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",h.backgroundImage,c,l),this.__setBgOverlay("overlayImage",h.overlayImage,c,l),this.__setBgOverlay("backgroundColor",h.background,c,l),this.__setBgOverlay("overlayColor",h.overlay,c,l)},__setBgOverlay:function(h,e,c,l){var n=this;if(!e){c[h]=!0,l&&l();return}h==="backgroundImage"||h==="overlayImage"?t.util.enlivenObjects([e],function(s){n[h]=s[0],c[h]=!0,l&&l()}):this["set"+t.util.string.capitalize(h,!0)](e,function(){c[h]=!0,l&&l()})},_enlivenObjects:function(h,e,c){if(!h||h.length===0){e&&e([]);return}t.util.enlivenObjects(h,function(l){e&&e(l)},null,c)},_toDataURL:function(h,e){this.clone(function(c){e(c.toDataURL(h))})},_toDataURLWithMultiplier:function(h,e,c){this.clone(function(l){c(l.toDataURLWithMultiplier(h,e))})},clone:function(h,e){var c=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(l){l.loadFromJSON(c,function(){h&&h(l)})})},cloneWithoutData:function(h){var e=t.util.createCanvasElement();e.width=this.width,e.height=this.height;var c=new t.Canvas(e);this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),h&&h(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):h&&h(c)}}),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend,l=e.util.object.clone,n=e.util.toFixed,s=e.util.string.capitalize,i=e.util.degreesToRadians,a=!e.isLikelyNode,u=2;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(o){o&&this.setOptions(o)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(o){var d=e.perfLimitSizeTotal,g=o.width,v=o.height,y=e.maxCacheSideLimit,C=e.minCacheSideLimit;if(g<=y&&v<=y&&g*v<=d)return g<C&&(o.width=C),v<C&&(o.height=C),o;var w=g/v,S=e.util.limitDimsByArea(w,d),O=e.util.capValue,M=O(C,S.x,y),I=O(C,S.y,y);return g>M&&(o.zoomX/=g/M,o.width=M,o.capped=!0),v>I&&(o.zoomY/=v/I,o.height=I,o.capped=!0),o},_getCacheCanvasDimensions:function(){var o=this.getTotalObjectScaling(),d=this._getTransformedDimensions(0,0),g=d.x*o.scaleX/this.scaleX,v=d.y*o.scaleY/this.scaleY;return{width:g+u,height:v+u,zoomX:o.scaleX,zoomY:o.scaleY,x:g,y:v}},_updateCacheCanvas:function(){var o=this.canvas;if(this.noScaleCache&&o&&o._currentTransform){var d=o._currentTransform.target,g=o._currentTransform.action;if(this===d&&g.slice&&g.slice(0,5)==="scale")return!1}var v=this._cacheCanvas,y=this._limitCacheSize(this._getCacheCanvasDimensions()),C=e.minCacheSideLimit,w=y.width,S=y.height,O,M,I=y.zoomX,N=y.zoomY,L=w!==this.cacheWidth||S!==this.cacheHeight,H=this.zoomX!==I||this.zoomY!==N,U=L||H,R=0,V=0,$=!1;if(L){var J=this._cacheCanvas.width,b=this._cacheCanvas.height,E=w>J||S>b,A=(w<J*.9||S<b*.9)&&J>C&&b>C;$=E||A,E&&!y.capped&&(w>C||S>C)&&(R=w*.1,V=S*.1)}return this instanceof e.Text&&this.path&&(U=!0,$=!0,R+=this.getHeightOfLine(0)*this.zoomX,V+=this.getHeightOfLine(0)*this.zoomY),U?($?(v.width=Math.ceil(w+R),v.height=Math.ceil(S+V)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,v.width,v.height)),O=y.x/2,M=y.y/2,this.cacheTranslationX=Math.round(v.width/2-O)+O,this.cacheTranslationY=Math.round(v.height/2-M)+M,this.cacheWidth=w,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(I,N),this.zoomX=I,this.zoomY=N,!0):!1},setOptions:function(o){this._setOptions(o),this._initGradient(o.fill,"fill"),this._initGradient(o.stroke,"stroke"),this._initPattern(o.fill,"fill"),this._initPattern(o.stroke,"stroke")},transform:function(o){var d=this.group&&!this.group._transformDone||this.group&&this.canvas&&o===this.canvas.contextTop,g=this.calcTransformMatrix(!d);o.transform(g[0],g[1],g[2],g[3],g[4],g[5])},toObject:function(o){var d=e.Object.NUM_FRACTION_DIGITS,g={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:n(this.left,d),top:n(this.top,d),width:n(this.width,d),height:n(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,d),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:n(this.strokeMiterLimit,d),scaleX:n(this.scaleX,d),scaleY:n(this.scaleY,d),angle:n(this.angle,d),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:n(this.skewX,d),skewY:n(this.skewY,d)};return this.clipPath&&!this.clipPath.excludeFromExport&&(g.clipPath=this.clipPath.toObject(o),g.clipPath.inverted=this.clipPath.inverted,g.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,g,o),this.includeDefaultValues||(g=this._removeDefaultValues(g)),g},toDatalessObject:function(o){return this.toObject(o)},_removeDefaultValues:function(o){var d=e.util.getKlass(o.type).prototype,g=d.stateProperties;return g.forEach(function(v){v==="left"||v==="top"||(o[v]===d[v]&&delete o[v],Array.isArray(o[v])&&Array.isArray(d[v])&&o[v].length===0&&d[v].length===0&&delete o[v])}),o},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var o=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(o.scaleX),scaleY:Math.abs(o.scaleY)}},getTotalObjectScaling:function(){var o=this.getObjectScaling(),d=o.scaleX,g=o.scaleY;if(this.canvas){var v=this.canvas.getZoom(),y=this.canvas.getRetinaScaling();d*=v*y,g*=v*y}return{scaleX:d,scaleY:g}},getObjectOpacity:function(){var o=this.opacity;return this.group&&(o*=this.group.getObjectOpacity()),o},_set:function(o,d){var g=o==="scaleX"||o==="scaleY",v=this[o]!==d,y=!1;return g&&(d=this._constrainScale(d)),o==="scaleX"&&d<0?(this.flipX=!this.flipX,d*=-1):o==="scaleY"&&d<0?(this.flipY=!this.flipY,d*=-1):o==="shadow"&&d&&!(d instanceof e.Shadow)?d=new e.Shadow(d):o==="dirty"&&this.group&&this.group.set("dirty",d),this[o]=d,v&&(y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(o)>-1?(this.dirty=!0,y&&this.group.set("dirty",!0)):y&&this.stateProperties.indexOf(o)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(o){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(o.save(),this._setupCompositeOperation(o),this.drawSelectionBackground(o),this.transform(o),this._setOpacity(o),this._setShadow(o,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(o)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(o),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),o.restore())},renderCache:function(o){o=o||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,o.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(o,d){if(o.save(),d.inverted?o.globalCompositeOperation="destination-out":o.globalCompositeOperation="destination-in",d.absolutePositioned){var g=e.util.invertTransform(this.calcTransformMatrix());o.transform(g[0],g[1],g[2],g[3],g[4],g[5])}d.transform(o),o.scale(1/d.zoomX,1/d.zoomY),o.drawImage(d._cacheCanvas,-d.cacheTranslationX,-d.cacheTranslationY),o.restore()},drawObject:function(o,d){var g=this.fill,v=this.stroke;d?(this.fill="black",this.stroke="",this._setClippingProperties(o)):this._renderBackground(o),this._render(o),this._drawClipPath(o,this.clipPath),this.fill=g,this.stroke=v},_drawClipPath:function(o,d){d&&(d.canvas=this.canvas,d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCache(o,d))},drawCacheOnCanvas:function(o){o.scale(1/this.zoomX,1/this.zoomY),o.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(o){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!o&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!o){var d=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-g/2,d,g)}return!0}return!1},_renderBackground:function(o){if(this.backgroundColor){var d=this._getNonTransformedDimensions();o.fillStyle=this.backgroundColor,o.fillRect(-d.x/2,-d.y/2,d.x,d.y),this._removeShadow(o)}},_setOpacity:function(o){this.group&&!this.group._transformDone?o.globalAlpha=this.getObjectOpacity():o.globalAlpha*=this.opacity},_setStrokeStyles:function(o,d){var g=d.stroke;g&&(o.lineWidth=d.strokeWidth,o.lineCap=d.strokeLineCap,o.lineDashOffset=d.strokeDashOffset,o.lineJoin=d.strokeLineJoin,o.miterLimit=d.strokeMiterLimit,g.toLive?g.gradientUnits==="percentage"||g.gradientTransform||g.patternTransform?this._applyPatternForTransformedGradient(o,g):(o.strokeStyle=g.toLive(o,this),this._applyPatternGradientTransform(o,g)):o.strokeStyle=d.stroke)},_setFillStyles:function(o,d){var g=d.fill;g&&(g.toLive?(o.fillStyle=g.toLive(o,this),this._applyPatternGradientTransform(o,d.fill)):o.fillStyle=g)},_setClippingProperties:function(o){o.globalAlpha=1,o.strokeStyle="transparent",o.fillStyle="#000000"},_setLineDash:function(o,d){!d||d.length===0||(1&d.length&&d.push.apply(d,d),o.setLineDash(d))},_renderControls:function(o,d){var g=this.getViewportTransform(),v=this.calcTransformMatrix(),y,C,w;d=d||{},C=typeof d.hasBorders<"u"?d.hasBorders:this.hasBorders,w=typeof d.hasControls<"u"?d.hasControls:this.hasControls,v=e.util.multiplyTransformMatrices(g,v),y=e.util.qrDecompose(v),o.save(),o.translate(y.translateX,y.translateY),o.lineWidth=1*this.borderScaleFactor,this.group||(o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(y.angle-=180),o.rotate(i(this.group?y.angle:this.angle)),d.forActiveSelection||this.group?C&&this.drawBordersInGroup(o,y,d):C&&this.drawBorders(o,d),w&&this.drawControls(o,d),o.restore()},_setShadow:function(o){if(this.shadow){var d=this.shadow,g=this.canvas,v,y=g&&g.viewportTransform[0]||1,C=g&&g.viewportTransform[3]||1;d.nonScaling?v={scaleX:1,scaleY:1}:v=this.getObjectScaling(),g&&g._isRetinaScaling()&&(y*=e.devicePixelRatio,C*=e.devicePixelRatio),o.shadowColor=d.color,o.shadowBlur=d.blur*e.browserShadowBlurConstant*(y+C)*(v.scaleX+v.scaleY)/4,o.shadowOffsetX=d.offsetX*y*v.scaleX,o.shadowOffsetY=d.offsetY*C*v.scaleY}},_removeShadow:function(o){this.shadow&&(o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0)},_applyPatternGradientTransform:function(o,d){if(!d||!d.toLive)return{offsetX:0,offsetY:0};var g=d.gradientTransform||d.patternTransform,v=-this.width/2+d.offsetX||0,y=-this.height/2+d.offsetY||0;return d.gradientUnits==="percentage"?o.transform(this.width,0,0,this.height,v,y):o.transform(1,0,0,1,v,y),g&&o.transform(g[0],g[1],g[2],g[3],g[4],g[5]),{offsetX:v,offsetY:y}},_renderPaintInOrder:function(o){this.paintFirst==="stroke"?(this._renderStroke(o),this._renderFill(o)):(this._renderFill(o),this._renderStroke(o))},_render:function(){},_renderFill:function(o){this.fill&&(o.save(),this._setFillStyles(o,this),this.fillRule==="evenodd"?o.fill("evenodd"):o.fill(),o.restore())},_renderStroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this.strokeUniform&&this.group){var d=this.getObjectScaling();o.scale(1/d.scaleX,1/d.scaleY)}else this.strokeUniform&&o.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(o,this.strokeDashArray),this._setStrokeStyles(o,this),o.stroke(),o.restore()}},_applyPatternForTransformedGradient:function(o,d){var g=this._limitCacheSize(this._getCacheCanvasDimensions()),v=e.util.createCanvasElement(),y,C=this.canvas.getRetinaScaling(),w=g.x/this.scaleX/C,S=g.y/this.scaleY/C;v.width=w,v.height=S,y=v.getContext("2d"),y.beginPath(),y.moveTo(0,0),y.lineTo(w,0),y.lineTo(w,S),y.lineTo(0,S),y.closePath(),y.translate(w/2,S/2),y.scale(g.zoomX/this.scaleX/C,g.zoomY/this.scaleY/C),this._applyPatternGradientTransform(y,d),y.fillStyle=d.toLive(o),y.fill(),o.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),o.scale(C*this.scaleX/g.zoomX,C*this.scaleY/g.zoomY),o.strokeStyle=y.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var o=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",o.scaleX),this.set("scaleY",o.scaleY),this.angle=o.angle,this.skewX=o.skewX,this.skewY=0}},_removeTransformMatrix:function(o){var d=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),d=e.util.transformPoint(d,this.transformMatrix)),this.transformMatrix=null,o&&(this.scaleX*=o.scaleX,this.scaleY*=o.scaleY,this.cropX=o.cropX,this.cropY=o.cropY,d.x+=o.offsetLeft,d.y+=o.offsetTop,this.width=o.width,this.height=o.height),this.setPositionByOrigin(d,"center","center")},clone:function(o,d){var g=this.toObject(d);this.constructor.fromObject?this.constructor.fromObject(g,o):e.Object._fromObject("Object",g,o)},cloneAsImage:function(o,d){var g=this.toCanvasElement(d);return o&&o(new e.Image(g)),this},toCanvasElement:function(o){o||(o={});var d=e.util,g=d.saveObjectTransform(this),v=this.group,y=this.shadow,C=Math.abs,w=(o.multiplier||1)*(o.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,o.withoutTransform&&d.resetObjectTransform(this),o.withoutShadow&&(this.shadow=null);var S=e.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),M=this.shadow,I,N={x:0,y:0},L,H,U;M&&(L=M.blur,M.nonScaling?I={scaleX:1,scaleY:1}:I=this.getObjectScaling(),N.x=2*Math.round(C(M.offsetX)+L)*C(I.scaleX),N.y=2*Math.round(C(M.offsetY)+L)*C(I.scaleY)),H=O.width+N.x,U=O.height+N.y,S.width=Math.ceil(H),S.height=Math.ceil(U);var R=new e.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});o.format==="jpeg"&&(R.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(R.width/2,R.height/2),"center","center");var V=this.canvas;R.add(this);var $=R.toCanvasElement(w||1,o);return this.shadow=y,this.set("canvas",V),v&&(this.group=v),this.set(g).setCoords(),R._objects=[],R.dispose(),R=null,$},toDataURL:function(o){return o||(o={}),e.util.toDataURL(this.toCanvasElement(o),o.format||"png",o.quality||1)},isType:function(o){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===o},complexity:function(){return 1},toJSON:function(o){return this.toObject(o)},rotate:function(o){var d=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return d&&this._setOriginToCenter(),this.set("angle",o),d&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(o,d){d=d||this.canvas.getPointer(o);var g=new e.Point(d.x,d.y),v=this._getLeftTopCoords();return this.angle&&(g=e.util.rotatePoint(g,v,i(-this.angle))),{x:g.x-v.x,y:g.y-v.y}},_setupCompositeOperation:function(o){this.globalCompositeOperation&&(o.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){e.runningAnimations&&e.runningAnimations.cancelByTarget(this)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),c(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.ENLIVEN_PROPS=["clipPath"],e.Object._fromObject=function(o,d,g,v){var y=e[o];d=l(d,!0),e.util.enlivenPatterns([d.fill,d.stroke],function(C){typeof C[0]<"u"&&(d.fill=C[0]),typeof C[1]<"u"&&(d.stroke=C[1]),e.util.enlivenObjectEnlivables(d,d,function(){var w=v?new y(d[v],d):new y(d);g&&g(w)})})},e.Object.__uid=0)}(p),function(){var h=t.util.degreesToRadians,e={left:-.5,center:0,right:.5},c={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(l,n,s,i,a){var u=l.x,o=l.y,d,g,v;return typeof n=="string"?n=e[n]:n-=.5,typeof i=="string"?i=e[i]:i-=.5,d=i-n,typeof s=="string"?s=c[s]:s-=.5,typeof a=="string"?a=c[a]:a-=.5,g=a-s,(d||g)&&(v=this._getTransformedDimensions(),u=l.x+d*v.x,o=l.y+g*v.y),new t.Point(u,o)},translateToCenterPoint:function(l,n,s){var i=this.translateToGivenOrigin(l,n,s,"center","center");return this.angle?t.util.rotatePoint(i,l,h(this.angle)):i},translateToOriginPoint:function(l,n,s){var i=this.translateToGivenOrigin(l,"center","center",n,s);return this.angle?t.util.rotatePoint(i,l,h(this.angle)):i},getCenterPoint:function(){var l=new t.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,n){var s=this.getCenterPoint();return this.translateToOriginPoint(s,l,n)},toLocalPoint:function(l,n,s){var i=this.getCenterPoint(),a,u;return typeof n<"u"&&typeof s<"u"?a=this.translateToGivenOrigin(i,"center","center",n,s):a=new t.Point(this.left,this.top),u=new t.Point(l.x,l.y),this.angle&&(u=t.util.rotatePoint(u,i,-h(this.angle))),u.subtractEquals(a)},setPositionByOrigin:function(l,n,s){var i=this.translateToCenterPoint(l,n,s),a=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(l){var n=h(this.angle),s=this.getScaledWidth(),i=t.util.cos(n)*s,a=t.util.sin(n)*s,u,o;typeof this.originX=="string"?u=e[this.originX]:u=this.originX-.5,typeof l=="string"?o=e[l]:o=l-.5,this.left+=i*(o-u),this.top+=a*(o-u),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function h(s){return[new t.Point(s.tl.x,s.tl.y),new t.Point(s.tr.x,s.tr.y),new t.Point(s.br.x,s.br.y),new t.Point(s.bl.x,s.bl.y)]}var e=t.util,c=e.degreesToRadians,l=e.multiplyTransformMatrices,n=e.transformPoint;e.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(s,i){return i?s?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),s?this.aCoords:this.lineCoords)},getCoords:function(s,i){return h(this._getCoords(s,i))},intersectsWithRect:function(s,i,a,u){var o=this.getCoords(a,u),d=t.Intersection.intersectPolygonRectangle(o,s,i);return d.status==="Intersection"},intersectsWithObject:function(s,i,a){var u=t.Intersection.intersectPolygonPolygon(this.getCoords(i,a),s.getCoords(i,a));return u.status==="Intersection"||s.isContainedWithinObject(this,i,a)||this.isContainedWithinObject(s,i,a)},isContainedWithinObject:function(s,i,a){for(var u=this.getCoords(i,a),o=i?s.aCoords:s.lineCoords,d=0,g=s._getImageLines(o);d<4;d++)if(!s.containsPoint(u[d],g))return!1;return!0},isContainedWithinRect:function(s,i,a,u){var o=this.getBoundingRect(a,u);return o.left>=s.x&&o.left+o.width<=i.x&&o.top>=s.y&&o.top+o.height<=i.y},containsPoint:function(s,d,a,u){var o=this._getCoords(a,u),d=d||this._getImageLines(o),g=this._findCrossPoints(s,d);return g!==0&&g%2===1},isOnScreen:function(s){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br,u=this.getCoords(!0,s);return u.some(function(o){return o.x<=a.x&&o.x>=i.x&&o.y<=a.y&&o.y>=i.y})||this.intersectsWithRect(i,a,!0,s)?!0:this._containsCenterOfCanvas(i,a,s)},_containsCenterOfCanvas:function(s,i,a){var u={x:(s.x+i.x)/2,y:(s.y+i.y)/2};return!!this.containsPoint(u,null,!0,a)},isPartiallyOnScreen:function(s){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br;if(this.intersectsWithRect(i,a,!0,s))return!0;var u=this.getCoords(!0,s).every(function(o){return(o.x>=a.x||o.x<=i.x)&&(o.y>=a.y||o.y<=i.y)});return u&&this._containsCenterOfCanvas(i,a,s)},_getImageLines:function(s){var i={topline:{o:s.tl,d:s.tr},rightline:{o:s.tr,d:s.br},bottomline:{o:s.br,d:s.bl},leftline:{o:s.bl,d:s.tl}};return i},_findCrossPoints:function(s,i){var a,u,o,d,g,v=0,y;for(var C in i)if(y=i[C],!(y.o.y<s.y&&y.d.y<s.y)&&!(y.o.y>=s.y&&y.d.y>=s.y)&&(y.o.x===y.d.x&&y.o.x>=s.x?g=y.o.x:(a=0,u=(y.d.y-y.o.y)/(y.d.x-y.o.x),o=s.y-a*s.x,d=y.o.y-u*y.o.x,g=-(o-d)/(a-u)),g>=s.x&&(v+=1),v===2))break;return v},getBoundingRect:function(s,i){var a=this.getCoords(s,i);return e.makeBoundingBoxFromPoints(a)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(s){return Math.abs(s)<this.minScaleLimit?s<0?-this.minScaleLimit:this.minScaleLimit:s===0?1e-4:s},scale:function(s){return this._set("scaleX",s),this._set("scaleY",s),this.setCoords()},scaleToWidth:function(s,i){var a=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(s/this.width/a)},scaleToHeight:function(s,i){var a=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(s/this.height/a)},calcLineCoords:function(){var s=this.getViewportTransform(),i=this.padding,a=c(this.angle),u=e.cos(a),o=e.sin(a),d=u*i,g=o*i,v=d+g,y=d-g,C=this.calcACoords(),w={tl:n(C.tl,s),tr:n(C.tr,s),bl:n(C.bl,s),br:n(C.br,s)};return i&&(w.tl.x-=y,w.tl.y-=v,w.tr.x+=v,w.tr.y-=y,w.bl.x-=v,w.bl.y+=y,w.br.x+=y,w.br.y+=v),w},calcOCoords:function(){var s=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),a=this.getViewportTransform(),u=l(a,i),o=l(u,s),o=l(o,[1/a[0],0,0,1/a[3],0,0]),d=this._calculateCurrentDimensions(),g={};return this.forEachControl(function(v,y,C){g[y]=v.positionHandler(d,o,C)}),g},calcACoords:function(){var s=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),a=l(i,s),u=this._getTransformedDimensions(),o=u.x/2,d=u.y/2;return{tl:n({x:-o,y:-d},a),tr:n({x:o,y:-d},a),bl:n({x:-o,y:d},a),br:n({x:o,y:d},a)}},setCoords:function(s){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),s?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return e.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var s=this.getCenterPoint();return[1,0,0,1,s.x,s.y]},transformMatrixKey:function(s){var i="_",a="";return!s&&this.group&&(a=this.group.transformMatrixKey(s)+i),a+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(s){var i=this.calcOwnMatrix();if(s||!this.group)return i;var a=this.transformMatrixKey(s),u=this.matrixCache||(this.matrixCache={});return u.key===a?u.value:(this.group&&(i=l(this.group.calcTransformMatrix(!1),i)),u.key=a,u.value=i,i)},calcOwnMatrix:function(){var s=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===s)return i.value;var a=this._calcTranslateMatrix(),u={angle:this.angle,translateX:a[4],translateY:a[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=s,i.value=e.composeMatrix(u),i.value},_getNonTransformedDimensions:function(){var s=this.strokeWidth,i=this.width+s,a=this.height+s;return{x:i,y:a}},_getTransformedDimensions:function(s,i){typeof s>"u"&&(s=this.skewX),typeof i>"u"&&(i=this.skewY);var a,u,o,d=s===0&&i===0;if(this.strokeUniform?(u=this.width,o=this.height):(a=this._getNonTransformedDimensions(),u=a.x,o=a.y),d)return this._finalizeDimensions(u*this.scaleX,o*this.scaleY);var g=e.sizeAfterTransform(u,o,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:s,skewY:i});return this._finalizeDimensions(g.x,g.y)},_finalizeDimensions:function(s,i){return this.strokeUniform?{x:s+this.strokeWidth,y:i+this.strokeWidth}:{x:s,y:i}},_calculateCurrentDimensions:function(){var s=this.getViewportTransform(),i=this._getTransformedDimensions(),a=n(i,s,!0);return a.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(h){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas&&this.canvas.sendBackwards(this,h),this},bringForward:function(h){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas&&this.canvas.bringForward(this,h),this},moveTo:function(h){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas&&this.canvas.moveTo(this,h),this}}),function(){function h(c,l){if(l){if(l.toLive)return c+": url(#SVGID_"+l.id+"); ";var n=new t.Color(l),s=c+": "+n.toRgb()+"; ",i=n.getAlpha();return i!==1&&(s+=c+"-opacity: "+i.toString()+"; "),s}else return c+": none; "}var e=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(c){var l=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",u=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",d=typeof this.opacity<"u"?this.opacity:"1",g=this.visible?"":" visibility: hidden;",v=c?"":this.getSvgFilter(),y=h("fill",this.fill),C=h("stroke",this.stroke);return[C,"stroke-width: ",n,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",u,"; ","stroke-miterlimit: ",o,"; ",y,"fill-rule: ",l,"; ","opacity: ",d,";",v,g].join("")},getSvgSpanStyles:function(c,l){var n="; ",i=c.fontFamily?"font-family: "+(c.fontFamily.indexOf("'")===-1&&c.fontFamily.indexOf('"')===-1?"'"+c.fontFamily+"'":c.fontFamily)+n:"",s=c.strokeWidth?"stroke-width: "+c.strokeWidth+n:"",i=i,a=c.fontSize?"font-size: "+c.fontSize+"px"+n:"",u=c.fontStyle?"font-style: "+c.fontStyle+n:"",o=c.fontWeight?"font-weight: "+c.fontWeight+n:"",d=c.fill?h("fill",c.fill):"",g=c.stroke?h("stroke",c.stroke):"",v=this.getSvgTextDecoration(c),y=c.deltaY?"baseline-shift: "+-c.deltaY+"; ":"";return v&&(v="text-decoration: "+v+n),[g,s,i,a,u,o,v,d,y,l?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(c){return["overline","underline","line-through"].filter(function(l){return c[l.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(c,l){var n=c?this.calcTransformMatrix():this.calcOwnMatrix(),s='transform="'+t.util.matrixToSVG(n);return s+(l||"")+'" '},_setSVGBg:function(c){if(this.backgroundColor){var l=t.Object.NUM_FRACTION_DIGITS;c.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,l),'" y="',e(-this.height/2,l),'" width="',e(this.width,l),'" height="',e(this.height,l),`"></rect>
`)}},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(c),{reviver:c})},toClipPathSVG:function(c){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(c),{reviver:c})},_createBaseClipPathSVGMarkup:function(c,l){l=l||{};var n=l.reviver,s=l.additionalTransform||"",i=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),a=c.indexOf("COMMON_PARTS");return c[a]=i,n?n(c.join("")):c.join("")},_createBaseSVGMarkup:function(c,l){l=l||{};var n=l.noStyle,s=l.reviver,i=n?"":'style="'+this.getSvgStyles()+'" ',a=l.withShadow?'style="'+this.getSvgFilter()+'" ':"",u=this.clipPath,o=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",d=u&&u.absolutePositioned,g=this.stroke,v=this.fill,y=this.shadow,C,w=[],S,O=c.indexOf("COMMON_PARTS"),M=l.additionalTransform;return u&&(u.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+u.clipPathId+`" >
`+u.toClipPathSVG(s)+`</clipPath>
`),d&&w.push("<g ",a,this.getSvgCommons(),` >
`),w.push("<g ",this.getSvgTransform(!1),d?"":a+this.getSvgCommons(),` >
`),C=[i,o,n?"":this.addPaintOrder()," ",M?'transform="'+M+'" ':""].join(""),c[O]=C,v&&v.toLive&&w.push(v.toSVG(this)),g&&g.toLive&&w.push(g.toSVG(this)),y&&w.push(y.toSVG(this)),u&&w.push(S),w.push(c.join("")),w.push(`</g>
`),d&&w.push(`</g>
`),s?s(w.join("")):w.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var h=t.util.object.extend,e="stateProperties";function c(n,s,i){var a={},u=!0;i.forEach(function(o){a[o]=n[o]}),h(n[s],a,u)}function l(n,s,i){if(n===s)return!0;if(Array.isArray(n)){if(!Array.isArray(s)||n.length!==s.length)return!1;for(var a=0,u=n.length;a<u;a++)if(!l(n[a],s[a]))return!1;return!0}else if(n&&typeof n=="object"){var o=Object.keys(n),d;if(!s||typeof s!="object"||!i&&o.length!==Object.keys(s).length)return!1;for(var a=0,u=o.length;a<u;a++)if(d=o[a],!(d==="canvas"||d==="group")&&!l(n[d],s[d]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(n){n=n||e;var s="_"+n;return Object.keys(this[s]).length<this[n].length?!0:!l(this[s],this,!0)},saveState:function(n){var s=n&&n.propertySet||e,i="_"+s;return this[i]?(c(this,i,this[s]),n&&n.stateProperties&&c(this,i,n.stateProperties),this):this.setupState(n)},setupState:function(n){n=n||{};var s=n.propertySet||e;return n.propertySet=s,this["_"+s]={},this.saveState(n),this}})}(),function(){var h=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(e,c){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var l=e.x,n=e.y,s,i,a=Object.keys(this.oCoords),u=a.length-1,o;for(this.__corner=0;u>=0;u--)if(o=a[u],!!this.isControlVisible(o)&&(i=this._getImageLines(c?this.oCoords[o].touchCorner:this.oCoords[o].corner),s=this._findCrossPoints({x:l,y:n},i),s!==0&&s%2===1))return this.__corner=o,o;return!1},forEachControl:function(e){for(var c in this.controls)e(this.controls[c],c,this)},_setCornerCoords:function(){var e=this.oCoords;for(var c in e){var l=this.controls[c];e[c].corner=l.calcCornerCoords(this.angle,this.cornerSize,e[c].x,e[c].y,!1),e[c].touchCorner=l.calcCornerCoords(this.angle,this.touchCornerSize,e[c].x,e[c].y,!0)}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var c=this.getCenterPoint(),l=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return e.translate(c.x,c.y),e.scale(1/n[0],1/n[3]),e.rotate(h(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-l.x/2,-l.y/2,l.x,l.y),e.restore(),this},drawBorders:function(e,c){c=c||{};var l=this._calculateCurrentDimensions(),n=this.borderScaleFactor,s=l.x+n,i=l.y+n,a=typeof c.hasControls<"u"?c.hasControls:this.hasControls,u=!1;return e.save(),e.strokeStyle=c.borderColor||this.borderColor,this._setLineDash(e,c.borderDashArray||this.borderDashArray),e.strokeRect(-s/2,-i/2,s,i),a&&(e.beginPath(),this.forEachControl(function(o,d,g){o.withConnection&&o.getVisibility(g,d)&&(u=!0,e.moveTo(o.x*s,o.y*i),e.lineTo(o.x*s+o.offsetX,o.y*i+o.offsetY))}),u&&e.stroke()),e.restore(),this},drawBordersInGroup:function(e,c,l){l=l||{};var n=t.util.sizeAfterTransform(this.width,this.height,c),s=this.strokeWidth,i=this.strokeUniform,a=this.borderScaleFactor,u=n.x+s*(i?this.canvas.getZoom():c.scaleX)+a,o=n.y+s*(i?this.canvas.getZoom():c.scaleY)+a;return e.save(),this._setLineDash(e,l.borderDashArray||this.borderDashArray),e.strokeStyle=l.borderColor||this.borderColor,e.strokeRect(-u/2,-o/2,u,o),e.restore(),this},drawControls:function(e,c){c=c||{},e.save();var l=this.canvas.getRetinaScaling(),n,s;return e.setTransform(l,0,0,l,0,0),e.strokeStyle=e.fillStyle=c.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=c.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,c.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(n=this.group.calcTransformMatrix()),this.forEachControl(function(i,a,u){s=u.oCoords[a],i.getVisibility(u,a)&&(n&&(s=t.util.transformPoint(s,n)),i.render(e,s.x,s.y,c,u))}),e.restore(),this},isControlVisible:function(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)},setControlVisible:function(e,c){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=c,this},setControlsVisibility:function(e){e||(e={});for(var c in e)this.setControlVisible(c,e[c]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(h,e){e=e||{};var c=function(){},l=e.onComplete||c,n=e.onChange||c,s=this;return t.util.animate({target:this,startValue:h.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){h.set("left",i),s.requestRenderAll(),n()},onComplete:function(){h.setCoords(),l()}})},fxCenterObjectV:function(h,e){e=e||{};var c=function(){},l=e.onComplete||c,n=e.onChange||c,s=this;return t.util.animate({target:this,startValue:h.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){h.set("top",i),s.requestRenderAll(),n()},onComplete:function(){h.setCoords(),l()}})},fxRemove:function(h,e){e=e||{};var c=function(){},l=e.onComplete||c,n=e.onChange||c,s=this;return t.util.animate({target:this,startValue:h.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){h.set("opacity",i),s.requestRenderAll(),n()},onComplete:function(){s.remove(h),l()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var h=[],e,c,l=[];for(e in arguments[0])h.push(e);for(var n=0,s=h.length;n<s;n++)e=h[n],c=n!==s-1,l.push(this._animate(e,arguments[0][e],arguments[1],c));return l}else return this._animate.apply(this,arguments)},_animate:function(h,e,c,l){var n=this,s;e=e.toString(),c?c=t.util.object.clone(c):c={},~h.indexOf(".")&&(s=h.split("."));var i=n.colorProperties.indexOf(h)>-1||s&&n.colorProperties.indexOf(s[1])>-1,a=s?this.get(s[0])[s[1]]:this.get(h);"from"in c||(c.from=a),i||(~e.indexOf("=")?e=a+parseFloat(e.replace("=","")):e=parseFloat(e));var u={target:this,startValue:c.from,endValue:e,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(o,d,g){return c.abort.call(n,o,d,g)},onChange:function(o,d,g){s?n[s[0]][s[1]]=o:n.set(h,o),!l&&c.onChange&&c.onChange(o,d,g)},onComplete:function(o,d,g){l||(n.setCoords(),c.onComplete&&c.onComplete(o,d,g))}};return i?t.util.animateColor(u.startValue,u.endValue,u.duration,u):t.util.animate(u)}}),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend,l=e.util.object.clone,n={x1:1,x2:1,y1:1,y2:1};if(e.Line){e.warn("fabric.Line is already defined");return}e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,a){i||(i=[0,0,0,0]),this.callSuper("initialize",a),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(a)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,a){return this.callSuper("_set",i,a),typeof n[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var a=this.calcLinePoints();i.moveTo(a.x1,a.y1),i.lineTo(a.x2,a.y2),i.lineWidth=this.strokeWidth;var u=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=u},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return c(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(i.y-=this.strokeWidth),this.height===0&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,a=this.y1<=this.y2?-1:1,u=i*this.width*.5,o=a*this.height*.5,d=i*this.width*-.5,g=a*this.height*-.5;return{x1:u,x2:d,y1:o,y2:g}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,`" />
`]}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(i,a,u){u=u||{};var o=e.parseAttributes(i,e.Line.ATTRIBUTE_NAMES),d=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];a(new e.Line(d,c(o,u)))},e.Line.fromObject=function(i,a){function u(d){delete d.points,a&&a(d)}var o=l(i,!0);o.points=[i.x1,i.y1,i.x2,i.y2],e.Object._fromObject("Line",o,u,"points")};function s(i,a){var u=i.origin,o=i.axis1,d=i.axis2,g=i.dimension,v=a.nearest,y=a.center,C=a.farthest;return function(){switch(this.get(u)){case v:return Math.min(this.get(o),this.get(d));case y:return Math.min(this.get(o),this.get(d))+.5*this.get(g);case C:return Math.max(this.get(o),this.get(d))}}}}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.degreesToRadians;if(e.Circle){e.warn("fabric.Circle is already defined.");return}e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(n,s){return this.callSuper("_set",n,s),n==="radius"&&this.setRadius(s),this},toObject:function(n){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(n))},_toSVG:function(){var n,s=0,i=0,a=(this.endAngle-this.startAngle)%360;if(a===0)n=["<circle ","COMMON_PARTS",'cx="'+s+'" cy="'+i+'" ','r="',this.radius,`" />
`];else{var u=c(this.startAngle),o=c(this.endAngle),d=this.radius,g=e.util.cos(u)*d,v=e.util.sin(u)*d,y=e.util.cos(o)*d,C=e.util.sin(o)*d,w=a>180?"1":"0";n=['<path d="M '+g+" "+v," A "+d+" "+d," 0 ",+w+" 1"," "+y+" "+C,'" ',"COMMON_PARTS",` />
`]}return n},_render:function(n){n.beginPath(),n.arc(0,0,this.radius,c(this.startAngle),c(this.endAngle),!1),this._renderPaintInOrder(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){return this.radius=n,this.set("width",n*2).set("height",n*2)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(n,s){var i=e.parseAttributes(n,e.Circle.ATTRIBUTE_NAMES);if(!l(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,s(new e.Circle(i))};function l(n){return"radius"in n&&n.radius>=0}e.Circle.fromObject=function(n,s){e.Object._fromObject("Circle",n,s)}}(p),function(h){var e=h.fabric||(h.fabric={});if(e.Triangle){e.warn("fabric.Triangle is already defined");return}e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(c){var l=this.width/2,n=this.height/2;c.beginPath(),c.moveTo(-l,n),c.lineTo(0,-n),c.lineTo(l,n),c.closePath(),this._renderPaintInOrder(c)},_toSVG:function(){var c=this.width/2,l=this.height/2,n=[-c+" "+l,"0 "+-l,c+" "+l].join(",");return["<polygon ","COMMON_PARTS",'points="',n,'" />']}}),e.Triangle.fromObject=function(c,l){return e.Object._fromObject("Triangle",c,l)}}(p),function(h){var e=h.fabric||(h.fabric={}),c=Math.PI*2;if(e.Ellipse){e.warn("fabric.Ellipse is already defined.");return}e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this.set("rx",l&&l.rx||0),this.set("ry",l&&l.ry||0)},_set:function(l,n){switch(this.callSuper("_set",l,n),l){case"rx":this.rx=n,this.set("width",n*2);break;case"ry":this.ry=n,this.set("height",n*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(l){l.beginPath(),l.save(),l.transform(1,0,0,this.ry/this.rx,0,0),l.arc(0,0,this.rx,0,c,!1),l.restore(),this._renderPaintInOrder(l)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(l,n){var s=e.parseAttributes(l,e.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,n(new e.Ellipse(s))},e.Ellipse.fromObject=function(l,n){e.Object._fromObject("Ellipse",l,n)}}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend;if(e.Rect){e.warn("fabric.Rect is already defined");return}e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(l){var n=this.rx?Math.min(this.rx,this.width/2):0,s=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,a=this.height,u=-this.width/2,o=-this.height/2,d=n!==0||s!==0,g=1-.5522847498;l.beginPath(),l.moveTo(u+n,o),l.lineTo(u+i-n,o),d&&l.bezierCurveTo(u+i-g*n,o,u+i,o+g*s,u+i,o+s),l.lineTo(u+i,o+a-s),d&&l.bezierCurveTo(u+i,o+a-g*s,u+i-g*n,o+a,u+i-n,o+a),l.lineTo(u+n,o+a),d&&l.bezierCurveTo(u+g*n,o+a,u,o+a-g*s,u,o+a-s),l.lineTo(u,o+s),d&&l.bezierCurveTo(u,o+g*s,u+g*n,o,u+n,o),l.closePath(),this._renderPaintInOrder(l)},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){var l=-this.width/2,n=-this.height/2;return["<rect ","COMMON_PARTS",'x="',l,'" y="',n,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(l,n,s){if(!l)return n(null);s=s||{};var i=e.parseAttributes(l,e.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var a=new e.Rect(c(s?e.util.object.clone(s):{},i));a.visible=a.visible&&a.width>0&&a.height>0,n(a)},e.Rect.fromObject=function(l,n){return e.Object._fromObject("Rect",l,n)}}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend,l=e.util.array.min,n=e.util.array.max,s=e.util.toFixed,i=e.util.projectStrokeOnPoints;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(a,u){u=u||{},this.points=a||[],this.callSuper("initialize",u),this._setPositionDimensions(u)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(a){var u=this._calcDimensions(a),o,d=this.exactBoundingBox?this.strokeWidth:0;this.width=u.width-d,this.height=u.height-d,a.fromSVG||(o=this.translateToGivenOrigin({x:u.left-this.strokeWidth/2+d/2,y:u.top-this.strokeWidth/2+d/2},"left","top",this.originX,this.originY)),typeof a.left>"u"&&(this.left=a.fromSVG?u.left:o.x),typeof a.top>"u"&&(this.top=a.fromSVG?u.top:o.y),this.pathOffset={x:u.left+this.width/2+d/2,y:u.top+this.height/2+d/2}},_calcDimensions:function(){var a=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,u=l(a,"x")||0,o=l(a,"y")||0,d=n(a,"x")||0,g=n(a,"y")||0,v=d-u,y=g-o;return{left:u,top:o,width:v,height:y}},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},_toSVG:function(){for(var a=[],u=this.pathOffset.x,o=this.pathOffset.y,d=e.Object.NUM_FRACTION_DIGITS,g=0,v=this.points.length;g<v;g++)a.push(s(this.points[g].x-u,d),",",s(this.points[g].y-o,d)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',a.join(""),`" />
`]},commonRender:function(a){var u,o=this.points.length,d=this.pathOffset.x,g=this.pathOffset.y;if(!o||isNaN(this.points[o-1].y))return!1;a.beginPath(),a.moveTo(this.points[0].x-d,this.points[0].y-g);for(var v=0;v<o;v++)u=this.points[v],a.lineTo(u.x-d,u.y-g);return!0},_render:function(a){this.commonRender(a)&&this._renderPaintInOrder(a)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(a){return function(u,o,d){if(!u)return o(null);d||(d={});var g=e.parsePointsAttribute(u.getAttribute("points")),v=e.parseAttributes(u,e[a].ATTRIBUTE_NAMES);v.fromSVG=!0,o(new e[a](g,c(v,d)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(a,u){return e.Object._fromObject("Polyline",a,u,"points")}}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.projectStrokeOnPoints;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return c(this.points,this)},_render:function(l){this.commonRender(l)&&(l.closePath(),this._renderPaintInOrder(l))}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(l,n){e.Object._fromObject("Polygon",l,n,"points")}}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.array.min,l=e.util.array.max,n=e.util.object.extend,s=e.util.object.clone,i=e.util.toFixed;if(e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(a,u){u=s(u||{}),delete u.path,this.callSuper("initialize",u),this._setPath(a||[],u)},_setPath:function(a,u){this.path=e.util.makePathSimpler(Array.isArray(a)?a:e.util.parsePath(a)),e.Polyline.prototype._setPositionDimensions.call(this,u||{})},_renderPathCommands:function(a){var u,o=0,d=0,g=0,v=0,y=0,C=0,w=-this.pathOffset.x,S=-this.pathOffset.y;a.beginPath();for(var O=0,M=this.path.length;O<M;++O)switch(u=this.path[O],u[0]){case"L":g=u[1],v=u[2],a.lineTo(g+w,v+S);break;case"M":g=u[1],v=u[2],o=g,d=v,a.moveTo(g+w,v+S);break;case"C":g=u[5],v=u[6],y=u[3],C=u[4],a.bezierCurveTo(u[1]+w,u[2]+S,y+w,C+S,g+w,v+S);break;case"Q":a.quadraticCurveTo(u[1]+w,u[2]+S,u[3]+w,u[4]+S),g=u[3],v=u[4],y=u[1],C=u[2];break;case"z":case"Z":g=o,v=d,a.closePath();break}},_render:function(a){this._renderPathCommands(a),this._renderPaintInOrder(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){return n(this.callSuper("toObject",a),{path:this.path.map(function(u){return u.slice()})})},toDatalessObject:function(a){var u=this.toObject(["sourcePath"].concat(a));return u.sourcePath&&delete u.path,u},_toSVG:function(){var a=e.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',a,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var a=e.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,a)+", "+i(-this.pathOffset.y,a)+")"},toClipPathSVG:function(a){var u=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:u})},toSVG:function(a){var u=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:u})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var a=[],u=[],o,d=0,g=0,v=0,y=0,C,w=0,S=this.path.length;w<S;++w){switch(o=this.path[w],o[0]){case"L":v=o[1],y=o[2],C=[];break;case"M":v=o[1],y=o[2],d=v,g=y,C=[];break;case"C":C=e.util.getBoundsOfCurve(v,y,o[1],o[2],o[3],o[4],o[5],o[6]),v=o[5],y=o[6];break;case"Q":C=e.util.getBoundsOfCurve(v,y,o[1],o[2],o[1],o[2],o[3],o[4]),v=o[3],y=o[4];break;case"z":case"Z":v=d,y=g;break}C.forEach(function(U){a.push(U.x),u.push(U.y)}),a.push(v),u.push(y)}var O=c(a)||0,M=c(u)||0,I=l(a)||0,N=l(u)||0,L=I-O,H=N-M;return{left:O,top:M,width:L,height:H}}}),e.Path.fromObject=function(a,u){if(typeof a.sourcePath=="string"){var o=a.sourcePath;e.loadSVGFromURL(o,function(d){var g=d[0];g.setOptions(a),a.clipPath?e.util.enlivenObjects([a.clipPath],function(v){g.clipPath=v[0],u&&u(g)}):u&&u(g)})}else e.Object._fromObject("Path",a,u,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(a,u,o){var d=e.parseAttributes(a,e.Path.ATTRIBUTE_NAMES);d.fromSVG=!0,u(new e.Path(d.d,n(d,o)))}}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.array.min,l=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,s,i){s=s||{},this._objects=[],i&&this.callSuper("initialize",s),this._objects=n||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;if(i)this._updateObjectsACoords();else{var u=s&&s.centerPoint;s.originX!==void 0&&(this.originX=s.originX),s.originY!==void 0&&(this.originY=s.originY),u||this._calcBounds(),this._updateObjectsCoords(u),delete s.centerPoint,this.callSuper("initialize",s)}this.setCoords()},_updateObjectsACoords:function(){for(var n=!0,s=this._objects.length;s--;)this._objects[s].setCoords(n)},_updateObjectsCoords:function(s){for(var s=s||this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],s)},_updateObjectCoords:function(n,s){var i=n.left,a=n.top,u=!0;n.set({left:i-s.x,top:a-s.y}),n.group=this,n.setCoords(u)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){var s=!!this.group;return this._restoreObjectsState(),e.util.resetObjectTransform(this),n&&(s&&e.util.removeTransformFromObject(n,this.group.calcTransformMatrix()),this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,s?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(n){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0,n.group=this,n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0,delete n.group},_set:function(n,s){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(n,s);if(n==="canvas")for(;i--;)this._objects[i]._set(n,s);e.Object.prototype._set.call(this,n,s)},toObject:function(n){var s=this.includeDefaultValues,i=this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){var o=u.includeDefaultValues;u.includeDefaultValues=s;var d=u.toObject(n);return u.includeDefaultValues=o,d}),a=e.Object.prototype.toObject.call(this,n);return a.objects=i,a},toDatalessObject:function(n){var s,i=this.sourcePath;if(i)s=i;else{var a=this.includeDefaultValues;s=this._objects.map(function(o){var d=o.includeDefaultValues;o.includeDefaultValues=a;var g=o.toDatalessObject(n);return o.includeDefaultValues=d,g})}var u=e.Object.prototype.toDatalessObject.call(this,n);return u.objects=s,u},render:function(n){this._transformDone=!0,this.callSuper("render",n),this._transformDone=!1},shouldCache:function(){var n=e.Object.prototype.shouldCache.call(this);if(n){for(var s=0,i=this._objects.length;s<i;s++)if(this._objects[s].willDrawShadow())return this.ownCaching=!1,!1}return n},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var n=0,s=this._objects.length;n<s;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var s=0,i=this._objects.length;s<i;s++)this._objects[s].render(n);this._drawClipPath(n,this.clipPath)},isCacheDirty:function(n){if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(var s=0,i=this._objects.length;s<i;s++)if(this._objects[s].isCacheDirty(!0)){if(this._cacheCanvas){var a=this.cacheWidth/this.zoomX,u=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/2,-u/2,a,u)}return!0}return!1},_restoreObjectsState:function(){var n=this.calcOwnMatrix();return this._objects.forEach(function(s){e.util.addTransformToObject(s,n),delete s.group,s.setCoords()}),this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(n){n.dispose&&n.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var n=this._objects,s=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var a=new e.ActiveSelection([]);return a.set(i),a.type="activeSelection",s.remove(this),n.forEach(function(u){u.group=a,u.dirty=!0,s.add(u)}),a.canvas=s,a._objects=n,s._activeObject=a,a.setCoords(),a}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var n=!0;return this.forEachObject(function(s){s.setCoords(n)}),this},_calcBounds:function(n){for(var s=[],i=[],a,u,o,d=["tr","br","bl","tl"],g=0,v=this._objects.length,y,C=d.length;g<v;++g){for(a=this._objects[g],o=a.calcACoords(),y=0;y<C;y++)u=d[y],s.push(o[u].x),i.push(o[u].y);a.aCoords=o}this._getBounds(s,i,n)},_getBounds:function(n,s,i){var a=new e.Point(c(n),c(s)),u=new e.Point(l(n),l(s)),o=a.y||0,d=a.x||0,g=u.x-a.x||0,v=u.y-a.y||0;this.width=g,this.height=v,i||this.setPositionByOrigin({x:d,y:o},"left","top")},_toSVG:function(n){for(var s=["<g ","COMMON_PARTS",` >
`],i=0,a=this._objects.length;i<a;i++)s.push("		",this._objects[i].toSVG(n));return s.push(`</g>
`),s},getSvgStyles:function(){var n=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",s=this.visible?"":" visibility: hidden;";return[n,this.getSvgFilter(),s].join("")},toClipPathSVG:function(n){for(var s=[],i=0,a=this._objects.length;i<a;i++)s.push("	",this._objects[i].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(s,{reviver:n})}}),e.Group.fromObject=function(n,s){var i=n.objects,a=e.util.object.clone(n,!0);if(delete a.objects,typeof i=="string"){e.loadSVGFromURL(i,function(u){var o=e.util.groupSVGElements(u,n,i),d=a.clipPath;delete a.clipPath,o.set(a),d?e.util.enlivenObjects([d],function(g){o.clipPath=g[0],s&&s(o)}):s&&s(o)});return}e.util.enlivenObjects(i,function(u){e.util.enlivenObjectEnlivables(n,a,function(){s&&s(new e.Group(u,a,!0))})})})}(p),function(h){var e=h.fabric||(h.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(c,l){l=l||{},this._objects=c||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;l.originX&&(this.originX=l.originX),l.originY&&(this.originY=l.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,l),this.setCoords()},toGroup:function(){var c=this._objects.concat();this._objects=[];var l=e.Object.prototype.toObject.call(this),n=new e.Group([]);if(delete l.type,n.set(l),c.forEach(function(i){i.canvas.remove(i),i.group=n}),n._objects=c,!this.canvas)return n;var s=this.canvas;return s.add(n),s._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(c,l,n){c.save(),c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",c,l),n=n||{},typeof n.hasControls>"u"&&(n.hasControls=!1),n.forActiveSelection=!0;for(var s=0,i=this._objects.length;s<i;s++)this._objects[s]._renderControls(c,n);c.restore()}}),e.ActiveSelection.fromObject=function(c,l){e.util.enlivenObjects(c.objects,function(n){delete c.objects,l&&l(new e.ActiveSelection(n,c,!0))})})}(p),function(h){var e=t.util.object.extend;if(h.fabric||(h.fabric={}),h.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(c,l){l||(l={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",l),this._initElement(c,l)},getElement:function(){return this._element||{}},setElement:function(c,l){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=c,this._originalElement=c,this._initConfig(l),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(c){var l=t.filterBackend;l&&l.evictCachesForKey&&l.evictCachesForKey(c)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(c){t.util.cleanUpJsdomNode(this[c]),this[c]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var c=this.getElement();return{width:c.naturalWidth||c.width,height:c.naturalHeight||c.height}},_stroke:function(c){if(!(!this.stroke||this.strokeWidth===0)){var l=this.width/2,n=this.height/2;c.beginPath(),c.moveTo(-l,-n),c.lineTo(l,-n),c.lineTo(l,n),c.lineTo(-l,n),c.lineTo(-l,-n),c.closePath()}},toObject:function(c){var l=[];this.filters.forEach(function(s){s&&l.push(s.toObject())});var n=e(this.callSuper("toObject",["cropX","cropY"].concat(c)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:l});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var c=[],l=[],n,s=this._element,i=-this.width/2,a=-this.height/2,u="",o="";if(!s)return[];if(this.hasCrop()){var d=t.Object.__uid++;c.push('<clipPath id="imageCrop_'+d+`">
`,'	<rect x="'+i+'" y="'+a+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),u=' clip-path="url(#imageCrop_'+d+')" '}if(this.imageSmoothing||(o='" image-rendering="optimizeSpeed'),l.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',a-this.cropY,'" width="',s.width||s.naturalWidth,'" height="',s.height||s.height,o,'"',u,`></image>
`),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,n=["	<rect ",'x="',i,'" y="',a,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=g}return this.paintFirst!=="fill"?c=c.concat(n,l):c=c.concat(l,n),c},getSrc:function(c){var l=c?this._element:this._originalElement;return l?l.toDataURL?l.toDataURL():this.srcFromAttribute?l.getAttribute("src"):l.src:this.src||""},setSrc:function(c,l,n){return t.util.loadImage(c,function(s,i){this.setElement(s,n),this._setWidthHeight(),l&&l(this,i)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var c=this.resizeFilter,l=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),s=n.scaleX,i=n.scaleY,a=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!c||s>l&&i>l){this._element=a,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,this._lastScaleY=i;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var u=t.util.createCanvasElement(),o=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,d=a.width,g=a.height;u.width=d,u.height=g,this._element=u,this._lastScaleX=c.scaleX=s,this._lastScaleY=c.scaleY=i,t.filterBackend.applyFilters([c],a,d,g,this._element,o),this._filterScalingX=u.width/this._originalElement.width,this._filterScalingY=u.height/this._originalElement.height},applyFilters:function(c){if(c=c||this.filters||[],c=c.filter(function(a){return a&&!a.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),c.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var l=this._originalElement,n=l.naturalWidth||l.width,s=l.naturalHeight||l.height;if(this._element===this._originalElement){var i=t.util.createCanvasElement();i.width=n,i.height=s,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,s),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(c,this._originalElement,n,s,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(c){t.util.setImageSmoothing(c,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(c),this._renderPaintInOrder(c)},drawCacheOnCanvas:function(c){t.util.setImageSmoothing(c,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,c)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(c){var l=this._element;if(l){var n=this._filterScalingX,s=this._filterScalingY,i=this.width,a=this.height,u=Math.min,o=Math.max,d=o(this.cropX,0),g=o(this.cropY,0),v=l.naturalWidth||l.width,y=l.naturalHeight||l.height,C=d*n,w=g*s,S=u(i*n,v-C),O=u(a*s,y-w),M=-i/2,I=-a/2,N=u(i,v/n-d),L=u(a,y/s-g);l&&c.drawImage(l,C,w,S,O,M,I,N,L)}},_needsResize:function(){var c=this.getTotalObjectScaling();return c.scaleX!==this._lastScaleX||c.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(c,l){this.setElement(t.util.getById(c),l),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={}),this.setOptions(c),this._setWidthHeight(c)},_initFilters:function(c,l){c&&c.length?t.util.enlivenObjects(c,function(n){l&&l(n)},"fabric.Image.filters"):l&&l()},_setWidthHeight:function(c){c||(c={});var l=this.getElement();this.width=c.width||l.naturalWidth||l.width||0,this.height=c.height||l.naturalHeight||l.height||0},parsePreserveAspectRatioAttribute:function(){var c=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),l=this._element.width,n=this._element.height,s=1,i=1,a=0,u=0,o=0,d=0,g,v=this.width,y=this.height,C={width:v,height:y};return c&&(c.alignX!=="none"||c.alignY!=="none")?(c.meetOrSlice==="meet"&&(s=i=t.util.findScaleToFit(this._element,C),g=(v-l*s)/2,c.alignX==="Min"&&(a=-g),c.alignX==="Max"&&(a=g),g=(y-n*i)/2,c.alignY==="Min"&&(u=-g),c.alignY==="Max"&&(u=g)),c.meetOrSlice==="slice"&&(s=i=t.util.findScaleToCover(this._element,C),g=l-v/s,c.alignX==="Mid"&&(o=g/2),c.alignX==="Max"&&(o=g),g=n-y/i,c.alignY==="Mid"&&(d=g/2),c.alignY==="Max"&&(d=g),l=v/s,n=y/i)):(s=v/l,i=y/n),{width:l,height:n,scaleX:s,scaleY:i,offsetLeft:a,offsetTop:u,cropX:o,cropY:d}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(c,l){var n=t.util.object.clone(c);t.util.loadImage(n.src,function(s,i){if(i){l&&l(null,!0);return}t.Image.prototype._initFilters.call(n,n.filters,function(a){n.filters=a||[],t.Image.prototype._initFilters.call(n,[n.resizeFilter],function(u){n.resizeFilter=u[0],t.util.enlivenObjectEnlivables(n,n,function(){var o=new t.Image(s,n);l(o,!1)})})})},null,n.crossOrigin)},t.Image.fromURL=function(c,l,n){t.util.loadImage(c,function(s,i){l&&l(new t.Image(s,n),i)},null,n&&n.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(c,l,n){var s=t.parseAttributes(c,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(s["xlink:href"],l,e(n?t.util.object.clone(n):{},s))}}(p),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var h=this.angle%360;return h>0?Math.round((h-1)/90)*90:Math.round(h/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(h){h=h||{};var e=function(){},c=h.onComplete||e,l=h.onChange||e,n=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){n.rotate(s),l()},onComplete:function(){n.setCoords(),c()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(h){return h.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(h){return h.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function h(c,l){var n="precision "+l+` float;
void main(){}`,s=c.createShader(c.FRAGMENT_SHADER);return c.shaderSource(s,n),c.compileShader(s),!!c.getShaderParameter(s,c.COMPILE_STATUS)}t.isWebglSupported=function(c){if(t.isLikelyNode)return!1;c=c||t.WebglFilterBackend.prototype.tileSize;var l=document.createElement("canvas"),n=l.getContext("webgl")||l.getContext("experimental-webgl"),s=!1;if(n){t.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),s=t.maxTextureSize>=c;for(var i=["highp","mediump","lowp"],a=0;a<3;a++)if(h(n,i[a])){t.webGlPrecision=i[a];break}}return this.isSupported=s,s},t.WebglFilterBackend=e;function e(c){c&&c.tileSize&&(this.tileSize=c.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}e.prototype={tileSize:2048,resources:{},setupGLContext:function(c,l){this.dispose(),this.createWebGLCanvas(c,l),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(c,l)},chooseFastestCopyGLTo2DMethod:function(c,l){var n=typeof window.performance<"u",s;try{new ImageData(1,1),s=!0}catch{s=!1}var i=typeof ArrayBuffer<"u",a=typeof Uint8ClampedArray<"u";if(n&&s&&i&&a){var u=t.util.createCanvasElement(),o=new ArrayBuffer(c*l*4);if(t.forceGLPutImageData){this.imageBuffer=o,this.copyGLTo2D=T;return}var d={imageBuffer:o,destinationWidth:c,destinationHeight:l,targetCanvas:u},g,v,y;u.width=c,u.height=l,g=window.performance.now(),_.call(d,this.gl,d),v=window.performance.now()-g,g=window.performance.now(),T.call(d,this.gl,d),y=window.performance.now()-g,v>y?(this.imageBuffer=o,this.copyGLTo2D=T):this.copyGLTo2D=_}},createWebGLCanvas:function(c,l){var n=t.util.createCanvasElement();n.width=c,n.height=l;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=n.getContext("webgl",s);i||(i=n.getContext("experimental-webgl",s)),i&&(i.clearColor(0,0,0,0),this.canvas=n,this.gl=i)},applyFilters:function(c,l,n,s,i,a){var u=this.gl,o;a&&(o=this.getCachedTexture(a,l));var d={originalWidth:l.width||l.originalWidth,originalHeight:l.height||l.originalHeight,sourceWidth:n,sourceHeight:s,destinationWidth:n,destinationHeight:s,context:u,sourceTexture:this.createTexture(u,n,s,!o&&l),targetTexture:this.createTexture(u,n,s),originalTexture:o||this.createTexture(u,n,s,!o&&l),passes:c.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},g=u.createFramebuffer();return u.bindFramebuffer(u.FRAMEBUFFER,g),c.forEach(function(v){v&&v.applyTo(d)}),m(d),this.copyGLTo2D(u,d),u.bindTexture(u.TEXTURE_2D,null),u.deleteTexture(d.sourceTexture),u.deleteTexture(d.targetTexture),u.deleteFramebuffer(g),i.getContext("2d").setTransform(1,0,0,1,0,0),d},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(c,l,n,s,i){var a=c.createTexture();return c.bindTexture(c.TEXTURE_2D,a),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,i||c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,i||c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),s?c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,s):c.texImage2D(c.TEXTURE_2D,0,c.RGBA,l,n,0,c.RGBA,c.UNSIGNED_BYTE,null),a},getCachedTexture:function(c,l){if(this.textureCache[c])return this.textureCache[c];var n=this.createTexture(this.gl,l.width,l.height,l);return this.textureCache[c]=n,n},evictCachesForKey:function(c){this.textureCache[c]&&(this.gl.deleteTexture(this.textureCache[c]),delete this.textureCache[c])},copyGLTo2D:_,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var c=this.gl,l={renderer:"",vendor:""};if(!c)return l;var n=c.getExtension("WEBGL_debug_renderer_info");if(n){var s=c.getParameter(n.UNMASKED_RENDERER_WEBGL),i=c.getParameter(n.UNMASKED_VENDOR_WEBGL);s&&(l.renderer=s.toLowerCase()),i&&(l.vendor=i.toLowerCase())}return this.gpuInfo=l,l}}}();function m(h){var e=h.targetCanvas,c=e.width,l=e.height,n=h.destinationWidth,s=h.destinationHeight;(c!==n||l!==s)&&(e.width=n,e.height=s)}function _(h,e){var c=h.canvas,l=e.targetCanvas,n=l.getContext("2d");n.translate(0,l.height),n.scale(1,-1);var s=c.height-l.height;n.drawImage(c,0,s,l.width,l.height,0,0,l.width,l.height)}function T(h,e){var c=e.targetCanvas,l=c.getContext("2d"),n=e.destinationWidth,s=e.destinationHeight,i=n*s*4,a=new Uint8Array(this.imageBuffer,0,i),u=new Uint8ClampedArray(this.imageBuffer,0,i);h.readPixels(0,0,n,s,h.RGBA,h.UNSIGNED_BYTE,a);var o=new ImageData(u,n,s);l.putImageData(o,0,0)}(function(){var h=function(){};t.Canvas2dFilterBackend=e;function e(){}e.prototype={evictCachesForKey:h,dispose:h,clearWebGLCaches:h,resources:{},applyFilters:function(c,l,n,s,i){var a=i.getContext("2d");a.drawImage(l,0,0,n,s);var u=a.getImageData(0,0,n,s),o=a.getImageData(0,0,n,s),d={sourceWidth:n,sourceHeight:s,imageData:u,originalEl:l,originalImageData:o,canvasEl:i,ctx:a,filterBackend:this};return c.forEach(function(g){g.applyTo(d)}),(d.imageData.width!==n||d.imageData.height!==s)&&(i.width=d.imageData.width,i.height=d.imageData.height),a.putImageData(d.imageData,0,0),d}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(h){h&&this.setOptions(h)},setOptions:function(h){for(var e in h)this[e]=h[e]},createProgram:function(h,e,c){e=e||this.fragmentSource,c=c||this.vertexSource,t.webGlPrecision!=="highp"&&(e=e.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var l=h.createShader(h.VERTEX_SHADER);if(h.shaderSource(l,c),h.compileShader(l),!h.getShaderParameter(l,h.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+h.getShaderInfoLog(l));var n=h.createShader(h.FRAGMENT_SHADER);if(h.shaderSource(n,e),h.compileShader(n),!h.getShaderParameter(n,h.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+h.getShaderInfoLog(n));var s=h.createProgram();if(h.attachShader(s,l),h.attachShader(s,n),h.linkProgram(s),!h.getProgramParameter(s,h.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+h.getProgramInfoLog(s));var i=this.getAttributeLocations(h,s),a=this.getUniformLocations(h,s)||{};return a.uStepW=h.getUniformLocation(s,"uStepW"),a.uStepH=h.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:i,uniformLocations:a}},getAttributeLocations:function(h,e){return{aPosition:h.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(h,e,c){var l=e.aPosition,n=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,n),h.enableVertexAttribArray(l),h.vertexAttribPointer(l,2,h.FLOAT,!1,0,0),h.bufferData(h.ARRAY_BUFFER,c,h.STATIC_DRAW)},_setupFrameBuffer:function(h){var e=h.context,c,l;h.passes>1?(c=h.destinationWidth,l=h.destinationHeight,(h.sourceWidth!==c||h.sourceHeight!==l)&&(e.deleteTexture(h.targetTexture),h.targetTexture=h.filterBackend.createTexture(e,c,l)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,h.targetTexture,0)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish())},_swapTextures:function(h){h.passes--,h.pass++;var e=h.targetTexture;h.targetTexture=h.sourceTexture,h.sourceTexture=e},isNeutralState:function(){var h=this.mainParameter,e=t.Image.filters[this.type].prototype;if(h)if(Array.isArray(e[h])){for(var c=e[h].length;c--;)if(this[h][c]!==e[h][c])return!1;return!0}else return e[h]===this[h];else return!1},applyTo:function(h){h.webgl?(this._setupFrameBuffer(h),this.applyToWebGL(h),this._swapTextures(h)):this.applyTo2d(h)},retrieveShader:function(h){return h.programCache.hasOwnProperty(this.type)||(h.programCache[this.type]=this.createProgram(h.context)),h.programCache[this.type]},applyToWebGL:function(h){var e=h.context,c=this.retrieveShader(h);h.pass===0&&h.originalTexture?e.bindTexture(e.TEXTURE_2D,h.originalTexture):e.bindTexture(e.TEXTURE_2D,h.sourceTexture),e.useProgram(c.program),this.sendAttributeData(e,c.attributeLocations,h.aPosition),e.uniform1f(c.uniformLocations.uStepW,1/h.sourceWidth),e.uniform1f(c.uniformLocations.uStepH,1/h.sourceHeight),this.sendUniformData(e,c.uniformLocations),e.viewport(0,0,h.destinationWidth,h.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(h,e,c){h.activeTexture(c),h.bindTexture(h.TEXTURE_2D,e),h.activeTexture(h.TEXTURE0)},unbindAdditionalTexture:function(h,e){h.activeTexture(e),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(h){this[this.mainParameter]=h},sendUniformData:function(){},createHelpLayer:function(h){if(!h.helpLayer){var e=document.createElement("canvas");e.width=h.sourceWidth,e.height=h.sourceHeight,h.helpLayer=e}},toObject:function(){var h={type:this.type},e=this.mainParameter;return e&&(h[e]=this[e]),h},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(h,e){var c=new t.Image.filters[h.type](h);return e&&e(c),c},function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.ColorMatrix=l(c.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(n){this.callSuper("initialize",n),this.matrix=this.matrix.slice(0)},applyTo2d:function(n){var s=n.imageData,i=s.data,a=i.length,u=this.matrix,o,d,g,v,y,C=this.colorsOnly;for(y=0;y<a;y+=4)o=i[y],d=i[y+1],g=i[y+2],C?(i[y]=o*u[0]+d*u[1]+g*u[2]+u[4]*255,i[y+1]=o*u[5]+d*u[6]+g*u[7]+u[9]*255,i[y+2]=o*u[10]+d*u[11]+g*u[12]+u[14]*255):(v=i[y+3],i[y]=o*u[0]+d*u[1]+g*u[2]+v*u[3]+u[4]*255,i[y+1]=o*u[5]+d*u[6]+g*u[7]+v*u[8]+u[9]*255,i[y+2]=o*u[10]+d*u[11]+g*u[12]+v*u[13]+u[14]*255,i[y+3]=o*u[15]+d*u[16]+g*u[17]+v*u[18]+u[19]*255)},getUniformLocations:function(n,s){return{uColorMatrix:n.getUniformLocation(s,"uColorMatrix"),uConstants:n.getUniformLocation(s,"uConstants")}},sendUniformData:function(n,s){var i=this.matrix,a=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],u=[i[4],i[9],i[14],i[19]];n.uniformMatrix4fv(s.uColorMatrix,!1,a),n.uniform4fv(s.uConstants,u)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Brightness=l(c.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(n){if(this.brightness!==0){var s=n.imageData,i=s.data,a,u=i.length,o=Math.round(this.brightness*255);for(a=0;a<u;a+=4)i[a]=i[a]+o,i[a+1]=i[a+1]+o,i[a+2]=i[a+2]+o}},getUniformLocations:function(n,s){return{uBrightness:n.getUniformLocation(s,"uBrightness")}},sendUniformData:function(n,s){n.uniform1f(s.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend,l=e.Image.filters,n=e.util.createClass;l.Convolute=n(l.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(s){var i=Math.sqrt(this.matrix.length),a=this.type+"_"+i+"_"+(this.opaque?1:0),u=this.fragmentSource[a];return s.programCache.hasOwnProperty(a)||(s.programCache[a]=this.createProgram(s.context,u)),s.programCache[a]},applyTo2d:function(s){var i=s.imageData,a=i.data,u=this.matrix,o=Math.round(Math.sqrt(u.length)),d=Math.floor(o/2),g=i.width,v=i.height,y=s.ctx.createImageData(g,v),C=y.data,w=this.opaque?1:0,S,O,M,I,N,L,H,U,R,V,$,J,b;for($=0;$<v;$++)for(V=0;V<g;V++){for(N=($*g+V)*4,S=0,O=0,M=0,I=0,b=0;b<o;b++)for(J=0;J<o;J++)H=$+b-d,L=V+J-d,!(H<0||H>=v||L<0||L>=g)&&(U=(H*g+L)*4,R=u[b*o+J],S+=a[U]*R,O+=a[U+1]*R,M+=a[U+2]*R,w||(I+=a[U+3]*R));C[N]=S,C[N+1]=O,C[N+2]=M,w?C[N+3]=a[N+3]:C[N+3]=I}s.imageData=y},getUniformLocations:function(s,i){return{uMatrix:s.getUniformLocation(i,"uMatrix"),uOpaque:s.getUniformLocation(i,"uOpaque"),uHalfSize:s.getUniformLocation(i,"uHalfSize"),uSize:s.getUniformLocation(i,"uSize")}},sendUniformData:function(s,i){s.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Grayscale=l(c.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(n){var s=n.imageData,i=s.data,a,u=i.length,o,d=this.mode;for(a=0;a<u;a+=4)d==="average"?o=(i[a]+i[a+1]+i[a+2])/3:d==="lightness"?o=(Math.min(i[a],i[a+1],i[a+2])+Math.max(i[a],i[a+1],i[a+2]))/2:d==="luminosity"&&(o=.21*i[a]+.72*i[a+1]+.07*i[a+2]),i[a]=o,i[a+1]=o,i[a+2]=o},retrieveShader:function(n){var s=this.type+"_"+this.mode;if(!n.programCache.hasOwnProperty(s)){var i=this.fragmentSource[this.mode];n.programCache[s]=this.createProgram(n.context,i)}return n.programCache[s]},getUniformLocations:function(n,s){return{uMode:n.getUniformLocation(s,"uMode")}},sendUniformData:function(n,s){var i=1;n.uniform1i(s.uMode,i)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Invert=l(c.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(n){var s=n.imageData,i=s.data,a,u=i.length;for(a=0;a<u;a+=4)i[a]=255-i[a],i[a+1]=255-i[a+1],i[a+2]=255-i[a+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(n,s){return{uInvert:n.getUniformLocation(s,"uInvert")}},sendUniformData:function(n,s){n.uniform1i(s.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend,l=e.Image.filters,n=e.util.createClass;l.Noise=n(l.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(s){if(this.noise!==0){var i=s.imageData,a=i.data,u,o=a.length,d=this.noise,g;for(u=0,o=a.length;u<o;u+=4)g=(.5-Math.random())*d,a[u]+=g,a[u+1]+=g,a[u+2]+=g}},getUniformLocations:function(s,i){return{uNoise:s.getUniformLocation(i,"uNoise"),uSeed:s.getUniformLocation(i,"uSeed")}},sendUniformData:function(s,i){s.uniform1f(i.uNoise,this.noise/255),s.uniform1f(i.uSeed,Math.random())},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Pixelate=l(c.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(n){var s=n.imageData,i=s.data,a=s.height,u=s.width,o,d,g,v,y,C,w,S,O,M,I;for(d=0;d<a;d+=this.blocksize)for(g=0;g<u;g+=this.blocksize)for(o=d*4*u+g*4,v=i[o],y=i[o+1],C=i[o+2],w=i[o+3],M=Math.min(d+this.blocksize,a),I=Math.min(g+this.blocksize,u),S=d;S<M;S++)for(O=g;O<I;O++)o=S*4*u+O*4,i[o]=v,i[o+1]=y,i[o+2]=C,i[o+3]=w},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(n,s){return{uBlocksize:n.getUniformLocation(s,"uBlocksize"),uStepW:n.getUniformLocation(s,"uStepW"),uStepH:n.getUniformLocation(s,"uStepH")}},sendUniformData:function(n,s){n.uniform1f(s.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.extend,l=e.Image.filters,n=e.util.createClass;l.RemoveColor=n(l.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(s){var i=s.imageData,a=i.data,u,o=this.distance*255,d,g,v,y=new e.Color(this.color).getSource(),C=[y[0]-o,y[1]-o,y[2]-o],w=[y[0]+o,y[1]+o,y[2]+o];for(u=0;u<a.length;u+=4)d=a[u],g=a[u+1],v=a[u+2],d>C[0]&&g>C[1]&&v>C[2]&&d<w[0]&&g<w[1]&&v<w[2]&&(a[u+3]=0)},getUniformLocations:function(s,i){return{uLow:s.getUniformLocation(i,"uLow"),uHigh:s.getUniformLocation(i,"uHigh")}},sendUniformData:function(s,i){var a=new e.Color(this.color).getSource(),u=parseFloat(this.distance),o=[0+a[0]/255-u,0+a[1]/255-u,0+a[2]/255-u,1],d=[a[0]/255+u,a[1]/255+u,a[2]/255+u,1];s.uniform4fv(i.uLow,o),s.uniform4fv(i.uHigh,d)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in n)c[s]=l(c.ColorMatrix,{type:s,matrix:n[s],mainParameter:!1,colorsOnly:!0}),e.Image.filters[s].fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric,c=e.Image.filters,l=e.util.createClass;c.BlendColor=l(c.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(n){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[n]+`}
}`},retrieveShader:function(n){var s=this.type+"_"+this.mode,i;return n.programCache.hasOwnProperty(s)||(i=this.buildSource(this.mode),n.programCache[s]=this.createProgram(n.context,i)),n.programCache[s]},applyTo2d:function(n){var s=n.imageData,i=s.data,a=i.length,u,o,d,g,v,y,C,w=1-this.alpha;C=new e.Color(this.color).getSource(),u=C[0]*this.alpha,o=C[1]*this.alpha,d=C[2]*this.alpha;for(var S=0;S<a;S+=4)switch(g=i[S],v=i[S+1],y=i[S+2],this.mode){case"multiply":i[S]=g*u/255,i[S+1]=v*o/255,i[S+2]=y*d/255;break;case"screen":i[S]=255-(255-g)*(255-u)/255,i[S+1]=255-(255-v)*(255-o)/255,i[S+2]=255-(255-y)*(255-d)/255;break;case"add":i[S]=g+u,i[S+1]=v+o,i[S+2]=y+d;break;case"diff":case"difference":i[S]=Math.abs(g-u),i[S+1]=Math.abs(v-o),i[S+2]=Math.abs(y-d);break;case"subtract":i[S]=g-u,i[S+1]=v-o,i[S+2]=y-d;break;case"darken":i[S]=Math.min(g,u),i[S+1]=Math.min(v,o),i[S+2]=Math.min(y,d);break;case"lighten":i[S]=Math.max(g,u),i[S+1]=Math.max(v,o),i[S+2]=Math.max(y,d);break;case"overlay":i[S]=u<128?2*g*u/255:255-2*(255-g)*(255-u)/255,i[S+1]=o<128?2*v*o/255:255-2*(255-v)*(255-o)/255,i[S+2]=d<128?2*y*d/255:255-2*(255-y)*(255-d)/255;break;case"exclusion":i[S]=u+g-2*u*g/255,i[S+1]=o+v-2*o*v/255,i[S+2]=d+y-2*d*y/255;break;case"tint":i[S]=u+g*w,i[S+1]=o+v*w,i[S+2]=d+y*w}},getUniformLocations:function(n,s){return{uColor:n.getUniformLocation(s,"uColor")}},sendUniformData:function(n,s){var i=new e.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,n.uniform4fv(s.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric,c=e.Image.filters,l=e.util.createClass;c.BlendImage=l(c.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(n){var s=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return n.programCache.hasOwnProperty(s)||(n.programCache[s]=this.createProgram(n.context,i)),n.programCache[s]},applyToWebGL:function(n){var s=n.context,i=this.createTexture(n.filterBackend,this.image);this.bindAdditionalTexture(s,i,s.TEXTURE1),this.callSuper("applyToWebGL",n),this.unbindAdditionalTexture(s,s.TEXTURE1)},createTexture:function(n,s){return n.getCachedTexture(s.cacheKey,s._element)},calculateMatrix:function(){var n=this.image,s=n._element.width,i=n._element.height;return[1/n.scaleX,0,0,0,1/n.scaleY,0,-n.left/s,-n.top/i,1]},applyTo2d:function(n){var s=n.imageData,i=n.filterBackend.resources,a=s.data,u=a.length,o=s.width,d=s.height,g,v,y,C,w,S,O,M,I,N,L=this.image,H;i.blendImage||(i.blendImage=e.util.createCanvasElement()),I=i.blendImage,N=I.getContext("2d"),I.width!==o||I.height!==d?(I.width=o,I.height=d):N.clearRect(0,0,o,d),N.setTransform(L.scaleX,0,0,L.scaleY,L.left,L.top),N.drawImage(L._element,0,0,o,d),H=N.getImageData(0,0,o,d).data;for(var U=0;U<u;U+=4)switch(w=a[U],S=a[U+1],O=a[U+2],M=a[U+3],g=H[U],v=H[U+1],y=H[U+2],C=H[U+3],this.mode){case"multiply":a[U]=w*g/255,a[U+1]=S*v/255,a[U+2]=O*y/255,a[U+3]=M*C/255;break;case"mask":a[U+3]=C;break}},getUniformLocations:function(n,s){return{uTransformMatrix:n.getUniformLocation(s,"uTransformMatrix"),uImage:n.getUniformLocation(s,"uImage")}},sendUniformData:function(n,s){var i=this.calculateMatrix();n.uniform1i(s.uImage,1),n.uniformMatrix3fv(s.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(n,s){e.Image.fromObject(n.image,function(i){var a=e.util.object.clone(n);a.image=i,s(new e.Image.filters.BlendImage(a))})}}(p),function(h){var e=h.fabric||(h.fabric={}),c=Math.pow,l=Math.floor,n=Math.sqrt,s=Math.abs,i=Math.round,a=Math.sin,u=Math.ceil,o=e.Image.filters,d=e.util.createClass;o.Resize=d(o.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(g,v){return{uDelta:g.getUniformLocation(v,"uDelta"),uTaps:g.getUniformLocation(v,"uTaps")}},sendUniformData:function(g,v){g.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),g.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(g){var v=this.getFilterWindow(),y=this.type+"_"+v;if(!g.programCache.hasOwnProperty(y)){var C=this.generateShader(v);g.programCache[y]=this.createProgram(g.context,C)}return g.programCache[y]},getFilterWindow:function(){var g=this.tempScale;return Math.ceil(this.lanczosLobes/g)},getTaps:function(){for(var g=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,y=this.getFilterWindow(),C=new Array(y),w=1;w<=y;w++)C[w-1]=g(w*v);return C},generateShader:function(C){for(var v=new Array(C),y=this.fragmentSourceTOP,C,w=1;w<=C;w++)v[w-1]=w+".0 * uDelta";return y+="uniform float uTaps["+C+`];
`,y+=`void main() {
`,y+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,y+=`  float sum = 1.0;
`,v.forEach(function(S,O){y+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+O+`];
`,y+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+O+`];
`,y+="  sum += 2.0 * uTaps["+O+`];
`}),y+=`  gl_FragColor = color / sum;
`,y+="}",y},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(g){g.webgl?(g.passes++,this.width=g.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=g.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),g.destinationWidth=this.dW,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceWidth=g.destinationWidth,this.height=g.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),g.destinationHeight=this.dH,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceHeight=g.destinationHeight):this.applyTo2d(g)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(g){return function(v){if(v>=g||v<=-g)return 0;if(v<11920929e-14&&v>-11920929e-14)return 1;v*=Math.PI;var y=v/g;return a(v)/v*a(y)/y}},applyTo2d:function(g){var v=g.imageData,y=this.scaleX,C=this.scaleY;this.rcpScaleX=1/y,this.rcpScaleY=1/C;var w=v.width,S=v.height,O=i(w*y),M=i(S*C),I;this.resizeType==="sliceHack"?I=this.sliceByTwo(g,w,S,O,M):this.resizeType==="hermite"?I=this.hermiteFastResize(g,w,S,O,M):this.resizeType==="bilinear"?I=this.bilinearFiltering(g,w,S,O,M):this.resizeType==="lanczos"&&(I=this.lanczosResize(g,w,S,O,M)),g.imageData=I},sliceByTwo:function(g,v,y,C,w){var S=g.imageData,O=.5,M=!1,I=!1,N=v*O,L=y*O,H=e.filterBackend.resources,U,R,V=0,$=0,J=v,b=0;for(H.sliceByTwo||(H.sliceByTwo=document.createElement("canvas")),U=H.sliceByTwo,(U.width<v*1.5||U.height<y)&&(U.width=v*1.5,U.height=y),R=U.getContext("2d"),R.clearRect(0,0,v*1.5,y),R.putImageData(S,0,0),C=l(C),w=l(w);!M||!I;)v=N,y=L,C<l(N*O)?N=l(N*O):(N=C,M=!0),w<l(L*O)?L=l(L*O):(L=w,I=!0),R.drawImage(U,V,$,v,y,J,b,N,L),V=J,$=b,b+=L;return R.getImageData(V,$,C,w)},lanczosResize:function(g,v,y,C,w){function S(A){var D,W,k,x,P,F,B,G,Q,et,nt;for(b.x=(A+.5)*L,E.x=l(b.x),D=0;D<w;D++){for(b.y=(D+.5)*H,E.y=l(b.y),P=0,F=0,B=0,G=0,Q=0,W=E.x-V;W<=E.x+V;W++)if(!(W<0||W>=v)){et=l(1e3*s(W-b.x)),J[et]||(J[et]={});for(var q=E.y-$;q<=E.y+$;q++)q<0||q>=y||(nt=l(1e3*s(q-b.y)),J[et][nt]||(J[et][nt]=N(n(c(et*U,2)+c(nt*R,2))/1e3)),k=J[et][nt],k>0&&(x=(q*v+W)*4,P+=k,F+=k*O[x],B+=k*O[x+1],G+=k*O[x+2],Q+=k*O[x+3]))}x=(D*C+A)*4,I[x]=F/P,I[x+1]=B/P,I[x+2]=G/P,I[x+3]=Q/P}return++A<C?S(A):M}var O=g.imageData.data,M=g.ctx.createImageData(C,w),I=M.data,N=this.lanczosCreate(this.lanczosLobes),L=this.rcpScaleX,H=this.rcpScaleY,U=2/this.rcpScaleX,R=2/this.rcpScaleY,V=u(L*this.lanczosLobes/2),$=u(H*this.lanczosLobes/2),J={},b={},E={};return S(0)},bilinearFiltering:function(g,v,y,C,w){var S,O,M,I,N,L,H,U,R,V,$,J,b=0,E,A=this.rcpScaleX,D=this.rcpScaleY,W=4*(v-1),k=g.imageData,x=k.data,P=g.ctx.createImageData(C,w),F=P.data;for(H=0;H<w;H++)for(U=0;U<C;U++)for(N=l(A*U),L=l(D*H),R=A*U-N,V=D*H-L,E=4*(L*v+N),$=0;$<4;$++)S=x[E+$],O=x[E+4+$],M=x[E+W+$],I=x[E+W+4+$],J=S*(1-R)*(1-V)+O*R*(1-V)+M*V*(1-R)+I*R*V,F[b++]=J;return P},hermiteFastResize:function(g,v,y,C,w){for(var S=this.rcpScaleX,O=this.rcpScaleY,M=u(S/2),I=u(O/2),N=g.imageData,L=N.data,H=g.ctx.createImageData(C,w),U=H.data,R=0;R<w;R++)for(var V=0;V<C;V++){for(var $=(V+R*C)*4,J=0,b=0,E=0,A=0,D=0,W=0,k=0,x=(R+.5)*O,P=l(R*O);P<(R+1)*O;P++)for(var F=s(x-(P+.5))/I,B=(V+.5)*S,G=F*F,Q=l(V*S);Q<(V+1)*S;Q++){var et=s(B-(Q+.5))/M,nt=n(G+et*et);nt>1&&nt<-1||(J=2*nt*nt*nt-3*nt*nt+1,J>0&&(et=4*(Q+P*v),k+=J*L[et+3],E+=J,L[et+3]<255&&(J=J*L[et+3]/250),A+=J*L[et],D+=J*L[et+1],W+=J*L[et+2],b+=J))}U[$]=A/b,U[$+1]=D/b,U[$+2]=W/b,U[$+3]=k/E}return H},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Contrast=l(c.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(n){if(this.contrast!==0){var s=n.imageData,i,u,a=s.data,u=a.length,o=Math.floor(this.contrast*255),d=259*(o+255)/(255*(259-o));for(i=0;i<u;i+=4)a[i]=d*(a[i]-128)+128,a[i+1]=d*(a[i+1]-128)+128,a[i+2]=d*(a[i+2]-128)+128}},getUniformLocations:function(n,s){return{uContrast:n.getUniformLocation(s,"uContrast")}},sendUniformData:function(n,s){n.uniform1f(s.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Saturation=l(c.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(n){if(this.saturation!==0){var s=n.imageData,i=s.data,a=i.length,u=-this.saturation,o,d;for(o=0;o<a;o+=4)d=Math.max(i[o],i[o+1],i[o+2]),i[o]+=d!==i[o]?(d-i[o])*u:0,i[o+1]+=d!==i[o+1]?(d-i[o+1])*u:0,i[o+2]+=d!==i[o+2]?(d-i[o+2])*u:0}},getUniformLocations:function(n,s){return{uSaturation:n.getUniformLocation(s,"uSaturation")}},sendUniformData:function(n,s){n.uniform1f(s.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Vibrance=l(c.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(n){if(this.vibrance!==0){var s=n.imageData,i=s.data,a=i.length,u=-this.vibrance,o,d,g,v;for(o=0;o<a;o+=4)d=Math.max(i[o],i[o+1],i[o+2]),g=(i[o]+i[o+1]+i[o+2])/3,v=Math.abs(d-g)*2/255*u,i[o]+=d!==i[o]?(d-i[o])*v:0,i[o+1]+=d!==i[o+1]?(d-i[o+1])*v:0,i[o+2]+=d!==i[o+2]?(d-i[o+2])*v:0}},getUniformLocations:function(n,s){return{uVibrance:n.getUniformLocation(s,"uVibrance")}},sendUniformData:function(n,s){n.uniform1f(s.uVibrance,-this.vibrance)}}),e.Image.filters.Vibrance.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Blur=l(c.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(n){n.webgl?(this.aspectRatio=n.sourceWidth/n.sourceHeight,n.passes++,this._setupFrameBuffer(n),this.horizontal=!0,this.applyToWebGL(n),this._swapTextures(n),this._setupFrameBuffer(n),this.horizontal=!1,this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},applyTo2d:function(n){n.imageData=this.simpleBlur(n)},simpleBlur:function(n){var s=n.filterBackend.resources,i,a,u=n.imageData.width,o=n.imageData.height;s.blurLayer1||(s.blurLayer1=e.util.createCanvasElement(),s.blurLayer2=e.util.createCanvasElement()),i=s.blurLayer1,a=s.blurLayer2,(i.width!==u||i.height!==o)&&(a.width=i.width=u,a.height=i.height=o);var d=i.getContext("2d"),g=a.getContext("2d"),v=15,y,C,w,S,O=this.blur*.06*.5;for(d.putImageData(n.imageData,0,0),g.clearRect(0,0,u,o),S=-v;S<=v;S++)y=(Math.random()-.5)/4,C=S/v,w=O*C*u+y,g.globalAlpha=1-Math.abs(C),g.drawImage(i,w,y),d.drawImage(a,0,0),g.globalAlpha=1,g.clearRect(0,0,a.width,a.height);for(S=-v;S<=v;S++)y=(Math.random()-.5)/4,C=S/v,w=O*C*o+y,g.globalAlpha=1-Math.abs(C),g.drawImage(i,y,w),d.drawImage(a,0,0),g.globalAlpha=1,g.clearRect(0,0,a.width,a.height);n.ctx.drawImage(i,0,0);var M=n.ctx.getImageData(0,0,i.width,i.height);return d.globalAlpha=1,d.clearRect(0,0,i.width,i.height),M},getUniformLocations:function(n,s){return{delta:n.getUniformLocation(s,"uDelta")}},sendUniformData:function(n,s){var i=this.chooseRightDelta();n.uniform2fv(s.delta,i)},chooseRightDelta:function(){var n=1,s=[0,0],i;return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),i=n*this.blur*.12,this.horizontal?s[0]=i:s[1]=i,s}}),c.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Gamma=l(c.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(n){this.gamma=[1,1,1],c.BaseFilter.prototype.initialize.call(this,n)},applyTo2d:function(n){var s=n.imageData,i=s.data,a=this.gamma,u=i.length,o=1/a[0],d=1/a[1],g=1/a[2],v;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,u=256;v<u;v++)this.rVals[v]=Math.pow(v/255,o)*255,this.gVals[v]=Math.pow(v/255,d)*255,this.bVals[v]=Math.pow(v/255,g)*255;for(v=0,u=i.length;v<u;v+=4)i[v]=this.rVals[i[v]],i[v+1]=this.gVals[i[v+1]],i[v+2]=this.bVals[i[v+2]]},getUniformLocations:function(n,s){return{uGamma:n.getUniformLocation(s,"uGamma")}},sendUniformData:function(n,s){n.uniform3fv(s.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.Composed=l(c.BaseFilter,{type:"Composed",subFilters:[],initialize:function(n){this.callSuper("initialize",n),this.subFilters=this.subFilters.slice(0)},applyTo:function(n){n.passes+=this.subFilters.length-1,this.subFilters.forEach(function(s){s.applyTo(n)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(n){return n.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(n){return!n.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(n,s){var i=n.subFilters||[],a=i.map(function(o){return new e.Image.filters[o.type](o)}),u=new e.Image.filters.Composed({subFilters:a});return s&&s(u),u}}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.Image.filters,l=e.util.createClass;c.HueRotation=l(c.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var n=this.rotation*Math.PI,s=e.util.cos(n),i=e.util.sin(n),a=1/3,u=Math.sqrt(a)*i,o=1-s;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=s+o/3,this.matrix[1]=a*o-u,this.matrix[2]=a*o+u,this.matrix[5]=a*o+u,this.matrix[6]=s+a*o,this.matrix[7]=a*o-u,this.matrix[10]=a*o-u,this.matrix[11]=a*o+u,this.matrix[12]=s+a*o},isNeutralState:function(n){return this.calculateMatrix(),c.BaseFilter.prototype.isNeutralState.call(this,n)},applyTo:function(n){this.calculateMatrix(),c.BaseFilter.prototype.applyTo.call(this,n)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(p),function(h){var e=h.fabric||(h.fabric={}),c=e.util.object.clone;if(e.Text){e.warn("fabric.Text is already defined");return}var l="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat(l),cacheProperties:e.Object.prototype.cacheProperties.concat(l),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(n,s){this.styles=s?s.styles||{}:{},this.text=n,this.__skipDimension=!0,this.callSuper("initialize",s),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var n=this.path;n&&(n.segmentsInfo=e.util.getPathSegmentsInfo(n.path))},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var n=this._splitTextIntoLines(this.text);return this.textLines=n.lines,this._textLines=n.graphemeLines,this._unwrappedTextLines=n._unwrappedLines,this._text=n.graphemeText,n},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var n,s,i,a,u,o,d,g=0,v=this._textLines.length;g<v;g++)if(!(this.textAlign!=="justify"&&(g===v-1||this.isEndOfWrapping(g)))&&(a=0,u=this._textLines[g],s=this.getLineWidth(g),s<this.width&&(d=this.textLines[g].match(this._reSpacesAndTabs)))){i=d.length,n=(this.width-s)/i;for(var y=0,C=u.length;y<=C;y++)o=this.__charBounds[g][y],this._reSpaceAndTab.test(u[y])?(o.width+=n,o.kernedWidth+=n,o.left+=a,a+=n):o.left+=a}},isEndOfWrapping:function(n){return n===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var n=this.callSuper("_getCacheCanvasDimensions"),s=this.fontSize;return n.width+=s*n.zoomX,n.height+=s*n.zoomY,n},_render:function(n){var s=this.path;s&&!s.isNotVisible()&&s._render(n),this._setTextStyles(n),this._renderTextLinesBackground(n),this._renderTextDecoration(n,"underline"),this._renderText(n),this._renderTextDecoration(n,"overline"),this._renderTextDecoration(n,"linethrough")},_renderText:function(n){this.paintFirst==="stroke"?(this._renderTextStroke(n),this._renderTextFill(n)):(this._renderTextFill(n),this._renderTextStroke(n))},_setTextStyles:function(n,s,i){if(n.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":n.textBaseline="middle";break;case"ascender":n.textBaseline="top";break;case"descender":n.textBaseline="bottom";break}n.font=this._getFontDeclaration(s,i)},calcTextWidth:function(){for(var n=this.getLineWidth(0),s=1,i=this._textLines.length;s<i;s++){var a=this.getLineWidth(s);a>n&&(n=a)}return n},_renderTextLine:function(n,s,i,a,u,o){this._renderChars(n,s,i,a,u,o)},_renderTextLinesBackground:function(n){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var s,i,a=n.fillStyle,u,o,d=this._getLeftOffset(),g=this._getTopOffset(),v=0,y=0,C,w,S=this.path,O,M=0,I=this._textLines.length;M<I;M++){if(s=this.getHeightOfLine(M),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",M)){g+=s;continue}u=this._textLines[M],i=this._getLineLeftOffset(M),y=0,v=0,o=this.getValueOfPropertyAt(M,0,"textBackgroundColor");for(var N=0,L=u.length;N<L;N++)C=this.__charBounds[M][N],w=this.getValueOfPropertyAt(M,N,"textBackgroundColor"),S?(n.save(),n.translate(C.renderLeft,C.renderTop),n.rotate(C.angle),n.fillStyle=w,w&&n.fillRect(-C.width/2,-s/this.lineHeight*(1-this._fontSizeFraction),C.width,s/this.lineHeight),n.restore()):w!==o?(O=d+i+v,this.direction==="rtl"&&(O=this.width-O-y),n.fillStyle=o,o&&n.fillRect(O,g,y,s/this.lineHeight),v=C.left,y=C.width,o=w):y+=C.kernedWidth;w&&!S&&(O=d+i+v,this.direction==="rtl"&&(O=this.width-O-y),n.fillStyle=w,n.fillRect(O,g,y,s/this.lineHeight)),g+=s}n.fillStyle=a,this._removeShadow(n)}},getFontCache:function(n){var s=n.fontFamily.toLowerCase();e.charWidthsCache[s]||(e.charWidthsCache[s]={});var i=e.charWidthsCache[s],a=n.fontStyle.toLowerCase()+"_"+(n.fontWeight+"").toLowerCase();return i[a]||(i[a]={}),i[a]},_measureChar:function(n,s,i,a){var u=this.getFontCache(s),o=this._getFontDeclaration(s),d=this._getFontDeclaration(a),g=i+n,v=o===d,y,C,w,S=s.fontSize/this.CACHE_FONT_SIZE,O;if(i&&u[i]!==void 0&&(w=u[i]),u[n]!==void 0&&(O=y=u[n]),v&&u[g]!==void 0&&(C=u[g],O=C-w),y===void 0||w===void 0||C===void 0){var M=this.getMeasuringContext();this._setTextStyles(M,s,!0)}return y===void 0&&(O=y=M.measureText(n).width,u[n]=y),w===void 0&&v&&i&&(w=M.measureText(i).width,u[i]=w),v&&C===void 0&&(C=M.measureText(g).width,u[g]=C,O=C-w),{width:y*S,kernedWidth:O*S}},getHeightOfChar:function(n,s){return this.getValueOfPropertyAt(n,s,"fontSize")},measureLine:function(n){var s=this._measureLine(n);return this.charSpacing!==0&&(s.width-=this._getWidthOfCharSpacing()),s.width<0&&(s.width=0),s},_measureLine:function(n){var s=0,i,a,u=this._textLines[n],o,d,g=0,v=new Array(u.length),y=0,C,w,S=this.path,O=this.pathSide==="right";for(this.__charBounds[n]=v,i=0;i<u.length;i++)a=u[i],d=this._getGraphemeBox(a,n,i,o),v[i]=d,s+=d.kernedWidth,o=a;if(v[i]={left:d?d.left+d.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(w=S.segmentsInfo[S.segmentsInfo.length-1].length,C=e.util.getPointOnPath(S.path,0,S.segmentsInfo),C.x+=S.pathOffset.x,C.y+=S.pathOffset.y,this.textAlign){case"left":y=O?w-s:0;break;case"center":y=(w-s)/2;break;case"right":y=O?0:w-s;break}for(y+=this.pathStartOffset*(O?-1:1),i=O?u.length-1:0;O?i>=0:i<u.length;O?i--:i++)d=v[i],y>w?y%=w:y<0&&(y+=w),this._setGraphemeOnPath(y,d,C),y+=d.kernedWidth}return{width:s,numOfSpaces:g}},_setGraphemeOnPath:function(n,s,i){var a=n+s.kernedWidth/2,u=this.path,o=e.util.getPointOnPath(u.path,a,u.segmentsInfo);s.renderLeft=o.x-i.x,s.renderTop=o.y-i.y,s.angle=o.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(n,s,i,a,u){var o=this.getCompleteStyleDeclaration(s,i),d=a?this.getCompleteStyleDeclaration(s,i-1):{},g=this._measureChar(n,o,a,d),v=g.kernedWidth,y=g.width,C;this.charSpacing!==0&&(C=this._getWidthOfCharSpacing(),y+=C,v+=C);var w={width:y,left:0,height:o.fontSize,kernedWidth:v,deltaY:o.deltaY};if(i>0&&!u){var S=this.__charBounds[s][i-1];w.left=S.left+S.width+g.kernedWidth-g.width}return w},getHeightOfLine:function(n){if(this.__lineHeights[n])return this.__lineHeights[n];for(var s=this._textLines[n],i=this.getHeightOfChar(n,0),a=1,u=s.length;a<u;a++)i=Math.max(this.getHeightOfChar(n,a),i);return this.__lineHeights[n]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var n,s=0,i=0,a=this._textLines.length;i<a;i++)n=this.getHeightOfLine(i),s+=i===a-1?n/this.lineHeight:n;return s},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(n,s){n.save();for(var i=0,a=this._getLeftOffset(),u=this._getTopOffset(),o=0,d=this._textLines.length;o<d;o++){var g=this.getHeightOfLine(o),v=g/this.lineHeight,y=this._getLineLeftOffset(o);this._renderTextLine(s,n,this._textLines[o],a+y,u+i+v,o),i+=g}n.restore()},_renderTextFill:function(n){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(n,"fillText")},_renderTextStroke:function(n){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this._setLineDash(n,this.strokeDashArray),n.beginPath(),this._renderTextCommon(n,"strokeText"),n.closePath(),n.restore())},_renderChars:function(n,s,i,a,u,o){var d=this.getHeightOfLine(o),g=this.textAlign.indexOf("justify")!==-1,v,y,C="",w,S=0,O,M=this.path,I=!g&&this.charSpacing===0&&this.isEmptyStyles(o)&&!M,N=this.direction==="ltr",L=this.direction==="ltr"?1:-1,H,U=s.canvas.getAttribute("dir");if(s.save(),U!==this.direction&&(s.canvas.setAttribute("dir",N?"ltr":"rtl"),s.direction=N?"ltr":"rtl",s.textAlign=N?"left":"right"),u-=d*this._fontSizeFraction/this.lineHeight,I){this._renderChar(n,s,o,0,i.join(""),a,u,d),s.restore();return}for(var R=0,V=i.length-1;R<=V;R++)O=R===V||this.charSpacing||M,C+=i[R],w=this.__charBounds[o][R],S===0?(a+=L*(w.kernedWidth-w.width),S+=w.width):S+=w.kernedWidth,g&&!O&&this._reSpaceAndTab.test(i[R])&&(O=!0),O||(v=v||this.getCompleteStyleDeclaration(o,R),y=this.getCompleteStyleDeclaration(o,R+1),O=e.util.hasStyleChanged(v,y,!1)),O&&(M?(s.save(),s.translate(w.renderLeft,w.renderTop),s.rotate(w.angle),this._renderChar(n,s,o,R,C,-S/2,0,d),s.restore()):(H=a,this._renderChar(n,s,o,R,C,H,u,d)),C="",v=y,a+=L*S,S=0);s.restore()},_applyPatternGradientTransformText:function(n){var s=e.util.createCanvasElement(),i,a=this.width+this.strokeWidth,u=this.height+this.strokeWidth;return s.width=a,s.height=u,i=s.getContext("2d"),i.beginPath(),i.moveTo(0,0),i.lineTo(a,0),i.lineTo(a,u),i.lineTo(0,u),i.closePath(),i.translate(a/2,u/2),i.fillStyle=n.toLive(i),this._applyPatternGradientTransform(i,n),i.fill(),i.createPattern(s,"no-repeat")},handleFiller:function(n,s,i){var a,u;return i.toLive?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(a=-this.width/2,u=-this.height/2,n.translate(a,u),n[s]=this._applyPatternGradientTransformText(i),{offsetX:a,offsetY:u}):(n[s]=i.toLive(n,this),this._applyPatternGradientTransform(n,i)):(n[s]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(n,s){return n.lineWidth=s.strokeWidth,n.lineCap=this.strokeLineCap,n.lineDashOffset=this.strokeDashOffset,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,this.handleFiller(n,"strokeStyle",s.stroke)},_setFillStyles:function(n,s){return this.handleFiller(n,"fillStyle",s.fill)},_renderChar:function(n,s,i,a,u,o,d){var g=this._getStyleDeclaration(i,a),v=this.getCompleteStyleDeclaration(i,a),y=n==="fillText"&&v.fill,C=n==="strokeText"&&v.stroke&&v.strokeWidth,w,S;!C&&!y||(s.save(),y&&(w=this._setFillStyles(s,v)),C&&(S=this._setStrokeStyles(s,v)),s.font=this._getFontDeclaration(v),g&&g.textBackgroundColor&&this._removeShadow(s),g&&g.deltaY&&(d+=g.deltaY),y&&s.fillText(u,o-w.offsetX,d-w.offsetY),C&&s.strokeText(u,o-S.offsetX,d-S.offsetY),s.restore())},setSuperscript:function(n,s){return this._setScript(n,s,this.superscript)},setSubscript:function(n,s){return this._setScript(n,s,this.subscript)},_setScript:function(n,s,i){var a=this.get2DCursorLocation(n,!0),u=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"fontSize"),o=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"deltaY"),d={fontSize:u*i.size,deltaY:o+u*i.baseline};return this.setSelectionStyles(d,n,s),this},_getLineLeftOffset:function(n){var s=this.getLineWidth(n),i=this.width-s,a=this.textAlign,u=this.direction,d,o=0,d=this.isEndOfWrapping(n);return a==="justify"||a==="justify-center"&&!d||a==="justify-right"&&!d||a==="justify-left"&&!d?0:(a==="center"&&(o=i/2),a==="right"&&(o=i),a==="justify-center"&&(o=i/2),a==="justify-right"&&(o=i),u==="rtl"&&(o-=i),o)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var n=this._forceClearCache;return n||(n=this.hasStateChanged("_dimensionAffectingProps")),n&&(this.dirty=!0,this._forceClearCache=!1),n},getLineWidth:function(n){if(this.__lineWidths[n]!==void 0)return this.__lineWidths[n];var s=this.measureLine(n),i=s.width;return this.__lineWidths[n]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(n,s,i){var a=this._getStyleDeclaration(n,s);return a&&typeof a[i]<"u"?a[i]:this[i]},_renderTextDecoration:function(n,s){if(!(!this[s]&&!this.styleHas(s))){for(var i,a,u,o,d,g,v,y,C=this._getLeftOffset(),w=this._getTopOffset(),S,O,M,I,N,L,H,U,R=this.path,V=this._getWidthOfCharSpacing(),$=this.offsets[s],J=0,b=this._textLines.length;J<b;J++){if(i=this.getHeightOfLine(J),!this[s]&&!this.styleHas(s,J)){w+=i;continue}v=this._textLines[J],L=i/this.lineHeight,o=this._getLineLeftOffset(J),O=0,M=0,y=this.getValueOfPropertyAt(J,0,s),U=this.getValueOfPropertyAt(J,0,"fill"),S=w+L*(1-this._fontSizeFraction),a=this.getHeightOfChar(J,0),d=this.getValueOfPropertyAt(J,0,"deltaY");for(var E=0,A=v.length;E<A;E++)if(I=this.__charBounds[J][E],N=this.getValueOfPropertyAt(J,E,s),H=this.getValueOfPropertyAt(J,E,"fill"),u=this.getHeightOfChar(J,E),g=this.getValueOfPropertyAt(J,E,"deltaY"),R&&N&&H)n.save(),n.fillStyle=U,n.translate(I.renderLeft,I.renderTop),n.rotate(I.angle),n.fillRect(-I.kernedWidth/2,$*u+g,I.kernedWidth,this.fontSize/15),n.restore();else if((N!==y||H!==U||u!==a||g!==d)&&M>0){var D=C+o+O;this.direction==="rtl"&&(D=this.width-D-M),y&&U&&(n.fillStyle=U,n.fillRect(D,S+$*a+d,M,this.fontSize/15)),O=I.left,M=I.width,y=N,U=H,a=u,d=g}else M+=I.kernedWidth;var D=C+o+O;this.direction==="rtl"&&(D=this.width-D-M),n.fillStyle=H,N&&H&&n.fillRect(D,S+$*a+d,M-V,this.fontSize/15),w+=i}this._removeShadow(n)}},_getFontDeclaration:function(n,s){var i=n||this,a=this.fontFamily,u=e.Text.genericFonts.indexOf(a.toLowerCase())>-1,o=a===void 0||a.indexOf("'")>-1||a.indexOf(",")>-1||a.indexOf('"')>-1||u?i.fontFamily:'"'+i.fontFamily+'"';return[e.isLikelyNode?i.fontWeight:i.fontStyle,e.isLikelyNode?i.fontStyle:i.fontWeight,s?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",o].join(" ")},render:function(n){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",n)))},_splitTextIntoLines:function(n){for(var s=n.split(this._reNewline),i=new Array(s.length),a=[`
`],u=[],o=0;o<s.length;o++)i[o]=e.util.string.graphemeSplit(s[o]),u=u.concat(i[o],a);return u.pop(),{_unwrappedLines:i,lines:s,graphemeText:u,graphemeLines:i}},toObject:function(n){var s=l.concat(n),i=this.callSuper("toObject",s);return i.styles=e.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(n,s){this.callSuper("set",n,s);var i=!1,a=!1;if(typeof n=="object")for(var u in n)u==="path"&&this.setPathInfo(),i=i||this._dimensionAffectingProps.indexOf(u)!==-1,a=a||u==="path";else i=this._dimensionAffectingProps.indexOf(n)!==-1,a=n==="path";return a&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(n,s,i){if(!n)return s(null);var a=e.parseAttributes(n,e.Text.ATTRIBUTE_NAMES),u=a.textAnchor||"left";if(i=e.util.object.extend(i?c(i):{},a),i.top=i.top||0,i.left=i.left||0,a.textDecoration){var o=a.textDecoration;o.indexOf("underline")!==-1&&(i.underline=!0),o.indexOf("overline")!==-1&&(i.overline=!0),o.indexOf("line-through")!==-1&&(i.linethrough=!0),delete i.textDecoration}"dx"in a&&(i.left+=a.dx),"dy"in a&&(i.top+=a.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var d="";"textContent"in n?d=n.textContent:"firstChild"in n&&n.firstChild!==null&&"data"in n.firstChild&&n.firstChild.data!==null&&(d=n.firstChild.data),d=d.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var g=i.strokeWidth;i.strokeWidth=0;var v=new e.Text(d,i),y=v.getScaledHeight()/v.height,C=(v.height+v.strokeWidth)*v.lineHeight-v.height,w=C*y,S=v.getScaledHeight()+w,O=0;u==="center"&&(O=v.getScaledWidth()/2),u==="right"&&(O=v.getScaledWidth()),v.set({left:v.left-O,top:v.top-(S-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:typeof g<"u"?g:1}),s(v)},e.Text.fromObject=function(n,s){var i=c(n),a=n.path;return delete i.path,e.Object._fromObject("Text",i,function(u){u.styles=e.util.stylesFromArray(n.styles,n.text),a?e.Object._fromObject("Path",a,function(o){u.set("path",o),s(u)},"path"):s(u)},"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}(p),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(h){if(!this.styles||typeof h<"u"&&!this.styles[h])return!0;var e=typeof h>"u"?this.styles:{line:this.styles[h]};for(var c in e)for(var l in e[c])for(var n in e[c][l])return!1;return!0},styleHas:function(h,e){if(!this.styles||!h||h===""||typeof e<"u"&&!this.styles[e])return!1;var c=typeof e>"u"?this.styles:{0:this.styles[e]};for(var l in c)for(var n in c[l])if(typeof c[l][n][h]<"u")return!0;return!1},cleanStyle:function(h){if(!this.styles||!h||h==="")return!1;var e=this.styles,c=0,l,n,s=!0,i=0,a;for(var u in e){l=0;for(var o in e[u]){var a=e[u][o],d=a.hasOwnProperty(h);c++,d?(n?a[h]!==n&&(s=!1):n=a[h],a[h]===this[h]&&delete a[h]):s=!1,Object.keys(a).length!==0?l++:delete e[u][o]}l===0&&delete e[u]}for(var g=0;g<this._textLines.length;g++)i+=this._textLines[g].length;s&&c===i&&(this[h]=n,this.removeStyle(h))},removeStyle:function(h){if(!(!this.styles||!h||h==="")){var e=this.styles,c,l,n;for(l in e){c=e[l];for(n in c)delete c[n][h],Object.keys(c[n]).length===0&&delete c[n];Object.keys(c).length===0&&delete e[l]}}},_extendStyles:function(h,e){var c=this.get2DCursorLocation(h);this._getLineStyle(c.lineIndex)||this._setLineStyle(c.lineIndex),this._getStyleDeclaration(c.lineIndex,c.charIndex)||this._setStyleDeclaration(c.lineIndex,c.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),e)},get2DCursorLocation:function(h,e){typeof h>"u"&&(h=this.selectionStart);for(var c=e?this._unwrappedTextLines:this._textLines,l=c.length,n=0;n<l;n++){if(h<=c[n].length)return{lineIndex:n,charIndex:h};h-=c[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:c[n-1].length<h?c[n-1].length:h}},getSelectionStyles:function(h,e,c){typeof h>"u"&&(h=this.selectionStart||0),typeof e>"u"&&(e=this.selectionEnd||h);for(var l=[],n=h;n<e;n++)l.push(this.getStyleAtPosition(n,c));return l},getStyleAtPosition:function(h,e){var c=this.get2DCursorLocation(h),l=e?this.getCompleteStyleDeclaration(c.lineIndex,c.charIndex):this._getStyleDeclaration(c.lineIndex,c.charIndex);return l||{}},setSelectionStyles:function(h,e,c){typeof e>"u"&&(e=this.selectionStart||0),typeof c>"u"&&(c=this.selectionEnd||e);for(var l=e;l<c;l++)this._extendStyles(l,h);return this._forceClearCache=!0,this},_getStyleDeclaration:function(h,e){var c=this.styles&&this.styles[h];return c?c[e]:null},getCompleteStyleDeclaration:function(h,e){for(var c=this._getStyleDeclaration(h,e)||{},l={},n,s=0;s<this._styleProperties.length;s++)n=this._styleProperties[s],l[n]=typeof c[n]>"u"?this[n]:c[n];return l},_setStyleDeclaration:function(h,e,c){this.styles[h][e]=c},_deleteStyleDeclaration:function(h,e){delete this.styles[h][e]},_getLineStyle:function(h){return!!this.styles[h]},_setLineStyle:function(h){this.styles[h]={}},_deleteLineStyle:function(h){delete this.styles[h]}})}(),function(){function h(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,c){this.callSuper("initialize",e,c),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,c){this[e]!==c&&(this._fireSelectionChanged(),this[e]=c),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var c=this.canvas.contextTop,l=this.canvas.viewportTransform;c.save(),c.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this.transform(c),this._clearTextArea(c),e||c.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var e=this._getCursorBoundaries(),c=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,c):this.renderSelection(e,c),c.restore()}},_clearTextArea:function(e){var c=this.width+4,l=this.height+4;e.clearRect(-c/2,-l/2,c,l)},_getCursorBoundaries:function(e){typeof e>"u"&&(e=this.selectionStart);var c=this._getLeftOffset(),l=this._getTopOffset(),n=this._getCursorBoundariesOffsets(e);return{left:c,top:l,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var c,l,n,s=0,i=0,a,u=this.get2DCursorLocation(e);n=u.charIndex,l=u.lineIndex;for(var o=0;o<l;o++)s+=this.getHeightOfLine(o);c=this._getLineLeftOffset(l);var d=this.__charBounds[l][n];return d&&(i=d.left),this.charSpacing!==0&&n===this._textLines[l].length&&(i-=this._getWidthOfCharSpacing()),a={top:s,left:c+(i>0?i:0)},this.direction==="rtl"&&(a.left*=-1),this.cursorOffsetCache=a,this.cursorOffsetCache},renderCursor:function(e,c){var l=this.get2DCursorLocation(),n=l.lineIndex,s=l.charIndex>0?l.charIndex-1:0,i=this.getValueOfPropertyAt(n,s,"fontSize"),a=this.scaleX*this.canvas.getZoom(),u=this.cursorWidth/a,o=e.topOffset,d=this.getValueOfPropertyAt(n,s,"deltaY");o+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,c),c.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,s,"fill"),c.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,c.fillRect(e.left+e.leftOffset-u/2,o+e.top+d,u,i)},renderSelection:function(e,c){for(var l=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=this.textAlign.indexOf("justify")!==-1,i=this.get2DCursorLocation(l),a=this.get2DCursorLocation(n),u=i.lineIndex,o=a.lineIndex,d=i.charIndex<0?0:i.charIndex,g=a.charIndex<0?0:a.charIndex,v=u;v<=o;v++){var y=this._getLineLeftOffset(v)||0,C=this.getHeightOfLine(v),w=0,S=0,O=0;if(v===u&&(S=this.__charBounds[u][d].left),v>=u&&v<o)O=s&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===o)if(g===0)O=this.__charBounds[o][g].left;else{var M=this._getWidthOfCharSpacing();O=this.__charBounds[o][g-1].left+this.__charBounds[o][g-1].width-M}w=C,(this.lineHeight<1||v===o&&this.lineHeight>1)&&(C/=this.lineHeight);var I=e.left+y+S,N=O-S,L=C,H=0;this.inCompositionMode?(c.fillStyle=this.compositionColor||"black",L=1,H=C):c.fillStyle=this.selectionColor,this.direction==="rtl"&&(I=this.width-I-N),c.fillRect(I,e.top+e.topOffset+H,N,L),e.topOffset+=w}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),c=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c}}}),t.IText.fromObject=function(e,c){var l=t.util.stylesFromArray(e.styles,e.text),n=Object.assign({},e,{styles:l});if(h(n),n.styles)for(var s in n.styles)for(var i in n.styles[s])h(n.styles[s][i]);t.Object._fromObject("IText",n,c,"text")}}(),function(){var h=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var c=e.canvas;c&&(c._hasITextHandlers||(c._hasITextHandlers=!0,e._initCanvasHandlers(c)),c._iTextInstances=c._iTextInstances||[],c._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var c=e.canvas;c&&(c._iTextInstances=c._iTextInstances||[],t.util.removeFromArray(c._iTextInstances,e),c._iTextInstances.length===0&&(c._hasITextHandlers=!1,e._removeCanvasHandlers(c)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(c){c.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,c,l,n){var s;return s={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",c,{duration:l,onComplete:function(){s.isAborted||e[n]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return s.isAborted}}),s},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var c=this,l=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){c._tick()},l)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,c=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&c&&c.clearContext(c.contextTop||c.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var c=0,l=e-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)c++,l--;for(;/\S/.test(this._text[l])&&l>-1;)c++,l--;return e-c},findWordBoundaryRight:function(e){var c=0,l=e;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)c++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)c++,l++;return e+c},findLineBoundaryLeft:function(e){for(var c=0,l=e-1;!/\n/.test(this._text[l])&&l>-1;)c++,l--;return e-c},findLineBoundaryRight:function(e){for(var c=0,l=e;!/\n/.test(this._text[l])&&l<this._text.length;)c++,l++;return e+c},searchWordBoundary:function(e,c){for(var l=this._text,n=this._reSpace.test(l[e])?e-1:e,s=l[n],i=t.reNonWord;!i.test(s)&&n>0&&n<l.length;)n+=c,s=l[n];return i.test(s)&&(n+=c===1?0:1),n},selectWord:function(e){e=e||this.selectionStart;var c=this.searchWordBoundary(e,-1),l=this.searchWordBoundary(e,1);this.selectionStart=c,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var c=this.findLineBoundaryLeft(e),l=this.findLineBoundaryRight(e);return this.selectionStart=c,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(c){c.selected=!1,c.isEditing&&c.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var c=this.getSelectionStartFromPointer(e.e),l=this.selectionStart,n=this.selectionEnd;(c!==this.__selectionStartOnMouseDown||l===n)&&(l===c||n===c)||(c>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=c):(this.selectionStart=c,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==l||this.selectionEnd!==n)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,c,l){var n=l.slice(0,e),s=t.util.string.graphemeSplit(n).length;if(e===c)return{selectionStart:s,selectionEnd:s};var i=l.slice(e,c),a=t.util.string.graphemeSplit(i).length;return{selectionStart:s,selectionEnd:s+a}},fromGraphemeToStringSelection:function(e,c,l){var n=l.slice(0,e),s=n.join("").length;if(e===c)return{selectionStart:s,selectionEnd:s};var i=l.slice(e,c),a=i.join("").length;return{selectionStart:s,selectionEnd:s+a}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,c=this._getCursorBoundaries(e),l=this.get2DCursorLocation(e),n=l.lineIndex,s=l.charIndex,i=this.getValueOfPropertyAt(n,s,"fontSize")*this.lineHeight,a=c.leftOffset,u=this.calcTransformMatrix(),o={x:c.left+a,y:c.top+c.topOffset+i},d=this.canvas.getRetinaScaling(),g=this.canvas.upperCanvasEl,v=g.width/d,y=g.height/d,C=v-i,w=y-i,S=g.clientWidth/v,O=g.clientHeight/y;return o=t.util.transformPoint(o,u),o=t.util.transformPoint(o,this.canvas.viewportTransform),o.x*=S,o.y*=O,o.x<0&&(o.x=0),o.x>C&&(o.x=C),o.y<0&&(o.y=0),o.y>w&&(o.y=w),o.x+=this.canvas._offset.left,o.y+=this.canvas._offset.top,{left:o.x+"px",top:o.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,c=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,c&&(c.blur&&c.blur(),c.parentNode&&c.parentNode.removeChild(c)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,c){var l=this.get2DCursorLocation(e,!0),n=this.get2DCursorLocation(c,!0),s=l.lineIndex,i=l.charIndex,a=n.lineIndex,u=n.charIndex,o,d;if(s!==a){if(this.styles[s])for(o=i;o<this._unwrappedTextLines[s].length;o++)delete this.styles[s][o];if(this.styles[a])for(o=u;o<this._unwrappedTextLines[a].length;o++)d=this.styles[a][o],d&&(this.styles[s]||(this.styles[s]={}),this.styles[s][i+o-u]=d);for(o=s+1;o<=a;o++)delete this.styles[o];this.shiftLineStyles(a,s-a)}else if(this.styles[s]){d=this.styles[s];var g=u-i,v,y;for(o=i;o<u;o++)delete d[o];for(y in this.styles[s])v=parseInt(y,10),v>=u&&(d[v-g]=d[y],delete d[y])}},shiftLineStyles:function(e,c){var l=h(this.styles);for(var n in this.styles){var s=parseInt(n,10);s>e&&(this.styles[s+c]=l[s],l[s-c]||delete this.styles[s])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(e,c,l,n){var s,i={},a=!1,u=this._unwrappedTextLines[e].length===c;l||(l=1),this.shiftLineStyles(e,l),this.styles[e]&&(s=this.styles[e][c===0?c:c-1]);for(var o in this.styles[e]){var d=parseInt(o,10);d>=c&&(a=!0,i[d-c]=this.styles[e][o],u&&c===0||delete this.styles[e][o])}var g=!1;for(a&&!u&&(this.styles[e+l]=i,g=!0),g&&l--;l>0;)n&&n[l-1]?this.styles[e+l]={0:h(n[l-1])}:s?this.styles[e+l]={0:h(s)}:delete this.styles[e+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(e,c,l,n){this.styles||(this.styles={});var s=this.styles[e],i=s?h(s):{};l||(l=1);for(var a in i){var u=parseInt(a,10);u>=c&&(s[u+l]=i[u],i[u-l]||delete s[u])}if(this._forceClearCache=!0,n){for(;l--;)Object.keys(n[l]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][c+l]=h(n[l]));return}if(s)for(var o=s[c?c-1:1];o&&l--;)this.styles[e][c+l]=h(o)},insertNewStyleBlock:function(e,c,l){for(var n=this.get2DCursorLocation(c,!0),s=[0],i=0,a=0;a<e.length;a++)e[a]===`
`?(i++,s[i]=0):s[i]++;s[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,s[0],l),l=l&&l.slice(s[0]+1)),i&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+s[0],i);for(var a=1;a<i;a++)s[a]>0?this.insertCharStyleObject(n.lineIndex+a,0,s[a],l):l&&this.styles[n.lineIndex+a]&&l[0]&&(this.styles[n.lineIndex+a][0]=l[0]),l=l&&l.slice(s[a]+1);s[a]>0&&this.insertCharStyleObject(n.lineIndex+a,0,s[a],l)},setSelectionStartEndWithShift:function(e,c,l){l<=e?(c===e?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=l):l>e&&l<c?this._selectionDirection==="right"?this.selectionEnd=l:this.selectionStart=l:(c===e?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=c),this.selectionEnd=l)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(h){if(this.canvas){this.__newClickTime=+new Date;var e=h.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",h),this._stopEvent(h.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(h){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===h.x&&this.__lastPointer.y===h.y},_stopEvent:function(h){h.preventDefault&&h.preventDefault(),h.stopPropagation&&h.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(h){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(h.e))},tripleClickHandler:function(h){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(h.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(h.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(h){if(this.__isMousedown=!1,!(!this.editable||this.group||h.transform&&h.transform.actionPerformed||h.e.button&&h.e.button!==1)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(h.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(h){var e=this.getSelectionStartFromPointer(h),c=this.selectionStart,l=this.selectionEnd;h.shiftKey?this.setSelectionStartEndWithShift(c,l,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(h){for(var e=this.getLocalPointer(h),c=0,l=0,n=0,s=0,i=0,a,u,o=0,d=this._textLines.length;o<d&&n<=e.y;o++)n+=this.getHeightOfLine(o)*this.scaleY,i=o,o>0&&(s+=this._textLines[o-1].length+this.missingNewlineOffset(o-1));a=this._getLineLeftOffset(i),l=a*this.scaleX,u=this._textLines[i],this.direction==="rtl"&&(e.x=this.width*this.scaleX-e.x+l);for(var g=0,v=u.length;g<v&&(c=l,l+=this.__charBounds[i][g].kernedWidth*this.scaleX,l<=e.x);g++)s++;return this._getNewSelectionStartFromOffset(e,c,l,s,v)},_getNewSelectionStartFromOffset:function(h,e,c,l,n){var s=h.x-e,i=c-h.x,a=i>s||i<0?0:1,u=l+a;return this.flipX&&(u=n-u),u>this._text.length&&(u=this._text.length),u}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var h=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+h.top+"; left: "+h.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+h.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(h){if(this.isEditing){var e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(h.keyCode in e)this[e[h.keyCode]](h);else if(h.keyCode in this.ctrlKeysMapDown&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapDown[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),h.keyCode>=33&&h.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(h){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(h.keyCode in this.ctrlKeysMapUp&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapUp[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(h){var e=this.fromPaste;if(this.fromPaste=!1,h&&h.stopPropagation(),!!this.isEditing){var c=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,n=c.length,s,i,a=n-l,u=this.selectionStart,o=this.selectionEnd,d=u!==o,g,v,y;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var C=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),w=u>C.selectionStart;d?(s=this._text.slice(u,o),a+=o-u):n<l&&(w?s=this._text.slice(o+a,o):s=this._text.slice(u,u-a)),i=c.slice(C.selectionEnd-a,C.selectionEnd),s&&s.length&&(i.length&&(g=this.getSelectionStyles(u,u+1,!1),g=i.map(function(){return g[0]})),d?(v=u,y=o):w?(v=o-s.length,y=o):(v=o,y=o+s.length),this.removeStyleFromTo(v,y)),i.length&&(e&&i.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(g=t.copiedTextStyle),this.insertNewStyleBlock(i,u,g)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(h){this.compositionStart=h.target.selectionStart,this.compositionEnd=h.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(h){return h&&h.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(h,e){var c=this._getLineLeftOffset(h),l;return e>0&&(l=this.__charBounds[h][e-1],c+=l.left+l.width),c},getDownCursorOffset:function(h,e){var c=this._getSelectionForOffset(h,e),l=this.get2DCursorLocation(c),n=l.lineIndex;if(n===this._textLines.length-1||h.metaKey||h.keyCode===34)return this._text.length-c;var s=l.charIndex,i=this._getWidthBeforeCursor(n,s),a=this._getIndexOnLine(n+1,i),u=this._textLines[n].slice(s);return u.length+a+1+this.missingNewlineOffset(n)},_getSelectionForOffset:function(h,e){return h.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(h,e){var c=this._getSelectionForOffset(h,e),l=this.get2DCursorLocation(c),n=l.lineIndex;if(n===0||h.metaKey||h.keyCode===33)return-c;var s=l.charIndex,i=this._getWidthBeforeCursor(n,s),a=this._getIndexOnLine(n-1,i),u=this._textLines[n].slice(0,s),o=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+a-u.length+(1-o)},_getIndexOnLine:function(h,e){for(var c=this._textLines[h],l=this._getLineLeftOffset(h),n=l,s=0,i,a,u=0,o=c.length;u<o;u++)if(i=this.__charBounds[h][u].width,n+=i,n>e){a=!0;var d=n-i,g=n,v=Math.abs(d-e),y=Math.abs(g-e);s=y<v?u:u-1;break}return a||(s=c.length-1),s},moveCursorDown:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",h)},moveCursorUp:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",h)},_moveCursorUpOrDown:function(h,e){var c="get"+h+"CursorOffset",l=this[c](e,this._selectionDirection==="right");e.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),l!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(h){var e=this._selectionDirection==="left"?this.selectionStart+h:this.selectionEnd+h;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),h!==0},moveCursorWithoutShift:function(h){return h<0?(this.selectionStart+=h,this.selectionEnd=this.selectionStart):(this.selectionEnd+=h,this.selectionStart=this.selectionEnd),h!==0},moveCursorLeft:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",h)},_move:function(h,e,c){var l;if(h.altKey)l=this["findWordBoundary"+c](this[e]);else if(h.metaKey||h.keyCode===35||h.keyCode===36)l=this["findLineBoundary"+c](this[e]);else return this[e]+=c==="Left"?-1:1,!0;if(typeof l<"u"&&this[e]!==l)return this[e]=l,!0},_moveLeft:function(h,e){return this._move(h,e,"Left")},_moveRight:function(h,e){return this._move(h,e,"Right")},moveCursorLeftWithoutShift:function(h){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(h,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(h){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(h,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(h,"selectionStart")},moveCursorRight:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",h)},_moveCursorLeftOrRight:function(h,e){var c="moveCursor"+h+"With";this._currentCursorOpacity=1,e.shiftKey?c+="Shift":c+="outShift",this[c](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(h){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(h,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(h,"selectionEnd")},moveCursorRightWithoutShift:function(h){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(h,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(h,e){typeof e>"u"&&(e=h+1),this.removeStyleFromTo(h,e),this._text.splice(h,e-h),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(h,e,c,l){typeof l>"u"&&(l=c),l>c&&this.removeStyleFromTo(c,l);var n=t.util.string.graphemeSplit(h);this.insertNewStyleBlock(n,c,e),this._text=[].concat(this._text.slice(0,c),n,this._text.slice(l)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var h=t.util.toFixed,e=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var c=this._getSVGLeftTopOffsets(),l=this._getSVGTextAndBg(c.textTop,c.textLeft);return this._wrapSVGTextAndBg(l)},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(),{reviver:c,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(c){var l=!0,n=this.getSvgTextDecoration(this);return[c.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",n?'text-decoration="'+n+'" ':"",'style="',this.getSvgStyles(l),'"',this.addPaintOrder()," >",c.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(c,l){var n=[],s=[],i=c,a;this._setSVGBg(s);for(var u=0,o=this._textLines.length;u<o;u++)a=this._getLineLeftOffset(u),(this.textBackgroundColor||this.styleHas("textBackgroundColor",u))&&this._setSVGTextLineBg(s,u,l+a,i),this._setSVGTextLineText(n,u,l+a,i),i+=this.getHeightOfLine(u);return{textSpans:n,textBgRects:s}},_createTextCharSpan:function(c,l,n,s){var i=c!==c.trim()||c.match(e),a=this.getSvgSpanStyles(l,i),u=a?'style="'+a+'"':"",o=l.deltaY,d="",g=t.Object.NUM_FRACTION_DIGITS;return o&&(d=' dy="'+h(o,g)+'" '),['<tspan x="',h(n,g),'" y="',h(s,g),'" ',d,u,">",t.util.string.escapeXml(c),"</tspan>"].join("")},_setSVGTextLineText:function(c,l,n,s){var i=this.getHeightOfLine(l),a=this.textAlign.indexOf("justify")!==-1,u,o,d="",g,v,y=0,C=this._textLines[l],w;s+=i*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,O=C.length-1;S<=O;S++)w=S===O||this.charSpacing,d+=C[S],g=this.__charBounds[l][S],y===0?(n+=g.kernedWidth-g.width,y+=g.width):y+=g.kernedWidth,a&&!w&&this._reSpaceAndTab.test(C[S])&&(w=!0),w||(u=u||this.getCompleteStyleDeclaration(l,S),o=this.getCompleteStyleDeclaration(l,S+1),w=t.util.hasStyleChanged(u,o,!0)),w&&(v=this._getStyleDeclaration(l,S)||{},c.push(this._createTextCharSpan(d,v,n,s)),d="",u=o,n+=y,y=0)},_pushTextBgRect:function(c,l,n,s,i,a){var u=t.Object.NUM_FRACTION_DIGITS;c.push("		<rect ",this._getFillAttributes(l),' x="',h(n,u),'" y="',h(s,u),'" width="',h(i,u),'" height="',h(a,u),`"></rect>
`)},_setSVGTextLineBg:function(c,l,n,s){for(var i=this._textLines[l],a=this.getHeightOfLine(l)/this.lineHeight,u=0,o=0,d,g,v=this.getValueOfPropertyAt(l,0,"textBackgroundColor"),y=0,C=i.length;y<C;y++)d=this.__charBounds[l][y],g=this.getValueOfPropertyAt(l,y,"textBackgroundColor"),g!==v?(v&&this._pushTextBgRect(c,v,n+o,s,u,a),o=d.left,u=d.width,v=g):u+=d.kernedWidth;g&&this._pushTextBgRect(c,g,n+o,s,u,a)},_getFillAttributes:function(c){var l=c&&typeof c=="string"?new t.Color(c):"";return!l||!l.getSource()||l.getAlpha()===1?'fill="'+c+'"':'opacity="'+l.getAlpha()+'" fill="'+l.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(c){for(var l=0,n=0,s=0;s<c;s++)l+=this.getHeightOfLine(s);return n=this.getHeightOfLine(s),{lineTop:l,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(c){var l=t.Object.prototype.getSvgStyles.call(this,c);return l+" white-space: pre;"}})}(),function(h){var e=h.fabric||(h.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(c){for(var l=0,n=0,s=0,i={},a=0;a<c.graphemeLines.length;a++)c.graphemeText[s]===`
`&&a>0?(n=0,s++,l++):!this.splitByGrapheme&&this._reSpaceAndTab.test(c.graphemeText[s])&&a>0&&(n++,s++),i[a]={line:l,offset:n},s+=c.graphemeLines[a].length,n+=c.graphemeLines[a].length;return i},styleHas:function(c,l){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[l];n&&(l=n.line)}return e.Text.prototype.styleHas.call(this,c,l)},isEmptyStyles:function(c){if(!this.styles)return!0;var l=0,n=c+1,s,i,a=!1,u=this._styleMap[c],o=this._styleMap[c+1];u&&(c=u.line,l=u.offset),o&&(n=o.line,a=n===c,s=o.offset),i=typeof c>"u"?this.styles:{line:this.styles[c]};for(var d in i)for(var g in i[d])if(g>=l&&(!a||g<s))for(var v in i[d][g])return!1;return!0},_getStyleDeclaration:function(c,l){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[c];if(!n)return null;c=n.line,l=n.offset+l}return this.callSuper("_getStyleDeclaration",c,l)},_setStyleDeclaration:function(c,l,n){var s=this._styleMap[c];c=s.line,l=s.offset+l,this.styles[c][l]=n},_deleteStyleDeclaration:function(c,l){var n=this._styleMap[c];c=n.line,l=n.offset+l,delete this.styles[c][l]},_getLineStyle:function(c){var l=this._styleMap[c];return!!this.styles[l.line]},_setLineStyle:function(c){var l=this._styleMap[c];this.styles[l.line]={}},_wrapText:function(c,l){var n=[],s;for(this.isWrapping=!0,s=0;s<c.length;s++)n=n.concat(this._wrapLine(c[s],s,l));return this.isWrapping=!1,n},_measureWord:function(c,l,n){var s=0,i,a=!0;n=n||0;for(var u=0,o=c.length;u<o;u++){var d=this._getGraphemeBox(c[u],l,u+n,i,a);s+=d.kernedWidth,i=c[u]}return s},_wrapLine:function(c,l,n,I){var i=0,a=this.splitByGrapheme,u=[],o=[],d=a?e.util.string.graphemeSplit(c):c.split(this._wordJoiners),g="",v=0,y=a?"":" ",C=0,w=0,S=0,O=!0,M=this._getWidthOfCharSpacing(),I=I||0;d.length===0&&d.push([]),n-=I;for(var N=0;N<d.length;N++)g=a?d[N]:e.util.string.graphemeSplit(d[N]),C=this._measureWord(g,l,v),v+=g.length,i+=w+C-M,i>n&&!O?(u.push(o),o=[],i=C,O=!0):i+=M,!O&&!a&&o.push(y),o=o.concat(g),w=a?0:this._measureWord([y],l,v),v++,O=!1,C>S&&(S=C);return N&&u.push(o),S+I>this.dynamicMinWidth&&(this.dynamicMinWidth=S-M+I),u},isEndOfWrapping:function(c){return!this._styleMap[c+1]||this._styleMap[c+1].line!==this._styleMap[c].line},missingNewlineOffset:function(c){return this.splitByGrapheme?this.isEndOfWrapping(c)?1:0:1},_splitTextIntoLines:function(c){for(var l=e.Text.prototype._splitTextIntoLines.call(this,c),n=this._wrapText(l.lines,this.width),s=new Array(n.length),i=0;i<n.length;i++)s[i]=n[i].join("");return l.lines=s,l.graphemeLines=n,l},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var c={};for(var l in this._styleMap)this._textLines[l]&&(c[this._styleMap[l].line]=1);for(var l in this.styles)c[l]||delete this.styles[l]},toObject:function(c){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(c))}}),e.Textbox.fromObject=function(c,l){var n=e.util.stylesFromArray(c.styles,c.text),s=Object.assign({},c,{styles:n});return e.Object._fromObject("Textbox",s,l,"text")}}(p),function(){var h=t.controlsUtils,e=h.scaleSkewCursorStyleHandler,c=h.scaleCursorStyleHandler,l=h.scalingEqually,n=h.scalingYOrSkewingX,s=h.scalingXOrSkewingY,i=h.scaleOrSkewActionName,a=t.Object.prototype.controls;if(a.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:e,actionHandler:s,getActionName:i}),a.mr=new t.Control({x:.5,y:0,cursorStyleHandler:e,actionHandler:s,getActionName:i}),a.mb=new t.Control({x:0,y:.5,cursorStyleHandler:e,actionHandler:n,getActionName:i}),a.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:e,actionHandler:n,getActionName:i}),a.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:c,actionHandler:l}),a.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:c,actionHandler:l}),a.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:c,actionHandler:l}),a.br=new t.Control({x:.5,y:.5,cursorStyleHandler:c,actionHandler:l}),a.mtr=new t.Control({x:0,y:-.5,actionHandler:h.rotationWithSnapping,cursorStyleHandler:h.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var u=t.Textbox.prototype.controls={};u.mtr=a.mtr,u.tr=a.tr,u.br=a.br,u.tl=a.tl,u.bl=a.bl,u.mt=a.mt,u.mb=a.mb,u.mr=new t.Control({x:.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:e,actionName:"resizing"}),u.ml=new t.Control({x:-.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:e,actionName:"resizing"})}}()})(un);function lf(p){let t,r="play",f,m;return{c(){t=Pt("button"),t.textContent=r},l(_){t=It(_,"BUTTON",{"data-svelte-h":!0}),pe(t)!=="svelte-pz3q1o"&&(t.textContent=r)},m(_,T){en(_,t,T),f||(m=Xt(t,"click",p[10]),f=!0)},p:De,d(_){_&&$t(t),f=!1,m()}}}function hf(p){let t,r="stop",f,m;return{c(){t=Pt("button"),t.textContent=r},l(_){t=It(_,"BUTTON",{"data-svelte-h":!0}),pe(t)!=="svelte-c7z9s6"&&(t.textContent=r)},m(_,T){en(_,t,T),f||(m=Xt(t,"click",p[9]),f=!0)},p:De,d(_){_&&$t(t),f=!1,m()}}}function Fr(p){let t,r;return{c(){t=Pt("div"),this.h()},l(f){t=It(f,"DIV",{class:!0,style:!0}),Ue(t).forEach($t),this.h()},h(){At(t,"class","timeBar svelte-1oskexy"),At(t,"style",r=`transform: translateX(${p[7](p[1].playTime)}px)`)},m(f,m){en(f,t,m)},p(f,m){m&2&&r!==(r=`transform: translateX(${f[7](f[1].playTime)}px)`)&&At(t,"style",r)},d(f){f&&$t(t)}}}function uf(p){let t,r,f,m,_,T,h="create note at frequency",e,c,l,n,s="create note at midi",i,a,u,o,d,g,v,y,C="copy",w,S,O="paste",M,I,N="delete",L,H,U="reset",R,V,$,J,b,E;function A(x,P){return x[1].tag=="playing"?hf:lf}let D=A(p),W=D(p),k=p[1].tag=="playing"&&Fr(p);return{c(){t=Pt("div"),r=Pt("div"),W.c(),f=Ht(),m=Pt("input"),_=Ht(),T=Pt("button"),T.textContent=h,e=Ht(),c=Pt("input"),l=Ht(),n=Pt("button"),n.textContent=s,i=Ht(),a=Pt("label"),u=fr("speed "),o=fr(p[4]),d=Ht(),g=Pt("input"),v=Ht(),y=Pt("button"),y.textContent=C,w=Ht(),S=Pt("button"),S.textContent=O,M=Ht(),I=Pt("button"),I.textContent=N,L=Ht(),H=Pt("button"),H.textContent=U,R=Ht(),V=Pt("div"),k&&k.c(),$=Ht(),J=Pt("canvas"),this.h()},l(x){t=It(x,"DIV",{class:!0});var P=Ue(t);r=It(P,"DIV",{class:!0});var F=Ue(r);W.l(F),f=qt(F),m=It(F,"INPUT",{type:!0,class:!0}),_=qt(F),T=It(F,"BUTTON",{"data-svelte-h":!0}),pe(T)!=="svelte-114kfg8"&&(T.textContent=h),e=qt(F),c=It(F,"INPUT",{type:!0,class:!0}),l=qt(F),n=It(F,"BUTTON",{"data-svelte-h":!0}),pe(n)!=="svelte-179hp1u"&&(n.textContent=s),i=qt(F),a=It(F,"LABEL",{for:!0});var B=Ue(a);u=dr(B,"speed "),o=dr(B,p[4]),B.forEach($t),d=qt(F),g=It(F,"INPUT",{type:!0,id:!0,min:!0,max:!0,step:!0}),v=qt(F),y=It(F,"BUTTON",{"data-svelte-h":!0}),pe(y)!=="svelte-1gemhfw"&&(y.textContent=C),w=qt(F),S=It(F,"BUTTON",{"data-svelte-h":!0}),pe(S)!=="svelte-1ne1is4"&&(S.textContent=O),M=qt(F),I=It(F,"BUTTON",{"data-svelte-h":!0}),pe(I)!=="svelte-1sws9pr"&&(I.textContent=N),L=qt(F),H=It(F,"BUTTON",{"data-svelte-h":!0}),pe(H)!=="svelte-gaf3q0"&&(H.textContent=U),F.forEach($t),R=qt(P),V=It(P,"DIV",{class:!0});var G=Ue(V);k&&k.l(G),$=qt(G),J=It(G,"CANVAS",{width:!0,height:!0,class:!0}),Ue(J).forEach($t),G.forEach($t),P.forEach($t),this.h()},h(){At(m,"type","number"),At(m,"class","svelte-1oskexy"),At(c,"type","number"),At(c,"class","svelte-1oskexy"),At(a,"for","speed"),At(g,"type","range"),At(g,"id","speed"),At(g,"min","0.2"),At(g,"max","5"),At(g,"step","0.01"),At(r,"class","controls svelte-1oskexy"),At(J,"width",qs),At(J,"height",Hn),At(J,"class","svelte-1oskexy"),At(V,"class","contain svelte-1oskexy"),At(t,"class","top svelte-1oskexy")},m(x,P){en(x,t,P),pt(t,r),W.m(r,null),pt(r,f),pt(r,m),Ye(m,p[2]),pt(r,_),pt(r,T),pt(r,e),pt(r,c),Ye(c,p[3]),pt(r,l),pt(r,n),pt(r,i),pt(r,a),pt(a,u),pt(a,o),pt(r,d),pt(r,g),Ye(g,p[4]),pt(r,v),pt(r,y),pt(r,w),pt(r,S),pt(r,M),pt(r,I),pt(r,L),pt(r,H),pt(t,R),pt(t,V),k&&k.m(V,null),pt(V,$),pt(V,J),p[19](J),b||(E=[Xt(window,"keydown",p[12]),Xt(m,"input",p[16]),Xt(T,"click",p[13]),Xt(c,"input",p[17]),Xt(n,"click",p[14]),Xt(g,"change",p[18]),Xt(g,"input",p[18]),Xt(y,"click",p[5]),Xt(S,"click",p[6]),Xt(I,"click",p[11]),Xt(H,"click",p[8])],b=!0)},p(x,[P]){D===(D=A(x))&&W?W.p(x,P):(W.d(1),W=D(x),W&&(W.c(),W.m(r,f))),P&4&&fn(m.value)!==x[2]&&Ye(m,x[2]),P&8&&fn(c.value)!==x[3]&&Ye(c,x[3]),P&16&&ro(o,x[4]),P&16&&Ye(g,x[4]),x[1].tag=="playing"?k?k.p(x,P):(k=Fr(x),k.c(),k.m(V,$)):k&&(k.d(1),k=null)},i:De,o:De,d(x){x&&$t(t),W.d(),k&&k.d(),p[19](null),b=!1,to(E)}}}const Yn=20,Un=21,hn=108,Hn=1e3,qs=5e3,Rr=20;function Nr(p){p.set({lockScalingY:!0,lockRotation:!0,hasRotatingPoint:!1}),p.setControlsVisibility({mt:!1,mb:!1,tl:!1,tr:!1,bl:!1,br:!1,mtr:!1})}function Lr(p){var t=p.calcTransformMatrix();return{x:t[4],y:t[5]}}function ff(p,t,r){let{synth:f}=t,m,_,T=!1;function h(R,V){const $=new un.fabric.Rect({fill:"green",left:R-Yn/2,top:V-Yn/2,width:Yn,height:Yn});Nr($),_.add($),a($)}eo(()=>{_=new un.fabric.Canvas(m),_.on("mouse:down",R=>{T=!1}),_.on("mouse:move",R=>{(R.e.movementX!=0||R.e.movementY!=0)&&(T=!0)}),_.on("mouse:up",R=>{if(R.target)a(R.target);else if(!T){const V=_.getPointer(R.e),$=V.x,J=V.y;h($,J)}}),_.on("object:moving",R=>{R.target}),_.on("selection:created",R=>{let V=_.getActiveObject();Nr(V),a(V)})});let e={objects:[],rect:{y:0,x:0}};function c(){e.objects=new Array;let R=_.getActiveObject();R&&(e.rect=Lr(R),_.getActiveObjects().forEach(function(V){var $=un.fabric.util.object.clone(V);e.objects.push($)}))}function l(){if(e.objects.length>0){for(let V of e.objects)e.objects.length==1?(V.set("top",V.top),V.set("left",V.left+20)):(V.set("top",V.top+e.rect.y),V.set("left",V.left+e.rect.x+20)),_.add(V);_.discardActiveObject();var R=new un.fabric.ActiveSelection(e.objects,{canvas:_});_.setActiveObject(R)}_.renderAll()}function n(R){return R/100/I}function s(R){return R*I*100}function i(R,V,$){let J=Lr(R),b=R.getBoundingRect(),E=J.x-b.width/2;const A=J.y+b.height/2,D=Un+(1-A/Hn)*(hn-Un),W=440*Math.pow(2,(D-69)/12),k=n(b.width),x=V?n(E)-($??0):0;f.triggerAttackRelease(W,k,rf()+x)}function a(R){if(f.shutup(),R.type=="activeSelection"){let V=n(R.getBoundingRect().left);R.getObjects().forEach($=>{i($,!0,V)})}else i(R,!1)}function u(){_.clear()}let o={tag:"stopped"};function d(){f.shutup(),o.tag=="playing"&&(clearInterval(o.interval),r(1,o={tag:"stopped"}))}function g(){let R=0;return _.getObjects().forEach(V=>{const $=n(V.getBoundingRect().left),J=n(V.getBoundingRect().width);R=Math.max(R,$+J)}),R}function v(){d(),_.getObjects().forEach(V=>{i(V,!0)});let R=g();r(1,o={tag:"playing",playTime:0,interval:setInterval(()=>{o.tag!="stopped"&&(r(1,o.playTime+=Rr/1e3,o),o.playTime>Math.min(R,n(qs))&&d())},Rr)})}function y(){let R=_.getActiveObjects();R&&(_.discardActiveObject(),R.forEach(V=>{_.remove(V)}))}no(()=>{_.dispose()});function C(R){R.key=="Backspace"&&y(),R.key==" "&&(o.tag=="playing"?d():v()),R.key=="c"&&(R.ctrlKey||R.metaKey)&&c(),R.key=="v"&&(R.ctrlKey||R.metaKey)&&l()}let w=440;function S(){const R=69+12*Math.log2(w/440),V=(hn-R)/(hn-Un)*Hn;h(10,V)}let O=69;function M(){const R=(hn-O)/(hn-Un)*Hn;h(10,R)}let I=1;function N(){w=fn(this.value),r(2,w)}function L(){O=fn(this.value),r(3,O)}function H(){I=fn(this.value),r(4,I)}function U(R){io[R?"unshift":"push"](()=>{m=R,r(0,m)})}return p.$$set=R=>{"synth"in R&&r(15,f=R.synth)},[m,o,w,O,I,c,l,s,u,d,v,y,C,S,M,f,N,L,H,U]}class df extends Br{constructor(t){super(),Vr(this,t,ff,uf,jr,{synth:15})}}function pf(p){let t,r="Start",f,m;return{c(){t=Pt("button"),t.textContent=r,this.h()},l(_){t=It(_,"BUTTON",{class:!0,"data-svelte-h":!0}),pe(t)!=="svelte-nrluse"&&(t.textContent=r),this.h()},h(){At(t,"class","svelte-zbzo3r")},m(_,T){en(_,t,T),f||(m=Xt(t,"click",p[2]),f=!0)},p:De,i:De,o:De,d(_){_&&$t(t),f=!1,m()}}}function gf(p){let t,r;return t=new df({props:{synth:p[1]}}),{c(){ao(t.$$.fragment)},l(f){co(t.$$.fragment,f)},m(f,m){lo(t,f,m),r=!0},p(f,m){const _={};m&2&&(_.synth=f[1]),t.$set(_)},i(f){r||(Oi(t.$$.fragment,f),r=!0)},o(f){xi(t.$$.fragment,f),r=!1},d(f){ho(t,f)}}}function mf(p){let t,r,f,m;const _=[gf,pf],T=[];function h(e,c){return e[0]?0:1}return t=h(p),r=T[t]=_[t](p),{c(){r.c(),f=pr()},l(e){r.l(e),f=pr()},m(e,c){T[t].m(e,c),en(e,f,c),m=!0},p(e,[c]){let l=t;t=h(e),t===l?T[t].p(e,c):(oo(),xi(T[l],1,1,()=>{T[l]=null}),so(),r=T[t],r?r.p(e,c):(r=T[t]=_[t](e),r.c()),Oi(r,1),r.m(f.parentNode,f))},i(e){m||(Oi(r),m=!0)},o(e){xi(r),m=!1},d(e){e&&$t(f),T[t].d(e)}}}function _f(p,t,r){let f=!1,m;async function _(){await Ru(),r(1,m=new sf),r(0,f=!0)}return[f,m,_]}class $f extends Br{constructor(t){super(),Vr(this,t,_f,mf,jr,{})}}export{$f as component};
